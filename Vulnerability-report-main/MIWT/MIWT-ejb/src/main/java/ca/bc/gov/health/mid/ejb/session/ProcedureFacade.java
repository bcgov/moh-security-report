package ca.bc.gov.health.mid.ejb.session;

import ca.bc.gov.health.mid.ejb.entity.Procedure;
import ca.bc.gov.health.mid.ejb.entity.ProcedureRid;
import jakarta.ejb.Stateless;
import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import java.util.List;

/**
 *
 * @author CGI Information Management Consultants Inc.
 */
@Stateless
public class ProcedureFacade extends AbstractFacade<Procedure> implements ProcedureFacadeLocal {

    @PersistenceContext(unitName = "MIDPU")
    private EntityManager em;

    protected EntityManager getEntityManager() {
        return em;
    }

    public void setEntityManager(EntityManager em) {
        this.em = em;
    }

    @Override
    public void edit(Procedure entity) {
        Procedure old = find(entity.getProcedureId());
        List<ProcedureRid> rids = old.getProcedureRidList();
        for (ProcedureRid procedureRid : rids) {
            em.remove(procedureRid);
        }
        super.edit(entity);
    }

    public ProcedureFacade() {
        super(Procedure.class);
    }

    @Override
    public List<Procedure> findAllByHA(String haCode) {
        return em.createNamedQuery("Procedure.findAllByHA").setParameter("haCode", haCode).getResultList();
    }

    @Override
    public List<Procedure> findAllValid() {
        return em.createNamedQuery("Procedure.findAllValid").getResultList();
    }
}
