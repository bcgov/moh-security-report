package ca.bc.gov.health.jsf;

import jakarta.faces.application.FacesMessage;
import jakarta.faces.component.UIComponent;
import jakarta.faces.component.UIInput;
import jakarta.faces.context.FacesContext;
import jakarta.faces.validator.FacesValidator;
import jakarta.faces.validator.Validator;
import jakarta.faces.validator.ValidatorException;
import java.util.Date;
import org.primefaces.component.calendar.Calendar;


/**
 *
 * @author CGI Information Management Consultants Inc.
 */
@FacesValidator("validator.afterDate")
public class DateComparisonValidator implements Validator{

    @Override
    public void validate(FacesContext context, UIComponent component, Object value) throws ValidatorException {
        if (value == null || ((UIInput)component).getAttributes().get("beforeDate") == null) return;
        
        Date toDate   = (Date) value; 
        String componentId = (String)((UIInput)component).getAttributes().get("beforeDate");
        Date fromDate = (Date) ((Calendar)(context.getViewRoot().findComponent(componentId))).getValue();

        if (fromDate!=null && toDate.before(fromDate)) {
            String msg = "Start Date cannot be after End Date";
            if (component.getAttributes().get("message")!=null){
                msg = (String)component.getAttributes().get("message");
            }
            FacesMessage message = new FacesMessage(msg);
            message.setSeverity(FacesMessage.SEVERITY_ERROR);
            throw new ValidatorException(message);
        }
    }

    
}
