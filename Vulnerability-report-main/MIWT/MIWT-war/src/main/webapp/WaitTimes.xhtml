<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30.xhtml">
    <ui:define name="title">Medical Imaging Wait Times Reports</ui:define>
    <ui:define name="body">
        <h1>
            Wait Times Reporting
        </h1>

        <p:messages id="messages">
            <p:autoUpdate/>
        </p:messages>

        <h:form id="form1">

            <div class="instruction">
                <h2>Instructions</h2>
                Select the fields you wish to include in your report, and any
                filters you wish to apply, and click the "View Details" button to view your report.
            </div>

            <div class="columns">
                <div class="column" style="width:80%">
                    <label>
                        Snapshot
                        <span class="required">* </span>
                    </label>
                    <p:selectOneMenu value="#{WaitTimes.snapshotId}">
                        <f:selectItems value="#{Droplists.snapshots}"/>
                    </p:selectOneMenu>
                </div>

                <div class="column" style="width:40%">
                    <label>
                        From
                        <span class="required">* </span>
                    </label>
                    <p:calendar value="#{WaitTimes.startDate}" navigator="true" pattern="dd-MMM-yyyy"
                                yearRange="c-10:c"/>

                </div>
                <div class="column" style="width:40%">
                    <label>
                        To
                        <span class="required">* </span>
                    </label>
                    <p:calendar value="#{WaitTimes.endDate}" navigator="true" pattern="dd-MMM-yyyy"
                                yearRange="c-10:c"/>

                </div>
            </div>

            <table class="ui-datatable rf-dt stable">
                <thead class="ui-datatable-header">
                <tr class="rf-dt-shdr">
                    <th style="width: 25px; padding:10px;" class="ui-state-default-table">Order</th>
                    <th style="width: 130px; padding:10px;" class="ui-state-default-table">Include in report?</th>
                    <th style="width: 150px; padding:10px;" class="ui-state-default-table">Field Name</th>
                    <th style="width: auto; padding:10px;" class="ui-state-default-table">Filter</th>
                </tr>
                </thead>
                <tbody class="ui-datatable-data">
                <ui:repeat value="#{WaitTimes.criteria.filters}" var="row" varStatus="index">
                    <tr class="ui-widget-content ui-datatable-odd">
                        <td style="text-align: center">
                            <p:commandLink action="#{WaitTimes.moveUp}" update="@form messages" class="reorder">
                                <f:setPropertyActionListener target="#{WaitTimes.indexToReorder}"
                                                             value="#{index.index}"/>
                                <i class="pi pi-arrow-up"></i>
                            </p:commandLink>
                            <p:commandLink action="#{WaitTimes.moveDown}" update="@form messages" class="reorder">
                                <f:setPropertyActionListener target="#{WaitTimes.indexToReorder}"
                                                             value="#{index.index}"/>
                                <i class="pi pi-arrow-down"></i>
                            </p:commandLink>
                        </td>
                        <td style="text-align: center;">
                            <h:selectBooleanCheckbox value="#{row.includeInReport}"/>
                        </td>
                        <td>#{row.label}</td>
                        <td>
                            <ui:fragment rendered="#{row.options!=null}">
                                <h:selectManyListbox value="#{row.selectedOptions}"
                                                     size="#{row.options.size()>5?5:row.options.size()}"
                                                     style="width: 100%">
                                    <f:selectItems value="#{row.options}"/>
                                </h:selectManyListbox>
                            </ui:fragment>
                        </td>
                    </tr>
                </ui:repeat>
                </tbody>
            </table>

            <div class="buttons">
                <p:commandButton value="View Details" action="#{WaitTimes.viewDetails}"
                                 disabled="#{Snapshots.snapshots.isEmpty()}" update="@form messages results"/>
                <p:commandButton value="Clear" action="#{WaitTimes.clear}" update="@form messages" process="@this"
                                 class="secondary"/>
            </div>
            <div class="clear"></div>

            <h:panelGroup id="results" layout="block" rendered="#{WaitTimes.results ne null}" class="results">
                <h2>
                    Wait Times Result in Days
                </h2>
                <h:panelGroup layout="block" style="text-align:right">
                    <p:commandButton value="Export as CSV" icon="pi pi-download" ajax="false" >
                        <p:dataExporter type="csv" target="resultsTable"  fileName="WaitTimeReport" />
                    </p:commandButton>
                    
                </h:panelGroup>

                <p:dataTable id="resultsTable" var="row" value="#{WaitTimes.results}" >
                    <p:columns value="#{WaitTimes.columns}" var="column" columnIndexVar="index" >
                        <f:facet name="header">
                            <h:outputText value="#{column.header}"/>
                        </f:facet>
                        <h:outputText value="#{row[column.property]}"/>
                        
                    </p:columns>
                </p:dataTable>

                <div class="criteria">
                    <h3>Criteria</h3>
                    <p:dataList var="row" value="#{WaitTimes.criteria.filters}" type="definition">
                        <f:facet name="description">
                            <h:outputText value="#{row.filterDisplayTxt}" rendered="#{row.includeInReport}"/>
                        </f:facet>
                    </p:dataList>
                </div>

            </h:panelGroup>
        </h:form>
    </ui:define>
</ui:composition>