<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30Template.xhtml">
    
    <ui:define name="title">Recalculate Statistics</ui:define>
    <ui:define name="content">
        <h2>Recalculate Statistics</h2>
        <p:outputPanel>
            <p:messages id="msgs" />
            Use this page to recalculate the statistics of a yet to be published site.<br/>
            <h:outputLabel styleClass="bold">
                WARNING: When you recalculate a site, all statistics for the site will be deleted and rebuilt from the source data.
            </h:outputLabel>
            <br/>
            <h:form id="form1">
                <h:outputLabel value="Select Site:"  styleClass="bold"/>
                <h:selectOneMenu id="siteSelection"
                                 value="#{SiteCalculator.selectedSite}">
                    <f:selectItems value="#{UnpublishedSites.unpublishedSites}" />
                    <p:ajax event="change" update="form1"/>
                </h:selectOneMenu>
                <p:commandButton value="Recalculate Now"
                                   action="#{SiteCalculator.recalculateNow}"
                                   update="form1, calcs, msgs"
                                   disabled="#{!SiteCalculator.enableImmediate}"
                                   onclick="if(!confirm('Are you sure you want to recalculate site '+document.getElementById('form1:siteSelection').options[document.getElementById('form1:siteSelection').selectedIndex].value+'?')){return false;}"/>
                <p:commandButton value="Recalculate Overnight"
                                   update="form1, calcs, msgs"
                                   disabled="#{!SiteCalculator.enableOvernight}"
                                   action="#{SiteCalculator.recalculateOvernight}"
                                   onclick="if(!confirm('Are you sure you want to recalculate site '+document.getElementById('form1:siteSelection').options[document.getElementById('form1:siteSelection').selectedIndex].value+'?')){return false;}" />
            </h:form>
        </p:outputPanel>
        <p />
        <p:dataTable id="calcs" styleClass="calculations" value="#{SiteCalculator.calculations.calculations}" var="job" >
            <f:facet name="header">
                <h:outputText value="Scheduled Recalculations"/>
            </f:facet>

            <p:column headerText="Site">
                <h:outputText value="#{job.site}" />
            </p:column>
            <p:column id="type" headerText="Type">
                <h:outputText value="#{job.type}" />
            </p:column>
            <p:column id="status" headerText="Status">
                <h:outputText value="#{job.status}" />
            </p:column>
        </p:dataTable>
        <p />
        <h:outputText>** Recalculations are not allowed on the same day as the standard monthly site load.</h:outputText>
    </ui:define>
</ui:composition>
