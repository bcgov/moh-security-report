/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

function navbarCollapse(x) {
    $('.navbar-collapse').toggleClass('collapse');
    $('.dropdown-menu').toggleClass('display-block');
    x.classList.toggle('hamburger-change');
}

function onGovMenuClick() {
    $('div.navbar-government-header-button,.government-menu-close-button').on('click', toggleGov);
}
function toggleGov() {
    $('#government-menu').slideToggle(350, 'linear');
    $('div.navbar-government-header-button span').toggleClass('arrow-up arrow-down');
}

function clickNewRow() {
    jQuery('.ui-datatable-data tr').first().find('span.ui-icon-pencil').each(function(){
        jQuery(this).click();
        jQuery('.ui-cell-editor-input input').first().focus();
        window.scrollTo(0, 0);
    });
}

function confirmExit() {
    return confirm("Please confirm you want to sign out. \nThis will also end all other active Keycloak or SiteMinder sessions you have open.");
}

$(document).ready(function() {
    $('li.dropdown').mouseenter(function() {
        $(this).toggleClass('active-dropdown');
    });

    $('li.dropdown').mouseleave(function() {
        $(this).toggleClass('active-dropdown');
    });
});

// Session Management
const TIMEOUT = 1920000; // 32 MINS slightly longer than KC session timeout, 1 minute less than timeout in web.xml
const ACTIVITY_CHECK_INTERVAL = 60000; // 1 min
const MAX_TIME_REMAINING_BEFORE_GROWL = 120000; // 2 min - growl will be shown when much time is remaining in the session

$(document).ready(function() {
    $.active = false;
    $.growl = false;
    $.elapsed = 0;
    $('body').bind('click keypress', function() { $.active = true; });
    checkActivity();
    setInterval(checkActivity, ACTIVITY_CHECK_INTERVAL); // function, interval
});

function checkActivity() {
    if ($.active) {
        $.elapsed = 0;
        $.active = false;
        $.growl = false;
        PF('timeoutWarning').removeAll();
        extendSession(); // p:remoteCommand in gov30Template.xhtml
    }
    if ($.elapsed < TIMEOUT) {
        $.elapsed += ACTIVITY_CHECK_INTERVAL;

        if ($.elapsed > (TIMEOUT - MAX_TIME_REMAINING_BEFORE_GROWL) && $.growl === false) {
            PF('timeoutWarning').show([{
                "summary":"Your session is about to expire",
                "detail":"Please continue using the application to extend your session",
                "severity":"warn"}]);
            $.growl = true;
        }
    } else {
        endSession().then(() => location.reload());  
    }
}