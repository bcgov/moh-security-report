/*
 * MaintainPriorities.java
 *
 * Created on Nov 14, 2008, 9:38:49 AM
 */
package swtadminwar;

import ca.bc.gov.health.login.RoleHelper;
import ca.bc.gov.hlth.swt.entity.Priority;
import ca.bc.gov.hlth.swt.session.PriorityFacadeLocal;
import jakarta.annotation.PostConstruct;
import jakarta.ejb.EJB;
import jakarta.faces.application.FacesMessage;
import jakarta.faces.context.FacesContext;
import jakarta.faces.view.ViewScoped;
import jakarta.inject.Named;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import org.primefaces.component.datatable.DataTable;
import org.primefaces.event.RowEditEvent;

/**
 *
 * @author greg.perkins
 */
@ViewScoped
@Named("MaintainPriorities")
public class MaintainPriorities implements Serializable {

    private static final long serialVersionUID = 1L;

    @EJB
    PriorityFacadeLocal priorityFacade;

    /**
     * <p>Construct a new Page bean instance.</p>
     */
    public MaintainPriorities() {
    }

    private List<Priority> priorities;

    @PostConstruct
    public void init() {
        priorities = new ArrayList<>(priorityFacade.findAll());
    }

    public void onRowEdit(RowEditEvent event) {
        Priority newPriority = (Priority) event.getObject();
        String userName = RoleHelper.getUserName(FacesContext.getCurrentInstance());

        newPriority.setLastModifiedByNm(userName);
        newPriority.setLastModifiedOnDtm(new Date());

        if (newPriority.getStatelessTransactionNbr() == 0) {
            newPriority.setStatelessTransactionNbr(1);
            priorityFacade.create(newPriority);
        } else {
            priorityFacade.edit(newPriority);
        }
        this.priorities = new ArrayList<>(priorityFacade.findAll());
        FacesContext.getCurrentInstance().addMessage(null, new FacesMessage("Save Successful"));
    }

    public void onRowCancel(RowEditEvent event) {
        this.priorities = new ArrayList<>(priorityFacade.findAll());
    }

    public void onAddNew() {
        // go to the first page
        DataTable d = (DataTable) FacesContext.getCurrentInstance().getViewRoot().findComponent("form1:theTable");
        d.reset();
        d.setFirst(0);

        // make a blank record
        Priority newPriority = new Priority();
        String userName = RoleHelper.getUserName(FacesContext.getCurrentInstance());

        newPriority.setCreatedByNm(userName);
        newPriority.setCreatedOnDtm(new Date());
        newPriority.setEffectiveDtm(new Date());
        newPriority.setLastModifiedOnDtm(new Date());
        newPriority.setLastModifiedByNm(userName);

        this.priorities.add(0, newPriority);
    }

    public List<Priority> getPriorities() {
        return priorities;
    }

    public void setPriorities(List<Priority> priorities) {
        this.priorities = priorities;
    }
}
