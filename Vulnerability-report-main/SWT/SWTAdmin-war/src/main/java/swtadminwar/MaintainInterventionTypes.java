/*
 * MaintainInterventionTypes.java
 *
 * Created on Nov 3, 2008, 3:20:24 PM
 */
package swtadminwar;

import ca.bc.gov.health.login.RoleHelper;
import ca.bc.gov.hlth.swt.entity.InterventionType;
import ca.bc.gov.hlth.swt.session.InterventionTypeFacadeLocal;
import jakarta.annotation.PostConstruct;
import jakarta.ejb.EJB;
import jakarta.faces.application.FacesMessage;
import jakarta.faces.context.FacesContext;
import jakarta.faces.view.ViewScoped;
import jakarta.inject.Named;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.logging.Logger;
import org.primefaces.component.datatable.DataTable;
import org.primefaces.event.RowEditEvent;

/**
 * @author greg.perkins
 */
@ViewScoped
@Named("MaintainInterventionTypes")
public class MaintainInterventionTypes implements Serializable {

    private static final long serialVersionUID = 1L;

    private final Logger log = Logger.getLogger(getClass().getName());

    @EJB
    InterventionTypeFacadeLocal interventionTypeFacade;

    private List<InterventionType> interventionTypes;

    @PostConstruct
    public void init() {
        interventionTypes = new ArrayList<>(interventionTypeFacade.findAll());
    }

    public void onRowEdit(RowEditEvent event) {

        InterventionType newInterventionType = (InterventionType) event.getObject();
        String userName = RoleHelper.getUserName(FacesContext.getCurrentInstance());

        newInterventionType.setLastModifiedByNm(userName);
        newInterventionType.setLastModifiedOnDtm(new Date());

        if (newInterventionType.getStatelessTransactionNbr() == 0) {

            newInterventionType.setStatelessTransactionNbr(1);
            interventionTypeFacade.create(newInterventionType);

        } else {
            interventionTypeFacade.edit(newInterventionType);
        }
        this.interventionTypes = new ArrayList<>(interventionTypeFacade.findAll());
        FacesContext.getCurrentInstance().addMessage(null, new FacesMessage("Save Successful"));
    }

    public void onRowCancel(RowEditEvent event) {
//        InterventionType newInterventionType = (InterventionType)event.getObject();
//        if (newInterventionType.getStatelessTransactionNbr() == 0) {
//            this.interventionTypes.remove(newInterventionType);
//        }
        this.interventionTypes = new ArrayList<>(interventionTypeFacade.findAll());
    }

    public void onAddNew() {
        // go to the first page
        DataTable d = (DataTable) FacesContext.getCurrentInstance().getViewRoot().findComponent("form1:theTable");
        d.reset();
        d.setFirst(0);

        // make a blank record
        InterventionType newInterventionType = new InterventionType();
        String userName = RoleHelper.getUserName(FacesContext.getCurrentInstance());

        newInterventionType.setCreatedByNm(userName);
        newInterventionType.setCreatedOnDtm(new Date());
        newInterventionType.setEffectiveDtm(new Date());
        newInterventionType.setLastModifiedOnDtm(new Date());
        newInterventionType.setLastModifiedByNm(userName);

        this.interventionTypes.add(0, newInterventionType);
    }

    public List<InterventionType> getInterventionTypes() {
        return interventionTypes;
    }

    public void setInterventionTypes(List<InterventionType> interventionTypes) {
        this.interventionTypes = interventionTypes;
    }
}
