/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package swtwar;

import ca.bc.gov.hlth.swt.entity.InterventionType;
import ca.bc.gov.hlth.swt.entity.RollupProcedureGroup;
import ca.bc.gov.hlth.swt.entity.Site;
import ca.bc.gov.hlth.swt.session.InterventionTypeFacadeLocal;
import ca.bc.gov.hlth.swt.session.RollupProcedureGroupFacadeLocal;
import ca.bc.gov.hlth.swt.session.SiteFacadeLocal;
import jakarta.annotation.PostConstruct;
import jakarta.ejb.EJB;
import jakarta.faces.view.ViewScoped;
import jakarta.inject.Named;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 *
 * @author trevor.schiavone
 */
@ViewScoped
@Named
public class FindByProcedure implements Serializable {

    private static final long serialVersionUID = 1L;

    private static final String ADULT = "Adult";
    private static final String PED = "Pediatric";

    private final String HEAD = "Head & Neck";
    private final String CHEST = "Chest & Breast";
    private final String ABDOMEN = "Abdomen, Pelvic Area, & Groin";
    private final String ARMS = "Arms, Shoulders & Hands";
    private final String LEGS = "Leg, Hip, Knee, & Foot";
    private final String SPINE = "Back & Spine";
    private final String FULL = "Full Body";

    private final Map<String, String> bodyPartMap = new HashMap<>();

    {
        bodyPartMap.put(HEAD, "HN");
        bodyPartMap.put(CHEST, "CB");
        bodyPartMap.put(ABDOMEN, "APG");
        bodyPartMap.put(ARMS, "ASH");
        bodyPartMap.put(LEGS, "LHKF");
        bodyPartMap.put(SPINE, "BB");
        bodyPartMap.put(FULL, "FB");

    }

    private String dialogPage;
    private String age;
    private String bodyArea;
    private String interventionType;

    private Site site;

    private List<RollupProcedureGroup> procedures;
    private List<InterventionType> interventionTypes;

    @EJB
    private SiteFacadeLocal siteFacade;
    @EJB
    private RollupProcedureGroupFacadeLocal rollupProcGroupFacade;
    @EJB
    private InterventionTypeFacadeLocal interventionTypeFacade;

    @PostConstruct
    public void init() {
        site = siteFacade.findCurrent();
        interventionTypes = new ArrayList<>();
        procedures = new ArrayList<>();
    }

    public void updateBodyAreaAndInterventionTypes(String bodyArea) {
        this.bodyArea = bodyArea;
        String bodyAreaCode = bodyPartMap.get(bodyArea);
        if (bodyAreaCode != null) {
            interventionTypes = interventionTypeFacade.findByBodyPartCd(bodyAreaCode);
        } else {
            interventionTypes = interventionTypeFacade.findByBodyPartCd(bodyPartMap.get(HEAD));
        }
        Collections.sort(interventionTypes);
        for (int i = 0; i < interventionTypes.size(); i++) {

            InterventionType interType = interventionTypes.get(i);
            if (interventionTypes.get(i).getInterventionTypeDsc().contains("Other Common Surgeries")) {
                interventionTypes.remove(i);
                interventionTypes.add(interType);
            }
        }
    }

    public void updateItvnTypeAndProcedures(String interventionTypeDesc, String interventionTypeCd) {
        this.interventionType = interventionTypeDesc;
        procedures = rollupProcGroupFacade.findByInterventionTypeBodyPartAndAge(site.getSiteId(), interventionTypeCd, bodyPartMap.get(bodyArea), ADULT.equals(age) ? "Y" : "N");
        Collections.sort(procedures);
    }

    public String getSpriteId() {
        switch (bodyArea) {
            case HEAD:
                return "sprite-head";
            case CHEST:
                return "sprite-chest";
            case ARMS:
                return "sprite-arms";
            case LEGS:
                return "sprite-legs";
            case ABDOMEN:
                return "sprite-abdomen";
            default:
                return "";
        }
    }

    public void setDialogPage(String dialogPage) {
        this.dialogPage = dialogPage;
    }

    public String getDialogPage() {
        return this.dialogPage;
    }

    public String getAge() {
        return age;
    }

    public void setAge(String age) {
        this.age = age;
    }

    public String getBodyArea() {
        return bodyArea;
    }

    public void setBodyArea(String bodyArea) {
        this.bodyArea = bodyArea;
    }

    public String getInterventionType() {
        return interventionType;
    }

    public void setInterventionType(String interventionType) {
        this.interventionType = interventionType;
    }

    public List<RollupProcedureGroup> getProcedures() {
        return procedures;
    }

    public List<InterventionType> getInterventionTypes() {
        return interventionTypes;
    }

    public static String getADULT() {
        return ADULT;
    }

    public static String getPED() {
        return PED;
    }

    public String getHEAD() {
        return HEAD;
    }

    public String getCHEST() {
        return CHEST;
    }

    public String getABDOMEN() {
        return ABDOMEN;
    }

    public String getARMS() {
        return ARMS;
    }

    public String getLEGS() {
        return LEGS;
    }

    public String getSPINE() {
        return SPINE;
    }

    public String getFULL() {
        return FULL;
    }
}
