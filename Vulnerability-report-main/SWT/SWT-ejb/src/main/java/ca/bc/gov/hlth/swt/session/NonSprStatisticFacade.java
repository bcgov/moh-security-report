/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.hlth.swt.session;

import ca.bc.gov.hlth.swt.entity.NonSprDataEntry;
import ca.bc.gov.hlth.swt.entity.NonSprStatistic;
import jakarta.ejb.Stateless;
import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import java.util.List;

/**
 *
 * @author greg.perkins
 */
@Stateless
public class NonSprStatisticFacade implements NonSprStatisticFacadeLocal {

    @PersistenceContext(unitName = "SWT-ejbPU")
    private EntityManager em;

    @Override
    public void create(NonSprStatistic nonSprStatistic) {
        em.persist(nonSprStatistic);
    }

    @Override
    public NonSprStatistic edit(NonSprStatistic nonSprStatistic) {
        return em.merge(nonSprStatistic);
    }

    @Override
    public void remove(NonSprStatistic nonSprStatistic) {
        em.remove(em.merge(nonSprStatistic));
    }

    @Override
    public Integer remove(NonSprDataEntry nonSprDataEntry) {
        return em.createNativeQuery("DELETE FROM SWT_NON_SPR_STATISTIC WHERE NON_SPR_DATA_ENTRY_ID = ?1")
                .setParameter(1, nonSprDataEntry.getNonSprDataEntryId())
                .executeUpdate();
    }

    @Override
    public NonSprStatistic find(Object id) {
        return em.find(ca.bc.gov.hlth.swt.entity.NonSprStatistic.class, id);
    }

    @Override
    public List<NonSprStatistic> findAll() {
        return em.createQuery("select object(o) from NonSprStatistic as o").getResultList();
    }

    @Override
    public List<NonSprStatistic> findByDataEntryId(Long nonSprDataEntryId) {
        return em.createNativeQuery("SELECT s.* FROM  SWT_NON_SPR_STATISTIC s, SWT_ROLLUP_FACILITY rf , SWT_ROLLUP_SURGEON rs, SWT_ROLLUP_PRIORITY rp WHERE s.NON_SPR_DATA_ENTRY_ID = ?1 AND rf.ROLLUP_FACILITY_ID(+) = s.ROLLUP_FACILITY_ID AND rs.ROLLUP_SURGEON_ID(+) = s.ROLLUP_SURGEON_ID AND rp.ROLLUP_PRIORITY_ID(+) = s.ROLLUP_PRIORITY_ID ORDER BY rf.FACILITY_NM,rs.SURGEON_LAST_NM,rp.SORT_ORDER_NBR,rp.PRIORITY_DSC", NonSprStatistic.class)
                .setParameter(1, nonSprDataEntryId)
                .getResultList();
    }

}
