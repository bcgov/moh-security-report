/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.hlth.swt.session;

import ca.bc.gov.hlth.swt.entity.InterventionType;
import jakarta.ejb.Stateless;
import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import java.util.List;

/**
 *
 * @author greg.perkins
 */
@Stateless
public class InterventionTypeFacade implements InterventionTypeFacadeLocal {

    @PersistenceContext(unitName = "SWT-ejbPU")
    private EntityManager em;

    @Override
    public void create(InterventionType interventionType) {
        em.persist(interventionType);
    }

    @Override
    public InterventionType edit(InterventionType interventionType) {
        return em.merge(interventionType);
    }

    @Override
    public void remove(InterventionType interventionType) {
        em.remove(em.merge(interventionType));
    }

    @Override
    public InterventionType find(Object id) {
        return em.find(ca.bc.gov.hlth.swt.entity.InterventionType.class, id);
    }

    @Override
    public InterventionType findByCode(String code) {
        return (InterventionType) em.createQuery("select object(o) from InterventionType o where o.interventionTypeCd='" + code + "'").getSingleResult();
    }

    @Override
    public List<InterventionType> findAll() {
        return em.createNativeQuery("select o.* from swt_Intervention_Type o order by DECODE(o.expiry_Dtm,null,1,2), o.sort_Order_Nbr NULLS FIRST, o.intervention_Type_Cd, o.intervention_Type_Dsc", InterventionType.class).getResultList();
    }

    @Override
    public List<InterventionType> findAllNonExpired() {
        return em.createNativeQuery("select o.* from swt_Intervention_Type o where o.expiry_dtm is null order by o.sort_Order_Nbr NULLS FIRST, o.intervention_Type_Cd, o.intervention_Type_Dsc", InterventionType.class).getResultList();
    }

    @Override
    public List<InterventionType> findByBodyPartCd(String bodyPartCode) {
        return em.createNativeQuery("select distinct o.* from swt_intervention_type o "
                + "inner join swt_procedure_group pg on O.INTERVENTION_TYPE_CD = PG.INTERVENTION_TYPE_CD "
                + //    Disabling Radiotherapy      WHERE O.INTERVENTION_TYPE_CD <> 'RADIO'
                "inner join swt_procgroup_bodypart pgbp on pg.procedure_group_id = pgbp.procedure_group_id  and pgbp.body_part_cd = '" + bodyPartCode + "'"
                + " WHERE O.INTERVENTION_TYPE_CD <> 'RADIO'",
                 InterventionType.class).getResultList();
    }

}
