/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.moh.addrvalidation.converter;

import java.io.IOException;
import java.io.InputStream;
import java.util.Properties;

/**
 *
 * @author killian.faussart
 */
public class StatusCodeValueMapper {
    
    private static final String STATUS_MAP_FILE = "statusMap.properties";
    private static final String CODE = ".CODE";
    private static final String MESSAGE = ".MESSAGE";
    private static final String UNMAPPED_CODE = "UNMAPPED ERROR CODE";
    
    private static final Properties statusMapProperties = new Properties();
    private static ClassLoader classloader;
    private static InputStream is;
    
    public StatusCodeValueMapper() throws IOException {
        classloader = Thread.currentThread().getContextClassLoader();
        is = classloader.getResourceAsStream(STATUS_MAP_FILE);
        statusMapProperties.load(is);
    }

    /**
     * Takes an AddressDoctor (OnPremises) status code and returns the
     * corresponding AddressDoctor (SOAP Web Service) status code
     *
     * @param statusCode Code coming from the ONPREMISES AddressDoctor API
     * @return
     */
    public String[] mapAddressDoctorStatusCode(int statusCode) {        
        return mapAddressDoctorStatusCode(statusCode,null);
    }
    
    /**
     * Takes an AddressDoctor (OnPremises) status code and returns the
     * corresponding AddressDoctor (SOAP Web Service) status code
     *
     * @param statusCode Code coming from the ONPREMISES AddressDoctor API
     * @param statusMessage Message coming from the ONPREMISES AddressDoctor API, if any
     * @return
     */
    public String[] mapAddressDoctorStatusCode(int statusCode, String statusMessage) {
        
        String[] mappedStatus;
        String statusCodeStr = String.valueOf(statusCode);
        
        if (statusMapProperties.containsKey(statusCodeStr.concat(CODE))) {            
            
            mappedStatus = new String[]{statusMapProperties.getProperty(statusCodeStr.concat(CODE)), 
                statusMapProperties.getProperty(statusCodeStr.concat(MESSAGE))};            
            
        } else {
              mappedStatus = new String[]{statusCodeStr,statusMessage != null ? statusMessage : UNMAPPED_CODE};          
        }
        
        return mappedStatus;
    }
    
}
