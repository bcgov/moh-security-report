/*
 * *********************************************************************************************************************
 *  Copyright (c) 2017, Ministry of Health, BC.                                                 *
 *                                                                                                                     *
 *  All rights reserved.                                                                                               *
 *    This information contained herein may not be used in whole                                                       *
 *    or in part without the express written consent of the                                                            *
 *    Government of British Columbia, Canada.                                                                          *
 *                                                                                                                     *
 *  Revision Control Information                                                                                       *
 *  File:                $Id::                                                                                       $ *
 *  Date of Last Commit: $Date::                                                                                     $ *
 *  Revision Number:     $Rev::                                                                                      $ *
 *  Last Commit by:      $Author::                                                                                   $ *
 *                                                                                                                     *
 * *********************************************************************************************************************
 */
package ca.bc.gov.moh.addrvalidation.audit;

import ca.bc.gov.moh.esb.util.audit.entity.Transaction;
import ca.bc.gov.moh.esb.util.audit.entity.TransactionEvent;
import javax.annotation.Resource;
import javax.ejb.LocalBean;
import javax.ejb.Stateless;
import javax.ejb.TransactionAttribute;
import javax.ejb.TransactionAttributeType;
import javax.inject.Inject;
import javax.jms.JMSConnectionFactory;
import javax.jms.JMSContext;
import javax.jms.JMSProducer;
import javax.jms.ObjectMessage;
import javax.jms.Queue;

/**
 * This class is a message driven bean that takes a newly created Transaction 
 * object and puts it on the JMS queue
 * 
 * @author joshua.burton
 */
@Stateless
@LocalBean
@TransactionAttribute(TransactionAttributeType.REQUIRES_NEW)
public class AddressValidationProducer {

    @Resource(mappedName = "jms/addrValQueue")
    private Queue addrValQueue;

    @Inject
    @JMSConnectionFactory("jms/addrValQueueFactory")
    private JMSContext context;

    public void sendJMSMessageToAddrValQueue(Transaction transaction) {
        ObjectMessage message = context.createObjectMessage(transaction);
        JMSProducer jmsProducer = context.createProducer();
        jmsProducer.send(addrValQueue, message);
    }
    
    public void sendJMSMessageToAddrValQueue(TransactionEvent event) {
        ObjectMessage message = context.createObjectMessage(event);
        JMSProducer jmsProducer = context.createProducer();
        jmsProducer.send(addrValQueue, message);
    }
}
