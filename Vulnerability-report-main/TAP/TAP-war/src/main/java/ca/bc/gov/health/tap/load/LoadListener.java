/*******************************************************************************
 * Copyright Â© 2015, Province of British Columbia.                             *
 *                                                                             *
 * All rights reserved.                                                        *
 *                                                                             *
 * File:                        LoadListener.java                              *
 * Date of Last Commit: $Date::                                              $ *
 * Revision Number:      $Rev::                                              $ *
 * Last Commit by:    $Author::                                              $ *
 *                                                                             *
 *******************************************************************************/

package ca.bc.gov.health.tap.load;

import ca.bc.gov.health.tap.load.config.ConfigException;
import ca.bc.gov.health.tap.load.util.BatchJobAutoStarter;
import ca.bc.gov.health.tap.session.LoadFacadeLocal;
import com.jcraft.jsch.JSchException;
import jakarta.ejb.EJB;
import jakarta.servlet.ServletContextEvent;
import jakarta.servlet.ServletContextListener;

/**
 * ContextListener to start the load process
 *
 * Looks up values from JNDI entries, and schedules the process to run at regular intervals
 *
 * @author Adebiyi.Kuseju
 */
public class LoadListener implements ServletContextListener {

    @EJB
    private LoadFacadeLocal loadFacade;
    private BatchJobAutoStarter batchJobAutoStarter;

    @Override
    public void contextInitialized(ServletContextEvent sce) {

        try {
            batchJobAutoStarter = new BatchJobAutoStarter(loadFacade, sce.getServletContext());
        } catch (ConfigException | JSchException ex) {
            throw new RuntimeException(ex);
        }
    }

    @Override
    public void contextDestroyed(ServletContextEvent sce) {
        batchJobAutoStarter.destroy();
    }
}
