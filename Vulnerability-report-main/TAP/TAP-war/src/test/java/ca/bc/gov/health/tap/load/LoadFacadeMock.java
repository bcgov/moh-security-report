/*******************************************************************************
 * Copyright Â© 2015, Province of British Columbia.                             *
 *                                                                             *
 * All rights reserved.                                                        *
 *                                                                             *
 * File:                        LoadFacadeMock.java                            *
 * Date of Last Commit: $Date::                                              $ *
 * Revision Number:      $Rev::                                              $ *
 * Last Commit by:    $Author::                                              $ *
 *                                                                             *
 *******************************************************************************/

/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.tap.load;

import ca.bc.gov.health.tap.session.LoadFacade;
import java.io.BufferedReader;
import java.io.FileReader;
import java.util.List;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

/**
 *
 * @author adebiyi.kuseju
 */
public class LoadFacadeMock extends LoadFacade {

    public int getRecordCount() {
        ApplicationContext context = new ClassPathXmlApplicationContext("test-application.xml");
        SftpClientMock SftpClient = (SftpClientMock) context.getBean("sftpClientMock");

        int count = 0;
        try (BufferedReader reader = new BufferedReader(new FileReader(SftpClient.fetch()))){

            String t;

            while ((t = reader.readLine()) != null) {

                if (!t.startsWith("TAP APPROVALS")) {
                    count++;
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }


        return count;
    }

    @Override
    public void loadRows(final String loadid, final List<Object[]> rows, long loaded) throws Exception {
    }

    @Override
    public int processDuplicates() {
        return 0;
    }

    @Override
    public int getDuplicatesCount() {
        return 0;
    }

    @Override
    public void createDuplicateCountEntry(String new_load_id, long duplicatesCount) {
    }

    public void emptyTable() {
    }
}
