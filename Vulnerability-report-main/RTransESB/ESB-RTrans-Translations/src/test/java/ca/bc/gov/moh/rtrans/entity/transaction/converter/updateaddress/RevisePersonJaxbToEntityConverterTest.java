/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.moh.rtrans.entity.transaction.converter.updateaddress;

import ca.bc.gov.moh.rtrans.entity.SystemResponse;
import ca.bc.gov.moh.rtrans.entity.transaction.RevisePersonResponse;
import ca.bc.gov.moh.rtrans.entity.transaction.converter.DataTypeConverter;
import ca.bc.gov.moh.rtrans.entity.transaction.converter.parent.JaxbToEntityTypeConverter;
import ca.bc.gov.moh.rtrans.entity.transaction.converter.reviseperson.RevisePersonJaxbToEntityTypeConverter;
import java.util.Date;
import java.util.List;
import javax.xml.bind.JAXBException;
import org.hl7.v3.HCIMINPersonRevisedResult;
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;
import org.junit.Test;

/**
 *
 * @author trevor.schiavone
 */
public class RevisePersonJaxbToEntityConverterTest extends JaxbToEntityTypeConverter {
    
    @Test
    public void testRPv3ToEntity() throws JAXBException {
        
        HCIMINPersonRevisedResult rpV3Respons = UpdateAddressUtils.createSuccessfulV3RevisePersonResponse();
        RevisePersonResponse rpResponseEntity = RevisePersonJaxbToEntityTypeConverter.convert(rpV3Respons);
        
        //These are the only fields used for the conversion to the HAPI message everything else is pulled from the original request
        assertEquals(rpResponseEntity.getMessageId(), "20060206100749");
        Date creationTime = DataTypeConverter.convertStringToDate("20170817140210.91");
        assertEquals(rpResponseEntity.getCreationTime(), creationTime);
        
        List<SystemResponse> systemResponses = rpResponseEntity.getSystemResponse();
        SystemResponse systemResponse = systemResponses.get(0);       
        assertEquals("BCHCIM.RP.0.0001", systemResponse.getCode());
        assertEquals("The Revise Person Request has been processed, and an existing PHN was found.", systemResponse.getCodeText());

    }
    
}
