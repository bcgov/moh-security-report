<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xmlns:jee="http://www.springframework.org/schema/jee"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
           http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-3.2.xsd
           http://camel.apache.org/schema/spring
           http://camel.apache.org/schema/spring/camel-spring.xsd
           http://www.springframework.org/schema/jee 
           http://www.springframework.org/schema/jee/spring-jee-3.2.xsd
           http://www.springframework.org/schema/tx
           http://www.springframework.org/schema/tx/spring-tx-3.2.xsd">
          
    <import resource="classpath:META-INF/cxf/cxf.xml" />
    <import resource="classpath:haEnvironmentSpecific.xml"/>  
    
    <bean id="haValueMapperConfig" class="ca.bc.gov.moh.rtrans.util.converter.HaValueMapperConfiguration" />
    <bean id="healthAuthorityValueMapper" class="ca.bc.gov.moh.rtrans.entity.transaction.converter.HealthAuthorityValueMapper"/>
    <bean id="haValueMapConfigProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
        <property name="location" value="classpath:haValueMapConfig.properties"/>
    </bean>
    
    <!-- This isn't used by ha, but it is referred to by applicationContext.xml
    so something needs to be here -->
    <routeContext id="customRoutes" xmlns="http://camel.apache.org/schema/spring">
        <route id="placeholder">
            <from uri="direct:placeholder"/>
            <to uri="log:placeholderroute?level=DEBUG"/>
        </route>      
    </routeContext>
	   
    <context:component-scan base-package="ca.bc.gov.moh" />
    <camelContext xmlns="http://camel.apache.org/schema/spring" handleFault="true">
        <contextScan />
        <jmxAgent id="agent" createConnector="true" serviceUrlPath="camel1"/>
        <!--<jmxAgent id="agent" createConnector="true" serviceUrlPath="rtrans-jmx"/>-->
        <!-- custom routes NEEDS to be set up in deployFlavourSpecific.xml in sub module -->
        <routeContextRef ref="customRoutes"/>
    </camelContext>
    
    <tx:annotation-driven />
 
    <bean id="persistenceExceptionTranslationPostProcessor"
          class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor" />
    
    <bean id="healthAuthorityMessageFilter" class="ca.bc.gov.moh.rtrans.ha.service.HealthAuthorityMessageFilter"/>
    
    <!-- JMS queue connection factory and destination resolver -->
    <!--<bean id="jmsDestinationResolver" class="org.springframework.jms.support.destination.JndiDestinationResolver"/>-->

    <!-- Spring JMS transaction policy and manager -->
<!--    <bean id="jmsTransactionManager" class="org.springframework.transaction.jta.JtaTransactionManager"/>
    <bean id="jmsTransactionPolicy" class="org.apache.camel.spring.spi.SpringTransactionPolicy">
        <property name="transactionManager" ref="jmsTransactionManager"/>
        <property name="propagationBehaviorName" value="PROPAGATION_REQUIRED"/>
    </bean>-->
    <!--<bean id="jmsTransactionManager" class="org.springframework.jms.connection.JmsTransactionManager">
        <property name="connectionFactory" ref="rtransQueueFactory"/>
    </bean>-->
    
    
<!--    <jee:jndi-lookup id="rtransQueueFactory" jndi-name="jms/rtransQueueFactory"/>
    
    <bean id="rtransQueueFactoryProxy" class="org.springframework.jms.connection.TransactionAwareConnectionFactoryProxy">
        <property name="targetConnectionFactory" ref="rtransQueueFactory"/>
    </bean>
    
     Camel queue configurations 
    <bean id="jmsRtransQueueConfig" class="org.apache.camel.component.jms.JmsConfiguration">
        <property name="connectionFactory" ref="rtransQueueFactoryProxy"/>
        <property name="destinationResolver" ref="jmsDestinationResolver"/>
        <property name="transacted" value="true"/>
        <property name="transactionManager" ref="jmsTransactionManager"/>
    </bean>
    
     Camel queue component 
    <bean id="rtransQueue" class="org.apache.camel.component.jms.JmsComponent">
        <property name="configuration" ref="jmsRtransQueueConfig"/>
    </bean>-->
</beans>

