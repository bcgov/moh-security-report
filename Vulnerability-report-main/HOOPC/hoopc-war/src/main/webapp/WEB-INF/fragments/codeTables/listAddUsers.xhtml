<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    
    <!--BCMOHAD-10234-22Mar22: Surrounding the label with div tag.-->
    <div class="ui-g-8">
    <h1 style="display: inline-flex">HOOPC Users</h1>
    </div>
    
    <!--BCMOHAD-10234-22Mar22: Placing checkbox to update the data table to display active users.-->
    <div class="ui-g-2" style="text-align: right; margin-left: 100px;">
        <p style="display: inline-flex; margin-right: 5px;">Active Users</p>
        
            <p:selectBooleanCheckbox id="activeUsers" value="#{UsersBean.activeUsers}">
                <p:ajax event="change" update="allUsers"/>
            </p:selectBooleanCheckbox>

    </div> 
    <p:commandButton id="openAddUser" value="Add User"
                     update="@form" process="@this" resetValues="true"
                     action="#{UsersBean.clearUser}"
                     oncomplete="PF('addDialog').show();" global="false"
                     style="float: right" />

    <!--BCMOHAD-10234-23Mar22: displaying the active users upon checking the checkbox -->
    <p:dataTable id="allUsers" var="result" value="#{UsersBean.allUsers}"  
                 selectionMode="single" selection="#{user}" sortBy="#{result.lastName}"
                 rowKey="#{result.id}" rowStyleClass="#{UsersBean.hideExpiredUsers(UsersBean.isActiveUsers(), result.accessEndDate)}">

        <p:ajax event="rowSelect" update="@form" resetValues="true" />

        <p:column headerText="LAST NAME" width="20%" sortBy="#{result.lastName}">
            <h:outputText value="#{result.lastName}"/>
        </p:column>

        <p:column headerText="FIRST NAME" width="15%" sortBy="#{result.firstName}">
            <h:outputText  value="#{result.firstName}" />
        </p:column>

        <p:column headerText="PHONE" sortBy="#{result.phoneNumber}">
            <h:outputText  value="#{result.phoneNumber}" />
        </p:column>

        <p:column headerText="EMAIL" width="25%" sortBy="#{result.emailAddress}">
            <h:outputText  value="#{result.emailAddress}" />
        </p:column>
            
        <p:column headerText="USER ID" sortBy="#{result.applicationUserid}">
            <h:outputText  value="#{result.applicationUserid}" />
        </p:column>
        
        <p:column headerText="End Date" sortBy="#{result.accessEndDate}">
            <h:outputText  value="#{result.accessEndDate}" />
        </p:column>        
    </p:dataTable>

    <p:dialog id="addDialog" widgetVar="addDialog" showHeader="false" closable="false"
        resizable="false" modal="true" width="900" closeOnEscape="true">

        <p:messages id="addUserMsg" closable="true"/>
        <h1>Add User</h1>

        <p:outputPanel id="addUserPanel" class="ui-g" >
            <f:event listener="#{UsersValidator.validate}" type="postValidate" />
            <div class="ui-g-4">
                <p:outputLabel for="userId" value="HOOPC User Id"/>
                <p:inputText id="userId" value="#{user.applicationUserid}" required="true"
                             validator="#{UsersValidator.validateDuplicateUser}"/>
            </div>
            <div class="ui-g-4">
                <p:outputLabel for="firstName" value="First Name"/>
                <p:inputText id="firstName" value="#{user.firstName}" required="true" />
            </div>
            <div class="ui-g-4">
                <p:outputLabel for="lastName" value="Last Name"/>
                <p:inputText id="lastName" value="#{user.lastName}" required="true" />
            </div>

            <div class="ui-g-4">
                <p:outputLabel for="applicationRole" value="Application Role" />
                <h:selectOneMenu id="applicationRole" value="#{user.applicationRole}" required="true">
                    <f:selectItem itemLabel="Select" itemValue="" noSelectionOption="true" />
                    <f:selectItem itemLabel="Ministry User" itemValue="MINISTRY" />
                    <f:selectItem itemLabel="Hospital User" itemValue="HOSPITAL" />
                </h:selectOneMenu>
            </div>
            <div class="ui-g-4">
                <p:outputLabel for="effectiveDate" value="Effective Date"/>
                <span class="date-pattern">(YYYYMMDD)</span>
                <p:calendar id="effectiveDate" required="true"
                            value="#{user.accessEffectiveDate}"
                            pattern="yyyyMMdd" navigator="true">
                    <f:converter converterId="localDateConverter"/>
                </p:calendar>                        
            </div>
            <div class="ui-g-4">
                <p:outputLabel for="endDate" value="End Date"/>
                <span class="date-pattern">(YYYYMMDD)</span>
                <p:calendar id="endDate"
                            value="#{user.accessEndDate}"
                            pattern="yyyyMMdd" navigator="true">
                    <f:converter converterId="localDateConverter"/>
                </p:calendar>                        
            </div>

            <div class="ui-g-4">
                <p:outputLabel for="email" value="Email" />
                <p:inputText id="email" value="#{user.emailAddress}"/>
            </div>
            <!--BCMOHAD-10199-1Mar22: Removing the mask pattern on phone number to accept it as text. -->
            <div class="ui-g-4">
                <p:outputLabel for="phoneNumber" value="Phone Number" />
                <p:inputText id="phoneNumber" value="#{user.phoneNumber}"/>
            </div>
            <!--BCMOHAD-10199-1Mar22: Removing the mask pattern on fax number to accept it as text.-->
            <div class="ui-g-4">
                <p:outputLabel for="fax" value="Fax" />
	            <p:inputText id="fax" value="#{user.faxNumber}"/>
            </div>
        </p:outputPanel>
        
        <div class="ui-g submit-buttons">
            <div class="ui-g-12" >
                <p:commandButton id="addUser" styleClass="submit-button"
                        update="addUserPanel addUserMsg" value="Submit" process="addDialog"
                        oncomplete="window.scrollTo(0,0);"
                        action="#{UsersBean.addUser}" />

                <p:button id="cancelAdd" value="Cancel" styleClass="secondary-button"
                        onclick="PF('addDialog').hide(); return false;" />
            </div>
        </div>

    </p:dialog>    
    
                    
</ui:composition>