<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <div class="ui-g submit-buttons">
        <div class="ui-g-12">

            <!-- In order to handle validation in the same tab and produce the PDF reports in a separate tab we use two buttons.
             Button 1 submits the form which triggers form validation if this passes we use JS to 'click' the second button
             Button 2 generates the reports in a new tab, it is invisible and only used by the JS when the form validation is passed
             CSV Reports don't onpen in browser, they're downloaded so they don't have the same issue-->
            <p:commandButton id="PDFValidation" value="Generate PDF"
                             styleClass="submit-button" action="#{bean.dummyAction}" update="@form"
                             oncomplete="window.scrollTo(0,0); if (args &amp;&amp; !args.validationFailed) { handlePDFValidationSuccessful() }"/>

            <p:commandButton id="generatePDF"
                             action="#{bean.runReportPDF()}"
                             update="@form" ajax="false" onclick="target='_blank'"
                             oncomplete="window.scrollTo(0,0);" style="display: none;"/>

            <p:commandButton id="generateCSV" value="Generate CSV"
                             styleClass="submit-button" action="#{bean.runReportCSV()}"
                             update="@form" ajax="false"
                             oncomplete="window.scrollTo(0,0);" />
        </div>
    </div>

    <script>
        function handlePDFValidationSuccessful() {
            document.getElementById('reportForm:generatePDF').click();
        }
    </script>
</ui:composition>