<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
        
    <h1>#{user.firstName} #{user.lastName}</h1>
    <p:outputPanel id="userInfoPanel">
        <f:event listener="#{UsersValidator.validate}" type="postValidate" />
        <div class="ui-g" >
            <div class="ui-g-3">
                <p:outputLabel for="editUserId" value="HOOPC User Id" styleClass="disabled"/>
                <p:inputText id="editUserId" value="#{user.applicationUserid}" disabled="true"/>
            </div>
            <div class="ui-g-3">
                <p:outputLabel for="editFirstName" value="First Name"/>
                <p:inputText id="editFirstName" value="#{user.firstName}" required="true" />
            </div>
            <div class="ui-g-3">
                <p:outputLabel for="editLastName" value="Last Name"/>
                <p:inputText id="editLastName" value="#{user.lastName}" required="true" />
            </div>
        </div>

        <div class="ui-g">
            <div class="ui-g-3">
                <p:outputLabel for="editApplicationRole" value="Application Role" />
                <h:selectOneMenu id="editApplicationRole" value="#{user.applicationRole}" required="true">
                    <f:selectItem itemLabel="Select" itemValue="" noSelectionOption="true" />
                    <f:selectItem itemLabel="Ministry User" itemValue="MINISTRY" />
                    <f:selectItem itemLabel="Hospital User" itemValue="HOSPITAL" />
                </h:selectOneMenu>
            </div>
            <div class="ui-g-3">
                <p:outputLabel for="editEffectiveDate" value="Effective Date"/>
                <span class="date-pattern">(YYYYMMDD)</span>
                <p:calendar id="editEffectiveDate" required="true"
                            value="#{user.accessEffectiveDate}"
                            pattern="yyyyMMdd" navigator="true" 
                            rendered="#{not UsersBean.effectiveDateReadOnly}">
                    <f:converter converterId="localDateConverter"/>
                </p:calendar>               
                <p:inputText id="editEffectiveDate2" 
                	rendered="#{UsersBean.effectiveDateReadOnly}" 
                	value="#{user.accessEffectiveDate}" readonly="true">
                    <f:converter converterId="localDateConverter"/>
                </p:inputText>         
            </div>
            <div class="ui-g-3">
                <p:outputLabel for="editEndDate" value="End Date"/>
                <span class="date-pattern">(YYYYMMDD)</span>
                <p:calendar id="editEndDate"
                            value="#{user.accessEndDate}"
                            pattern="yyyyMMdd" navigator="true">
                    <f:converter converterId="localDateConverter"/>
                </p:calendar>                        
            </div>
        </div>

        <div class="ui-g">
            <div class="ui-g-3">
                <p:outputLabel for="editEmail" value="Email" />
                <p:inputText id="editEmail" value="#{user.emailAddress}"/>
            </div>
            <!--BCMOHAD-10199-1Mar22: Removing the mask pattern on phone number to accept it as text.-->
            <div class="ui-g-3">
                <p:outputLabel for="editPhoneNumber" value="Phone Number" />
                <p:inputText id="editPhoneNumber" value="#{user.phoneNumber}"/>
            </div>
            <!--BCMOHAD-10199-1Mar22: Removing the mask pattern on fax number to accept it as text.-->
            <div class="ui-g-3">
                <p:outputLabel for="editFax" value="Fax" />
	        <p:inputText id="editFax" value="#{user.faxNumber}"/>
            </div>
        </div>
        <div class="ui-g submit-buttons">
            <div class="ui-g-12" >
                <p:commandButton id="editUser" styleClass="submit-button"
                        update="@form" value="Submit" process="userInfoPanel"
                        oncomplete="window.scrollTo(0,0);"
                        action="#{UsersBean.editUser}"/>
            </div>
        </div>        
    </p:outputPanel>


    <p:commandButton id="openAddAuth" value="Add Hospital Authorization"
                     update="@form" process="@this" resetValues="true"  
                     action="#{UsersBean.clearUserAuth}" rendered="#{user.applicationRole eq 'HOSPITAL'}"
                     oncomplete="PF('authDialog').show();" global="false"
                     style="float: right; display: inline-flex" />

    <p:dataTable id="userAuths" var="result" value="#{user.appUserAuthorizationsList}" rendered="#{user.applicationRole eq 'HOSPITAL'}" 
                 selectionMode="single" selection="#{UsersBean.userAuthorization}" sortBy="#{result.hspId.hospitalNumber}"
                 rowKey="#{result.id}" rowStyleClass="ui-datatable-row">

        <f:facet name="header"><h:outputText value="HOSPITAL AUTHORIZATIONS"/></f:facet>
        <p:ajax event="rowSelect" update="@form" resetValues="true" oncomplete="PF('authDialog').show();" />

        <p:column headerText="HOSPITAL NAME" width="20%" sortBy="#{result.hspId.hospitalNumber}">
            <h:outputText value="#{result.hspId.hospitalNumber}-#{result.hspId.name}"/>
        </p:column>

        <p:column headerText="EFFECTIVE DATE" width="20%" sortBy="#{result.effectiveDate}">
            <h:outputText  value="#{result.effectiveDate}" />
        </p:column>

        <p:column headerText="END DATE" sortBy="#{result.endDate}">
            <h:outputText  value="#{result.endDate}" />
        </p:column>
    </p:dataTable>                          

    <p:dialog id="authDialog" widgetVar="authDialog" showHeader="false" closable="false"
        resizable="false" modal="true" width="400" closeOnEscape="true">               

        <p:messages id="authMsg" closable="true" styleClass="short-message-box"/>
        <h1><h:outputText value="#{UsersBean.userAuthorization.id eq null ? 'Add Hospital Authorization'
                                    : 'Edit Hospital Authorization'}"/></h1>

        <p:outputPanel id="authPanel" class="ui-g" >
            <f:event listener="#{UsersValidator.validate}" type="postValidate" />
            <h:inputHidden id="authUserId" value="#{user.applicationUserid}" />
                           
            <div class="ui-g-10">
                <p:outputLabel for="authHospitalName" value="Hospital Name"
                               styleClass="#{UsersBean.userAuthorization.id ne null ? 'disabled' : ''}"/>
                <h:selectOneMenu id="authHospitalName" value="#{UsersBean.userAuthorization.hspId}"
                                 required="#{UsersBean.userAuthorization.id eq null}" converter="HospitalConverter"
                                 disabled="#{UsersBean.userAuthorization.id ne null}">
                    <f:selectItem itemLabel="Select" itemValue="" noSelectionOption="true" />
                    <f:selectItems value="#{ApplicationBean.hospitalsListBC}" var="hospital"
                                   itemLabel="#{hospital.hospitalNumber}-#{hospital.name}"
                                   itemValue="#{hospital}" />
                </h:selectOneMenu>
            </div>
            <div class="ui-g-10">
                <p:outputLabel for="authEffectiveDate" value="Effective Date"/>
                <span class="date-pattern">(YYYYMMDD)</span>
                <p:calendar id="authEffectiveDate" required="true"
                            value="#{UsersBean.userAuthorization.effectiveDate}"
                            pattern="yyyyMMdd" navigator="true">
                    <f:converter converterId="localDateConverter"/>
                </p:calendar>                        
            </div>
            <div class="ui-g-10">
                <p:outputLabel for="authEndDate" value="End Date"/>
                <span class="date-pattern">(YYYYMMDD)</span>
                <p:calendar id="authEndDate"
                            value="#{UsersBean.userAuthorization.endDate}"
                            pattern="yyyyMMdd" navigator="true">
                    <f:converter converterId="localDateConverter"/>
                </p:calendar>                        
            </div>                
        </p:outputPanel>

        <div class="ui-g submit-buttons">
            <div class="ui-g-12" >
                <p:commandButton id="addEditUserAuth" styleClass="submit-button"
                        update="authPanel authMsg" value="Submit" process="authDialog"
                        oncomplete="window.scrollTo(0,0);"
                        action="#{UsersBean.editUser}" />

                <p:button id="cancelAddEditUserAuth" value="Cancel" styleClass="secondary-button"
                        onclick="PF('authDialog').hide(); return false;" />
            </div>
        </div>

    </p:dialog>
                    
</ui:composition>