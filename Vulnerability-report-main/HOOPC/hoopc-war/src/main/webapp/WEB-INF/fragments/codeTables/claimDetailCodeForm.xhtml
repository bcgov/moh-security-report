<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<h:form id="codeForm">

		<p:commandButton value="Delete" process="@this" update="@form"
			id="deleteSeleniumCodeButton"
			action="#{ClaimDetailCodeBean.deleteSeleniumTestCode}"
			styleClass="danger" style="display: none;margin-left:20px;"
			oncomplete="window.scrollTo(0,0);" />

		<p:messages id="messages" closable="true" />

        <div class="ui-g-8">
		<h1 style="display: inline-flex">
			<c:if test="#{viewId eq 'newbornProcedure.xhtml'}">Newborn Code</c:if>
			<c:if test="#{viewId eq 'serviceCode.xhtml'}">Service Code</c:if>
		</h1>
        </div>
        <!--BCMOHAD-10489-31Mar22: Active codes label and checkbox-->

        <div class="ui-g-2" style="text-align: right; margin-left: 40px;">
            <p style="display: inline-flex; margin-right: 3px;">Active Codes</p>
                <p:selectBooleanCheckbox id="activeServiceCodes" value="#{ClaimDetailCodeBean.activeServiceCodes}">
                    <p:ajax event="change" update="allCodes"/>
                </p:selectBooleanCheckbox>
        </div>

		<p:commandButton id="openAddCodeButton"
			value="#{viewId eq 'newbornProcedure.xhtml' ? 'Add Newborn Code' : 'Add Service Code'}"
			update="@form" process="@this" resetValues="true"
			action="#{ClaimDetailCodeBean.clearCode}"
			oncomplete="PF('addDialog').show();" global="false"
			style="float: right" />
        <!-- BCMOHAD-10489-1Apr22: marking the inactive code rows in grey  -->
		<p:dataTable id="allCodes" var="codeRow"
			value="#{ClaimDetailCodeBean.allCodes}" selectionMode="single"
			selection="#{claimDetailCode}" rowKey="#{codeRow.id}"
                     sortBy="#{codeRow.codeValue}" rowStyleClass="#{ClaimDetailCodeBean.hideExpiredCodes(ClaimDetailCodeBean.isActiveServiceCodes(),
                               ClaimDetailCodeBean.mostRecentRatesNDates(codeRow.serviceRatesList, 'END DATE'))}">
                               

			<p:ajax event="rowSelect" update="@form" resetValues="true"
				listener="#{ClaimDetailCodeBean.onRowSelect}"
				oncomplete="PF('editDialog').show();" global="false" />

			<p:column width="15%"
				headerText="#{viewId eq 'newbornProcedure.xhtml' ? 'NEWBORN CODE' : 'CODE'}"
				sortBy="#{codeRow.codeValue}">
				<h:outputText value="#{codeRow.codeValue}" />
			</p:column>
			<p:column
				headerText="#{viewId eq 'newbornProcedure.xhtml' ? 'SHORT DESCRIPTION' : 'DESCRIPTION'}"
				sortBy="#{codeRow.shortDescription}">
				<h:outputText value="#{codeRow.shortDescription}" />
			</p:column>
			<p:column headerText="LONG DESCRIPTION"
				sortBy="#{codeRow.longDescription}"
				rendered="#{viewId eq 'newbornProcedure.xhtml'}">
				<h:outputText value="#{codeRow.longDescription}" />
			</p:column>
			<p:column
				headerText="#{viewId eq 'newbornProcedure.xhtml' ? 'MULTIPLE BIRTH' : 'DUPLICATE ALLOWED'}"
				sortBy="#{codeRow.duplicateAllowedInd}">
				<h:outputText
					value="#{codeRow.duplicateAllowedInd eq 'Y' ? 'Yes' : 'No'}" />
			</p:column>
            <!--BCMOHAD-10489-29MAR22: added 3 new columns such as Current rate, Effective date and End date to the code table with most recent values -->
            <p:column headerText="CURRENT RATE"
                      sortBy="#{ClaimDetailCodeBean.mostRecentRatesNDates(codeRow.serviceRatesList, 'CURRENT RATE')}">
                <h:outputText value="#{ClaimDetailCodeBean.mostRecentRatesNDates(codeRow.serviceRatesList, 'CURRENT RATE')}"/>
            </p:column>
            
            <p:column headerText="EFFECTIVE DATE" 
                      sortBy="#{ClaimDetailCodeBean.mostRecentRatesNDates(codeRow.serviceRatesList, 'EFFECTIVE DATE')}">
                <h:outputText value="#{ClaimDetailCodeBean.mostRecentRatesNDates(codeRow.serviceRatesList, 'EFFECTIVE DATE')}"/>
            </p:column> 
            
            <p:column headerText="END DATE" 
                      sortBy="#{ClaimDetailCodeBean.mostRecentRatesNDates(codeRow.serviceRatesList, 'END DATE')}">
                <h:outputText value="#{ClaimDetailCodeBean.mostRecentRatesNDates(codeRow.serviceRatesList, 'END DATE')}"/>
            </p:column>
		</p:dataTable>

		<p:dialog id="addDialog" widgetVar="addDialog" showHeader="false"
			closable="false" resizable="false" modal="true" width="900"
			closeOnEscape="true">

			<p:messages id="addCodeMsg" closable="true" />
			<h1>
				<c:if test="#{viewId eq 'newbornProcedure.xhtml'}">Add Newborn Code</c:if>
				<c:if test="#{viewId eq 'serviceCode.xhtml'}">Add Service Code</c:if>
			</h1>

			<p:outputPanel id="addDialogPanel" class="ui-g">
				<f:event listener="#{ClaimDetailCodeValidator.validate}"
					type="postValidate" />

				<div class="ui-g-4">
					<p:outputLabel for="code"
						value="#{viewId eq 'newbornProcedure.xhtml' ? 'Newborn Code' : 'Code'}" />
					<p:inputText id="code" value="#{claimDetailCode.codeValue}"
						required="true"
						validator="#{ClaimDetailCodeValidator.validateDuplicate}" />
				</div>
				<div class="ui-g-8">
					<p:outputLabel for="shortDescription"
						value="#{viewId eq 'newbornProcedure.xhtml' ? 'Short Description' : 'Description'}" />
					<p:inputText id="shortDescription"
						value="#{claimDetailCode.shortDescription}" required="true" />
				</div>
				<br />
				<h:panelGroup class="ui-g-12" layout="block"
					rendered="#{viewId eq 'newbornProcedure.xhtml'}">
					<p:outputLabel for="longDescription" value="Long Description" />
					<p:inputText id="longDescription"
						value="#{claimDetailCode.longDescription}" />
				</h:panelGroup>
				<br />
				<div class="ui-g-12">
					<p:outputLabel for="duplicateAllowedInd"
						value="#{viewId eq 'newbornProcedure.xhtml' ? 'Multiple Birth' : 'Duplicate Allowed'}" />
					<p:selectOneRadio id="duplicateAllowedInd"
						value="#{claimDetailCode.duplicateAllowedInd}" required="true">
						<f:selectItem itemLabel="Yes" itemValue="Y" />
						<f:selectItem itemLabel="No" itemValue="N" />
					</p:selectOneRadio>
				</div>
				<div class="ui-g">
					<div class="ui-g-4">
						<p:outputLabel for="rateAmount" value="Rate Amount" />
						<p:inputText id="rateAmount" required="true"
							value="#{ClaimDetailCodeBean.serviceRate.rateAmount}" />
					</div>
					<div class="ui-g-4">
						<p:outputLabel for="effectiveDate" value="Effective Date" />
						<span class="date-pattern">(YYYYMMDD)</span>
						<p:calendar id="effectiveDate" required="true"
							value="#{ClaimDetailCodeBean.serviceRate.effectiveDate}"
							pattern="yyyyMMdd" navigator="true">
							<f:converter converterId="localDateConverter" />
						</p:calendar>
					</div>
					<div class="ui-g-4">
						<p:outputLabel for="endDate" value="End Date" />
						<span class="date-pattern">(YYYYMMDD)</span>
						<p:calendar id="endDate"
							value="#{ClaimDetailCodeBean.serviceRate.endDate}"
							pattern="yyyyMMdd" navigator="true">
							<f:converter converterId="localDateConverter" />
						</p:calendar>
					</div>
				</div>
			</p:outputPanel>
			<div class="ui-g submit-buttons" style="margin: 20px 0px 10px 0px;">
				<div class="ui-g-12">
					<p:commandButton id="addCodeButton" styleClass="submit-button"
						update="addDialogPanel addCodeMsg" value="Submit"
						process="addDialog" oncomplete="window.scrollTo(0,0);"
						action="#{ClaimDetailCodeBean.saveCode}" />

					<p:button id="cancelAdd" value="Cancel"
						styleClass="secondary-button"
						onclick="PF('addDialog').hide(); return false;" />
				</div>
			</div>
		</p:dialog>

		<p:dialog id="editDialog" widgetVar="editDialog" showHeader="false"
			closable="false" resizable="false" modal="true" width="900"
			closeOnEscape="true">

			<p:messages id="editCodeMsg" closable="true" />
			<h1>
				<c:if test="#{viewId eq 'newbornProcedure.xhtml'}">Edit Newborn Code</c:if>
				<c:if test="#{viewId eq 'serviceCode.xhtml'}">Edit Service Code</c:if>
			</h1>

			<p:outputPanel id="editDialogPanel" class="ui-g"
				style="max-height: 800px">

				<f:event listener="#{ClaimDetailCodeValidator.validate}"
					type="postValidate" />

				<div class="ui-g-4">
					<p:outputLabel for="editCode" styleClass="disabled"
						value="#{viewId eq 'newbornProcedure.xhtml' ? 'Newborn Code' : 'Code'}" />
					<p:inputText id="editCode" value="#{claimDetailCode.codeValue}"
						disabled="true" required="true" />
				</div>
				<div class="ui-g-8">
					<p:outputLabel for="editShortDescription"
						value="#{viewId eq 'newbornProcedure.xhtml' ? 'Short Description' : 'Description'}" />
					<p:inputText id="editShortDescription"
						value="#{claimDetailCode.shortDescription}" required="true" />
				</div>
				<br />
				<h:panelGroup class="ui-g-8" layout="block"
					rendered="#{viewId eq 'newbornProcedure.xhtml'}">
					<p:outputLabel for="editLongDescription" value="Long Description" />
					<p:inputText id="editLongDescription"
						value="#{claimDetailCode.longDescription}" />
				</h:panelGroup>
				<br />
				<div
					class="#{viewId eq 'newbornProcedure.xhtml' ? 'ui-g-4' : 'ui-g-12'}">
					<p:outputLabel for="editDuplicateAllowedInd"
						value="#{viewId eq 'newbornProcedure.xhtml' ? 'Multiple Birth' : 'Duplicate Allowed'}" />
					<p:selectOneRadio id="editDuplicateAllowedInd"
						value="#{claimDetailCode.duplicateAllowedInd}" required="true">
						<f:selectItem itemLabel="Yes" itemValue="Y" />
						<f:selectItem itemLabel="No" itemValue="N" />
					</p:selectOneRadio>
				</div>

				<div class="ui-g-4">
					<p:outputLabel for="editNewRateAmount" value="New Rate Amount" />
					<p:inputText id="editNewRateAmount"
						onblur="addRequiredAsteriskToCodeTableRates('codeForm')"
						value="#{ClaimDetailCodeBean.serviceRate.rateAmount}" />
				</div>
				<div class="ui-g-4">
					<p:outputLabel for="editNewRateEffectiveDate"
						value="Effective Date" />
					<span class="date-pattern">(YYYYMMDD)</span>
					<p:calendar id="editNewRateEffectiveDate"
						value="#{ClaimDetailCodeBean.serviceRate.effectiveDate}"
						pattern="yyyyMMdd" navigator="true"
						onblur="addRequiredAsteriskToCodeTableRates('codeForm');">
						<p:ajax event="dateSelect" global="false"
							oncomplete="addRequiredAsteriskToCodeTableRates('codeForm'); return false;" />
						<f:converter converterId="localDateConverter" />
					</p:calendar>
				</div>
				<div class="ui-g-4" style="margin-bottom: 25px">
					<p:outputLabel for="editRateEndDate" value="End Date" />
					<span class="date-pattern">(YYYYMMDD)</span>
					<p:calendar id="editRateEndDate"
						value="#{ClaimDetailCodeBean.serviceRate.endDate}"
						pattern="yyyyMMdd" navigator="true">
						<f:converter converterId="localDateConverter" />
					</p:calendar>
				</div>

				<div class="ui-g-4">
					<p:outputLabel for="editPrevRateAmount" value="Rate 1 Amount" />
					<p:inputText id="editPrevRateAmount" required="true"
						value="#{claimDetailCode.serviceRatesList[0].rateAmount}" />
				</div>
				<div class="ui-g-4">
					<p:outputLabel for="editPrevRateEffectiveDate"
						value="Effective Date" />
					<span class="date-pattern">(YYYYMMDD)</span>
					<p:calendar id="editPrevRateEffectiveDate" required="true"
						value="#{claimDetailCode.serviceRatesList[0].effectiveDate}"
						pattern="yyyyMMdd" navigator="true">
						<f:converter converterId="localDateConverter" />
					</p:calendar>
				</div>
				<div class="ui-g-4">
					<p:outputLabel for="editPrevRateEndDate" value="End Date" />
					<span class="date-pattern">(YYYYMMDD)</span>
					<p:calendar id="editPrevRateEndDate"
						value="#{claimDetailCode.serviceRatesList[0].endDate}"
						pattern="yyyyMMdd" navigator="true">
						<f:converter converterId="localDateConverter" />
					</p:calendar>
				</div>

				<ui:repeat var="codeRate"
					value="#{claimDetailCode.serviceRatesList}" varStatus="status"
					offset="1"
					size="#{claimDetailCode.serviceRatesList.size() gt 4 ? 4 : claimDetailCode.serviceRatesList.size()}">
					<div class="ui-g-4">
						<p:outputLabel for="editRateAmount"
							value="Rate #{status.index + 1} Amount" />
						<p:inputText id="editRateAmount" value="#{codeRate.rateAmount}"
							required="true" />
					</div>
					<div class="ui-g-4">
						<p:outputLabel for="editRateEffectiveDate" value="Effective Date" />
						<span class="date-pattern">(YYYYMMDD)</span>
						<p:calendar id="editRateEffectiveDate"
							value="#{codeRate.effectiveDate}" pattern="yyyyMMdd"
							navigator="true" required="true">
							<f:converter converterId="localDateConverter" />
						</p:calendar>
					</div>
					<div class="ui-g-4">
						<p:outputLabel for="editRateEndDate" value="End Date" />
						<span class="date-pattern">(YYYYMMDD)</span>
						<p:calendar id="editRateEndDate" value="#{codeRate.endDate}"
							pattern="yyyyMMdd" navigator="true">
							<f:converter converterId="localDateConverter" />
						</p:calendar>
					</div>
				</ui:repeat>
			</p:outputPanel>

			<div class="ui-g submit-buttons row"
				style="margin: 20px 0px 10px 0px;">
				<div class="ui-g-12">
					<p:commandButton id="editCodeButton" styleClass="submit-button"
						update="editDialogPanel editCodeMsg" value="Submit"
						process="editDialog" oncomplete="window.scrollTo(0,0);"
						action="#{ClaimDetailCodeBean.saveCode}" />

					<p:button id="cancelEdit" value="Cancel"
						styleClass="secondary-button"
						onclick="PF('editDialog').hide(); return false;" />

				</div>
			</div>
		</p:dialog>
	</h:form>
</ui:composition>
