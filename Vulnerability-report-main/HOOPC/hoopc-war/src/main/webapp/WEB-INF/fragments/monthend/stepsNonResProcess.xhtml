<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <p:outputLabel styleClass="reportMonthEndBold" style="display:block;" 
                   value="STEP 1: PROCESS CLAIMS AND ADJUSTMENTS" />

    <p:commandButton id="monthendStep1" value="Schedule Month End" onclick="clearMessages()"
                     styleClass="submit-button" action="#{bean.scheduleMonthend('NRES')}"
                     update="@form" oncomplete="window.scrollTo(0,0);" 
                     style="margin-top:10px;display:block;"/>

    <p:outputLabel styleClass="reportMonthEndBold" style="display:block;" 
                   value="STEP 2: OBTAIN APPROVAL FOR MONTH END" />

    <p:commandButton id="monthendStep2" value="Payment Requisition PDF" 
                     styleClass="submit-button" action="#{bean.setApproval()}"
                     update="@form" onclick="clearMessages()"
                     oncomplete="window.scrollTo(0,0); if (args &amp;&amp; !args.validationFailed) { handlePDFValidationSuccessful('generatePDFStep2') }"
                     style="margin-top:10px;display:block;" />

    <p:commandButton id="generatePDFStep2"
                     update="@form" ajax="false" onclick="target = '_blank';"
                     oncomplete="window.scrollTo(0,0);" style="display: none;">
        <p:fileDownload value="#{bean.showReports('reconciliation_report.pdf')}" contentDisposition="inline"/>
    </p:commandButton>
    

    <p:outputLabel styleClass="reportMonthEndBold" style="display:block;"
                   value="STEP 3: DISTRIBUTE AND PRINT MONTH END REPORTS TO THE PROVINCE AND HEALTH AUTHORITIES" />

    <p:commandButton id="monthendStep3" value="Complete Month End Report PDF" 
                     styleClass="submit-button" action="#{bean.distributeMonthendReports()}"
                     update="@form" onclick="clearMessages()"
                     oncomplete="window.scrollTo(0,0); if (args &amp;&amp; !args.validationFailed) { handlePDFValidationSuccessful('generatePDFStep3') }"
                     style="margin-top:10px;display:block;"/>

    <p:commandButton id="generatePDFStep3"
                     update="@form" ajax="false" onclick="target = '_blank';"
                     oncomplete="window.scrollTo(0,0);" style="display: none;">
        <p:fileDownload value="#{bean.showReports('monthendReports.pdf')}" contentDisposition="inline"/>
    </p:commandButton>

    <p:commandButton  id="monthendCancel"
                      value="Cancel Month End" styleClass="submit-button danger"
                      action="#{bean.cancelMonthend('NRES')}" update="@form" 
                      oncomplete="window.scrollTo(0,0);" onclick="clearMessages()"
                      style="margin-top:20px;display:block;"/>
    
    <script>
        function handlePDFValidationSuccessful(commandButton) {
            document.getElementById('reportForm:' + commandButton).click();
        }
    </script>
</ui:composition>