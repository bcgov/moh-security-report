<!DOCTYPE html>
<ui:composition template="/WEB-INF/templates/gov30Template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:define name="title">Invoices Received</ui:define>

    <ui:define name="content">
        <script type="text/javascript">
            function updateAddDialogPanel() {
                updateAmounts('inpatClaimAmount', 'inpatClaimAdjustAmount',
                        'inpatClaimTotalAmount', 'outpatClaimAmount',
                        'outpatClaimAdjustAmount', 'outpatClaimTotalAmount',
                        'invoiceTotal');
            }
            function updateEditDialogPanel() {
                updateAmounts('editInpatClaimAmount',
                        'editInpatClaimAdjustAmount',
                        'editInpatClaimTotalAmount', 'editOutpatClaimAmount',
                        'editOutpatClaimAdjustAmount',
                        'editOutpatClaimTotalAmount', 'editInvoiceTotal');
            }

            function updateAmounts(elemInpatClaimAmount,
                    elemInpatClaimAdjAmount, elemInpatTotal,
                    elemOutpatClaimAmount, elemOutpatClaimAdjAmount,
                    elemOutpatTotal, elemInvoiceTotal) {

                // Get the values
                var inpatClaimAmount = $(
                        "input[id*='" + elemInpatClaimAmount + "']").val();
                var inpatClaimAdjustAmount = $(
                        "input[id*='" + elemInpatClaimAdjAmount + "']").val();
                var inpatTotal = $("input[id*='" + elemInpatTotal + "']").val();
                var outpatClaimAmount = $(
                        "input[id*='" + elemOutpatClaimAmount + "']").val();
                var outpatClaimAdjustAmount = $(
                        "input[id*='" + elemOutpatClaimAdjAmount + "']").val();
                var outpatTotal = $("input[id*='" + elemOutpatTotal + "']")
                        .val();
                var invoiceTotal = $("input[id*='" + elemInvoiceTotal + "']")
                        .val();

                // Format values
                if (isNaN(inpatClaimAmount) || inpatClaimAmount == "") {
                    inpatClaimAmount = "0";
                }
                if (isNaN(inpatClaimAdjustAmount)
                        || inpatClaimAdjustAmount == "") {
                    inpatClaimAdjustAmount = "0";
                }
                if (isNaN(outpatClaimAmount) || outpatClaimAmount == "") {
                    outpatClaimAmount = "0";
                }
                if (isNaN(outpatClaimAdjustAmount)
                        || outpatClaimAdjustAmount == "") {
                    outpatClaimAdjustAmount = "0";
                }
                if (isNaN(invoiceTotal) || invoiceTotal == "") {
                    invoiceTotal = "0";
                }

                // Convert values to float with two decimal digits
                inpatClaimAmount = parseFloat(inpatClaimAmount).toFixed(2);
                inpatClaimAdjustAmount = parseFloat(inpatClaimAdjustAmount)
                        .toFixed(2);
                outpatClaimAmount = parseFloat(outpatClaimAmount).toFixed(2);
                outpatClaimAdjustAmount = parseFloat(outpatClaimAdjustAmount)
                        .toFixed(2);
                invoiceTotal = parseFloat(invoiceTotal).toFixed(2);

                // Calculate totals
                var inpatTotal = inpatClaimAmount - inpatClaimAdjustAmount;
                inpatTotal.toFixed(2);
                var outpatTotal = outpatClaimAmount - outpatClaimAdjustAmount;
                outpatTotal.toFixed(2);

                // Reassign the values to the fields
                $("input[id*='" + elemInpatClaimAmount + "']").val(
                        inpatClaimAmount);
                $("input[id*='" + elemInpatClaimAdjAmount + "']").val(
                        inpatClaimAdjustAmount);
                $("input[id*='" + elemInpatTotal + "']").val(inpatTotal);

                $("input[id*='" + elemOutpatClaimAmount + "']").val(
                        outpatClaimAmount);
                $("input[id*='" + elemOutpatClaimAdjAmount + "']").val(
                        outpatClaimAdjustAmount);
                $("input[id*='" + elemOutpatTotal + "']").val(outpatTotal);

                $("input[id*='" + elemInvoiceTotal + "']").val(invoiceTotal);

            }
        </script>

        <ui:include src="/WEB-INF/fragments/navTabs/adminTabs.xhtml" />

        <ui:include
            src="/WEB-INF/fragments/administration/invoiceReceivedListForm.xhtml" />

        <h:form id="adminForm">
            <p:dialog id="addDialog" widgetVar="addDialog" showHeader="false"
                      closable="false" resizable="false" modal="true" width="900"
                      closeOnEscape="true" style="max-height:900px">

                <p:outputPanel id="addDialogPanel" style="max-height:800px">

                    <p:messages id="addMsg" escape="false" closable="true" />
                    <h1>Add Invoice</h1>

                    <div class="ui-g">
                        <div class="ui-g-4">
                            <p:outputLabel for="number" value="Invoice #" />
                            <p:inputText id="number"
                                         value="#{InvoicesReceivedBean.invoice.invoice}" required="true"
                                         validator="#{InvoicesReceivedValidator.validateDuplicate}" />
                        </div>

                        <div class="ui-g-4">
                            <p:outputLabel for="invoiceTotal" value="Invoice Total ($)" />
                            <p:inputText id="invoiceTotal" required="true"
                                         value="#{InvoicesReceivedBean.invoiceTotal}"
                                         onblur="updateAddDialogPanel()" />
                        </div>

                        <div class="ui-g-4">
                            <p:outputLabel for="invoiceDate" value="Invoice Date" />
                            <span class="date-pattern">(YYYYMMDD)</span>
                            <p:calendar id="invoiceDate"
                                        value="#{InvoicesReceivedBean.invoice.invoiceDate}"
                                        pattern="yyyyMMdd" navigator="true" required="true"
                                        maxlength="8">
                                <f:converter converterId="localDateConverter" />
                            </p:calendar>
                        </div>

                    </div>

                    <div class="ui-g">
                        <div class="ui-g-4">
                            <p:outputLabel for="invoiceReceived" value="Date Received" />
                            <span class="date-pattern">(YYYYMMDD)</span>
                            <p:calendar id="invoiceReceived"
                                        value="#{InvoicesReceivedBean.invoice.invoiceReceived}"
                                        pattern="yyyyMMdd" navigator="true" required="true"
                                        maxlength="8">
                                <f:converter converterId="localDateConverter" />
                            </p:calendar>
                        </div>
                        <div class="ui-g-4">
                            <p:outputLabel for="provincialBillingDate"
                                           value="Provincial Billing Date" />
                            <span class="date-pattern">(YYYYMMDD)</span>
                            <p:calendar id="provincialBillingDate"
                                        value="#{InvoicesReceivedBean.invoice.provincialBillingPeriod}"
                                        pattern="yyyyMMdd" navigator="true" required="true"
                                        maxlength="8">
                                <f:converter converterId="localDateConverter" />
                            </p:calendar>
                        </div>
                        <div class="ui-g-4">
                            <p:outputLabel for="billingPeriod" value="Processing Month" />
                            <span class="date-pattern">(YYYYMM)</span>
                            <p:inputText id="billingPeriod"
                                         value="#{InvoicesReceivedBean.invoice.ibpId.periodCode}"
                                         required="true" maxlength="6" />
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 35px;">
                        <h2>INPATIENTS</h2>
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <p:outputLabel for="inpatClaimNumber" value="Number of Claims" />
                                <p:inputText id="inpatClaimNumber"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[0].invoiceQuantity}" />
                            </div>
                        </div>
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <p:outputLabel for="inpatClaimAmount" value="Claim Amount ($)" />
                                <p:inputText id="inpatClaimAmount"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[0].invoiceAmount}"
                                             onblur="updateAddDialogPanel()" />
                            </div>
                            <div class="ui-g-4">
                                <p:outputLabel for="inpatClaimAdjustAmount"
                                               value="- Adjustments Amount ($)" />
                                <p:inputText id="inpatClaimAdjustAmount"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[0].reductionAmount}"
                                             onblur="updateAddDialogPanel()" />
                            </div>
                            <div class="ui-g-4">
                                <p:outputLabel for="inpatClaimTotalAmount" value="Total ($)" />
                                <p:inputText id="inpatClaimTotalAmount" disabled="true"
                                             value="#{InvoicesReceivedBean.calculateTotalAmounts('inpatTotal')}" />
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 35px;">
                        <h2>OUTPATIENTS</h2>
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <p:outputLabel for="outpatClaimNumber" value="Number of Claims" />
                                <p:inputText id="outpatClaimNumber"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[1].invoiceQuantity}" />
                            </div>
                        </div>
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <p:outputLabel for="outpatClaimAmount" value="Claim Amount ($)" />
                                <p:inputText id="outpatClaimAmount"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[1].invoiceAmount}"
                                             onblur="updateAddDialogPanel()" />
                            </div>
                            <div class="ui-g-4">
                                <p:outputLabel for="outpatClaimAdjustAmount"
                                               value="- Adjustments Amount ($)" />
                                <p:inputText id="outpatClaimAdjustAmount"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[1].reductionAmount}"
                                             onblur="updateAddDialogPanel()" />
                            </div>
                            <div class="ui-g-4">
                                <p:outputLabel for="outpatClaimTotalAmount" value="Total ($)" />
                                <p:inputText id="outpatClaimTotalAmount" disabled="true"
                                             value="#{InvoicesReceivedBean.calculateTotalAmounts('inpatTotal')}" />
                            </div>
                        </div>
                    </div>
                    <div class="ui-g submit-buttons" style="margin: 20px 0px 10px 0px;">
                        <div class="ui-g-12">
                            <p:commandButton id="addInvoice" styleClass="submit-button"
                                             update="addDialogPanel addMsg" value="Submit"
                                             process="addDialog" oncomplete="window.scrollTo(0,0);"
                                             action="#{InvoicesReceivedBean.saveInvoice}" />

                            <p:button id="cancelButton" value="Cancel"
                                      styleClass="secondary-button"
                                      onclick="PF('addDialog').hide(); return false;" />
                        </div>
                    </div>
                </p:outputPanel>
            </p:dialog>

            <p:dialog id="editDialog" widgetVar="editDialog" showHeader="false"
                      closable="false" resizable="false" modal="true" width="900"
                      closeOnEscape="true" style="max-height:900px">

                <p:focus for="editInvoiceTotal" context="editDialog" />

                <p:outputPanel id="editDialogPanel" style="max-height:800px">

                    <p:messages id="editMsg" escape="false" closable="true" />
                    <h1>Edit Invoice</h1>

                    <div class="ui-g">
                        <div class="ui-g-4">
                            <p:outputLabel for="editNumber" value="Invoice #" />
                            <p:inputText id="editNumber"
                                         value="#{InvoicesReceivedBean.invoice.invoice}" required="true"
                                         disabled="true" />
                        </div>

                        <div class="ui-g-4">
                            <p:outputLabel for="editInvoiceTotal" value="Invoice Total ($)" />
                            <p:inputText id="editInvoiceTotal" required="true"
                                         value="#{InvoicesReceivedBean.invoiceTotal}"
                                         onblur="updateEditDialogPanel()" />
                        </div>
                        <div class="ui-g-4">
                            <p:outputLabel for="editInvoiceDate" value="Invoice Date" />
                            <span class="date-pattern">(YYYYMMDD)</span>
                            <p:calendar id="editInvoiceDate"
                                        value="#{InvoicesReceivedBean.invoice.invoiceDate}"
                                        pattern="yyyyMMdd" navigator="true" required="true"
                                        maxlength="8">
                                <f:converter converterId="localDateConverter" />
                            </p:calendar>
                        </div>
                    </div>

                    <div class="ui-g">
                        <div class="ui-g-4">
                            <p:outputLabel for="editInvoiceReceived" value="Date Received" />
                            <span class="date-pattern">(YYYYMMDD)</span>
                            <p:calendar id="editInvoiceReceived"
                                        value="#{InvoicesReceivedBean.invoice.invoiceReceived}"
                                        pattern="yyyyMMdd" navigator="true" required="true"
                                        maxlength="8">
                                <f:converter converterId="localDateConverter" />
                            </p:calendar>
                        </div>
                        <div class="ui-g-4">
                            <p:outputLabel for="editProvincialBillingDate"
                                           value="Provincial Billing Date" />
                            <span class="date-pattern">(YYYYMMDD)</span>
                            <p:calendar id="editProvincialBillingDate"
                                        value="#{InvoicesReceivedBean.invoice.provincialBillingPeriod}"
                                        pattern="yyyyMMdd" navigator="true" required="true"
                                        maxlength="8">
                                <f:converter converterId="localDateConverter" />
                            </p:calendar>
                        </div>
                        <div class="ui-g-4">
                            <p:outputLabel for="editBillingPeriod" value="Processing Month" />
                            <span class="date-pattern">(YYYYMM)</span>
                            <p:inputText id="editBillingPeriod"
                                         value="#{InvoicesReceivedBean.invoice.ibpId.periodCode}"
                                         required="true" maxlength="6" />
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 35px;">
                        <h2>INPATIENTS</h2>
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <p:outputLabel for="editInpatClaimNumber"
                                               value="Number of Claims" />
                                <p:inputText id="editInpatClaimNumber"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[0].invoiceQuantity}" />
                            </div>
                        </div>
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <p:outputLabel for="editInpatClaimAmount"
                                               value="Claim Amount ($)" />
                                <p:inputText id="editInpatClaimAmount"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[0].invoiceAmount}"
                                             onblur="updateEditDialogPanel()" />
                            </div>
                            <div class="ui-g-4">
                                <p:outputLabel for="editInpatClaimAdjustAmount"
                                               value="Adjustments Amount ($)" />
                                <p:inputText id="editInpatClaimAdjustAmount"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[0].reductionAmount}"
                                             onblur="updateEditDialogPanel()" />
                            </div>
                            <div class="ui-g-4">
                                <p:outputLabel for="editInpatClaimTotalAmount" value="Total ($)" />
                                <p:inputText id="editInpatClaimTotalAmount" disabled="true"
                                             value="#{InvoicesReceivedBean.calculateTotalAmounts('inpatTotal')}" />
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 35px;">
                        <h2>OUTPATIENTS</h2>
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <p:outputLabel for="editOutpatClaimNumber" value="Number of Claims" />
                                <p:inputText id="editOutpatClaimNumber"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[1].invoiceQuantity}" />
                            </div>
                        </div>
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <p:outputLabel for="editOutpatClaimAmount"
                                               value="Claim Amount ($)" />
                                <p:inputText id="editOutpatClaimAmount"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[1].invoiceAmount}"
                                             onblur="updateEditDialogPanel()" />
                            </div>
                            <div class="ui-g-4">
                                <p:outputLabel for="editOutpatClaimAdjustAmount"
                                               value="Adjustments Amount ($)" />
                                <p:inputText id="editOutpatClaimAdjustAmount"
                                             value="#{InvoicesReceivedBean.invoice.invoiceDetailsList[1].reductionAmount}"
                                             onblur="updateEditDialogPanel()" />
                            </div>
                            <div class="ui-g-4">
                                <p:outputLabel for="editOutpatClaimTotalAmount"
                                               value="Total ($)" />
                                <p:inputText id="editOutpatClaimTotalAmount" disabled="true"
                                             value="#{InvoicesReceivedBean.calculateTotalAmounts('outpatTotal')}" />
                            </div>
                        </div>
                    </div>
                    <div class="ui-g submit-buttons" style="margin: 20px 0px 10px 0px;">
                        <div class="ui-g-12">
                            <p:commandButton id="editInvoice" styleClass="submit-button"
                                             update="editDialogPanel editMsg" value="Submit"
                                             process="editDialog" oncomplete="window.scrollTo(0,0);"
                                             action="#{InvoicesReceivedBean.saveInvoice}" />

                            <p:button id="editCancelButton" value="Cancel"
                                      styleClass="secondary-button"
                                      onclick="PF('editDialog').hide(); return false;" />

                            <p:commandButton value="Delete" styleClass="danger" process="@this" update="@form"
                                             id="deleteSeleniumCodeButton" style="display:none; margin-left:20px;"
                                             action="#{InvoicesReceivedBean.removeInvoice}" />
                        </div>
                    </div>
                </p:outputPanel>
            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>
