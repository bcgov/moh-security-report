<!DOCTYPE html>
<ui:composition template="/WEB-INF/templates/gov30Template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:cc="http://xmlns.jcp.org/jsf/composite/composites">

    <ui:define name="title">Reprint Resident Month End Reports</ui:define>

    <ui:define name="content">
        <h:form id="reprintResReportForm">
            <ui:include src="/WEB-INF/fragments/navTabs/monthendTabs.xhtml" />
            <p:messages id="messages" closable="true"/>

            <h1 class="reportMonthEnd">Reprint Resident Month End Reports</h1>
            <div class="ui-g">
                <div class="ui-g-12" style="margin: 15px 0px 10px 5px;">
                    <p:outputLabel value="STEP 1: SELECT PROVINCES" for="provinces"
                                   style="margin-bottom: 10px"/>
                    <cc:selectManyCheckboxAll id="provinces" value="#{ReprintResMonthEnd.selectedProvinces}" layout="grid" columns="2"
                                               required="true" allValue="#{ReprintResMonthEnd.selectAllProvinces}" allLabel="Select All Provinces">
                        <f:selectItem itemLabel="Alberta" itemValue="AB"/>
                        <f:selectItem itemLabel="Nunavut" itemValue="NU"/>
                        <f:selectItem itemLabel="Manitoba" itemValue="MB"/>
                        <f:selectItem itemLabel="Ontario" itemValue="ON"/>
                        <f:selectItem itemLabel="New Brunswick" itemValue="NB"/>
                        <f:selectItem itemLabel="Prince Edward Island" itemValue="PE"/>
                        <f:selectItem itemLabel="Newfoundland/Labrador" itemValue="NL"/>
                        <f:selectItem itemLabel="Quebec" itemValue="QC"/>
                        <f:selectItem itemLabel="Northwest Territories" itemValue="NT"/>
                        <f:selectItem itemLabel="Saskatchewan" itemValue="SK"/>
                        <f:selectItem itemLabel="Nova Scotia" itemValue="NS"/>
                        <f:selectItem itemLabel="Yukon Territory" itemValue="YT"/>
                    </cc:selectManyCheckboxAll>
                </div>

                <div class="ui-g-3" style="margin-top: 10px;">
                    <p:outputLabel for="processingMonth" value="STEP 2: SELECT PROCESSING MONTH" style="margin-bottom: 10px"/>
                    <p:outputLabel value="Billing Period" />
                    <span class="date-pattern">(YYYYMM)</span>
                    <p:selectOneMenu id="processingMonth" editable="true" maxlength="6"
                                     style="width: 100%" required="true"
                                     value="#{ReprintResMonthEnd.processingMonth}"
                                     validator="YearMonthValidator">
                        <f:selectItems value="#{ReprintResMonthEnd.months}" />
                        <p:ajax event="itemSelect" update="@this" global="false" immediate="true"/>
                    </p:selectOneMenu>
                </div>

                <div class="ui-g-12" style="margin-top: 10px;">
                    <p:outputLabel value="STEP 3: SELECT REPORTS TO REPRODUCE" 
                                   for="reports" style="margin-bottom: 10px"/>
                    <cc:selectManyCheckboxAll id="reports" value="#{ReprintResMonthEnd.selectedReports}" required="false" 
                                               layout="grid" columns="1" allValue="#{ReprintResMonthEnd.selectAllReports}" allLabel="Select All Reports">
                        <f:selectItem itemLabel="Invoice Balance and Details" itemValue="HOOPCR0001"/>
                        <f:selectItem itemLabel="Payment Requisition" itemValue="HOOPCR0004"/>
                        <f:selectItem itemLabel="Adjustment Report" itemValue="HOOPCR0003A"/>
                        <f:selectItem itemLabel="Detailed Inpatient Claims Listing" itemValue="HOOPCR0016"/>
                        <f:selectItem itemLabel="Detailed Outpatient Claims Listing" itemValue="HOOPCR0017"/>
                    </cc:selectManyCheckboxAll>
                </div>

                <div class="ui-g-12 submit-buttons" >
                    <p:commandButton id="PDFValidation" value="Generate PDF"
                                     styleClass="submit-button" action="#{ReprintResMonthEnd.retrieveProvReports}" update="@form"
                                     oncomplete="window.scrollTo(0,0); if (args &amp;&amp; !args.validationFailed) { handlePDFValidationSuccessful() }"/>

                    <!-- //Start code BCMOHAD-9621 Automatically generate the error reports for the Alberta and Ontario files ** -->
                    <p:commandButton id="CSVReport" value="Generate error report" 
                                     styleClass="submit-button" update="@form" 
                                     ajax="false" oncomplete="window.scrollTo(0,0);">
                        <p:fileDownload value="#{ReprintResMonthEnd.generateErrorReport()}"/>
                    </p:commandButton>
                    <!-- //End code BCMOHAD-9621 Automatically generate the error reports for the Alberta and Ontario files ** -->

                    <p:commandButton id="generatePDF" value="Generate PDF"
                                     style="display: none;" onclick="target = '_blank';"
                                     update="@form" ajax="false" oncomplete="window.scrollTo(0,0);">
                        <p:fileDownload value="#{ReprintResMonthEnd.generatePDF()}" contentDisposition="inline"/>
                    </p:commandButton>

                </div>

                <script>
                    function handlePDFValidationSuccessful() {
                        document.getElementById('reprintResReportForm:generatePDF').click();
                    }
                </script>
            </div>
        </h:form>
    </ui:define>
</ui:composition>
