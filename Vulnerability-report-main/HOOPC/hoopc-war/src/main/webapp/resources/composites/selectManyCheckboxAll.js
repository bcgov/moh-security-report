$(document).ready(function() {
    // Iterate over each composite container with class "checkboxes-all"
    $(".checkboxes-all").each(function() {
        var $composite = $(this);
        var widgetAll = PrimeFaces.widgets[$composite.data("widget-all")];
        var widgetCheckboxes = PrimeFaces.widgets[$composite.data("widget-checkboxes")];

        // Check if all individual checkboxes are checked
        var allChecked = widgetCheckboxes.inputs.toArray().every(function(checkbox) {
            return $(checkbox).is(":checked");
        });

        // If all individual checkboxes are checked, check the "all" checkbox
        if (allChecked) {
            widgetAll.check();
        }
    });
});

// Function to get widget references from the DOM element
function getWidgetsFromElement(triggerElement) {
    var $composite = $(triggerElement).closest(".checkboxes-all");
    var widgetAll = PrimeFaces.widgets[$composite.data("widget-all")];
    var widgetCheckboxes = PrimeFaces.widgets[$composite.data("widget-checkboxes")];

    return {widgetAll, widgetCheckboxes};
}

// Function to toggle all checkboxes based on the "all" checkbox state
function toggleAllCheckboxes(triggerElement) {
    var {widgetAll, widgetCheckboxes} = getWidgetsFromElement(triggerElement);
    var newCheckedState = widgetAll.isChecked();

    if (newCheckedState) {
        widgetCheckboxes.checkAll();
    } else {
        widgetCheckboxes.uncheckAll();
    }
}

// Function to handle individual checkbox clicks
function handleIndividualCheckboxClick(triggerElement) {
    var {widgetAll, widgetCheckboxes} = getWidgetsFromElement(triggerElement);

    // Uncheck the "all" checkbox if any individual checkbox is unchecked
    if (!$(triggerElement).is(":checked") && widgetAll.isChecked()) {
        widgetAll.uncheck();
    }

    // Check if all individual checkboxes are checked
    var allChecked = widgetCheckboxes.inputs.toArray().every(function(checkbox) {
        return $(checkbox).is(":checked");
    });

    // Check the "all" checkbox if all individual checkboxes are checked
    if (allChecked) {
        widgetAll.check();
    }
}

// Event bindings
$(document).on("click", ".checkboxes-all .all .ui-chkbox", function() {
    toggleAllCheckboxes(this);
});

$(document).on("click", ".checkboxes-all .ui-selectmanycheckbox .ui-chkbox", function() {
    handleIndividualCheckboxClick(this);
});
