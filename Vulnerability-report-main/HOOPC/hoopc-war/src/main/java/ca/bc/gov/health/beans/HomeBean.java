/*
 * To change this license header, choose License Headers in Project Properties. To change this
 * template file, choose Tools | Templates and open the template in the editor.
 */
package ca.bc.gov.health.beans;

import ca.bc.gov.health.beans.codes.HospitalsBean;
import static ca.bc.gov.health.constants.GlobalConstants.ROLE_UNAUTHORIZED;
import ca.bc.gov.health.database.ejb.ApplicationBulletinsFacadeLocal;
import ca.bc.gov.health.database.entity.ApplicationBulletins;
import ca.bc.gov.health.exception.HoopcException;
import ca.bc.gov.health.service.HoopcSessionBean;
import jakarta.annotation.PostConstruct;
import jakarta.ejb.EJB;
import jakarta.faces.view.ViewScoped;
import jakarta.inject.Inject;
import jakarta.inject.Named;
import java.io.Serializable;
import java.time.LocalDate;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import org.slf4j.LoggerFactory;

/**
 * Loads bulletins for the home page.
 *
 * @author Trevor.Schiavone
 */
@Named("HomeBean")
@ViewScoped
public class HomeBean extends BaseBean implements Serializable {

  private static final org.slf4j.Logger LOG = LoggerFactory.getLogger(HospitalsBean.class);
  private static final long serialVersionUID = 1409627608855947183L;

  @Inject private HoopcSessionBean session;

  @EJB private ApplicationBulletinsFacadeLocal applicationBulletinsFacade;

  private String userRole;
  private List<ApplicationBulletins> activeBulletinsList;
  transient Map<String, Object> criteria = new HashMap<>();

  /**
   * Inits the HomeBean.
   */
  @PostConstruct
  public void init() {

    if (session.getCurrentUser() != null) {
      userRole = session.getCurrentUser().getApplicationRole();
    } else {
      userRole = ROLE_UNAUTHORIZED;
    }

    criteria.put("todayDate", LocalDate.now());
    try {
      activeBulletinsList = applicationBulletinsFacade.findByNamedQuery("ApplicationBulletins.findActive", criteria);
    } catch (HoopcException e) {
      LOG.error(e.getMessage());
    }
  }

  public String getUserRole() {
    return userRole;
  }

  public List<ApplicationBulletins> getActiveBulletinsList() {
    return activeBulletinsList;
  }
}
