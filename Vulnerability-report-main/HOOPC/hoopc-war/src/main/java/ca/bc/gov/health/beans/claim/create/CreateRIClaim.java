/*
 * To change this license header, choose License Headers in Project Properties. To change this
 * template file, choose Tools | Templates and open the template in the editor.
 */
package ca.bc.gov.health.beans.claim.create;

import ca.bc.gov.health.constants.GlobalConstants;
import static ca.bc.gov.health.constants.GlobalConstants.DEFAULT_SOURCE_CODE;
import static ca.bc.gov.health.constants.GlobalConstants.DEFAULT_STATUS_CODE;
import static ca.bc.gov.health.constants.GlobalConstants.RESIDENT_PROVINCE;
import ca.bc.gov.health.service.viewmodel.AdmissionsViewModel;
import ca.bc.gov.health.service.viewmodel.ClaimViewModel;
import ca.bc.gov.health.service.viewmodel.PatientsViewModel;
import jakarta.faces.view.ViewScoped;
import jakarta.inject.Named;
import java.time.LocalDate;

/**
 * The Class CreateRIClaim.
 *
 * @author Trevor.Schiavone
 */
@Named("CreateRIClaim")
@ViewScoped
public class CreateRIClaim extends CreateClaim {
  private static final long serialVersionUID = 8279556572702301574L;

  /** Setup new claim. */
  @Override
  public void setupNewClaim() {
    claim = new ClaimViewModel();
    claim.setAdmission(new AdmissionsViewModel());
    claim.setPatient(new PatientsViewModel());
    claim.setStatusCode(DEFAULT_STATUS_CODE);
    claim.setClaimSource(DEFAULT_SOURCE_CODE);
    claim.setSubmissionDate(LocalDate.now());

    // Set ResidencyType and ClaimType (Resident Inpatient)
    claim.setResidencyType(
        applicationBean.getResidencyTypesList().stream()
            .filter(p -> p.getTypeCode().equals(GlobalConstants.RES_RESIDENCY_TYPE))
            .findFirst()
            .orElse(null));
    claim.setClaimType(
        applicationBean.getClaimTypeList().stream()
            .filter(p -> p.getClaimType().equals(GlobalConstants.INPATIENT_CLAIM_TYPE))
            .findFirst()
            .orElse(null));

    // Need to set this in the backing bean so it shows up on the disabled input field
    claim.getPatient().setProvince(RESIDENT_PROVINCE);
    claim.setIcdCodingScheme("ICD10");

    // Default values
    claim.setAccidentIndicator("N");
    claim.getPatient().setDeceasedFlag("N");
    claim.getAdmission().setLongTermStayInd("N");
  }

  /* (non-Javadoc)
   * @see ca.bc.gov.health.beans.claim.create.CreateClaim#getEditRedirectUrl(java.lang.Long)
   */
  @Override
  public String getEditRedirectUrl(Long claimid) {
    return "editClaimResidentInpatient?faces-redirect=true&claimId=" + claimid;
  }
}
