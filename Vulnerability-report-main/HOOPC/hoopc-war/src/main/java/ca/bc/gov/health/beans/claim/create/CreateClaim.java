package ca.bc.gov.health.beans.claim.create;

import ca.bc.gov.health.beans.ApplicationBean;
import ca.bc.gov.health.beans.ClaimBean;
import static ca.bc.gov.health.constants.GlobalConstants.CLAIM_CREATE_MESSAGE;
import static ca.bc.gov.health.constants.GlobalConstants.CLAIM_CREATE_MESSAGE_ERROR;
import static ca.bc.gov.health.constants.GlobalConstants.CLAIM_CREATE_MESSAGE_SOFT_ERROR;
import ca.bc.gov.health.exception.HoopcException;
import ca.bc.gov.health.service.HoopcSessionBean;
import jakarta.annotation.PostConstruct;
import jakarta.faces.application.FacesMessage;
import jakarta.inject.Inject;
import java.io.Serializable;

/** The Class CreateClaim. */
public abstract class CreateClaim extends ClaimBean implements Serializable {
  private static final long serialVersionUID = 8482510962734180996L;

  /** Setup an new Claim with defaul values set. */
  public abstract void setupNewClaim();

  @Inject protected ApplicationBean applicationBean;
  @Inject protected HoopcSessionBean session;

  /** Instantiates a new creates the claim. */
  public CreateClaim() {
    super();
  }

  /** Inits the. */
  @PostConstruct
  public void init() {
    setupNewClaim();
  }

  /**
   * Creates the claim.
   *
   * @return the string
   */
  public String createClaim() {
    try {
      session.clearSearchResult();
      Long newId = claimService.createClaim(claim);
      if (claimService.getClaimErrors(newId).isEmpty()) {
        addMessage(new FacesMessage(FacesMessage.SEVERITY_INFO, CLAIM_CREATE_MESSAGE, null));
      } else {
        addMessage(
            new FacesMessage(FacesMessage.SEVERITY_WARN, CLAIM_CREATE_MESSAGE_SOFT_ERROR, null));
      }
      return getEditRedirectUrl(newId);
    } catch (HoopcException e) {
      addMessage(e);
      return "";
    } catch (Exception ex) {
      addMessage(new FacesMessage(FacesMessage.SEVERITY_ERROR, CLAIM_CREATE_MESSAGE_ERROR, null));
      return "";
    }
  }
}
