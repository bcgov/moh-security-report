package ca.bc.gov.health.validators;

import jakarta.enterprise.context.RequestScoped;
import jakarta.faces.application.FacesMessage;
import jakarta.faces.component.UIComponent;
import jakarta.faces.component.UIInput;
import jakarta.faces.context.FacesContext;
import jakarta.faces.validator.Validator;
import jakarta.faces.validator.ValidatorException;
import jakarta.inject.Named;
import org.apache.commons.lang3.StringUtils;

/** Validator for Claim Report pages. */
@RequestScoped
@Named("AuthorityProvinceHospitalValidator")
public class AuthorityProvinceHospitalValidator implements Validator {

  /*
   * (non-Javadoc)
   *
   * @see jakarta.faces.validator.Validator#validate(jakarta.faces.context.FacesContext,
   * jakarta.faces.component.UIComponent, java.lang.Object)
   */
  @Override
  public void validate(FacesContext fc, UIComponent uic, Object value) throws ValidatorException {

    String residentialProvince = (String) value;

    UIInput treatingHospitalComponent =
        (UIInput) uic.getAttributes().get("treatingHospitalUIInput");
    String treatingHospital = (String) treatingHospitalComponent.getValue();

    UIInput treatingHealthAuthorityComponent =
        (UIInput) uic.getAttributes().get("treatingHealthAuthorityUIInput");
    String treatingHealthAuthority = (String) treatingHealthAuthorityComponent.getValue();

    if (StringUtils.isBlank(residentialProvince)
        && StringUtils.isBlank(treatingHospital)
        && StringUtils.isBlank(treatingHealthAuthority)) {

      treatingHospitalComponent.setValid(false);
      treatingHealthAuthorityComponent.setValid(false);

      throw new ValidatorException(
          new FacesMessage(
              FacesMessage.SEVERITY_ERROR,
              "One of Treating Health Authority, Treating Hospital or Residential Province is required",
              ""));
    }
  }

  public void validateProvinceHospital(FacesContext fc, UIComponent uic, Object value) {

    String treatingHospital = (String) value;

    UIInput treatingProvinceComponent =
        (UIInput) uic.getAttributes().get("treatingProvinceUIInput");
    String treatingProvince = (String) treatingProvinceComponent.getValue();

    if (StringUtils.isBlank(treatingProvince) && StringUtils.isBlank(treatingHospital)) {
      treatingProvinceComponent.setValid(false);
      throw new ValidatorException(
          new FacesMessage(
              FacesMessage.SEVERITY_ERROR,
              "One of Treating Province or Treating Hospital is required",
              ""));
    }
  }
}
