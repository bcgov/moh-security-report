/*
 * To change this license header, choose License Headers in Project Properties. To change this
 * template file, choose Tools | Templates and open the template in the editor.
 */
package ca.bc.gov.health.beans.codes;

import ca.bc.gov.health.beans.BaseBean;
import ca.bc.gov.health.constants.GlobalConstants;
import ca.bc.gov.health.database.ejb.ProvincesTerritoriesFacadeLocal;
import ca.bc.gov.health.database.entity.ProvincesTerritories;
import ca.bc.gov.health.exception.HoopcException;
import ca.bc.gov.health.service.HoopcAppService;
import jakarta.annotation.PostConstruct;
import jakarta.ejb.EJB;
import jakarta.faces.application.FacesMessage;
import jakarta.faces.view.ViewScoped;
import jakarta.inject.Inject;
import jakarta.inject.Named;
import java.io.Serializable;
import java.util.List;
import org.primefaces.PrimeFaces;

/**
 * The Class ProvincesBean.
 *
 * @author Trevor.Schiavone
 */
@Named("ProvincesBean")
@ViewScoped
public class ProvincesBean extends BaseBean implements Serializable {

  private static final long serialVersionUID = 1409627608855947183L;

  @EJB private ProvincesTerritoriesFacadeLocal provincesTerritoriesFacade;

  @Inject private HoopcAppService appService;

  private List<ProvincesTerritories> allProvinces;
  private ProvincesTerritories selectedProvince;

  /** Inits the. */
  @PostConstruct
  public void init() {
    loadAllProvincesList();
  }

  private void loadAllProvincesList() {
    try {
      allProvinces = provincesTerritoriesFacade.findAll();
    } catch (HoopcException e) {
      addMessage(e, false);
    }
  }

  /** Save province. */
  public void saveProvince() {
    try {
      provincesTerritoriesFacade.edit(selectedProvince);
      addMessage(FacesMessage.SEVERITY_INFO, GlobalConstants.PROVINCE_EDIT_MESSAGE, false);
      appService.initHospitals();
      loadAllProvincesList();
      PrimeFaces.current().ajax().update("provincesForm");
    } catch (HoopcException e) {
      addMessage(e, false);
    }
  }

  /* Getters and Setters */
  public List<ProvincesTerritories> getAllProvinces() {
    return allProvinces;
  }

  public ProvincesTerritories getSelectedProvince() {
    return selectedProvince;
  }

  public void setSelectedProvince(ProvincesTerritories selectedProvince) {
    this.selectedProvince = selectedProvince;
  }
}
