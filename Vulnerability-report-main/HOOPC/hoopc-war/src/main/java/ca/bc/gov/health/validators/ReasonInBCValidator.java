/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.validators;

import ca.bc.gov.health.database.ejb.ReasonInProvCodesFacadeLocal;
import ca.bc.gov.health.exception.HoopcException;
import jakarta.ejb.EJB;
import jakarta.faces.application.FacesMessage;
import jakarta.faces.component.UIComponent;
import jakarta.faces.context.FacesContext;
import jakarta.faces.validator.FacesValidator;
import jakarta.faces.validator.Validator;
import jakarta.faces.validator.ValidatorException;
import java.util.HashMap;
import java.util.Map;

/**
 * The Class ReasonInBCValidator.
 *
 * @author trevor.schiavone
 */
@SuppressWarnings("rawtypes")
@FacesValidator(value = "ReasonInBCValidator", managed = true)
public class ReasonInBCValidator implements Validator {

  @EJB private ReasonInProvCodesFacadeLocal reasonInProvCodesFacade;

  /* (non-Javadoc)
   * @see jakarta.faces.validator.Validator#validate(jakarta.faces.context.FacesContext, jakarta.faces.component.UIComponent, java.lang.Object)
   */
  @Override
  public void validate(FacesContext fc, UIComponent uic, Object value) throws ValidatorException {

    try {
      String code = (String) value;
      String errorMessage = "The code submitted already exists";

      Map<String, Object> criteria = new HashMap<>();
      criteria.put("reasonCode", code);

      if (!reasonInProvCodesFacade
          .findByNamedQuery("ReasonInProvCodes.findDuplicate", criteria)
          .isEmpty()) {
        throw new ValidatorException(
            new FacesMessage(FacesMessage.SEVERITY_ERROR, errorMessage, ""));
      }

    } catch (HoopcException ex) {
      throw new ValidatorException(
          new FacesMessage(FacesMessage.SEVERITY_ERROR, ex.getMessage(), ""));
    }
  }
}
