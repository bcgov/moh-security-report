package ca.bc.gov.health.beans.claim.search;

import ca.bc.gov.health.beans.ClaimBean;
import static ca.bc.gov.health.constants.GlobalConstants.CLAIM_CREATE_MESSAGE_ERROR;
import ca.bc.gov.health.database.entity.HospitalOopClaims;
import ca.bc.gov.health.exception.HoopcException;
import ca.bc.gov.health.service.HoopcSessionBean;
import jakarta.faces.application.FacesMessage;
import jakarta.inject.Inject;
import java.io.Serializable;

/** The Class SearchClaim. */
public abstract class SearchClaim extends ClaimBean implements Serializable {

  private static final long serialVersionUID = 613429084558484515L;

  @Inject protected HocLazyDataModel claimSearchResults;
  @Inject protected HoopcSessionBean session;

  private HospitalOopClaims selectedClaim;

  /** Instantiates a new search claim. */
  public SearchClaim() {
    super(true);
  }

  /** Setup an new Claim with default values set. */
  public abstract void setupNewClaim();

  /**
   * Search.
   *
   * @return the string
   */
  public String search() {
    claimSearchResults = new HocLazyDataModel();
    claimSearchResults.setClaim(claim);
    claimSearchResults.setClaimService(claimService);
    claimSearchResults.setSession(session);

    Long totalRowCount = 0L;
    try {
      totalRowCount = claimService.selectCountByCriteria(claim);
      claimSearchResults.setTotalRowCount(totalRowCount);
    } catch (HoopcException e) {
      addMessage(e);
    } catch (Exception ex) {
      addMessage(new FacesMessage(FacesMessage.SEVERITY_ERROR, CLAIM_CREATE_MESSAGE_ERROR, null));
    }

    return "";
  }

  @Override
  public String getEditRedirectUrl(Long claimid) {
    return getEditRedirectUrl() + claimid;
  }

  public abstract String getEditRedirectUrl();

  public HospitalOopClaims getSelectedClaim() {
    return selectedClaim;
  }

  public void setSelectedClaim(HospitalOopClaims selectedClaim) {
    this.selectedClaim = selectedClaim;
  }

  public HocLazyDataModel getClaimSearchResults() {
    return claimSearchResults;
  }

  public abstract String getResultsTitle();
}
