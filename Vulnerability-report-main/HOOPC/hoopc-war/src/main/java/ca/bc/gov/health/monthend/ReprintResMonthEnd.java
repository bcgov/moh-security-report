/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.monthend;

import ca.bc.gov.health.constants.GlobalConstants;
import ca.bc.gov.health.exception.HoopcException;
import jakarta.annotation.PostConstruct;
import jakarta.faces.view.ViewScoped;
import jakarta.inject.Named;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;
import org.primefaces.model.DefaultStreamedContent;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;



/** @author trevor.schiavone */
@ViewScoped
@Named("ReprintResMonthEnd")
public class ReprintResMonthEnd extends ReprintMonthEnd implements Serializable {

  private static final long serialVersionUID = 2291236572538970324L;
  private static final Logger LOG = LoggerFactory.getLogger(ReprintResMonthEnd.class);

  private String processingMonth;
  private List<String> selectedReports = new ArrayList<>();
  private boolean selectAllReports;


  @PostConstruct
  @Override
  public void init() {
    try {
      super.init();
      
    } catch (HoopcException ex) {
      LOG.error(ex.getMessage());
    }
  }
  
  
  public void retrieveProvReports() throws Exception {
      
    super.retrieveProvReports(
        super.selectedProvinces,
        GlobalConstants.RES_RESIDENCY_TYPE,
        String.join(",", selectedReports),
        processingMonth);
  }

//Start code BCMOHAD-9621 Automatically generate the error reports for the Alberta and Ontario files **
  
//Code refactored for BCMOHAM-21682, allow user to choose either Ontario or Alberta or both 
//colin.anderson@cgi.com 2/4/25
  
  
  public DefaultStreamedContent generateErrorReport() throws Exception {
    try {
        
       
      return buildErrorCSV(processingMonth, super.selectedProvinces);
      
    } catch (HoopcException e) {
      LOG.debug("****** Client forgot to pick up a billing period before trying to produce the error report", e);
      return null;
    }
  }
//End code BCMOHAD-9621 Automatically generate the error reports for the Alberta and Ontario files **

  
  
  
  
  
  /* Getters and Setters */

  public List<String> getSelectedReports() {
    return selectedReports;
  }

  public void setSelectedReports(List<String> selectedReports) {
    this.selectedReports = selectedReports;
  }

  public boolean getSelectAllReports() {
    return selectAllReports;
  }

  public void setSelectAllReports(boolean selectAllReports) {
    this.selectAllReports = selectAllReports;
  }

  public String getProcessingMonth() {
    return processingMonth;
  }

  public void setProcessingMonth(String processingMonth) {
    this.processingMonth = processingMonth;
  }
}
