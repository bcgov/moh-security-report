package ca.bc.gov.health.validation.rule;

import ca.bc.gov.health.validation.ValidationError;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertNull;
import org.junit.jupiter.api.Test;

public class NotInSetRuleTest {

  private static String FIELD_NAME = "FieldName";
  private static String OK_VALUE = "OK";

  public static boolean InSetFunction(String value) {
    return OK_VALUE.equals(value);
  }

  @Test
  public void NotInSet_OK() {
    TestObject obj =
        new TestObject() {
          {
            setStringValue(OK_VALUE);
          }
        };

    ValidationRule<TestObject> rule =
        new NotInSetRule<TestObject, String>(
            FIELD_NAME, TestObject::getStringValue, "value1", "value2");

    ValidationError error = rule.validate(obj);

    assertNull(error);
  }

  @Test
  public void NotInSet_Null() {
    TestObject obj = new TestObject();

    ValidationRule<TestObject> rule =
        new NotInSetRule<TestObject, String>(
            FIELD_NAME, TestObject::getStringValue, "value1", "value2");

    ValidationError error = rule.validate(obj);

    assertNull(error);
  }

  @Test
  public void NotInSet_Error_OneVal() {
    TestObject obj =
        new TestObject() {
          {
            setStringValue(OK_VALUE);
          }
        };

    ValidationRule<TestObject> rule =
        new NotInSetRule<TestObject, String>(FIELD_NAME, TestObject::getStringValue, OK_VALUE);

    ValidationError error = rule.validate(obj);

    assertNotNull(error);
    assertEquals(FIELD_NAME, error.getRule().getRuleIdentifier());
    assertEquals(ValidationRuleType.NOT_IN_SET, error.getRule().getType());
    assertNotNull(error.getMessage());
    assertEquals(
        "Incorrect value OK supplied for FieldName. FieldName must not be OK", error.getMessage());
  }

  @Test
  public void NotInSet_Error_MultiVal() {
    TestObject obj =
        new TestObject() {
          {
            setStringValue(OK_VALUE);
          }
        };

    ValidationRule<TestObject> rule =
        new NotInSetRule<TestObject, String>(
            FIELD_NAME, TestObject::getStringValue, "value1", "value2", OK_VALUE);

    ValidationError error = rule.validate(obj);

    assertNotNull(error);
    assertEquals(FIELD_NAME, error.getRule().getRuleIdentifier());
    assertEquals(ValidationRuleType.NOT_IN_SET, error.getRule().getType());
    assertNotNull(error.getMessage());
    assertEquals(
        "Incorrect value OK supplied for FieldName. FieldName must not be one of value1,value2,OK",
        error.getMessage());
  }
}
