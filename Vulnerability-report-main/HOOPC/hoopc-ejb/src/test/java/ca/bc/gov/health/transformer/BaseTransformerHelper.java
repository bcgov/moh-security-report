package ca.bc.gov.health.transformer;

import ca.bc.gov.health.database.entity.ClaimContents;
import ca.bc.gov.health.database.entity.HighcostProcedurePerformed;
import ca.bc.gov.health.database.entity.HospitalOopClaims;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.Comparator;
import org.apache.commons.lang3.StringUtils;

public class BaseTransformerHelper {

  protected LocalDate formatDate(String date) {
    DateTimeFormatter fmt = DateTimeFormatter.ofPattern("yyyyMMdd");
    return LocalDate.parse(date, fmt);
  }

  protected ClaimContents getClaimContents(String context, long position, HospitalOopClaims c) {
    int occurence = 0;
    if (c.getClaimContentsList() != null) {
      c.getClaimContentsList().sort(Comparator.comparing(ClaimContents::getSequenceNum));
      for (ClaimContents content : c.getClaimContentsList()) {
        if (content.getContext().equals(context)) {
          occurence++;
          if (!StringUtils.isBlank(content.getCdcId().getCodeValue()) && occurence == position) {
            return content;
          }
        }
      }
    }
    return null;
  }

  protected HighcostProcedurePerformed getHighCostProcedurePerf(
      long position, HospitalOopClaims c) {
    int occurence = 0;
    if (c.getHighcostProcedurePerformedList() != null) {
      c.getHighcostProcedurePerformedList()
          .sort(Comparator.comparing(HighcostProcedurePerformed::getSequenceNum));
      for (HighcostProcedurePerformed highCostProcedure : c.getHighcostProcedurePerformedList()) {
        occurence++;
        if (occurence == position) {
          return highCostProcedure;
        }
      }
    }
    return null;
  }
}
