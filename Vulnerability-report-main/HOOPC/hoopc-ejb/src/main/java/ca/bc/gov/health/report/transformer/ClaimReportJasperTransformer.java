package ca.bc.gov.health.report.transformer;

import ca.bc.gov.health.report.model.ClaimReportModel;
import java.util.Map;

/** The Class ClaimReportJasperTransformer. */
public class ClaimReportJasperTransformer extends BaseReportTransformer {

  /**
   * Transform to jasper model.
   *
   * @param record the record
   * @return the claim report model
   */
  public static ClaimReportModel transformToJasperModel(Map<String, Object> record) {
    ClaimReportModel jModel = new ClaimReportModel();

    jModel.setProvince(readString(record, "PROVINCE"));
    jModel.setSubmissionDate(readTimestamp(record, "SUBMISSION_DATE"));
    jModel.setStatus(readString(record, "STATUS"));
    jModel.setProvincialClaimNumber(readString(record, "PROV_CLAIM_NO"));
    jModel.setInsuranceNumber(readString(record, "INS_CARD_NO"));
    jModel.setInsuranceExpiracyDate(readTimestamp(record, "INS_EXP_DATE"));
    jModel.setHospitalClaimNumber(readString(record, "HOSP_CLAIM_NO"));
    jModel.setAssociatedClaimNumber(readString(record, "ASSOC_CLAIM_NO"));
    jModel.setSurname(readString(record, "LAST_NAME"));
    jModel.setAddressLine1(readString(record, "ADDRESS1"));
    jModel.setCity(readString(record, "CITY"));
    jModel.setPostalCode(readString(record, "POSTAL_CODE"));
    jModel.setGivenName(readString(record, "FIRST_NAME"));
    jModel.setAddressLine2(readString(record, "ADDRESS2"));
    jModel.setBirthDate(readTimestamp(record, "BIRTHDATE"));
    jModel.setSex(readString(record, "SEX"));
    jModel.setDeceased(readString(record, "DECEASED"));
    jModel.setReason(readString(record, "REASON"));

    // ADMISS_DATE for INPATIENT, SERVICE_DATE for OUTPATIENT, exclusive
    String admissDate = readTimestamp(record, "ADMISS_DATE");
    String serviceDate = readTimestamp(record, "SERVICE_DATE");
    jModel.setAdmissionServiceDate(serviceDate != null ? serviceDate : admissDate);

    jModel.setDischargeDate(readTimestamp(record, "DISCH_DATE"));
    jModel.setDaysStay(readBigDecimalAsString(record, "DAYS_STAY", 0));
    jModel.setPerDiemRate(readBigDecimal(record, "PER_DIEM_RATE", 2));
    jModel.setAdmissionNo(readString(record, "ADMISS_NO"));
    jModel.setDiagnosticCode(readString(record, "DIAGNOSIS_CODE"));
    jModel.setProcedureCode(readString(record, "PROCEDURE_CODE"));
    jModel.setAccidentCode(readString(record, "ACCIDENT_CODE"));
    jModel.setHiCostProc1(readBigDecimalAsString(record, "HI_COST_PROC1", 0));
    jModel.setHiCostProc2(readBigDecimalAsString(record, "HI_COST_PROC2", 0));
    jModel.setHiCostProc3(readBigDecimalAsString(record, "HI_COST_PROC3", 0));
    jModel.setHiCostDate1(readTimestamp(record, "HI_COST_DATE1"));
    jModel.setHiCostDate2(readTimestamp(record, "HI_COST_DATE2"));
    jModel.setHiCostDate3(readTimestamp(record, "HI_COST_DATE3"));
    jModel.setClaimAmount(readBigDecimal(record, "CLAIM_AMT", 2));
    jModel.setAdjustment(readBigDecimal(record, "ADJ_AMT", 2));
    jModel.setHospitalNotes(readString(record, "HOSP_NOTES"));
    jModel.setAdjustmentReason(readString(record, "ADJ_REASON"));
    jModel.setOverrideReason(readString(record, "OVERRIDE_REASON"));
    jModel.setHospitalNumber(readString(record, "HOSPITAL_NUMBER"));
    jModel.setHospitalName(readString(record, "HOSPITAL_NAME"));
    jModel.setNotes(readString(record, "NOTES"));
    jModel.setServiceCode(readString(record, "SERVICE_CODE"));
    jModel.setReportType(extractTitle(record));
    jModel.setDecReason(readString(record, "DEC_REASON"));
    //BCMOHAD-9615-7Mar22: Resident patient's province. 
    jModel.setAddrProvince(readString(record, "ADDR_PROVINCE"));

    return jModel;
  }

  private static String extractTitle(Map<String, Object> map) {
    String title = "";
    if (map.containsKey("REPORT_TYPE")) {
      title = readString(map, "REPORT_TYPE");
    } else if (map.containsKey("REPORT_TITLE")) {
      title = readString(map, "REPORT_TITLE");
    }
    return title;
  }
}
