package ca.bc.gov.health.sfds.session;

import ca.bc.gov.health.sfds.dto.FileMetaDataDto;
import ca.bc.gov.health.sfds.files.FileDescription;
import ca.bc.gov.health.sfds.files.FileDescriptionGroup;
import ca.bc.gov.health.sfds.files.Mailbox;
import java.util.ArrayList;
import java.util.List;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.junit.Before;
import org.junit.Test;

public class FilesFacadeTest extends AbstractFacadeTest {

    private static final Logger LOG = LogManager.getLogger(FilesFacadeTest.class);

    protected static FilesFacade facade;

    @Before
    public void setUp() {
        facade = new FilesFacade();
        facade.entityManager = entityManager;
        System.setProperty("java.naming.factory.initial", "ca.bc.gov.health.sfds.service.helper.ContextFactory");
    }

    @Test
    public void getMetaData() {
        LOG.debug("\n===== Testing getFileMetaData");
        FileMetaDataDto dto = facade.getFileMetaData("phcb", "xxx");
        assert (dto == null);
        LOG.debug(dto);
        LOG.debug("\n===== Test completed \n");
    }

    @Test
    public void getFilesFromMailbox() {
        LOG.debug("\n===== Testing getFilesFromMailbox");

        Mailbox m = new Mailbox();
        m.setName("bcma");
        m.setPrivileges((byte) 1);
        m.setUses(new ArrayList<>());
        m.getUses().add("bcma");

        List<FileDescription> list = facade.getFilesFromMailbox(m);
        assert (!list.isEmpty());

        for (FileDescription file : list) {
            LOG.debug(file);
        }

        LOG.debug("\n===== Test completed \n");
    }

    @Test
    public void getGroupedFilesFromMailbox() {
        LOG.debug("\n===== Testing getGroupedFilesFromMailbox");
        Mailbox m = new Mailbox();
        m.setName("bcma");
        m.setPrivileges((byte) 1);
        m.setUses(new ArrayList<>());
        m.getUses().add("bcma");
        List<FileDescriptionGroup> list = facade.getGroupedFilesFromMailbox(m);
        assert (list.size() > 0);
        LOG.debug("\n===== Test completed \n");
    }
}
