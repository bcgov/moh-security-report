package ca.bc.gov.health.sfds.session;

import jakarta.persistence.EntityTransaction;
import java.nio.charset.StandardCharsets;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.junit.Before;
import org.junit.Test;

public class DataParcelProviderTest extends AbstractFacadeTest {

    private static final Logger LOG = LogManager.getLogger(DataParcelProviderTest.class);

    protected static DataParcelProviderFacade facade;

    @Before
    public void setUp() {
        facade = new DataParcelProviderFacade();
        facade.setEntityManager(entityManager);
    }

    @Test
    public void createDataParcelProvider() {
        LOG.debug("\n===== Testing DataParcelProvider creation");
        EntityTransaction t = entityManager.getTransaction();
        if (t.isActive()) {
            t.rollback();
        }
        t.begin();
        try {
            Long id = facade.createDataParcelProvider(
                    "New bulletin content which is supposed to be a UTF-8 encoded long string".getBytes(StandardCharsets.UTF_8),
                    "JUnit_Test");
            assert (id != null);
        } catch (Exception e) {
            LOG.error("Exception in createDataParcel", e.fillInStackTrace());
            t.rollback();
            throw new RuntimeException(e);
        }
        t.rollback();
        LOG.debug("\n===== Test completed \n");
    }

}
