<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns:h="http://java.sun.com/jsf/html" 
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:p="http://primefaces.org/ui" 
                template="/WEB-INF/templates/gov30Template.xhtml">

    <ui:define name="title">
        <h:outputFormat value="#{msg['title.healthOrg']}" />
    </ui:define>

    <ui:define name="content">

        <ui:include src="/WEB-INF/fragments/navTabs/adminTabs.xhtml" />

        <!-- PF Messages Component defined for the whole page -->
        <p:messages closable="true" id="pageMessages" rendered="#{HealthOrganizationsBean.enablePageMessages}">
            <p:autoUpdate disabled="false" />
        </p:messages>

        <h:form id="createForm">
            <div class="ui-g">
                <p:commandButton id="createHSP" value="#{msg['healthOrganizations.button.createHSP']}" 
                                 action="#{HealthOrganizationsBean.instantiateHealthServiceProvider()}"
                                 actionListener="#{HealthOrganizationsBean.disablePageMessaging()}"
                                 update="healthOrganizationForm:healthOrganizationDialog" 
                                 oncomplete="PF('healthOrganizationDialogWidget').show(); $('#pageMessages').html('')">
                    <p:resetInput target="createForm" />
                </p:commandButton>
                <p:commandButton id="createHA" value="#{msg['healthOrganizations.button.createHA']}"
                                 action="#{HealthOrganizationsBean.instantiateHealthAuthority()}"
                                 actionListener="#{HealthOrganizationsBean.disablePageMessaging()}"
                                 update="healthOrganizationForm:healthOrganizationDialog" 
                                 oncomplete="PF('healthOrganizationDialogWidget').show(); $('#pageMessages').html('')">
                    <p:resetInput target="createForm" />
                </p:commandButton>
            </div>
        </h:form>

        <h:form id="filterForm">
            <p:dataTable id="healthOrgTable" value="#{HealthOrganizationsBean.healthOrganizations}"
                         var="row" rowKey="#{row.hoId}" rowIndexVar="rowIndex"
                         paginator="true" paginatorAlwaysVisible="true" rows="50" paginatorPosition="top"
                         currentPageReportTemplate="{startRecord} - {endRecord} of {totalRecords}" 
                         paginatorTemplate="{CurrentPageReport} {PreviousPageLink} {NextPageLink}"
                         widgetVar="rulesTableWidget" filteredValue="#{HealthOrganizationsBean.filteredHealthOrganizations}"
                         selection="#{HealthOrganizationsBean.currentHealthOrganization}" selectionMode="single"
                         sortBy="#{row.spId}">
                <f:facet name="header">
                    <p:outputPanel>
                        <h:outputText value="#{msg['healthOrganizations.label.filterRules']}" /> <h:outputText styleClass="smallGrey" value=" #{msg['healthOrganizations.label.filterRulesExtra']}" /><br/>
                        <p:inputText type="search" id="globalFilter" />
                        <p:commandButton id="filter" onclick="PF('rulesTableWidget').filter()" value="#{msg['healthOrganizations.button.search']}" />
                        <p:defaultCommand target="filter" />
                    </p:outputPanel>
                </f:facet>
                <p:ajax event="rowSelect" 
                        listener="#{HealthOrganizationsBean.updateCurrentHealthOrganization}"	
                        resetValues="true"
                        update="healthOrganizationForm:healthOrganizationDialog healthOrganizationForm:deleteHODialog" 
                        oncomplete="{PF('healthOrganizationDialogWidget').show(); $('#pageMessages').html('')}" />
                <p:column visible="false">#{row.hoId}</p:column> 
                <p:column filterBy="#{row.spId}" filterable="true" filterStyle="display:none" width="20%" sortBy="#{row.spId}" sortOrder="asc" headerText="#{msg['healthOrganizations.label.serviceProividerId']}">#{row.spId}</p:column>
                <p:column filterBy="#{row.currentName}" filterable="true" filterStyle="display:none" sortBy="#{row.currentName}" headerText="#{msg['healthOrganizations.label.name']}">#{row.currentName}</p:column>
                <p:column filterBy="#{row.haName}" filterable="true" filterStyle="display:none" sortBy="#{row.haName}" headerText="#{msg['healthOrganizations.label.healthAuthority']}">#{row.haName}</p:column>
            </p:dataTable> 
        </h:form>

        <h:form id="healthOrganizationForm">

            <!-- Confirm Organization Deletion dialog -->
            <p:dialog id="deleteHODialog" visible="false"
                      closable="false" modal="true" resizable="false"
                      header="#{HealthOrganizationsBean.deleteDialogueHeader}" widgetVar="deleteHODialogWidget">
                <div class="dialogMessage">
                    <h:outputText value="#{HealthOrganizationsBean.deleteDialogueWarning}" escape="false" />
                </div>

                <p:commandButton id="healthOrganizationDeleteConfirm" value="#{msg['healthOrganizations.button.delete']}"
                                 widgetVar="healthOrganizationDeleteConfirmButton"
                                 styleClass="red" 
                                 action="#{HealthOrganizationsBean.deleteHealthOrganization()}"
                                 immediate="true" 
                                 update="healthOrganizationForm filterForm"
                                 process="healthOrganizationForm" 
                                 onclick="PF('healthOrganizationDialogWidget').hide(); PF('healthOrganizationDeleteCancelButton').disable(); PF('healthOrganizationDeleteConfirmButton').disable()"
                                 oncomplete="PF('deleteHODialogWidget').hide(); PF('healthOrganizationDialogWidget').hide(); PF('rulesTableWidget').clearFilters(); PrimeFaces.scrollTo('pageMessages')" />

                <p:commandButton id="healthOrganizationDeleteCancel"
                                 widgetVar="healthOrganizationDeleteCancelButton"
                                 value="#{msg['healthOrganizations.button.cancel']}"
                                 styleClass="secondary"
                                 onclick="PF('deleteHODialogWidget').hide();" />
            </p:dialog>

            <p:dialog id="healthOrganizationDialog" width="650" closable="false" modal="true" resizable="false" visible="false" 
                      widgetVar="healthOrganizationDialogWidget" header="#{HealthOrganizationsBean.dialogueHeader}">

                <div id="healthOrganizationDialogScroll" class="dialogueScroll" style="max-height: 600px">
                    <p:messages id="healthOrganizationMessages" closable="true" escape="false" />

                    <div class="ui-g">
                        <div class="ui-g-12">
                            <p:outputLabel for="healthOrganizationName" indicateRequired="true" value="#{msg['healthOrganizations.label.name']}" />
                            <p:inputText id="healthOrganizationName" value="#{HealthOrganizationsBean.currentHealthOrganization.currentName}" required="true" maxlength="80" />
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-8">
                            <p:outputLabel for="healthOrganizationSPID" indicateRequired="true" value="#{msg['healthOrganizations.label.SPID']}" styleClass="#{HealthOrganizationsBean.updateHealthAuthority?'disabled':''}" />
                            <p:inputText id="healthOrganizationSPID" value="#{HealthOrganizationsBean.currentHealthOrganization.spId}" required="true" maxlength="5" disabled="#{HealthOrganizationsBean.updateHealthAuthority}" />
                        </div>
                    </div>
                    <!-- Health Service Provider only -->
                    <ui:fragment rendered="#{!HealthOrganizationsBean.healthAuthoritySelected}">
                        <div class="ui-g">
                            <div class="ui-g-8">
                                <p:outputLabel for="healthOrganizationBedCapacity" indicateRequired="false" value="#{msg['healthOrganizations.label.bedCapacity']}" />
                                <p:inputText id="healthOrganizationBedCapacity" value="#{HealthOrganizationsBean.currentHealthOrganization.ratedBedCapacity}" maxlength="4" />
                            </div>
                        </div>

                        <div class="ui-g">
                            <div class="ui-g-8">
                                <p:outputLabel for="healthOrganizationProfileCode" indicateRequired="false" value="#{msg['healthOrganizations.label.profileCode']}" />
                                <p:inputText id="healthOrganizationProfileCode" value="#{HealthOrganizationsBean.currentHealthOrganization.profileCode}" maxlength="7" />
                            </div>
                        </div>
                        <div class="ui-g">
                            <div class="ui-g-8">
                                <p:outputLabel for="healthOrganizationOwnership" indicateRequired="true" value="#{msg['healthOrganizations.label.ownership']}" />
                                <p:inputText id="healthOrganizationOwnership" value="#{HealthOrganizationsBean.currentHealthOrganization.ownershipCode}" maxlength="1" required="true" />
                            </div>
                        </div>
                        <div class="ui-g">
                            <div class="ui-g-8">
                                <p:outputLabel for="healthOrganizationTeachingStatus" indicateRequired="false" value="#{msg['healthOrganizations.label.teachingStatus']}" />
                                <p:inputText id="healthOrganizationTeachingStatus" value="#{HealthOrganizationsBean.currentHealthOrganization.teachingStatusCode}" maxlength="1" />
                            </div>
                        </div>
                        <div class="ui-g">
                            <div class="ui-g-8">
                                <p:outputLabel for="healthOrganizationHA" indicateRequired="true" value="#{msg['healthOrganizations.label.healthAuthority']}" />
                                <h:selectOneMenu id="healthOrganizationHA" value="#{HealthOrganizationsBean.healthAuthority}" required="true"> 
                                    <f:selectItem itemLabel="Select" noSelectionOption="true" />
                                    <f:selectItems value="#{HealthOrganizationsBean.activeHealthAuthorities}" var="item" />
                                </h:selectOneMenu>
                            </div>
                        </div>
                        <div class="ui-g">
                            <div class="ui-g-8">
                                <p:outputLabel for="healthOrganizationRelationshipType" indicateRequired="true" value="#{msg['healthOrganizations.label.relationshipType']}" />
                                <h:selectOneMenu id="healthOrganizationRelationshipType" value="#{HealthOrganizationsBean.relationshipType}" required="true"> 
                                    <f:selectItems value="#{HealthOrganizationsBean.allowedRelationships}" var="item" />
                                </h:selectOneMenu>
                            </div>
                        </div>
                    </ui:fragment>
                    <!-- Health Authority only -->
                    <ui:fragment rendered="#{HealthOrganizationsBean.healthAuthoritySelected}">
                        <div class="ui-g">
                            <div class="ui-g-8">
                                <p:outputLabel for="healthOrganizationAuthorityTypeId" indicateRequired="true" value="#{msg['healthOrganizations.label.healthAuthorityType']}" />
                                <h:selectOneMenu id="healthOrganizationAuthorityTypeId" value="#{HealthOrganizationsBean.healthAuthorityType}" required="true"> 
                                    <f:selectItem itemLabel="Select" noSelectionOption="true" />
                                    <f:selectItems value="#{HealthOrganizationsBean.healthAuthorityTypes}" var="item" />
                                </h:selectOneMenu>
                            </div>
                        </div>
                        <div class="ui-g">
                            <div class="ui-g-8">
                                <p:outputLabel for="healthOrganizationHealthAuthorityNumber" indicateRequired="true" value="#{msg['healthOrganizations.label.healthAuthorityNumber']}" />
                                <p:inputText id="healthOrganizationHealthAuthorityNumber" value="#{HealthOrganizationsBean.currentHealthOrganization.haNumber}" maxlength="3" required="true" validatorMessage="#{msg['healthOrganizations.message.updateHA.errorHANumberRegex']}">
                                    <f:validateRegex pattern="[0-9]{1,3}" />
                                </p:inputText> 
                            </div>
                        </div>
                    </ui:fragment>
                    <!-- Common part -->
                    <div class="ui-g">
                        <div class="ui-g-8">
                            <p:outputLabel for="healthOrganizationHSDA" indicateRequired="true" value="#{msg['healthOrganizations.label.hsda']}" />
                            <h:selectOneMenu id="healthOrganizationHSDA" value="#{HealthOrganizationsBean.healthServiceDeliveryArea}" required="true"> 
                                <f:selectItem itemLabel="Select" noSelectionOption="true" />
                                <f:selectItems value="#{HealthOrganizationsBean.healthServiceDeliveryAreas}" var="item" />
                            </h:selectOneMenu>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-8">
                            <p:outputLabel for="healthOrganizationLHA" indicateRequired="true" value="#{msg['healthOrganizations.label.lha']}" />
                            <h:selectOneMenu id="healthOrganizationLHA" value="#{HealthOrganizationsBean.localHealthArea}" required="true"> 
                                <f:selectItem itemLabel="Select" noSelectionOption="true" />
                                <f:selectItems value="#{HealthOrganizationsBean.localHealthAreas}" var="item" />
                            </h:selectOneMenu>

                        </div>
                    </div>
                    <!-- Health Service Provider only -->
                    <ui:fragment rendered="#{!HealthOrganizationsBean.healthAuthoritySelected}">
                        <div class="ui-g">
                            <div class="ui-g-12">
                                <p:outputLabel for="healthOrganizationAddress" indicateRequired="true" value="#{msg['healthOrganizations.label.address']}" />
                                <p:inputTextarea id="healthOrganizationAddress" rows="3" value="#{HealthOrganizationsBean.currentHealthOrganization.institutionAddress}" maxlength="200" required="true" />
                            </div>
                        </div>
                    </ui:fragment>
                    <!-- Health Authority only -->
                    <ui:fragment rendered="#{HealthOrganizationsBean.healthAuthoritySelected}">
                        <div class="ui-g">
                            <div class="ui-g-8">
                                <p:outputLabel for="healthOrganizationOwnershipHA" indicateRequired="true" value="#{msg['healthOrganizations.label.ownership']}" />
                                <p:inputText id="healthOrganizationOwnershipHA" value="#{HealthOrganizationsBean.currentHealthOrganization.ownershipCode}" maxlength="1" required="true" />
                            </div>
                        </div>
                        <div class="ui-g">
                            <div class="ui-g-8">
                                <p:outputLabel for="healthOrganizationTeachingStatusHA" indicateRequired="true" value="#{msg['healthOrganizations.label.teachingStatus']}" />
                                <p:inputText id="healthOrganizationTeachingStatusHA" value="#{HealthOrganizationsBean.currentHealthOrganization.teachingStatusCode}" maxlength="1" required="true" />
                            </div>
                        </div>
                    </ui:fragment>
                    <div class="ui-g">
                        <div class="ui-g-8">
                            <p:outputLabel for="healthOrganizationCity" indicateRequired="true" value="#{msg['healthOrganizations.label.city']}" />
                            <p:inputText id="healthOrganizationCity" value="#{HealthOrganizationsBean.currentHealthOrganization.institutionCity}" maxlength="35" required="true" />
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-8">
                            <p:outputLabel for="healthOrganizationPostalCode" indicateRequired="true" value="#{msg['healthOrganizations.label.postalCode']}" />
                            <p:inputText id="healthOrganizationPostalCode" value="#{HealthOrganizationsBean.currentHealthOrganization.postalCode}" maxlength="6" required="true" />
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-12">
                            <p:outputLabel for="healthOrganizationComments" indicateRequired="false" value="#{msg['healthOrganizations.label.comments']}" />
                            <p:inputTextarea id="healthOrganizationComments" rows="3" value="#{HealthOrganizationsBean.currentHealthOrganization.supplierInstComments}" maxlength="255" />
                        </div>
                    </div>
                    <p:commandButton id="healthOrganizationCreate" value="#{msg['healthOrganizations.button.add']}"
                                     widgetVar="healthOrganizationCreateButton"
                                     onclick="PF('healthOrganizationCreateButton').disable(); PF('healthOrganizationCancelButton').disable()" 
                                     action="#{HealthOrganizationsBean.saveHealthOrganization()}" 
                                     update="healthOrganizationMessages filterForm"
                                     rendered="#{HealthOrganizationsBean.createHealthOrganization}" 
                                     process="healthOrganizationForm" 
                                     oncomplete="if (!args.validationFailed){PF('healthOrganizationDialogWidget').hide(); PF('rulesTableWidget').filter(); PrimeFaces.scrollTo('pageMessages')} else {PF('healthOrganizationCreateButton').enable(); PF('healthOrganizationCancelButton').enable(); document.getElementById('healthOrganizationDialogScroll').scrollTop=0;}" />
                    <p:commandButton id="healthOrganizationUpdate" value="#{msg['healthOrganizations.button.update']}" 
                                     widgetVar="healthOrganizationUpdateButton"
                                     onclick="PF('healthOrganizationUpdateButton').disable(); PF('healthOrganizationCancelButton').disable(); PF('healthOrganizationDeleteButton').disable()"
                                     action="#{HealthOrganizationsBean.saveHealthOrganization()}" 
                                     update="healthOrganizationMessages filterForm"
                                     rendered="#{!HealthOrganizationsBean.createHealthOrganization}" 
                                     process="healthOrganizationForm" 
                                     oncomplete="if (!args.validationFailed){PF('healthOrganizationDialogWidget').hide(); PF('rulesTableWidget').filter(); PrimeFaces.scrollTo('pageMessages')} else {PF('healthOrganizationUpdateButton').enable(); PF('healthOrganizationCancelButton').enable(); PF('healthOrganizationDeleteButton').enable(); document.getElementById('healthOrganizationDialogScroll').scrollTop=0;}" /> 
                    <p:commandButton id="healthOrganizationDelete" value="#{msg['healthOrganizations.button.delete']}"
                                     widgetVar="healthOrganizationDeleteButton" 
                                     styleClass="red"
                                     rendered="#{!HealthOrganizationsBean.createHealthOrganization}"
                                     onclick="PF('deleteHODialogWidget').show();" />

                    <p:commandButton id="healthOrganizationCancel" value="#{msg['healthOrganizations.button.cancel']}" styleClass="secondary"
                                     widgetVar="healthOrganizationCancelButton" 
                                     action="#{HealthOrganizationsBean.clearHealthOrganization()}" update="healthOrganizationForm filterForm" process="@this" oncomplete="PF('healthOrganizationDialogWidget').hide();">
                        <p:resetInput target="healthOrganizationForm" />
                    </p:commandButton>
                </div>
            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>