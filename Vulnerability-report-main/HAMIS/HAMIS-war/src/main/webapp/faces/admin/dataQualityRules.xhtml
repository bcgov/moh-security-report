<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns:h="http://java.sun.com/jsf/html" 
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:p="http://primefaces.org/ui" 
                template="/WEB-INF/templates/gov30Template.xhtml">

    <ui:define name="title">
        <h:outputFormat value="#{msg['title.dataQualityRules']}" />
    </ui:define>

    <ui:define name="content">
        <ui:include src="/WEB-INF/fragments/navTabs/adminTabs.xhtml" />
        <p:messages id="messages" closable="true" escape="false" />

        <h:form id="form1">
            <div class="ui-g">
                <div class="ui-g-9">
                    <p:outputLabel for="fiscalYear" value="#{msg['dataQuality.label.fiscalYear']}" styleClass="disabled" />
                    <h:selectOneMenu id="fiscalYear" value="#{DataQualityRulesBean.fiscalYear}" disabled="true">
                        <f:selectItem itemValue="#{DataQualityRulesBean.fiscalYear}" itemLabel="#{DataQualityRulesBean.fiscalYear}" />
                    </h:selectOneMenu>
                </div>
            </div>
            <div class="ui-g">
                <div class="ui-g-9">
                    <p:outputLabel for="providerType" value="#{msg['dataQuality.label.providerType']}" />
                    <h:selectOneMenu id="providerType" value="#{DataQualityRulesBean.providerType}" required="true"> 
                        <p:ajax event="change" listener="#{DataQualityRulesBean.onProviderTypeChange()}" update="rulesForm" />
                        <f:selectItems value="#{DataQualityRulesBean.providerTypes}" var="item" />
                    </h:selectOneMenu>
                </div>
            </div>
        </h:form>

        <h:form id="rulesForm">
            <p:dataTable id="rulesTable" value="#{DataQualityRulesBean.rules}"
                         var="row" rowKey="#{row.dqptId}" rowIndexVar="rowIndex"
                         paginator="false" paginatorAlwaysVisible="false" rows="50" paginatorPosition="top"
                         currentPageReportTemplate="{startRecord} - {endRecord} of {totalRecords}" 
                         paginatorTemplate="{CurrentPageReport} {PreviousPageLink} {NextPageLink}"
                         widgetVar="rulesTableWidget" sortBy="#{row.primAcctDefn}"
                         selection="#{DataQualityRulesBean.selectedRule}" selectionMode="single">
                <p:ajax event="rowSelect" oncomplete="PF('ruleWidget').show();" update="ruleDialog" />
                <p:column sortBy="#{row.primAcctDefn}" sortOrder="asc" headerText="#{msg['dataQuality.label.primaryAccount']}">#{row.primAcctDefn}</p:column>
                <p:column sortBy="#{row.scndAcctDefn}" headerText="#{msg['dataQuality.label.secondaryAccount']}">#{row.scndAcctDefn}</p:column>
                <p:column sortBy="#{row.testCondition}" headerText="#{msg['dataQuality.label.testCondition']}">#{row.testConditionDesc}</p:column>
                <p:column sortBy="#{row.testSeverity}" headerText="#{msg['dataQuality.label.testSeverity']}">#{row.testSeverityDesc}</p:column>
                <p:column sortBy="#{row.fsDataType}" headerText="#{msg['dataQuality.label.dataType']}">#{row.fsDataTypeDesc}</p:column>
                <p:column sortBy="#{row.abTrxnType}" headerText="#{msg['dataQuality.label.transactionType']}">#{row.abTrxnTypeDesc}</p:column>
            </p:dataTable> 
            <p:commandButton id="create" value="#{msg['hamis.button.create']}" update="ruleDialog" oncomplete="PF('ruleWidget').show();" process="@this" actionListener="#{DataQualityRulesBean.createRule()}">
            </p:commandButton>
        </h:form>

        <p:dialog id="ruleDialog" header="#{DataQualityRulesBean.selectedRule.dqptId==null?msg['dataQuality.createRule']:msg['dataQuality.updateRule']}" width="650" closable="false" modal="true" resizable="false" visible="false" widgetVar="ruleWidget">
            <h:form id="ruleForm">
                <div id="ruleDialogScroll" class="dialogueScroll">
                    <p:messages id="ruleMessages" closable="true" />
                    <div class="ui-g">
                        <div class="ui-g-12">
                            <p:outputLabel for="providerType" value="#{msg['dataQuality.label.providerType']}" styleClass="disabled" />
                            <h:selectOneMenu id="providerType" value="#{DataQualityRulesBean.providerType}" disabled="true" styleClass="disabled"> 
                                <f:selectItems value="#{DataQualityRulesBean.providerTypes}" var="item" />
                            </h:selectOneMenu>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-6">
                            <p:outputLabel for="primaryAccount" value="#{msg['dataQuality.label.primaryAccountDefinition']}" indicateRequired="true" />
                            <p:inputText id="primaryAccount" maxlength="9" value="#{DataQualityRulesBean.selectedRule.primAcctDefn}" required="true" />
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-6">
                            <p:outputLabel for="secondaryAccount" value="#{msg['dataQuality.label.secondaryAccountDefinition']}" indicateRequired="true" />
                            <p:inputText id="secondaryAccount" maxlength="7" value="#{DataQualityRulesBean.selectedRule.scndAcctDefn}" required="true" />
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-6">
                            <p:outputLabel for="testCondition" value="#{msg['dataQuality.label.testCondition']}" indicateRequired="true" />
                            <h:selectOneMenu id="testCondition" value="#{DataQualityRulesBean.selectedRule.testCondition}" required="true">
                                <f:selectItem itemLabel="Select" noSelectionOption="true" />
                                <f:selectItems value="#{DroplistBean.testConditions}" />
                            </h:selectOneMenu>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-6">
                            <p:outputLabel for="testSeverity" value="#{msg['dataQuality.label.testSeverity']}" indicateRequired="true" />
                            <h:selectOneMenu id="testSeverity" value="#{DataQualityRulesBean.selectedRule.testSeverity}" required="true">
                                <f:selectItem itemLabel="Select" noSelectionOption="true" />
                                <f:selectItems value="#{DroplistBean.testSeverities}" />
                            </h:selectOneMenu>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-6">
                            <p:outputLabel for="dataType" value="#{msg['dataQuality.label.dataType']}" indicateRequired="true" />
                            <h:selectOneMenu id="dataType" value="#{DataQualityRulesBean.selectedRule.fsDataType}" required="true">
                                <f:selectItem itemLabel="Select" noSelectionOption="true" />
                                <f:selectItems value="#{DroplistBean.dataTypes}" />
                            </h:selectOneMenu>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-6">
                            <p:outputLabel for="transactionType" value="#{msg['dataQuality.label.transactionType']}" indicateRequired="true" />
                            <h:selectOneMenu id="transactionType" value="#{DataQualityRulesBean.selectedRule.abTrxnType}" required="true">
                                <f:selectItem itemLabel="Select" noSelectionOption="true" />
                                <f:selectItems value="#{DroplistBean.transactionTypes}" />
                            </h:selectOneMenu>
                        </div>
                    </div>
                    <div class="ui-g">
                        <p:commandButton id="addUpdate" value="#{DataQualityRulesBean.selectedRule.dqptId==null?msg['hamis.button.create']:msg['hamis.button.update']}" action="#{DataQualityRulesBean.saveRule()}" update="rulesForm messages ruleMessages" oncomplete="if (!args.validationFailed){PF('ruleWidget').hide();}else{document.getElementById('ruleDialogScroll').scrollTop=0;}" />
                        <p:commandButton id="cancel" value="#{msg['hamis.button.cancel']}" styleClass="secondary" oncomplete="PF('ruleWidget').hide();" process="@this" update="messages ruleForm rulesForm" actionListener="#{DataQualityRulesBean.cancel()}">
                            <p:resetInput target="ruleForm" />
                        </p:commandButton>
                        <p:commandButton id="delete" value="#{msg['hamis.button.delete']}" styleClass="red" onclick="PF('deleteDialogWidget').show();" rendered="#{DataQualityRulesBean.selectedRule.dqptId!=null}" />
                    </div>
                </div>
            </h:form>
        </p:dialog>

        <p:dialog id="deleteDialog" width="650" closable="false" modal="true" resizable="false" visible="false" widgetVar="deleteDialogWidget" header="#{msg['dataQuality.deleteTitle']}">
            <div class="dialogMessage">
                #{msg['dataQuality.deleteDesc']}
            </div>
            <h:form id="deleteForm">
                <p:commandButton id="delete" value="#{msg['hamis.button.delete']}" styleClass="red" action="#{DataQualityRulesBean.delete()}" ajax="false" oncomplete="PF('deleteDialogWidget').hide();PF('ruleWidget').hide();" update="rulesForm messages" />
                <p:commandButton id="cancel" value="#{msg['hamis.button.cancel']}" styleClass="secondary" oncomplete="PF('deleteDialogWidget').hide();" process="@this" />
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>