<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns:h="http://java.sun.com/jsf/html" 
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:p="http://primefaces.org/ui" 
                template="/WEB-INF/templates/gov30Template.xhtml">

    <ui:define name="title">
        <h:outputFormat value="#{msg['title.authorizeDS']}" />
    </ui:define>

    <ui:define name="content">

        <ui:include src="/WEB-INF/fragments/navTabs/dataSubmissionTabs.xhtml" />

        <h:form id="filterForm">

            <p:messages closable="true" />

            <p:dataTable value="#{AuthorizeDataSubmitterBean.dataSubmitters}" var="row" selectionMode="single" 
                         selection="#{AuthorizeDataSubmitterBean.selectedDataSubmitter}" rowKey="#{row.userId}" rowIndexVar="rowIndex"
                         onRowClick="PF('removeDialog').show()" id="table" sortBy="#{row.username}">
                <p:ajax event="rowSelect" update="removeForm" />
                <p:column sortBy="#{row.username}" sortOrder="asc" headerText="#{msg['authorizeDs.label.authorizedUsers']}">#{row.username}</p:column>
                <p:column sortBy="#{row.name}" headerText="#{msg['authorizeDs.label.name']}">#{row.name}</p:column>
                <p:column sortBy="#{row.healthOrganization}" headerText="#{msg['authorizeDs.label.ha']}">#{row.healthOrganization}</p:column>
                <p:column sortBy="#{row.emailAddress}" headerText="#{msg['authorizeDs.label.email']}">#{row.emailAddress}</p:column>
                <p:column sortBy="#{row.telephoneNumber}" headerText="#{msg['authorizeDs.label.telephone']}">#{row.telephoneNumber}</p:column>
                <p:column sortBy="#{row.effDt}" headerText="#{msg['authorizeDs.label.effectiveDate']}"><h:outputText value="#{row.effDt}"><f:convertDateTime pattern="MMM d, YYYY" /></h:outputText></p:column>
            </p:dataTable>
            <p:tooltip value="#{msg['authorizeDs.button.remove']}" for="filterForm:table" showDelay="500" trackMouse="true" />
            <p:commandButton id="assignUser" value="#{msg['authorizeDs.button.assignUser']}" action="#{AuthorizeDataSubmitterBean.clear()}" update="assignForm" oncomplete="PF('assignDialog').show()" />

        </h:form>
        <p:dialog modal="true" widgetVar="assignDialog" closable="false" resizable="false" draggable="false" header="#{msg['authorizeDs.button.assignUser']}" width="650">
            <h:form id="assignForm">
                <p:messages closable="true" />
                <div class="ui-g">
                    <div class="ui-g-6">
                        <p:outputLabel for="assignForm:userId" indicateRequired="true" value="#{msg['authorizeDs.label.userId']}"></p:outputLabel>
                        <h:selectOneMenu id="userId" required="true" value="#{AuthorizeDataSubmitterBean.selectedUser}">
                            <p:ajax event="change" listener="#{AuthorizeDataSubmitterBean.selectUnassignedUser()}" process="@this" update="userId email telephone name" />
                            <f:selectItem noSelectionOption="true" />
                            <f:selectItems value="#{AuthorizeDataSubmitterBean.unassignedUsers}" />
                        </h:selectOneMenu>
                    </div>
                    <div class="ui-g-6">
                        <p:outputLabel styleClass="disabled" for="email"><h:outputText value="#{msg['authorizeDs.label.email']}" /></p:outputLabel>
                        <p:inputText id="email" value="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.emailAddress}" disabled="true" style="pointer-events: all" title="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.emailAddress}" />
                    </div>
                </div>
                <div class="ui-g">
                    <div class="ui-g-6">
                        <p:outputLabel for="assignForm:healthOrganization" indicateRequired="true" value="#{msg['authorizeDs.label.healthOrganization']}" styleClass="#{UserBean.isDataSubmitter()?'disabled':''}" />
                        <h:selectOneMenu id="healthOrganization" required="true" value="#{AuthorizeDataSubmitterBean.selectedAssignedHo}" disabled="#{UserBean.isDataSubmitter()}">
                            <f:selectItem noSelectionOption="true" />
                            <f:selectItems value="#{AuthorizeDataSubmitterBean.healthAuthorities}" />
                        </h:selectOneMenu>
                    </div>
                    <div class="ui-g-6">
                        <p:outputLabel styleClass="disabled" for="telephone">#{msg['authorizeDs.label.telephone']}</p:outputLabel>
                        <p:inputText id="telephone" value="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.telephoneNumber}" disabled="true" style="pointer-events: all" title="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.telephoneNumber}" />
                    </div>
                </div>
                <div class="ui-g">
                    <div class="ui-g-6">
                        <p:outputLabel styleClass="disabled" for="name">#{msg['authorizeDs.label.name']}</p:outputLabel>
                        <p:inputText id="name" value="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.name}" disabled="true" style="pointer-events: all" title="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.name}" />
                    </div>
                </div>
                <div class="ui-g">
                    <p:commandButton id="assign" value="#{msg['authorizeDs.button.assign']}" action="#{AuthorizeDataSubmitterBean.assign()}" update="assignForm filterForm" process="assignForm" oncomplete="if (!args.validationFailed){PF('assignDialog').hide();}" /> 
                    <p:commandButton id="cancelAssign" value="#{msg['authorizeDs.button.cancel']}" styleClass="secondary" action="#{AuthorizeDataSubmitterBean.clear()}" update="assignForm" process="@this" oncomplete="PF('assignDialog').hide()" />
                </div>
            </h:form>
        </p:dialog>

        <p:dialog modal="true" widgetVar="removeDialog" closable="false" resizable="false" draggable="false" header="#{msg['authorizeDs.label.removeUser']}" width="650">
            <h:form id="removeForm">
                <p><h:outputText value="#{msg['authorizeDs.text.removed']}#{AuthorizeDataSubmitterBean.selectedDataSubmitter.healthOrganization}" /></p>
                <div class="ui-g">
                    <div class="ui-g-6">
                        <p:outputLabel styleClass="disabled" for="userId">#{msg['authorizeDs.label.userId']}</p:outputLabel>
                        <p:inputText id="userId" value="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.username}" disabled="true" style="pointer-events: all" title="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.username}" />
                    </div>
                    <div class="ui-g-6">
                        <p:outputLabel styleClass="disabled" for="email">#{msg['authorizeDs.label.email']}</p:outputLabel>
                        <p:inputText id="email" value="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.emailAddress}" disabled="true" style="pointer-events: all" title="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.emailAddress}" />
                    </div>
                </div>
                <div class="ui-g">
                    <div class="ui-g-6">
                        <p:outputLabel styleClass="disabled" for="healthOrganization">#{msg['authorizeDs.label.ha']}</p:outputLabel>
                        <p:inputText id="healthOrganization" value="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.healthOrganization}" disabled="true" style="pointer-events: all" title="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.healthOrganization}" />
                    </div>
                    <div class="ui-g-6">
                        <p:outputLabel styleClass="disabled" for="telephone">#{msg['authorizeDs.label.telephone']}</p:outputLabel>
                        <p:inputText id="telephone" value="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.telephoneNumber}" disabled="true" style="pointer-events: all" title="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.telephoneNumber}" />
                    </div>
                </div>
                <div class="ui-g">
                    <div class="ui-g-6">
                        <p:outputLabel styleClass="disabled" for="name">#{msg['authorizeDs.label.name']}</p:outputLabel>
                        <p:inputText id="name" value="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.name}" disabled="true" style="pointer-events: all" title="#{AuthorizeDataSubmitterBean.selectedDataSubmitter.name}" />
                    </div>
                </div>
                <div class="ui-g">
                    <p:commandButton id="remove" value="#{msg['authorizeDs.button.remove']}" process="removeForm" update="removeForm filterForm" styleClass="red" action="#{AuthorizeDataSubmitterBean.remove()}" oncomplete="PF('removeDialog').hide();" /> 
                    <p:commandButton id="cancelRemove" value="#{msg['authorizeDs.button.cancel']}" styleClass="secondary" process="@this" update="removeForm" action="#{AuthorizeDataSubmitterBean.clear()}" oncomplete="PF('removeDialog').hide()" />
                </div>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>