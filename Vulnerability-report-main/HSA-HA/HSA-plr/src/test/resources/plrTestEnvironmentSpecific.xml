<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xmlns:jee="http://www.springframework.org/schema/jee"
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
           http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
           http://www.springframework.org/schema/util
           http://www.springframework.org/schema/util/spring-util-3.2.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-3.2.xsd
           http://camel.apache.org/schema/spring
           http://camel.apache.org/schema/spring/camel-spring.xsd
           http://www.springframework.org/schema/util 
           http://www.springframework.org/schema/util/spring-util-3.2.xsd
           http://www.springframework.org/schema/jee 
           http://www.springframework.org/schema/jee/spring-jee-3.2.xsd"
>
          
    
    <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer" id="plrCustomConfigProperties">
        <property name="location">
            <value>classpath:plrCustomConfig.properties</value>
        </property>
    </bean>
    
    <bean id="fileDropConfig" class="ca.bc.gov.moh.hsa.util.audit.FileDropConfiguration">
        
    </bean>
    
    <bean id="noErrorHandler" class="org.apache.camel.builder.NoErrorHandlerBuilder"/>
 
<!--    Don't want to start JMS for some tests-->
<!--    <bean id="openMQ" class="org.apache.camel.component.jms.JmsComponent">
        <property name="connectionFactory" ref="jmsConnectionFactory"/>
    </bean>
 
    <jee:jndi-lookup id="jmsConnectionFactory" jndi-name="jms/__defaultConnectionFactory"/>    -->
    
    <routeContext id="customRoutes2" xmlns="http://camel.apache.org/schema/spring">
       
        <route id="incomingClientA">
            <from uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientA/IN?password=VnFy6qAG&amp;delay=3000&amp;streamDownload=true&amp;delete=true"/>
            <setHeader headerName="client">
                <constant>A</constant>        
            </setHeader>
            <to uri="direct:inboundBatch"/>
        </route>   
        
        <route id="incomingClientB">
            <from uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientB/IN?password=VnFy6qAG&amp;delay=3000&amp;streamDownload=true&amp;delete=true"/>
            <setHeader headerName="client">
                <constant>B</constant>        
            </setHeader>
            <to uri="direct:inboundBatch"/>
        </route>   
           
        <route id="outgoingSFTP" errorHandlerRef="noErrorHandler">
            <from uri="direct:batchResponse"/>
            <!--<to uri="audit:outgoingSFTP"/>-->
            <choice>
                <when>
                    <simple>${header.client} == 'A'</simple>
                    <!--<to uri="audit:outgoingClientA"/>-->
                    <to uri="direct:clientAResponse"/>
                </when>
                <when>
                    <simple>${header.client} == 'B'</simple>
                    <!--<to uri="audit:outgoingClientB"/>-->
                    <to uri="direct:clientBResponse"/>
                </when>
                <otherwise>
                    <!--<to uri="audit:outgoingClientC"/>-->
                    <to uri="direct:clientCResponse"/>
                </otherwise>
            </choice>
        </route>   
           
        <route id="outgoingClientA" errorHandlerRef="noErrorHandler">
            <from uri="direct:clientAResponse"/>
            <to uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientA/OUT?password=VnFy6qAG&amp;fileName=PLR_XML_Response_${date:now:yyyyMMddHHmmssSSS}.xml"/>
        </route>   
           
        <route id="outgoingClientB" errorHandlerRef="noErrorHandler">
            <from uri="direct:clientBResponse"/>
            <to uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientB/OUT?password=VnFy6qAG&amp;fileName=PLR_XML_Response_${date:now:yyyyMMddHHmmssSSS}.xml"/>
        </route>   
           
        <route id="outgoingClientC" errorHandlerRef="noErrorHandler">
            <from uri="direct:clientCResponse"/>
            <to uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientC/OUT?password=VnFy6qAG&amp;fileName=PLR_XML_Response_${date:now:yyyyMMddHHmmssSSS}.xml"/>
        </route>   
        
    </routeContext>
    
    <routeContext id="customRoutes" xmlns="http://camel.apache.org/schema/spring">
       
        <route id="placeholder">
            <from uri="direct:placeholder"/>
            <to uri="log:placeholderroute?level=DEBUG"/>
        </route>      
        
    </routeContext>
 
</beans>

