package ca.bc.gov.moh.hsa.plr.esb.service.batch;

import ca.bc.gov.health.plr.dto.esb.BatchTransactionStatusRequest;
import ca.bc.gov.health.plr.dto.provider.esb.BatchStatus;
import static ca.bc.gov.moh.hsa.util.audit.TransactionIDAssigner.TRANSACTION_ID_HEADER_KEY;
import org.apache.camel.Exchange;
import org.apache.commons.lang.Validate;
import org.springframework.stereotype.Component;

/**
 *
 * @author conrad.gustafson
 */
@Component
public class BatchStatusReporter {

    public void process(Exchange exchange, BatchStatus status) throws Exception {
        Validate.notNull(status, "BatchStatus cannot be null.");
        String client = exchange.getIn().getHeader(Exchange.FILE_PATH, String.class);
        
        BatchTransactionStatusRequest batchStatusRequest = new BatchTransactionStatusRequest();
        batchStatusRequest.setStatus(status);
        batchStatusRequest.setClient(client);
        String uniqueMessageId = (String) exchange.getIn().getHeader(TRANSACTION_ID_HEADER_KEY);
        batchStatusRequest.setUniqueMessageId(uniqueMessageId);
        
        exchange.getIn().setBody(batchStatusRequest);
    }
    
}
