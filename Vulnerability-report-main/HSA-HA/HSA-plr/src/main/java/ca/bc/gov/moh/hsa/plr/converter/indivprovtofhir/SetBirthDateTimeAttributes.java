/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.moh.hsa.plr.converter.indivprovtofhir;

import ca.bc.gov.moh.hsa.plr.converter.facilitytofhir.SetAttributesCommon;
import static ca.bc.gov.moh.hsa.plr.converter.indivprovtofhir.ProviderFhirConstants.BC_PROVIDER_BIRTHTIME_EXTENSION_URL;
import ca.bc.gov.moh.hsa.plr.esb.fhir.common.FHIRFactory;
import java.util.Date;

/**
 *
 * @author dan.stepanov
 */
public class SetBirthDateTimeAttributes extends SetAttributesCommon {

    public SetBirthDateTimeAttributes(FHIRFactory theFactory) {
        super(theFactory);
    }

    public void setBirthDateTime(Object parent, Date dob) {
        if (dob != null) {

            // add new dateType
            Object dateType = factory.newDateType();
            factory.callMethod(parent, "setBirthDateElement", dateType);
            Object dateTimeType = factory.newDateTimeType(dob);

            // Create an extension and add it to the dateType/_birthdate 
            Object bcBirthdateExt = factory.newExtension();
            // set bc birthtime extension url/value
            factory.callMethod(bcBirthdateExt, "setUrl", BC_PROVIDER_BIRTHTIME_EXTENSION_URL);
            factory.callMethod(bcBirthdateExt, "setValue", dateTimeType);
            // add extension to new dateType
            factory.callMethod(dateType, "addExtension", bcBirthdateExt);
        }
    }

}
