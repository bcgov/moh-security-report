/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.moh.hsa.plr.converter;

import ca.bc.gov.health.plr.dto.esb.BatchResponse;
import ca.bc.gov.health.plr.dto.esb.MaintainProviderResponse;
import ca.bc.gov.moh.hsa.plr.entity.transaction.BatchInformationMessageEntity;
import ca.bc.gov.moh.hsa.plr.entity.transaction.BatchResponseEntity;
import ca.bc.gov.moh.hsa.plr.entity.transaction.MaintainProviderResponseEntity;
import java.lang.reflect.InvocationTargetException;
import java.util.Collection;
import java.util.List;
import org.apache.commons.lang.StringUtils;

/**
 *
 * @author conrad.gustafson
 */
public class BatchResponseToEntityConverter extends PLRDtoToEntityConverter {

    static BatchResponseEntity convertBatchResponseToEntity(BatchResponse batchResponse)
            throws IllegalAccessException, InvocationTargetException {

        BatchResponseEntity batchResponseEntity = new BatchResponseEntity();

        convertHeader(batchResponse, batchResponseEntity);
        convertTarget(batchResponse, batchResponseEntity);
        convertSource(batchResponse, batchResponseEntity);

        List<BatchInformationMessageEntity> batchInformationEntityList = batchResponseEntity.getInformationMessages();

        String submittedTransactions = batchResponse.getSubmittedTransactions();
        String successfulTransactions = batchResponse.getSuccessfulTransactions();
        String failedTransactions = batchResponse.getFailedTransactions();
        String responseContent = batchResponse.getResponseContent();

        if (!StringUtils.isEmpty(submittedTransactions)) {
            batchInformationEntityList.add(new BatchInformationMessageEntity("SUBMITTED_TRANSACTIONS", submittedTransactions));
        }
        if (!StringUtils.isEmpty(successfulTransactions)) {
            batchInformationEntityList.add(new BatchInformationMessageEntity("SUCCESSFUL_TRANSACTIONS", successfulTransactions));
        }
        if (!StringUtils.isEmpty(failedTransactions)) {
            batchInformationEntityList.add(new BatchInformationMessageEntity("FAILED_TRANSACTIONS", failedTransactions));
        }
        if (!StringUtils.isEmpty(responseContent)) {
            batchInformationEntityList.add(new BatchInformationMessageEntity("RESPONSE_CONTENT", responseContent));
        }

        List<MaintainProviderResponseEntity> maintainProviderResponseEntities = batchResponseEntity.getMaintainProviderResponseEntities();
        Collection<MaintainProviderResponse> maintainProviderResponses = batchResponse.getMaintainProviderResponses();
        for (MaintainProviderResponse maintainProviderResponse : maintainProviderResponses) {
            MaintainProviderResponseEntity entity = MaintainProviderResponseToEntityConverter.convertMaintainProviderResponseMessageToEntity(maintainProviderResponse);
            maintainProviderResponseEntities.add(entity);
        }

        return batchResponseEntity;
    }
}
