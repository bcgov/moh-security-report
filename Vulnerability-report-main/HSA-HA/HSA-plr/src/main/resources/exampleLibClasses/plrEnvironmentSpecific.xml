<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:camel="http://camel.apache.org/schema/spring"
       xmlns:jee="http://www.springframework.org/schema/jee"
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
                           http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
                           http://www.springframework.org/schema/util
                           http://www.springframework.org/schema/util/spring-util-3.2.xsd
                           http://www.springframework.org/schema/context
                           http://www.springframework.org/schema/context/spring-context-3.2.xsd
                           http://camel.apache.org/schema/spring
                           http://camel.apache.org/schema/spring/camel-spring.xsd
                           http://www.springframework.org/schema/util 
                           http://www.springframework.org/schema/util/spring-util-3.2.xsd
		           http://www.springframework.org/schema/jee 
                           http://www.springframework.org/schema/jee/spring-jee-3.2.xsd"
       >

  <sslContextParameters id="sslParameters" xmlns="http://camel.apache.org/schema/spring">
    <!-- <keyManagers -->
    <!--     keyPassword="HCIM"> -->
    <!--   <keyStore -->
    <!--       resource="distributions.jks" -->
    <!--       password="changeit" -->
    <!--       /> -->
    <!-- </keyManagers> -->
    <!-- <trustManagers> -->
    <!--   <keyStore  -->
    <!--       resource="trust.jks" -->
    <!--       password="changeit"/> -->
    <!-- </trustManagers> -->
  </sslContextParameters>  

  <bean id="bridgePropertyPlaceholder" class="org.apache.camel.spring.spi.BridgePropertyPlaceholderConfigurer">
    <property name="location" value="classpath:plrCustomConfig.properties"/>
  </bean>
  
  <bean id="noErrorHandler" class="org.apache.camel.builder.NoErrorHandlerBuilder"/>
  
  <bean id="openMQ" class="org.apache.camel.component.jms.JmsComponent">
    <property name="connectionFactory" ref="jmsConnectionFactory"/>
  </bean>
  
  <bean id="println" class="ca.bc.gov.moh.hsa.util.Println"/>
  
  <jee:jndi-lookup id="jmsConnectionFactory" jndi-name="jms/__defaultConnectionFactory"/>
  
  <routeContext id="customRoutes2" xmlns="http://camel.apache.org/schema/spring">
    
    <route id="placeholder">
      <from uri="direct:placeholder"/>
      <to uri="log:placeholderroute?level=DEBUG"/>
    </route>      
    
  </routeContext>
  
  <routeContext id="customRoutes" xmlns="http://camel.apache.org/schema/spring">

    <route id="outgoingDistributionPlaceholder">
      <from uri="direct:distributionOutbound"/>
      <to uri="bean:println"/>
      <!-- <to uri="spring-ws:http://localhost?sslContextParameters=#sslParameters"/> -->
    </route>
                      
    <route id="incomingClientDS">
      <from uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientDS/IN?{{ftpRouteOptions}}"/>
      <setHeader headerName="client">
        <constant>DS</constant>        
      </setHeader>
      <to uri="direct:inboundBatch"/>
    </route>
    
    <route id="incomingClientDS2">
      <from uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientDS2/IN?{{ftpRouteOptions}}"/>
      <setHeader headerName="client">
        <constant>DS2</constant>
      </setHeader>
      <to uri="direct:inboundBatch"/>
    </route>
	
    <!-- <route id="incomingClientDEV"> -->
    <!--   <from uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientDEV/IN?{{ftpRouteOptions}}"/> -->
    <!--   <setHeader headerName="client"> -->
    <!--     <constant>DEV</constant> -->
    <!--   </setHeader> -->
    <!--   <to uri="direct:inboundBatch"/> -->
    <!-- </route>	 -->
    
    <route id="incomingClientA">
      <from uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientA/IN?{{ftpRouteOptions}}"/>
      <setHeader headerName="client">
        <constant>A</constant>        
      </setHeader>
      <to uri="direct:inboundBatch"/>
    </route>   
    
    <route id="incomingClientB">
      <from uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientB/IN?{{ftpRouteOptions}}"/>
      <setHeader headerName="client">
        <constant>B</constant>        
      </setHeader>
      <to uri="direct:inboundBatch"/>
    </route>   
    
    <route id="outgoingSFTP" errorHandlerRef="noErrorHandler">
      <from uri="direct:batchResponse"/>
      <to uri="audit:outgoingSFTP"/>
      <to uri="bean:println"/>
      <choice>
        <when>
          <simple>${header.client} == 'DS'</simple>
          <to uri="audit:outgoingClientDS"/>
          <to uri="direct:clientDSResponse"/>
        </when>
        <when>
          <simple>${header.client} == 'DS2'</simple>
          <to uri="audit:outgoingClientDS2"/>
          <to uri="direct:clientDS2Response"/>
        </when>
        <when>
          <simple>${header.client} == 'DEV'</simple>
          <to uri="audit:outgoingClientDEV"/>
          <to uri="direct:clientDEVResponse"/>
        </when>
        <when>
          <simple>${header.client} == 'A'</simple>
          <to uri="audit:outgoingClientA"/>
          <to uri="direct:clientAResponse"/>
        </when>
        <when>
          <simple>${header.client} == 'B'</simple>
          <to uri="audit:outgoingClientB"/>
          <to uri="direct:clientBResponse"/>
        </when>
        <otherwise>
          <to uri="audit:outgoingClientC"/>
          <to uri="direct:clientCResponse"/>
        </otherwise>
      </choice>
    </route>   
    
    <route id="outgoingClientDS" errorHandlerRef="noErrorHandler">
      <from uri="direct:clientDSResponse"/>
      <to uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientDS/OUT?password=VnFy6qAG&amp;fileName=PLR_XML_Response_${date:now:yyyyMMddHHmmssSSS}.xml"/>
    </route>

    <route id="outgoingClientDS2" errorHandlerRef="noErrorHandler">
      <from uri="direct:clientDS2Response"/>
      <to uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientDS2/OUT?password=VnFy6qAG&amp;fileName=PLR_XML_Response_${date:now:yyyyMMddHHmmssSSS}.xml"/>
    </route>   
	
    <route id="outgoingClientDEV" errorHandlerRef="noErrorHandler">
      <from uri="direct:clientDEVResponse"/>
      <to uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientDEV/OUT?password=VnFy6qAG&amp;fileName=PLR_XML_Response_${date:now:yyyyMMddHHmmssSSS}.xml"/>
    </route>   
    
    <route id="outgoingClientA" errorHandlerRef="noErrorHandler">
      <from uri="direct:clientAResponse"/>
      <to uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientA/OUT?password=VnFy6qAG&amp;fileName=PLR_XML_Response_${date:now:yyyyMMddHHmmssSSS}.xml"/>
    </route>   
    
    <route id="outgoingClientB" errorHandlerRef="noErrorHandler">
      <from uri="direct:clientBResponse"/>
      <to uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientB/OUT?password=VnFy6qAG&amp;fileName=PLR_XML_Response_${date:now:yyyyMMddHHmmssSSS}.xml"/>
    </route>   
    
    <route id="outgoingClientC" errorHandlerRef="noErrorHandler">
      <from uri="direct:clientCResponse"/>
      <to uri="sftp://PLRDEV@ftpsvcs.hlth.gov.bc.ca:22/PLRDEV/ClientC/OUT?password=VnFy6qAG&amp;fileName=PLR_XML_Response_${date:now:yyyyMMddHHmmssSSS}.xml"/>
    </route>   
    
  </routeContext>
  
</beans>

