/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.moh.hsa.util.audit;

import org.apache.camel.Exchange;
import org.apache.camel.component.file.GenericFileEndpoint;
import org.apache.camel.component.file.GenericFileOperations;
import org.apache.camel.component.file.GenericFileProducer;

/**
 *
 * @author conrad.gustafson
 */
public class ConfigurableFileProducer<T> extends GenericFileProducer<T> {

    private final ConfigurableFileEndpoint endpoint;

    protected ConfigurableFileProducer(ConfigurableFileEndpoint endpoint, GenericFileOperations<T> operations) {
        super((GenericFileEndpoint<T>) endpoint, operations);
        this.endpoint = endpoint;
    }

    @Override
    public void process(Exchange exchange) throws Exception {
        String transactionType = exchange.getIn().getHeader(FileDropComponent.TRANSACTION_MESSAGE_TYPE_HEADER_KEY, String.class);
        String messageContext = getMessageContext();

        boolean messageToBeSaved = isMessageToBeSaved(transactionType, messageContext);

        if (messageToBeSaved) {
            super.process(exchange);
        }
    }

    public String getMessageContext() {
        return endpoint.getMessageContext();
    }

    private boolean isMessageToBeSaved(String transactionType, String messageContext) {
        return endpoint.isMessageToBeSaved(transactionType, messageContext);
    }
}
