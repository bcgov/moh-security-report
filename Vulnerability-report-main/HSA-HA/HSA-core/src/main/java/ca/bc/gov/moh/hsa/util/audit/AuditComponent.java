/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.moh.hsa.util.audit;

import ca.bc.gov.moh.hsa.util.audit.entity.dao.TransactionDAO;
import java.util.Map;
import org.apache.camel.Endpoint;
import org.apache.camel.impl.DefaultComponent;
import org.springframework.beans.factory.annotation.Autowired;

/**
 * Component for setting up audit endpoints. Can be configured with level and status parameters, which will be passed to the audit processor.
 * @author greg.perkins
 */
public class AuditComponent extends DefaultComponent {

    /**
     * DAO to pass to the processor for persistence
     */
    @Autowired
    private TransactionDAO dao;
    
    /**
     * Creates the endpoint for auditing
     * @param uri protocol
     * @param remaining enventType
     * @param map Map<String,Object> extra parameters
     * @return Endpoint
     * @throws Exception 
     */
    @Override
    protected Endpoint createEndpoint(String uri, String remaining, Map<String, Object> map) throws Exception {
        String level = null;
        String status = null;
        String transactionType = null;
        
        if (map.containsKey("level")){
            level = map.get("level").toString();
        }
        if (map.containsKey("status")){
            status = map.get("status").toString();
        }        
        if (map.containsKey("transactionType")){
            transactionType = map.get("transactionType").toString();
        }
        
        AuditProcessor ap = new AuditProcessor(remaining,level,status,transactionType);
        ap.setDao(dao);
        
        return new AuditEndpoint(uri, ap);
    }
}

