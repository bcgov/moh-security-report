<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30Template.xhtml">
    <ui:define name="title">Submit Other Activities</ui:define>
    <ui:define name="body">

        <h1>Submit Other Activities</h1>
        <h:form id="form1">      

            <ui:include src="/WEB-INF/fragments/returnedMail.xhtml" />

            <ui:fragment rendered="#{User.isInactive}">
                <ui:include src="/WEB-INF/fragments/noAccess.xhtml" />
            </ui:fragment>

            <ui:fragment rendered="#{not User.isInactive}">
                <h:panelGroup id="licenceNumber" style="padding-left: 25px">
<!--                    <p:panelGrid columns="2" styleClass="borderless ui-grid-blank" layout="grid" -->
<!--                                 columnClasses="ui-grid-col-1 label-col, ui-grid-col-4">-->

                        #{msg['EmergencyMedicalAssistant.licno.desc']}:
                        <p:inputText value="#{SubmitOtherActivities.licenceNumber}" size="10" maxlength="6" label="LicenceNumber" id="LicenceNumber" 
                                     valueChangeListener="#{SubmitOtherActivities.changeLicenceNumber}" style="margin-left:20px; margin-right: 20px">
<!--                            <p:ajax event="change" update="form1 global-messages" process="@this" />-->
                        </p:inputText>
                    <p:commandButton action="#{SubmitOtherActivities.search}"
                                     styleClass="submit-button interactiveButton"
                                     value="#{msg['button.search']}"
                                     update="form1 global-messages" partialSubmit="true" process="LicenceNumber"/>
<!--                    </p:panelGrid>-->
                </h:panelGroup>


                <h:panelGroup rendered="#{!SubmitOtherActivities.licenceNumber.isEmpty() and
                                          SubmitOtherActivities.validLicenceNumber}">

                    <h:panelGroup styleClass="error-message" rendered="#{User.isInactive}">
                        <i class="pi pi-ban"/>
                        <h:outputText value="#{msg['User.inactive']}"  />
                    </h:panelGroup>

                    <h:panelGroup id="statusWarning" rendered="#{SubmitOtherActivities.userIsEma and !User.isInactive}">

                        <ui:param name="InShortfall" value="#{ SubmitOtherActivities.reportingYearId == EmaccsVariables.currentReportingYearId ? msg['Shortfall.true.warning']:msg['PrevYearShortfall.true.warning']}" />
                        <ui:param name="NotInShortfall" value="#{msg['Shortfall.false.warning']}" />

                        <h:panelGroup rendered="#{SubmitOtherActivities.ccExempt}">
                            <i class="pi pi-info-circle" style="color:#1d20b3"/>
                            <h:outputText value=" #{msg['CcExempt.warning']}"/> 
                            <br/>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{EmaccsVariables.isAdjudicationPeriod(SubmitOtherActivities.reportingYearId)}">
                            <i class="pi pi-check" style="color:green"/>
                            <h:outputText value=" #{SubmitOtherActivities.pendingAdj ? msg['PendingAdj.true.warning']:msg['PendingAdj.false.warning']}" />
                            <br/>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{EmaccsVariables.isShortfallPeriod(SubmitOtherActivities.reportingYearId)}">
                            <i class="pi pi-check" style="color:green"/>
                            <h:outputText value=" #{SubmitOtherActivities.shortfall ? InShortfall:NotInShortfall}"/> 
                            <br/>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{SubmitOtherActivities.reportingYearId != EmaccsVariables.currentReportingYearId
                                                  and SubmitOtherActivities.reportingYearId != EmaccsVariables.previousReportingYearId}"
                                      styleClass="error-message">
                            <i class="pi pi-exclamation-triangle"/>
                            <h:outputText value=" #{msg['PendingAdj.Shortfall.false.warning']}" />
                            <br/>
                        </h:panelGroup>

                        <i class="pi pi-info-circle" style="color:#1d20b3"/>
                        <h:outputText value=" #{msg['Select.Year']}" />

                    </h:panelGroup>

                    <p:panelGrid columns="2" styleClass="borderless ui-grid-blank licence-info" layout="grid" 
                                 columnClasses="ui-grid-col-2 label-col, ui-grid-col-1" style="margin-bottom: 20px">

                        Reporting Year:
                        <h:selectOneMenu id="reportingYear" value="#{SubmitOtherActivities.reportingYearId}"
                                         valueChangeListener="#{SubmitOtherActivities.changeReportingYear}">
                            <f:selectItems value="#{Droplists.reportingYears}"></f:selectItems>
                            <p:ajax event="change" update="form1" process="@this" />
                        </h:selectOneMenu>

                        <h:outputText value="Other Credit Total:"/>
                        <h:outputText value="#{SubmitOtherActivities.otherCreditTotal}"/>

                    </p:panelGrid>

                    <p:panel id="entry" rendered="#{SubmitOtherActivities.editable}" 
                             header="Activity Information" style="margin-bottom: 20px">
                        <p:messages id="submitOtherActivityMessages"/>

                        <div class="ui-g">

                            <div class="ui-g-12">
                                <span class="required">*</span><p:outputLabel for="activityName" value="#{msg['OtherActivity.activityName.desc']}"/><br/>
                                <p:inputText id="activityName" value="#{SubmitOtherActivities.otherActivity2.activityName}" size="50" required="true"
                                             requiredMessage="#{msg['OtherActivity.activityName.desc']} is required">
                                    <f:validator validatorId="validator.activityNameMatcher"/>
                                </p:inputText>
                            </div>

                            <div class="ui-g-12">
                                <span class="required">*</span><p:outputLabel for="location" value="Location/Provider"/><br/>
                                <p:inputText id="location" value="#{SubmitOtherActivities.otherActivity2.location}" 
                                             size="50" required="true" requiredMessage="#{msg['OtherActivity.location.desc']} is required">
                                </p:inputText>
                            </div>

                            <div class="ui-g-2">
                                <span class="required">*</span><p:outputLabel for="beforeDate" value="#{msg['OtherActivity.startDate.desc']}"/><br/>
                                <p:calendar id="beforeDate"
                                            value="#{SubmitOtherActivities.otherActivity2.startDate}"
                                            required="true" showOn="button" navigator="true"
                                            requiredMessage="#{msg['OtherActivity.startDate.desc']} is required"
                                            pattern="#{SubmitOtherActivities.dateFormat}"
                                            size="11" binding="#{beforeDate}"
                                            converterMessage="Please enter a properly formatted Start Date: yyyy/mm/dd"
                                            />
                            </div>

                            <div class="ui-g-10">
                                <span class="required">*</span><p:outputLabel for="afterDate" value="#{msg['OtherActivity.endDate.desc']}"/><br/>
                                <p:calendar id="afterDate"
                                            value="#{SubmitOtherActivities.otherActivity2.endDate}"
                                            pattern="#{SubmitOtherActivities.dateFormat}"
                                            required="true" requiredMessage="#{msg['OtherActivity.endDate.desc']} is required"
                                            showOn="button" size="11" navigator="true"                                                                                           
                                            converterMessage="Please enter a properly formatted End Date: yyyy/mm/dd"
                                            validator="validator.selectedDate">
                                    <f:validator validatorId="validator.dateComparison"/>
                                    <f:attribute name="beforeDate" value="#{beforeDate}"/>
                                    <f:attribute name="reportingYear" value="form1:reportingYear"/>
                                </p:calendar>
                            </div>

                            <div class="ui-g-12">
                                <span class="required">*</span><p:outputLabel for="duration" value="#{msg['OtherActivity.duration.desc']}"/><br/>
                                <h:selectOneMenu id="duration"
                                                 value="#{SubmitOtherActivities.otherActivity2.duration}"
                                                 required="true"
                                                 requiredMessage="#{msg['OtherActivity.duration.desc']} is required">
                                    <f:selectItem itemValue="" itemLabel="" noSelectionOption="true"/>
                                    <f:selectItems value="#{Droplists.hoursList}"></f:selectItems>
                                </h:selectOneMenu>
                            </div>

                            <div class="ui-g-12">
                                <span class="required">*</span><p:outputLabel for="activityDetails" value="#{msg['OtherActivity.details.desc']}"/><br/>
                                <p:inputTextarea id="activityDetails" value="#{SubmitOtherActivities.otherActivity2.details}" rows="6" cols="55" maxlength="300"
                                                 required="true" requiredMessage="#{msg['OtherActivity.details.desc']} is required" label="Details" >
                                </p:inputTextarea>
                            </div>

                            <div class="ui-g-12">
                                <span class="required">*</span><p:outputLabel for="NOCPAreaDropdown" value="NOCP Area"/><br/>
                                <f:validateBean disabled="true" >
                                    <h:selectOneMenu id="NOCPAreaDropdown"
                                                     value="#{SubmitOtherActivities.otherActivity2.nocpAreaId.id}"
                                                     valueChangeListener="#{SubmitOtherActivities.changeNOCPArea}"
                                                     required="true"
                                                     requiredMessage="#{msg['OtherActivity.nocpAreaId.desc']} is required">
                                        <f:selectItem itemValue="" itemLabel="" noSelectionOption="true"/>
                                        <f:selectItems value="#{Droplists.nocpAreas}"></f:selectItems>
                                        <p:ajax event="change" update="NOCPGeneralCompetencyDropdown,NOCPSpecificCompetencyDropdown" process="@this" />
                                    </h:selectOneMenu>
                                </f:validateBean>
                            </div>

                            <div class="ui-g-12">
                                <p:outputLabel value="NOCP General Competency"/><br/>
                                <f:validateBean disabled="true" >
                                    <h:selectOneMenu id="NOCPGeneralCompetencyDropdown"
                                                     value="#{SubmitOtherActivities.otherActivity2.nocpCompetencyTypeId.id}"
                                                     valueChangeListener="#{SubmitOtherActivities.changeNOCPType}" style="max-width: 690px; min-width: 23.5%;">
                                        <f:selectItem itemValue="" itemLabel="" noSelectionOption="true"/>
                                        <f:selectItems value="#{SubmitOtherActivities.filteredNOCPTypes}"></f:selectItems>
                                        <p:ajax event="change" update="NOCPSpecificCompetencyDropdown" process="@this" />
                                    </h:selectOneMenu>
                                </f:validateBean>
                            </div>

                            <div class="ui-g-12">
                                <p:outputLabel value="NOCP Specific Competency"/><br/>
                                <f:validateBean disabled="true" >
                                    <h:selectOneMenu id="NOCPSpecificCompetencyDropdown" value="#{SubmitOtherActivities.otherActivity2.nocpCompetencySubtypeId.id}"
                                                     style="max-width: 690px; min-width: 23.5%;">
                                        <f:selectItem itemValue="" itemLabel=""/>
                                        <f:selectItems value="#{SubmitOtherActivities.filteredNOCPSubtypes}"></f:selectItems>
                                    </h:selectOneMenu>
                                </f:validateBean>
                            </div>   

                            <div class="ui-g-12">
                                <p:outputPanel id="fileUploadPanel">
                                    <p:outputLabel value="Upload New Attachment "/>
                                    <h:outputText styleClass="text-danger" style="font-weight: 600" value=" - Please make Sure you click 'Upload File' after choosing your attachment"/>
                                    <br/>
                                    <h:outputText rendered="#{SubmitOtherActivities.otherActivity2.attachment ne null}" value="Current attachment upload: "/>
                                    <h:outputLink style="font-weight: 600; font-size:16px"
                                                  rendered="#{SubmitOtherActivities.otherActivity2.attachment!=null 
                                                              and SubmitOtherActivities.otherActivity.id ne null and SubmitOtherActivities.uploadChanged eq false}"
                                                  value="#{facesContext.externalContext.requestContextPath}/attachment?ent=activity&amp;id=#{SubmitOtherActivities.otherActivity2.id}">
                                        <h:outputText value=" #{SubmitOtherActivities.otherActivity2.filename}"/>
                                    </h:outputLink>
                                    <h:outputText value="#{SubmitOtherActivities.otherActivity2.filename}"
                                                  rendered="#{SubmitOtherActivities.otherActivity2.attachment ne null
                                                              and SubmitOtherActivities.uploadChanged eq true}" />
                                    <p:fileUpload  listener="#{SubmitOtherActivities.uploadFile}" update="@form:fileUploadPanel"
                                                   sizeLimit="52428800" 
                                                   invalidSizeMessage="File exceeds 50 megs limit. Please consider compressing the file(zip) or to use another file format."
                                                   invalidFileMessage="Invalid file type"
                                                   fileLimitMessage="Only one file allow per upload"
                                                   fileLimit="1" 
                                                   mode="advanced" 
                                                   uploadLabel="Upload File"
                                                   converterMessage="Conversion failed"
                                                   />
                                </p:outputPanel>
                            </div> 
                            <div class="ui-g-12">
                                <ui:param name="confirmDelDisable" value="$('.interactiveButton3').removeAttr('disabled');"/>
                                <p:commandButton id="addBtn" styleClass="interactiveButton submit-button"
                                                 rendered="#{SubmitOtherActivities.otherActivity2.id==null}"
                                                 action="#{SubmitOtherActivities.add}"
                                                 value="#{msg['button.add']}"
                                                 update="form1:entry form1:listTable"/>

                                <p:commandButton id="updateBtn" styleClass="interactiveButton submit-button"
                                                 rendered="#{SubmitOtherActivities.otherActivity2.id!=null}"
                                                 action="#{SubmitOtherActivities.update}"
                                                 value="#{msg['button.update']}"
                                                 update="form1:entry form1:listTable" />

                                <p:commandLink id="clearBtn" styleClass="interactiveButton"
                                               action="#{SubmitOtherActivities.clear}"
                                               value="#{msg['button.clear']}"
                                               update="form1:entry form1:listTable" process="@this" />                            
                            </div>
                        </div>            
                    </p:panel>

                    <p:messages id="deleteMessage"/>

                    <h:panelGroup rendered="#{!SubmitOtherActivities.ccExempt}">                   

                        <p:dataTable id="listTable" value="#{SubmitOtherActivities.otherActivityList}" var="row" rows="10" rowIndexVar="index"
                                     paginator="true" paginatorPosition="top" paginatorAlwaysVisible="false" style="margin: 20px 0px"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                            <f:facet name="header"><h:outputText value="Submitted Activities"/></f:facet>

                            <p:column>
                                <h:outputLink value="#{facesContext.externalContext.requestContextPath}/attachment?ent=activity&amp;id=#{row.id}" rendered="#{SubmitOtherActivities.hasAttachment(row.id)}">
                                    <h:graphicImage value="/resources/images/attach.png"/>
                                </h:outputLink>
                            </p:column>

                            <p:column sortBy="#{row.activityName}" headerText="#{msg['OtherActivity.activityName.desc']}">
                                <h:outputText value="#{row.activityName}"/>
                            </p:column>

                            <p:column headerText="NOCP">
                                <h:outputText value="#{row.nocpAreaId.areaCode}"
                                              rendered="#{row.nocpAreaId!=null &amp;&amp; row.nocpCompetencyTypeId==null}"/>
                                <h:outputText value="#{row.nocpCompetencyTypeId.competencyCode}"
                                              rendered="#{row.nocpCompetencyTypeId!=null &amp;&amp; row.nocpCompetencySubtypeId==null}"/>
                                <h:outputText value="#{row.nocpCompetencySubtypeId.subtypeCompetencyCode}"
                                              rendered="#{row.nocpCompetencySubtypeId!=null}"/>
                            </p:column>

                            <p:column sortBy="#{row.startDate}" headerText="#{msg['OtherActivity.startDate.desc']}">
                                <h:outputText value="#{SubmitOtherActivities.getAsBasicDateString(row.startDate)}"/>
                            </p:column>

                            <p:column sortBy="#{row.endDate}" headerText="#{msg['OtherActivity.endDate.desc']}">
                                <h:outputText value="#{SubmitOtherActivities.getAsBasicDateString(row.endDate)}"/>
                            </p:column>

                            <p:column sortBy="#{row.duration}" headerText="#{msg['OtherActivity.duration.desc']}">
                                <h:outputText value="#{row.duration}"/>
                            </p:column>

                            <p:column sortBy="#{row.credits}" headerText="#{msg['OtherActivity.credits.desc']}">
                                <h:outputText value="#{row.credits}"/>
                            </p:column>

                            <p:column sortBy="#{row.adjudicatedCredits}" headerText="#{msg['OtherActivity.adjudicatedCredits.desc']}">
                                <h:outputText value="#{row.adjudicatedCredits}"/>
                            </p:column>

                            <p:column style="text-align: center;" id="emaCol" headerText="Options">

                                <ui:param name="defaultValue" value="#{(row.credits != null and row.credits > 0) ||
                                                                       (row.adjudicatedCredits != null and row.adjudicatedCredits > 0)}"/>

                                <p:commandButton id="selectButton1"  styleClass="datatable-options #{defaultValue ? 'interactiveButton2':'interactiveButton'  }"
                                                 action="#{SubmitOtherActivities.select}"
                                                 value="#{msg['button.select']}"
                                                 update="form1" process="@this"
                                                 disabled="#{defaultValue}" style="margin-bottom: 5px"
                                                 rendered="#{SubmitOtherActivities.editable}">
                                    <f:setPropertyActionListener id="selectParam1" target="#{SubmitOtherActivities.otherActivity}" value="#{row}"/>
                                </p:commandButton>

                                <p:commandButton id="deleteButton1"  styleClass="datatable-options #{defaultValue ? 'interactiveButton2':'interactiveButton'  }"
                                                 value="#{msg['button.delete']}"
                                                 update="form1" process="@this"
                                                 disabled="#{defaultValue}" style="margin-bottom: 5px"
                                                 rendered="#{SubmitOtherActivities.editable}"
                                                 oncomplete="PF('confirmDelete').show()">
                                    <f:setPropertyActionListener id="deleteParam1" target="#{SubmitOtherActivities.otherActivityToDelete}" value="#{row}"/>
                                </p:commandButton>

                                <p:commandButton id="commentsButton1" styleClass="datatable-options interactiveButton"
                                                 value="Comments"
                                                 oncomplete="PF('commentsPopup').show()"
                                                 update="form1" process="@this">
                                    <f:setPropertyActionListener id="commentsParam1" target="#{SubmitOtherActivities.yetAnotherActivity}" value="#{row}"/>
                                </p:commandButton>
                            </p:column>

                            <p:column style="text-align: center;" id="adminCol" headerText="Options">

                                <p:commandButton id="selectButton2"  styleClass="datatable-options interactiveButton"
                                                 update="form1" process="@this" style="margin-bottom: 5px"
                                                 action="#{SubmitOtherActivities.select}"
                                                 value="#{msg['button.select']}">
                                    <f:setPropertyActionListener id="selectParam2" target="#{SubmitOtherActivities.otherActivity}" value="#{row}"/>
                                </p:commandButton>

                                <p:commandButton id="deleteButton2"  styleClass="datatable-options interactiveButton"
                                                 update="form1" process="@this" style="margin-bottom: 5px"
                                                 value="#{msg['button.delete']}"
                                                 oncomplete="PF('confirmDelete').show()">
                                    <f:setPropertyActionListener id="deleteParam2" target="#{SubmitOtherActivities.otherActivityToDelete}" value="#{row}"/>
                                </p:commandButton>

                                <p:commandButton id="commentsButton2"  styleClass="datatable-options interactiveButton"
                                                 update="form1" process="@this"
                                                 value="Comments" style="margin-bottom: 5px"
                                                 oncomplete="PF('editCommentsPopup').show();">
                                    <f:setPropertyActionListener id="commentsParam2" target="#{SubmitOtherActivities.yetAnotherActivity}" value="#{row}"/>
                                </p:commandButton>
                            </p:column>

                            <p:column style="text-align: center;" id="caCol" headerText="Options">
                                <p:commandButton id="commentsButton3"   styleClass=" datatable-optionsinteractiveButton"
                                                 update="form1" process="@this"
                                                 value="Comments"
                                                 oncomplete="PF('editCommentsPopup').show();"
                                                 >
                                    <f:setPropertyActionListener id="commentsParam2" target="#{SubmitOtherActivities.yetAnotherActivity}" value="#{row}"/>
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                    </h:panelGroup>

                    <p:dialog id="commentsPopup" minWidth="300" widgetVar="commentsPopup" modal="true">
                        <f:facet name="header">Comments</f:facet>
                        #{SubmitOtherActivities.yetAnotherActivity.comments}<br/><br/>
                        <p:commandButton onclick="PF('commentsPopup').hide(); return false;" value="Close"/>
<!--                        process="@this"-->
                    </p:dialog>

                    <p:dialog id="editCommentsPopup" widgetVar="editCommentsPopup" minWidth="300" modal="true">
                        <f:facet name="header">Comments</f:facet>
<!--                        <p:inputTextarea value="#{SubmitOtherActivities.yetAnotherActivity.comments}" rows="6" cols="55" label="Comments" />-->
                        #{SubmitOtherActivities.yetAnotherActivity.comments}
                        <br/><br/>
                        <p:commandButton process="@this" value="Close" onclick="PF('editCommentsPopup').hide();" />
                    </p:dialog>

                    <p:dialog id="confirmDelete" modal="true" resizable="false" height="140" widgetVar="confirmDelete"   >
                        <f:facet name="header">Confirm Delete</f:facet>
                        Please confirm the deletion of the following activity<br/>
                        <h:outputText value="#{SubmitOtherActivities.otherActivityToDelete.activityName}" style="font-weight:600"/>

                        <div style="margin-top: 20px">
                            <p:commandButton id="confirmDeleteButton" value="OK" styleClass="submit-button" action="#{SubmitOtherActivities.delete}"
                                             oncomplete="PF('confirmDelete').hide()" update="form1:listTable form1:deleteMessage" process="@this"/>
                            <p:commandLink value="Cancel" onclick="PF('confirmDelete').hide()" process="@this" />
                        </div>

                    </p:dialog>

                </h:panelGroup>
            </ui:fragment>

        </h:form>
    </ui:define>
</ui:composition>
