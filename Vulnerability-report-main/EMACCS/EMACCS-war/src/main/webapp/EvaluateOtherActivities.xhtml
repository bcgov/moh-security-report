<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30Template.xhtml">
    
    <ui:define name="title">Evaluate Other Activities</ui:define>
    <ui:define name="body">
        <h1>Evaluate Other Activities</h1>
        <h:form id="form1">
                
            <p:panelGrid columns="2" styleClass="borderless ui-grid-blank licence-info" layout="grid" 
                         columnClasses="ui-grid-col-2 label-col, ui-grid-col-1" style="margin-bottom: 20px">

                Reporting Year:
                <h:selectOneMenu id="reportingYear" value="#{EvaluateOtherActivities.reportingYearId}" valueChangeListener="#{EvaluateOtherActivities.changeReportingYear}">
                    <f:selectItems value="#{Droplists.reportingYears}"></f:selectItems>
                    <p:ajax event="change" update="form1" process="@this" />
                </h:selectOneMenu>

                Other Credit Total:
                <h:outputText value="#{EvaluateOtherActivities.otherCreditTotal}"/>

            </p:panelGrid>
  
            <p:panel id="entry" header="Activity Information for ##{EvaluateOtherActivities.licenceNumber}" style="margin-bottom: 20px">
                
                <div class="ui-g">
                    
                    <div class="ui-g-6">
                        <div class="ui-g">
                            <div class="ui-g-12">
                                <span class="required">*</span><p:outputLabel for="activityName" value="Activity Name"/><br/>
                                <p:inputText id="activityName" value="#{EvaluateOtherActivities.otherActivity2.activityName}" 
                                             required="true" requiredMessage="Activity Name is required" 
                                             size="50"/>
                            </div>
                            <div class="ui-g-12">
                                <span class="required">*</span><p:outputLabel for="location" value="#{msg['OtherActivity.location.desc']}"/><br/>
                                <p:inputText id="location" value="#{EvaluateOtherActivities.otherActivity2.location}" 
                                             required="true" requiredMessage="Location is required" 
                                              size="50"/>
                            </div>
                           <div class="ui-g-4">
                                <span class="required">*</span><p:outputLabel for="beforeDate" value="Start Date"/><br/>
                                <p:calendar id="beforeDate"
                                            value="#{EvaluateOtherActivities.otherActivity2.startDate}"
                                            required="true" requiredMessage="Start Date is required"
                                            pattern="#{EvaluateOtherActivities.dateFormat}" showOn="button"
                                            label="yyyy/mm/dd" size="11" binding="#{beforeDate}" navigator="true"
                                            converterMessage="Please enter a properly formatted Start Date: yyyy/mm/dd"/>
                            </div>
                            <div class="ui-g-8">
                                <span class="required">*</span><h:outputText value="#{msg['OtherActivity.endDate.desc']}"/><br/>
                                <p:calendar id="afterDate"
                                            value="#{EvaluateOtherActivities.otherActivity2.endDate}"
                                            required="true" requiredMessage="End Date is required"
                                            pattern="#{EvaluateOtherActivities.dateFormat}"
                                            label="yyyy/mm/dd" size="11" showOn="button" navigator="true"
                                            converterMessage="Please enter a properly formatted End Date: yyyy/mm/dd">
                                        <f:validator validatorId="validator.dateComparison"/>
                                        <f:attribute name="beforeDate" value="#{beforeDate}"/>
                                </p:calendar>
                            </div>
                            <div class="ui-g-12">
                                <span class="required">*</span><p:outputLabel for="duration" value="Duration"/><br/>
                                <h:selectOneMenu id="duration"
                                                value="#{EvaluateOtherActivities.otherActivity2.duration}"
                                                required="true"
                                                requiredMessage="Duration is required">
                                    <f:selectItem itemValue="" itemLabel="" noSelectionOption="true"/>
                                    <f:selectItems value="#{Droplists.hoursList}"></f:selectItems>
                                </h:selectOneMenu>
                            </div>
                            <div class="ui-g-12">
                                <h:outputText value="#{msg['OtherActivity.details.desc']}"/><br/>
                                <p:inputTextarea value="#{EvaluateOtherActivities.otherActivity2.details}" cols="40" rows="4" />
                            </div>
                            <div class="ui-g-12">
                                <span class="required">*</span><p:outputLabel for="NOCPAreaDropdown" value="NOCP Area"/><br/>
                                <f:validateBean disabled="true" >
                                    <h:selectOneMenu id="NOCPAreaDropdown"
                                                    value="#{EvaluateOtherActivities.otherActivity2.nocpAreaId}"
                                                    valueChangeListener="#{EvaluateOtherActivities.changeNOCPArea}"
                                                    style="max-width: 400px;" converter="NocpAreaConverter"
                                                    required="true"
                                                    requiredMessage="#{msg['OtherActivity.nocpAreaId.desc']} is required">
                                            <f:selectItem itemValue="" itemLabel="" noSelectionOption="true"/>
                                            <f:selectItems value="#{Droplists.allNocpAreas}" var="nocpArea"
                                                           itemLabel="#{nocpArea.areaCode.concat(' ').concat(nocpArea.areaName)}"/>
                                            <p:ajax event="change" update="NOCPGeneralCompetencyDropdown NOCPSpecificCompetencyDropdown" process="@this" />
                                    </h:selectOneMenu>
                                </f:validateBean>
                            </div>

                            <div class="ui-g-12">
                                <h:outputText value="NOCP General Competency"/><br/>
                                <f:validateBean disabled="true" >
                                    <h:selectOneMenu id="NOCPGeneralCompetencyDropdown"
                                                    value="#{EvaluateOtherActivities.otherActivity2.nocpCompetencyTypeId}"
                                                    valueChangeListener="#{EvaluateOtherActivities.changeNOCPType}" style="max-width: 400px;"
                                                    converter="NocpCompetencyTypeConverter">
                                            <f:selectItem itemValue="" itemLabel="" noSelectionOption="true"/>
                                            <f:selectItems value="#{EvaluateOtherActivities.filteredNOCPTypes}"  var="nocpType"
                                                           itemLabel="#{nocpType.competencyCode.concat(' ').concat(nocpType.competencyName)}"/>
                                            <p:ajax event="change" update="NOCPSpecificCompetencyDropdown" process="@this" />
                                    </h:selectOneMenu>
                                </f:validateBean>
                            </div>

                            <div class="ui-g-12">
                                <h:outputText value="NOCP Specific Competency"/><br/>
                                <f:validateBean disabled="true" >
                                    <h:selectOneMenu id="NOCPSpecificCompetencyDropdown"
                                        value="#{EvaluateOtherActivities.otherActivity2.nocpCompetencySubtypeId}" style="max-width: 400px;"
                                        converter="NocpCompetencySubtypeConverter">
                                        <f:selectItem itemValue="" itemLabel=""/>
                                        <f:selectItems value="#{EvaluateOtherActivities.filteredNOCPSubtypes}" var="nocpSubType"
                                                       itemLabel="#{nocpSubType.subtypeCompetencyCode.concat(' ').concat(nocpSubType.subtypeCompetencyName)}"/>
                                    </h:selectOneMenu>
                                </f:validateBean>
                            </div>                            
                        </div>
                    </div>
                    
                    <div class="ui-g-6">
                        <div class="ui-g">
                            <div class="ui-g-12">
                                <span class="required">*</span><p:outputLabel for="status" value="#{msg['OtherActivity.statusId.desc']}"/><br/>
                                <h:selectOneMenu id="status"
                                                 value="#{EvaluateOtherActivities.otherActivity2.statusId}"
                                                 required="true" converter="ActivityStatusConverter"
                                                 requiredMessage="A Status is required in the Activity Information form.">
                                        <f:selectItem itemValue="" itemLabel=""/>
                                        <f:selectItems value="#{Droplists.allActivityStatus}" var="activityStatus"
                                                       itemLabel="#{activityStatus.activityStatus}"></f:selectItems>
                                </h:selectOneMenu>
                            </div>
                            <div class="ui-g-4">
                                <h:outputText value="#{msg['OtherActivity.credits.desc']}" /><br/>
                                <p:inputText value="#{EvaluateOtherActivities.otherActivity2.credits}"  size="10"/>
                            </div>

                            <div class="ui-g-8">
                                <h:outputText value="Adjudicated Credits"/><br/>
                                <p:inputText value="#{EvaluateOtherActivities.otherActivity2.adjudicatedCredits}"   size="10"/>
                            </div>  
                            
                            <div class="ui-g-12">
                                <h:outputText value="#{msg['OtherActivity.comments.desc']}"/><br/>
                                <p:inputTextarea value="#{EvaluateOtherActivities.otherActivity2.comments}" cols="40" rows="4" />
                            </div>   
                            
                            <div class="ui-g-12">
                            <p:outputPanel id="fileUploadPanel">
                                <p:outputLabel value="Upload New Attachment "/>
                                <h:outputText styleClass="text-danger" style="font-weight: 600" value=" - Please make Sure you click 'Upload File' after choosing your attachment"/>
                                <br/>
                                <h:outputText rendered="#{EvaluateOtherActivities.otherActivity2.attachment ne null}" value="Current attachment upload: "/>
                                <h:outputLink style="font-weight: 600; font-size:16px"
                                    rendered="#{EvaluateOtherActivities.otherActivity2.attachment!=null 
                                                and EvaluateOtherActivities.otherActivity2.id ne null and EvaluateOtherActivities.uploadChanged eq false}"
                                    value="#{facesContext.externalContext.requestContextPath}/attachment?ent=activity&amp;id=#{EvaluateOtherActivities.otherActivity2.id}">
                                    <h:outputText value=" #{EvaluateOtherActivities.otherActivity2.filename}"/>
                                </h:outputLink>
                                <h:outputText value="#{EvaluateOtherActivities.otherActivity2.filename}"
                                              rendered="#{EvaluateOtherActivities.otherActivity2.attachment ne null
                                                        and EvaluateOtherActivities.uploadChanged eq true}" />
                                <p:fileUpload  listener="#{EvaluateOtherActivities.uploadFile}" update="@form:fileUploadPanel"
                                               sizeLimit="52428800" 
                                               invalidSizeMessage="File exceeds 50 megs limit. Please consider compressing the file(zip) or to use another file format."
                                               fileLimit="1" mode="advanced" uploadLabel="Upload File" />                                
                            </p:outputPanel>

                            </div>                            
                        </div>
                    </div>
                </div>
                
                <div class="ui-g">
                    <div class="ui-g-12">
                        <p:commandButton id="addBtn" styleClass="submit-button"
                                         rendered="#{EvaluateOtherActivities.otherActivity2.id==null}"
                                         action="#{EvaluateOtherActivities.add}"
                                         value="#{msg['button.add']}"
                                         update="form1 global-messages" 
                                         oncomplete="window.scrollTo(0,0);" />

                        <p:commandButton id="updateBtn" styleClass="submit-button"
                                         rendered="#{EvaluateOtherActivities.otherActivity2.id!=null}"
                                         action="#{EvaluateOtherActivities.update}"
                                         value="#{msg['button.update']}"
                                         update="@form global-messages"
                                         oncomplete="window.scrollTo(0,0);"/>

                        <p:commandLink id="clearBtn"
                                         action="#{EvaluateOtherActivities.clear}"
                                         value="Clear"
                                         update="form1 global-messages" process="@this"/>                        
                    </div>                    
                </div>
                
            </p:panel>

            <p:dataTable id="listTable" value="#{EvaluateOtherActivities.otherActivity2List}" var="row" rows="100" rowIndexVar="index"
                         paginator="true" paginatorPosition="top" paginatorAlwaysVisible="false" rendered="#{AdjudicationQueue.resultsLicence!=null}"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                <f:facet name="header"><h:outputText value="Course Information List"/></f:facet>
                <p:column style="width: 3%; text-align: center">
                    <h:outputLink value="#{facesContext.externalContext.requestContextPath}/attachment?ent=activity&amp;id=#{row.id}" rendered="#{row.attachment!=null}">
                    <h:graphicImage value="/resources/images/attach.png"/>
                    </h:outputLink>
                </p:column>
                
                <p:column style="min-width: 12%" sortBy="#{row.activityName}" headerText="#{msg['OtherActivity.activityName.desc']}">
                    <h:outputText value="#{row.activityName}"/>
                </p:column>
                
                <p:column headerText="NOCP">
                    <h:outputText value="#{row.nocpAreaId.areaCode}"
                                  rendered="#{row.nocpAreaId!=null &amp;&amp; row.nocpCompetencyTypeId==null}"/>
                    <h:outputText value="#{row.nocpCompetencyTypeId.competencyCode}"
                                  rendered="#{row.nocpCompetencyTypeId!=null &amp;&amp; row.nocpCompetencySubtypeId==null}"/>
                    <h:outputText value="#{row.nocpCompetencySubtypeId.subtypeCompetencyCode}"
                                  rendered="#{row.nocpCompetencySubtypeId!=null}"/>
                </p:column>
                
                <p:column headerText="#{msg['OtherActivity.startDate.desc']}">
                    <h:outputText value="#{row.startDate}">
                        <f:convertDateTime pattern="yyyy/MM/dd" />
                    </h:outputText>
                </p:column>
                
                <p:column headerText="#{msg['OtherActivity.endDate.desc']}">
                    <h:outputText value="#{row.endDate}">
                        <f:convertDateTime pattern="yyyy/MM/dd" />
                    </h:outputText>
                </p:column>
                
                <p:column headerText="#{msg['OtherActivity.duration.desc']}">
                    <h:outputText value="#{row.duration}"/>
                </p:column>
                
                <p:column headerText="#{msg['OtherActivity.statusId.desc']}">
                    <h:outputText value="#{row.statusId.activityStatus}"/>
                </p:column>
                
                <p:column headerText="#{msg['OtherActivity.credits.desc']}">
                    <h:outputText value="#{row.credits}"/>
                </p:column>
                
                <p:column headerText="#{msg['OtherActivity.adjudicatedCredits.desc']}">
                    <h:outputText value="#{row.adjudicatedCredits}"/>
                </p:column>
                
                <p:column style="text-align: center;" headerText="Options">
                <p:commandButton id="selectButton" style="margin-bottom: 5px"
                                   action="#{EvaluateOtherActivities.select}"
                                   
                                   value="#{msg['button.select']}"
                                   update="form1 global-messages" process="@this"
                                   oncomplete="window.scrollTo(0,0)">
                    <f:setPropertyActionListener id="selectParam" target="#{EvaluateOtherActivities.otherActivity2}" value="#{row}"/>
                </p:commandButton>
                <p:commandButton id="deleteButton"
                                   value="#{msg['button.delete']}"
                                   update="form1" process="@this"
                                   oncomplete="PF('confirmDelete').show()">
                    <f:setPropertyActionListener id="deleteParam" target="#{EvaluateOtherActivities.otherActivityToDelete}" value="#{row}"/>
                </p:commandButton>
                </p:column>
            </p:dataTable>
            
            <p:dialog id="confirmDelete" modal="true" resizable="false" widgetVar="confirmDelete"   >
                <f:facet name="header">Confirm Delete</f:facet>
                <span style="padding-top: 20px">Please confirm the deletion of the following activity</span><br/>
                <h:outputText value="#{EvaluateOtherActivities.otherActivityToDelete.activityName}" style="font-weight:600;"/>

                <div style="margin: 20px 0px">
                    <p:commandButton id="confirmDeleteButton" value="OK" styleClass="submit-button" action="#{EvaluateOtherActivities.delete}"
                       oncomplete="PF('confirmDelete').hide();window.scrollTo(0,0)" update="form1 global-messages" process="@this"/>
                    <p:commandLink value="Cancel" onclick="PF('confirmDelete').hide(); return false" process="@this" />
                </div>

            </p:dialog>

        </h:form>
    </ui:define>
</ui:composition>
