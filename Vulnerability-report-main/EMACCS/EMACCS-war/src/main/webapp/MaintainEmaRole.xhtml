<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"

                template="/WEB-INF/templates/gov30Template.xhtml">
    <ui:define name="title">Maintain EMA Roles</ui:define>
    <ui:define name="body">

        <h1>Maintain <h:outputText value="#{msg['EmaRole.desc']}"/>s</h1>    
        <h:form id="form1">

            <ui:include src="/WEB-INF/fragments/returnedMail.xhtml" />

            <ui:fragment rendered="#{User.isInactive}">
                <ui:include src="/WEB-INF/fragments/noAccess.xhtml" />
            </ui:fragment>

            <ui:fragment rendered="#{not User.isInactive}">
                <p:panel id="entry" header="User / Role #{MaintainEmaRole.ema.role}" style="margin-bottom: 20px">
                    <p:messages id="licenceEmaRole" styleClass="inline-messages" showIcon="false"   /> 

                    <div class="ui-g">
                        <div class="ui-g-12">
                            <h:outputText value="#{msg['EmaRole.userName.desc']}"/><br/>
                            <p:inputText value="#{MaintainEmaRole.userName}" size="50" 
                                         readonly="#{MaintainEmaRole.selectedKey!=null}"/>
                        </div>

                        <div class="ui-g-12">
                            <h:outputText value="#{msg['EmaRole.firstName.desc']}"/><br/>
                            <p:inputText value="#{MaintainEmaRole.firstName}" size="50" 
                                         readonly="#{MaintainEmaRole.selectedKey!=null}"/>
                        </div>

                        <div class="ui-g-12">
                            <h:outputText value="#{msg['EmaRole.lastName.desc']}"/><br/>
                            <p:inputText value="#{MaintainEmaRole.lastName}" size="50" 
                                         readonly="#{MaintainEmaRole.selectedKey!=null}"/>
                        </div>

                        <div class="ui-g-12">
                            <h:outputText value="#{msg['EmaRole.licenceNo.desc']}"/><br/>
                            <p:inputText value="#{MaintainEmaRole.licenseNo}" 
                                         readonly="#{MaintainEmaRole.selectedKey!=null}"
                                         
                                       
                                         size="50" /> 

                        </div>

                        <div class="ui-g-12">
                            <h:selectBooleanCheckbox value="#{MaintainEmaRole.includeAll}" style="height:20px; width:20px; margin: 0px 10px 0px 0px"/>
                            <h:outputText style="vertical-align: super" value="Doesn't have EMA Role"/>
                        </div>

                        <div class="ui-g-12">
                            <p:commandButton action="#{MaintainEmaRole.search}" value="#{msg['button.search']}" styleClass="submit-button"
                                             rendered="#{MaintainEmaRole.selectedKey==null}"  
                                             update="form1" process="@form"/>

                            <p:commandButton action="#{MaintainEmaRole.grantEmaRole}" value="Grant EMA Role" styleClass="submit-button"
                                             rendered="#{MaintainEmaRole.showGrantButton}"  
                                             update="form1" process="@form"/>

                            <p:commandButton action="#{MaintainEmaRole.revokeEmaRole}" value="Revoke EMA Role" styleClass="submit-button"
                                             rendered="#{MaintainEmaRole.showRevokeButton}" 
                                             update="form1" process="@form"/>

                            <p:commandLink action="#{MaintainEmaRole.clear}" value="#{msg['button.clear']}"  styleClass="submit-button"
                                           update="form1" process="@form"/>

                          <p:commandButton action="#{MaintainEmaRole.deleteEMA}" value="Delete EMA" styleClass="submit-button"
                                             rendered="#{MaintainEmaRole.showDeleteButton}"  style="float: right;"
                                             update="form1" process="@form"/>
                          
                              <!--    <p:commandButton value="Delete EMA"
                                             style="float: right;"
                                             rendered="#{MaintainEmaRole.showDeleteButton}"
                                             onclick="PF('confirmation').show();return false"
                                             update="form1" process="@this"/>  -->
                   
                        </div>
                    </div>
                    <p:dialog id="confirmation" modal="true" resizable="false" 
                              draggable="false" height="130" width="300"  widgetVar="confirmation">
                        <f:facet name="header">Confirm Delete</f:facet>

                        <h:outputText value="Please confirm the deletion of the Hnet account with user name " />
                        <h:outputText value="#{MaintainEmaRole.userName}" style="font-weight:bold" />
                        <br/>
                        <br/>                                      
                        <p:commandLink value="Cancel" style="float:right; margin-left: 10px"
                                       onclick="PF('confirmation').hide();return false" />
                        <p:commandButton value="OK" style="float:right" action="#{MaintainEmaRole.deleteEMA}"
                                         update="form1" process="@form"
                                         oncomplete="PF('confirmation')}.hide()" />

                    </p:dialog>
                </p:panel>



                <p:dataTable id="listTable" value="#{MaintainEmaRole.emas}" var="row" rows="10"
                             paginator="true" paginatorPosition="top" paginatorAlwaysVisible="false"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                    <f:facet name="header"><h:outputText value="Search Results"/></f:facet>

                    <p:column sortBy="#{row.userId}" headerText="#{msg['EmaRole.userName.desc']}">
                        <h:outputText value="#{row.userId}"/>
                    </p:column>
                    <p:column sortBy="#{row.firstName}" headerText="#{msg['EmaRole.firstName.desc']}">
                        <h:outputText value="#{row.fname}"/>
                    </p:column>

                    <p:column sortBy="#{row.lastName}" headerText="#{msg['EmaRole.lastName.desc']}">
                        <h:outputText value="#{row.lname}"/>
                    </p:column>

                    <p:column sortBy="#{row.lastName}" headerText="#{msg['EmaRole.licenceNo.desc']}">
                        <h:outputText value="#{row.licno}"/>
                    </p:column>

                    <p:column sortBy="#{row.role}" headerText="Role">
                        <h:outputText value="#{row.role}"/>
                    </p:column>    

                    <p:column style="text-align: center;" headerText="Select">
                        <p:commandButton id="selectButton" styleClass="interactiveButton"
                                         action="#{MaintainEmaRole.select}"
                                         value="#{msg['button.select']}"
                                         update="form1"
                                         onclick="$('.interactiveButton').attr('disabled', 'disabled');"
                                         oncomplete="$('.interactiveButton').removeAttr('disabled');"
                                         process="@this">
                            <f:setPropertyActionListener id="selectParam"
                                                         target="#{MaintainEmaRole.selectedKey}"
                                                         value="#{row.userId}"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </ui:fragment>

        </h:form>
    </ui:define>
</ui:composition>
