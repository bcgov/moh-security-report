<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30Template.xhtml">
    <ui:define name="title">Submit Approved Activities</ui:define>
    <ui:define name="body">
        <h1>Submit Approved Activities</h1>

        <h:form id="form1">

            <ui:include src="/WEB-INF/fragments/returnedMail.xhtml" />

            <ui:fragment rendered="#{User.isInactive}">
                <ui:include src="/WEB-INF/fragments/noAccess.xhtml" />
            </ui:fragment>

            <ui:fragment rendered="#{not User.isInactive}">
                <h:panelGroup id="licenceNumber" style="padding-left: 25px">
                    <!--                    <p:panelGrid columns="2" styleClass="borderless ui-grid-blank" layout="grid" -->
                    <!--                                 columnClasses="ui-grid-col-1 label-col, ui-grid-col-4">-->

                    #{msg['EmergencyMedicalAssistant.licno.desc']}:
                    <p:inputText value="#{SubmitApprovedActivities.licenceNumber}" size="10" maxlength="6" label="LicenceNumber" id="LicenceNumber" 
                                 valueChangeListener="#{SubmitApprovedActivities.changeLicenceNumber}" style="margin-left:20px; margin-right: 20px">
                        <!--                            <p:ajax event="change" update="form1 global-messages" process="@this" />-->
                    </p:inputText>
                    <p:commandButton action="#{SubmitApprovedActivities.search}"
                                     styleClass="submit-button interactiveButton"
                                     value="#{msg['button.search']}"
                                     update="form1 global-messages" partialSubmit="true" process="LicenceNumber"/>

                    <!--                    </p:panelGrid>-->
                </h:panelGroup>

                <h:panelGroup rendered="#{!SubmitApprovedActivities.licenceNumber.isEmpty() and
                                          SubmitApprovedActivities.validLicenceNumber}">

                    <h:panelGroup styleClass="error-message" rendered="#{User.isInactive}">
                        <i class="pi pi-ban"/>
                        <h:outputText value="#{msg['User.inactive']}"  />
                    </h:panelGroup>

                    <h:panelGroup id="statusWarning"
                                  rendered="#{SubmitApprovedActivities.userIsEma and !User.isInactive}">

                        <h:panelGroup rendered="#{SubmitApprovedActivities.ccExempt}">
                            <i class="pi pi-info-circle" style="color:#1d20b3"/>
                            <h:outputText value=" #{msg['CcExempt.warning']}"/> 
                            <br/>
                        </h:panelGroup>

                        <ui:param name="InShortfall" value="#{ SubmitApprovedActivities.reportingYearId == EmaccsVariables.currentReportingYearId ? msg['Shortfall.true.warning']:msg['PrevYearShortfall.true.warning']}" />
                        <ui:param name="NotInShortfall" value="#{msg['Shortfall.false.warning']}" />

                        <h:panelGroup rendered="#{SubmitApprovedActivities.adjudicationPeriod}">
                            <i class="pi pi-check" style="color:green"/>
                            <h:outputText value=" #{SubmitApprovedActivities.pendingAdj ? msg['PendingAdj.true.warning']:msg['PendingAdj.false.warning']}" />
                            <br/>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{SubmitApprovedActivities.shortfallPeriod}">
                            <i class="pi pi-check" style="color:green"/>
                            <h:outputText value=" #{SubmitApprovedActivities.shortfall ? InShortfall:NotInShortfall}"/> 
                            <br/>
                        </h:panelGroup>        

                        <h:panelGroup rendered="#{SubmitApprovedActivities.reportingYearId != EmaccsVariables.currentReportingYearId
                                                  and SubmitApprovedActivities.reportingYearId != EmaccsVariables.previousReportingYearId}"
                                      styleClass="error-message">
                            <i class="pi pi-exclamation-triangle"/>
                            <h:outputText value=" #{msg['PendingAdj.Shortfall.false.warning']}" />
                            <br/>
                        </h:panelGroup>

                        <i class="pi pi-info-circle" style="color:#1d20b3"/>
                        <h:outputText value=" #{msg['Select.Year']}" />
                    </h:panelGroup>

                    <p:panelGrid columns="2" styleClass="borderless ui-grid-blank licence-info" layout="grid" 
                                 columnClasses="ui-grid-col-2 label-col, ui-grid-col-1" style="margin-bottom: 20px">

                        Reporting Year:
                        <h:selectOneMenu id="reportingYear" value="#{SubmitApprovedActivities.reportingYearId}" valueChangeListener="#{SubmitApprovedActivities.changeReportingYear}">
                            <f:selectItems value="#{Droplists.reportingYears}"></f:selectItems>
                            <p:ajax event="change" update="form1" process="@this" />
                        </h:selectOneMenu>

                        <h:outputText value="Approved Credit Total:"/>
                        <h:outputText value="#{SubmitApprovedActivities.approvedCreditTotal}"/>

                    </p:panelGrid>

                    <p:panel id="entry" rendered="#{SubmitApprovedActivities.editable}" header="Activity Information" style="margin-bottom: 20px">

                        <div class="ui-g">
                            <div class="ui-g-6">
                                <div class="ui-g">

                                    <p:messages id="activityMessages" />

                                    <div class="ui-g-12">
                                        <a href="https://www2.gov.bc.ca/assets/gov/health/about-bc-s-health-care-system/heath-care-partners/colleges-board-and-commissions/emergency-medical-assistants-licensing-board/approved-activites-emaccs.pdf" target="_blank">Approved Activities Master List</a>
                                    </div>

                                    <div class="ui-g-12">
                                        <span class="required">*</span>
                                        <p:outputLabel for="ActivityNameDropdown" value="#{msg['ActivityType.activityName.desc']}"/><br/>
                                        <p:selectOneMenu id="ActivityNameDropdown"
                                        				 value="#{SubmitApprovedActivities.approvedActivity.activityId.id}"
                                        				 valueChangeListener="#{SubmitApprovedActivities.changeActivityName}"
                                        				 required="true"
                                                         requiredMessage="#{msg['ActivityType.activityName.desc']} is required"
                                                         filter="true" filterMatchMode="contains"
                                                         styleClass="selectOneMenuStyle">
                                            <f:selectItem itemValue="" itemLabel=""/>
                                            <f:selectItems value="#{Droplists.enabledActivityTypes}" />
                                            <p:ajax event="change" update="@form:activityInfo" process="@this" />
                                            <f:validator validatorId="validator.approvedActivityNameMatcher"/>
                                            <p:panel styleClass="panelStyle"/>
                                        </p:selectOneMenu>


                                    </div>


                                    <div class="ui-g-12">
                                        <span class="required">*</span><p:outputLabel value="Location/Provider" for="location"/><br/>
                                        <p:inputText value="#{SubmitApprovedActivities.approvedActivity.location}" id="location"
                                                     size="50" required="true" requiredMessage="#{msg['ApprovedActivity.location.desc']} is required" />
                                    </div>

                                    <div class="ui-g-12">
                                        <span class="required">*</span><p:outputLabel for="beforeDate" value="#{msg['ApprovedActivity.startDate.desc']}"/><br/>
                                        <p:calendar id="beforeDate"
                                                    value="#{SubmitApprovedActivities.approvedActivity.startDate}"
                                                    required="true" showOn="button" navigator="true"
                                                    requiredMessage="#{msg['ApprovedActivity.startDate.desc']} is required"
                                                    pattern="#{SubmitApprovedActivities.dateFormat}"
                                                    size="11" binding="#{beforeDate}"
                                                    converterMessage="Please enter a properly formatted Start Date: yyyy/mm/dd"
                                                    />
                                    </div>

                                    <div class="ui-g-12">
                                        <span class="required">*</span><p:outputLabel for="afterDate" value="#{msg['ApprovedActivity.endDate.desc']}"/><br/>
                                        <p:calendar id="afterDate"
                                                    value="#{SubmitApprovedActivities.approvedActivity.endDate}"
                                                    required="true" navigator="true"
                                                    requiredMessage="#{msg['ApprovedActivity.endDate.desc']} is required"
                                                    showOn="button" size="11"
                                                    pattern="#{SubmitApprovedActivities.dateFormat}"                                                   
                                                    converterMessage="Please enter a properly formatted End Date: yyyy/mm/dd"
                                                    validator="validator.selectedDate">
                                            <f:validator validatorId="validator.dateComparison"/>
                                            <f:attribute name="beforeDate" value="#{beforeDate}"/>
                                            <f:attribute name="reportingYear" value="form1:reportingYear"/>
                                        </p:calendar>
                                    </div>
                                    <div class="ui-g-12">
                                        <p:outputLabel for="details" value="#{msg['ApprovedActivity.details.desc']}"/><br/>
                                        <p:inputTextarea value="#{SubmitApprovedActivities.approvedActivity.details}"
                                                         rows="6" cols="55" maxlength="300" id="details"/>
                                    </div>
                                    <div class="ui-g-12">
                                        <ui:param name="hideButtonString" value="$('.interactiveButton2').removeAttr('disabled');"/>
                                        <ui:param name="defaultValue" value="#{SubmitApprovedActivities.deletes.size()==0}"/>

                                        <p:commandButton id="addBtn" styleClass="interactiveButton submit-button"
                                                         rendered="#{SubmitApprovedActivities.approvedActivity.id==null}"
                                                         action="#{SubmitApprovedActivities.add}"
                                                         value="#{msg['button.add']}" update="form1" />

                                        <p:commandButton id="updateBtn" styleClass="interactiveButton submit-button"
                                                         rendered="#{SubmitApprovedActivities.approvedActivity.id!=null}"
                                                         action="#{SubmitApprovedActivities.update}"
                                                         value="#{msg['button.update']}" update="form1" />                          

                                        <p:commandButton id="delBtn" styleClass="interactiveButton submit-button"
                                                         value="#{msg['button.delete']}"
                                                         rendered="#{SubmitApprovedActivities.approvedActivity.id!=null}"                              
                                                         onclick="PF('confirmationNoRefresh').show();return false"                                           
                                                         process="@this"/>                       

                                        <p:commandLink id="cancelBtn"
                                                       action="#{SubmitApprovedActivities.clear}"
                                                       value="#{msg['button.clear']}" update="form1" 
                                                       process="@this"/>
                                    </div>

                                </div>
                            </div>
                            <h:panelGroup layout="block" styleClass="ui-g-6" id="activityInfo">
                                <p:panelGrid columns="2" styleClass="borderless ui-grid-blank licence-info" layout="grid" 
                                             columnClasses="ui-grid-col-2 label-col, ui-grid-col-8" style="padding-left:10px">

                                    <h:outputText value="#{msg['ActivityType.duration.desc']}: "/>
                                    <h:outputText value="#{SubmitApprovedActivities.approvedActivity.activityId.duration}" id="Duration" />

                                    <h:outputText value="#{msg['ActivityType.maximum.desc']}: "/>                       
                                    <h:outputText value="#{SubmitApprovedActivities.approvedActivity.activityId.maximum}" id="Maximum"/>

                                    <h:outputText value="#{msg['ActivityType.credits.desc']}: "/>   
                                    <h:outputText value="#{SubmitApprovedActivities.approvedActivity.activityId.defaultCredits}" id="Credits" /> 
                                </p:panelGrid>  
                                <p:panelGrid columns="1" styleClass="borderless ui-grid-blank" layout="grid" 
                                             columnClasses="ui-grid-col-12" style="padding-left:10px; border: 1px solid #dddddd">

                                    <h:outputText value="#{msg['OtherActivity.nocpAreaId.desc']}:" style="font-weight: 600"/>
                                    <h:panelGroup id="NOCPArea">
                                        <ul style="padding-left:10px">
                                            <ui:repeat value="#{SubmitApprovedActivities.approvedActivity.activityId.activityNocpAreaList}" var="area">
                                                <li style="list-style-type: disc; margin-left: 15px;">
                                                    <h:outputText value="#{area.nocpAreaId.areaName}" />
                                                </li>
                                            </ui:repeat>
                                        </ul>
                                    </h:panelGroup>

                                    <h:outputText value="#{msg['OtherActivity.nocpCompetencyTypeId.desc']}:" style="font-weight: 600"/>  
                                    <h:panelGroup id="NOCPCompetency">
                                        <ul style="padding-left:10px">
                                            <ui:repeat value="#{SubmitApprovedActivities.approvedActivity.activityId.activityNocpCompTypeList}" var="type">
                                                <li style="list-style-type: disc; margin-left: 15px;">
                                                    <h:outputText value="#{type.nocpCompTypeId.competencyName}" />
                                                </li>
                                            </ui:repeat>                                        
                                        </ul>
                                    </h:panelGroup>

                                    <h:outputText value="#{msg['OtherActivity.nocpCompetencySubtypeId.desc']}:" style="font-weight: 600"/>           
                                    <h:panelGroup id="NOCPSubCompetency">
                                        <ul style="padding-left:10px">
                                            <ui:repeat value="#{SubmitApprovedActivities.approvedActivity.activityId.activityNocpCompSubtypeList}" var="subtype">
                                                <li style="list-style-type: disc; margin-left: 15px;">
                                                    <h:outputText value="#{subtype.nocpCompSubtypeId.subtypeCompetencyName}" />
                                                </li>
                                            </ui:repeat>                                        
                                        </ul>
                                    </h:panelGroup>             
                                </p:panelGrid>        
                            </h:panelGroup>
                        </div>               
                    </p:panel>     

                    <h:panelGroup rendered="#{!SubmitApprovedActivities.ccExempt}">

                        <h:outputText value="#{msg['Delete.reminder.desc']}" rendered ="#{!defaultValue}" style="color:red; font-size: 16px"/>
                        <p:dataTable id="listTable" value="#{SubmitApprovedActivities.approvedActivityList}" var="row" rows="10" rowIndexVar="index"
                                     paginator="true" paginatorPosition="top" paginatorAlwaysVisible="false"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

                            <f:facet name="header"><h:outputText value="Submitted Activities"/></f:facet>

                            <p:column sortBy="#{row.activityName}" headerText="#{msg['ActivityType.activityName.desc']}">
                                <h:outputText value="#{row.activityName}"/>
                            </p:column>

                            <p:column sortBy="#{row.activityId.activityNocpCodes}" headerText="NOCPs">
                                <h:outputText value="#{row.activityId.activityNocpCodes}"/>
                            </p:column>

                            <p:column sortBy="#{row.startDate}" headerText="#{msg['ApprovedActivity.startDate.desc']}">
                                <h:outputText value="#{SubmitApprovedActivities.getAsBasicDateString(row.startDate)}"/>
                            </p:column>

                            <p:column sortBy="#{row.endDate}" headerText="#{msg['ApprovedActivity.endDate.desc']}">
                                <h:outputText value="#{SubmitApprovedActivities.getAsBasicDateString(row.endDate)}"/>
                            </p:column>

                            <p:column sortBy="#{row.activityId.duration}" headerText="#{msg['ActivityType.duration.desc']}">
                                <h:outputText value="#{row.activityId.duration}"/>
                            </p:column>

                            <p:column sortBy="#{row.activityId.credits}" headerText="#{msg['ActivityType.credits.desc']}">
                                <h:outputText value="#{row.activityId.defaultCredits}"/>
                            </p:column>

                            <p:column id="editCol" style="text-align: center;" rendered="#{SubmitApprovedActivities.editable}" headerText="Options">
                                <p:commandButton id="selectButton" styleClass="datatable-options"
                                                 action="#{SubmitApprovedActivities.select}"
                                                 value="#{msg['button.select']}"
                                                 update="form1" process="@this" >

                                    <f:setPropertyActionListener id="selectParam" target="#{SubmitApprovedActivities.approvedActivity}" value="#{row}"/>
                                </p:commandButton>
                                <p:commandButton id="deleteButton" styleClass="datatable-options"
                                                 value="#{msg['button.delete']}"
                                                 update="form1:confirmation" process="@this"
                                                 oncomplete="PF('confirmation').show();" >
                                    <f:setPropertyActionListener id="deleteParam" target="#{SubmitApprovedActivities.approvedActivity}" value="#{row}"/>                   
                                </p:commandButton>                   
                            </p:column>        
                        </p:dataTable>

                        <p:dialog id="confirmation" modal="true" resizable="false" draggable="false" height="145" widgetVar="confirmation"  >
                            <f:facet name="header">Confirm Delete</f:facet>
                            <h:outputText value="Please confirm the deletion of:" /><br/>
                            <h:outputText value="#{SubmitApprovedActivities.approvedActivity.activityName}" style="font-weight:bold" />
                            <br/>
                            <br/>        
                            <p:commandButton value="OK" styleClass="submit-button" action="#{SubmitApprovedActivities.delete}"
                                             oncomplete="PF('confirmation').hide()"  update="form1" process="@this"/>
                            <p:commandLink value="Cancel" process="@this" update="form1"
                                           onclick="PF('confirmation').hide();" action="#{SubmitApprovedActivities.refresh}" immediate="true"/>
                        </p:dialog>

                        <!--            This is a different confirmation panel. When an Activity is already selected and then delete is pressed we don't
                                    want to refresh the form if the user cancels-->
                        <p:dialog id="confirmationNoRefresh" modal="true" resizable="false" draggable="false" height="145" widgetVar="confirmationNoRefresh"   >
                            <f:facet name="header">Confirm Delete</f:facet>
                            <h:outputText value="Please confirm the deletion of:" /><br/>
                            <h:outputText value="#{SubmitApprovedActivities.approvedActivity.activityName}" style="font-weight:bold" />
                            <br/>
                            <br/>        
                            <p:commandButton value="OK" styleClass="submit-button" action="#{SubmitApprovedActivities.delete}"
                                             oncomplete="PF('confirmationNoRefresh').hide()" update="form1" process="@this"/>
                            <p:commandLink value="Cancel"
                                           onclick="PF('confirmationNoRefresh').hide()" process="@this" immediate="true"/>
                        </p:dialog>


                    </h:panelGroup>    
                </h:panelGroup>
            </ui:fragment>

        </h:form>
    </ui:define>
</ui:composition>
