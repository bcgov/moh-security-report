<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30Template.xhtml">
    <ui:define name="title">Log Patient Contacts</ui:define>
    <ui:define name="body">

        <h1>Log Patient Contacts </h1>
        <h:form id="form1">
            <ui:include src="/WEB-INF/fragments/returnedMail.xhtml"/>
            <ui:fragment rendered="#{User.isInactive}">
                <ui:include src="/WEB-INF/fragments/noAccess.xhtml"/>
            </ui:fragment>

            <ui:fragment rendered="#{not User.isInactive}">

                <h:panelGroup id="licenceNumber" style="padding-left: 25px">
<!--                    <p:panelGrid columns="2" styleClass="borderless ui-grid-blank" layout="grid"-->
<!--                                 columnClasses="ui-grid-col-1 label-col, ui-grid-col-4" style="margin-bottom: 20px">-->

                        #{msg['EmergencyMedicalAssistant.licno.desc']}:
                        <p:inputText value="#{LogPatientContacts.licenceNumber}" size="10" maxlength="6"
                                     label="LicenceNumber" id="LicenceNumber"
                                     valueChangeListener="#{LogPatientContacts.changeLicenceNumber}"

                                     style="margin-left:20px; margin-right: 20px">
                            <!--                            <p:ajax event="change" update="form1 global-messages" process="@this" />-->
                        </p:inputText>
                        <p:commandButton action="#{LogPatientContacts.search}"
                                         styleClass="submit-button interactiveButton"
                                         value="#{msg['button.search']}"
                                         update="form1 global-messages" partialSubmit="true" process="LicenceNumber"
                                         />
<!--                    </p:panelGrid>-->
                </h:panelGroup>

                <h:panelGroup
                        rendered="#{!LogPatientContacts.licenceNumber.isEmpty() and LogPatientContacts.validLicenceNumber}">

                    <h:panelGroup styleClass="error-message" rendered="#{User.isInactive}">
                        <i class="pi pi-ban"/>
                        <h:outputText value="#{msg['User.inactive']}"/>
                    </h:panelGroup>

                    <h:panelGroup id="statusWarning" rendered="#{LogPatientContacts.userIsEma and !User.isInactive}">

                        <ui:param name="InShortfall"
                                  value="#{ LogPatientContacts.reportingYearId == EmaccsVariables.currentReportingYearId ? msg['Shortfall.true.warning']:msg['PrevYearShortfall.true.warning']}"/>
                        <ui:param name="NotInShortfall" value="#{msg['Shortfall.false.warning']}"/>

                        <h:panelGroup rendered="#{LogPatientContacts.ccExempt}">
                            <i class="pi pi-info-circle" style="color:#1d20b3"/>
                            <h:outputText value=" #{msg['CcExempt.warning']}"/>
                            <br/>
                        </h:panelGroup>

                        <h:panelGroup
                                rendered="#{EmaccsVariables.isAdjudicationPeriod(LogPatientContacts.reportingYearId)}">
                            <i class="pi pi-check" style="color:green"/>
                            <h:outputText
                                    value=" #{LogPatientContacts.pendingAdj ? msg['PendingAdj.true.warning']:msg['PendingAdj.false.warning']}"/>
                            <br/>
                        </h:panelGroup>

                        <h:panelGroup
                                rendered="#{EmaccsVariables.isShortfallPeriod(LogPatientContacts.reportingYearId)}">
                            <i class="pi pi-check" style="color:green"/>
                            <h:outputText value=" #{LogPatientContacts.shortfall ? InShortfall:NotInShortfall}"/>
                            <br/>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{LogPatientContacts.reportingYearId != EmaccsVariables.currentReportingYearId
                                                  and LogPatientContacts.reportingYearId != EmaccsVariables.previousReportingYearId}"
                                      styleClass="error-message">
                            <i class="pi pi-exclamation-triangle"/>
                            <h:outputText value=" #{msg['PendingAdj.Shortfall.false.warning']}"/>
                            <br/>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{LogPatientContacts.contactLimit}">
                            <i class="pi pi-info-circle" style="color:#1d20b3"/>
                            <h:outputText value=" #{msg['PatientContact.contactLimit']}"/>
                            <br/>
                        </h:panelGroup>

                        <i class="pi pi-info-circle" style="color:#1d20b3"/>
                        <h:outputText value=" #{msg['Select.Year']}"/>
                    </h:panelGroup>

                    <p:panelGrid id="licenseInfo" columns="2" styleClass="borderless ui-grid-blank licence-info"
                                 layout="grid"
                                 columnClasses="ui-grid-col-2 label-col pct-width-12, ui-grid-col-4"
                                 style="margin-bottom: 20px">

                        <h:outputText value="Reporting Year: "/>
                        <h:selectOneMenu id="reportingYear" value="#{LogPatientContacts.reportingYearId}"
                                         valueChangeListener="#{LogPatientContacts.changeReportingYear}">
                            <f:selectItems value="#{Droplists.reportingYears}"></f:selectItems>
                            <p:ajax event="change" update="form1" process="@this"/>
                        </h:selectOneMenu>

                        <h:outputText value="#{msg['PatientContact.contacts.desc']}:"/>
                        #{LogPatientContacts.patientContactList.size()}
                    </p:panelGrid>


                    <p:panel id="patientContactPanel" style="z-index: 500; margin-bottom:20px"
                             header="#{msg['PatientContact.form']}"
                             rendered="#{LogPatientContacts.editable and !LogPatientContacts.contactLimit}">

                        <p:messages id="patientContactMessages" styleClass="inline-messages" showIcon="false"/>
                        <div class="ui-g">
                            <div class="ui-g-4">
                                <span class="required">* </span> <p:outputLabel for="callDate" value="Call Date"/> <br/>
                                <p:calendar id="callDate" required="true" navigator="true" showOn="button"
                                            value="#{LogPatientContacts.patientContact.callDate}"
                                            requiredMessage="#{msg['PatientContact.callDate.desc']} is required"
                                            pattern="#{LogPatientContacts.getDateTimeFormat()}"
                                            validator="validator.selectedDate">
                                    <f:attribute name="reportingYear" value="form1:reportingYear"/>
                                    <f:validator validatorId="validator.callDate"/>
                                </p:calendar>
                            </div>

                            <div class="ui-g-8">
                                <span class="required">* </span> <p:outputLabel for="location" value="Location"/> <br/>
                                <p:inputText value="#{LogPatientContacts.patientContact.location}" size="50"
                                             maxlength="200" id="location"
                                             required="true"
                                             requiredMessage="#{msg['ApprovedActivity.location.desc']} is required"/>
                            </div>

                            <div class="ui-g-4">
                                <span class="required">* </span> <p:outputLabel for="contactTypeDropdown"
                                                                                value="Contact Type"/> <br/>
                                <h:selectOneMenu id="contactTypeDropdown"
                                                 value="#{LogPatientContacts.patientContact.contactTypeId.id}"
                                                 hideNoSelectionOption="true"
                                                 required="true"
                                                 requiredMessage="#{msg['PatientContact.contactTypeId.desc']} is required">
                                    <f:selectItem itemValue="#{null}" itemLabel="" noSelectionOption="true"/>
                                    <f:selectItems value="#{Droplists.contactTypes}"></f:selectItems>
                                    <p:ajax event="change" update="contactTypeDropdown contactSubTypeDropdown"
                                            process="@this"
                                            listener="#{LogPatientContacts.changeContactType(LogPatientContacts.patientContact.contactTypeId.id)}"/>
                                </h:selectOneMenu>
                            </div>

                            <div class="ui-g-8">
                                <span class="required">* </span> <p:outputLabel for="skill1" value="Skill 1"/> <br/>
                                <h:selectOneMenu value="#{LogPatientContacts.patientContact.skill1Id.id}" id="skill1"
                                                 required="true"
                                                 requiredMessage="#{msg['PatientContact.skill1Id.desc']} is required">
                                    <f:selectItem itemValue="" itemLabel=""/>
                                    <f:selectItems value="#{Droplists.skills}"/>
                                </h:selectOneMenu>
                            </div>

                            <div class="ui-g-4">
                                <span class="required">* </span> <p:outputLabel for="contactSubTypeDropdown"
                                                                                value="Sub-Contact Type"/> <br/>
                                <h:selectOneMenu id="contactSubTypeDropdown"
                                                 value="#{LogPatientContacts.patientContact.contactSubtypeId.id}"
                                                 required="true"
                                                 requiredMessage="#{msg['PatientContact.contactSubtypeId.desc']} is required">
                                    <f:selectItem itemValue="" itemLabel="" noSelectionOption="true"/>
                                    <f:selectItems value="#{LogPatientContacts.filteredContactSubTypes}"/>
                                </h:selectOneMenu>
                            </div>

                            <div class="ui-g-8">
                                <span class="required">* </span> <p:outputLabel for="skill2" value="Skill 2"/> <br/>
                                <h:selectOneMenu id="skill2" value="#{LogPatientContacts.patientContact.skill2Id.id}"
                                                 required="true"
                                                 requiredMessage="#{msg['PatientContact.skill2Id.desc']} is required">
                                    <f:selectItem itemValue="" itemLabel=""/>
                                    <f:selectItems value="#{Droplists.skills}"/>
                                </h:selectOneMenu>
                            </div>

                            <div class="ui-g-12">
                                <ui:param name="hideButtonString"
                                          value="$('.interactiveButton2').removeAttr('disabled');"/>

                                <p:commandButton rendered="#{LogPatientContacts.patientContact.id==null}"
                                                 styleClass="submit-button"
                                                 action="#{LogPatientContacts.add}" value="#{msg['button.add']}"
                                                 onclick="$('.interactiveButton').attr('disabled', 'disabled');$('.interactiveButton2').attr('disabled', 'disabled');"
                                                 oncomplete="$('.interactiveButton').removeAttr('disabled');"
                                                 update="form1:patientContactPanel form1:listTable form1:licenseInfo"/>

                                <p:commandButton rendered="#{LogPatientContacts.patientContact.id!=null}"
                                                 styleClass="submit-button"
                                                 action="#{LogPatientContacts.update}" value="#{msg['button.update']}"
                                                 onclick="$('.interactiveButton').attr('disabled', 'disabled');$('.interactiveButton2').attr('disabled', 'disabled');"
                                                 oncomplete="$('.interactiveButton').removeAttr('disabled');"
                                                 update="form1:patientContactPanel form1:listTable"/>

                                <p:commandLink action="#{LogPatientContacts.clear}" value="#{msg['button.clear']}"
                                               onclick="$('.interactiveButton').attr('disabled', 'disabled');$('.interactiveButton2').attr('disabled', 'disabled');"
                                               oncomplete="$('.interactiveButton').removeAttr('disabled');"
                                               update="form1" process="@this"/>
                            </div>
                        </div>
                    </p:panel>

                    <p:messages id="deleteMessage" showIcon="false"/>

                    <p:dataTable id="listTable" value="#{LogPatientContacts.patientContactList}" var="row" rows="10"
                                 rowIndexVar="index"
                                 paginator="true" paginatorPosition="top" paginatorAlwaysVisible="false"
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                        <f:facet name="header"><h:outputText
                                value="#{msg['PatientContact.contacts.submitted']}"/></f:facet>

                        <p:column sortBy="#{row.callDate}" headerText="#{msg['PatientContact.callDate.desc']}">
                            <h:outputText value="#{LogPatientContacts.getAsDateTimeString(row.callDate)}"/>
                        </p:column>

                        <p:column sortBy="#{row.contactTypeId.contactTypeName}"
                                  headerText="#{msg['PatientContact.contactTypeId.desc']}">
                            <h:outputText value="#{row.contactTypeId.contactTypeName}"/>
                        </p:column>

                        <p:column sortBy="#{row.contactSubtypeId.contactSubtypeName}"
                                  headerText="#{msg['PatientContact.contactSubtypeId.desc']}">
                            <h:outputText value="#{row.contactSubtypeId.contactSubtypeName}"/>
                        </p:column>

                        <p:column sortBy="#{row.skill1Id.skillName}"
                                  headerText="#{msg['PatientContact.skill1Id.desc']}">
                            <h:outputText value="#{row.skill1Id.skillName}"/>
                        </p:column>

                        <p:column sortBy="#{row.skill2Id.skillName}"
                                  headerText="#{msg['PatientContact.skill2Id.desc']}">
                            <h:outputText value="#{row.skill2Id.skillName}"/>
                        </p:column>

                        <p:column sortBy="#{row.location}" headerText="#{msg['ApprovedActivity.location.desc']}">
                            <h:outputText value="#{row.location}"/>
                        </p:column>

                        <p:column id="editCol" headerText="Options"
                                  style="text-align: center;" rendered="#{LogPatientContacts.editable}">
                            <p:commandButton id="selectButton"
                                             styleClass="datatable-options"
                                             action="#{LogPatientContacts.select}"
                                             value="#{msg['button.select']}"
                                             update="form1"
                                             process="@this">
                                <f:setPropertyActionListener id="selectParam"
                                                             target="#{LogPatientContacts.patientContact}"
                                                             value="#{row}"/>
                            </p:commandButton>
                            <p:commandButton id="deleteButton"
                                             styleClass="datatable-options"
                                             oncomplete="PF('confirmDelete').show();"
                                             value="#{msg['button.delete']}"
                                             update="form1" process="@this">
                                <f:setPropertyActionListener id="deleteParam"
                                                             target="#{LogPatientContacts.patientContactForDelete}"
                                                             value="#{row}"/>
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>


                    <p:dialog id="confirmDelete" modal="true" resizable="false" height="180" widgetVar="confirmDelete">
                        <f:facet name="header">Confirm Delete</f:facet>
                        Please confirm the deletion of the following Patient Contact<br/><br/>
                        Call Date: <h:outputText value="#{LogPatientContacts.patientContactForDelete.callDate}"
                                                 style="font-weight:600"/> <br/>
                        Contact Type: <h:outputText
                            value="#{LogPatientContacts.patientContactForDelete.contactTypeId.contactTypeName}"
                            style="font-weight:600"/> <br/>
                        Location: <h:outputText value="#{LogPatientContacts.patientContactForDelete.location}"
                                                style="font-weight:600"/> <br/>

                        <div style="margin-top: 20px">
                            <p:commandButton id="confirmDeleteButton" value="OK" styleClass="submit-button"
                                             action="#{LogPatientContacts.delete}"
                                             oncomplete="PF('confirmDelete').hide()"
                                             update="form1:listTable form1:deleteMessage form1:licenseInfo"
                                             process="@this"/>
                            <p:commandLink value="Cancel" onclick="PF('confirmDelete').hide(); return false"
                                           process="@this"/>
                        </div>

                    </p:dialog>

                </h:panelGroup>
            </ui:fragment>

        </h:form>
    </ui:define>
</ui:composition>
