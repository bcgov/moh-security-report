<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30Template.xhtml"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">


    <ui:define name="title">Maintain <h:outputText value="#{msg['ActivityType.desc']}"/>s</ui:define>
    <ui:define name="body">
        <h1>Maintain <h:outputText value="#{msg['ActivityType.desc']}"/>s</h1>

        <p:growl id="growl" showDetail="false" />
        <h:form id="form1">
            <c:if test="#{MaintainActivityType.activityType.id!=null}">
                <script>
                    // Launch the callback function after the user finish typing into the input text field.
                    var delay = (function () {
                        var timer = 0;
                        return function (callback, ms) {
                            clearTimeout(timer);
                            timer = setTimeout(callback, ms);
                        };
                    })();
                </script>
            </c:if>
            <p:panel id="entry" header="Edit #{msg['ActivityType.desc']}"  style="margin-bottom: 20px">
                <div class="ui-g">
                    <div class="ui-g-12">
                        <span class='required'>*</span><p:outputLabel for="activityCode" value="#{msg['ActivityType.activityCode.desc']}"/><br/>
                        <p:inputText id="activityCode" value="#{MaintainActivityType.activityType.activityCode}"
                                     size="10" required="true"
                                     requiredMessage="#{msg['ActivityType.activityCode.desc']} is required" />
                    </div>

                    <div class="ui-g-12">
                        <span class='required'>*</span><p:outputLabel for="name" value="#{msg['ActivityType.activityName.desc']}"/><br/>
                        <p:inputText id="name" value="#{MaintainActivityType.activityType.activityName}"
                                     size="50" required="true"
                                     requiredMessage="#{msg['ActivityType.activityName.desc']} is required" />
                    </div>

                    <div class="ui-g-12">
                        <span class='required'>*</span><p:outputLabel for="credits" value="#{msg['ActivityType.credits.desc']}"/><br/>
                        <!-- Adding the c:if condition to have 2 different input fields that have the same ID, -->
                        <!-- but not be display under the same condition, due to the Ajax event on the keyup of the first field. -->
                        <!-- The JS function launch a refresh of the form after the last key was up after 0,5 seconds from typing.-->
                        <c:if test="#{MaintainActivityType.activityType.id!=null}">
                            <p:inputText
                                id="credits" value="${MaintainActivityType.activityType.defaultCredits}"
                                size="10" required="true"
                                requiredMessage="#{msg['ActivityType.credits.desc']} is required" 
                                onkeyup="delay(function () {doAjax();}, 500);">
                                <p:remoteCommand name="doAjax" action="#{MaintainActivityType.handleValueChange}"/>
                            </p:inputText>
                        </c:if>
                        <c:if test="#{MaintainActivityType.activityType.id==null}">
                            <p:inputText
                                id="credits" value="#{MaintainActivityType.activityType.defaultCredits}"
                                size="10" required="true"
                                requiredMessage="#{msg['ActivityType.credits.desc']} is required" >
                            </p:inputText>
                        </c:if>
                    </div>

                    <div class="ui-g-12">
                        <span class='required'>*</span><p:outputLabel for="duration" value="#{msg['ActivityType.duration.desc']}"/><br/>
                        <p:inputText id="duration" value="#{MaintainActivityType.activityType.duration}" 
                                     size="50" required="true" 
                                     requiredMessage="#{msg['ActivityType.duration.desc']} is required" />
                    </div>

                    <div class="ui-g-12">
                        <span class='required'>*</span><p:outputLabel for="maximum" value="#{msg['ActivityType.maximum.desc']}"/><br/>
                        <p:inputText id="maximum" value="#{MaintainActivityType.activityType.maximum}" 
                                     size="50" required="true" 
                                     requiredMessage="#{msg['ActivityType.maximum.desc']} is required" />
                    </div>

                    <div class="ui-g-12">
                        <span style="color: #D69C22">To move a single area, select it in the box below and click "-&gt; Add" or "&lt;- Remove"</span><br/>
                        <p:pickList value="#{MaintainActivityType.picklistAreas}" var="area" responsive="true" converter="NocpAreaConverter"
                                    itemValue="#{area}" itemLabel="#{area.areaCode} - #{area.areaName}">
                            <f:facet name="sourceCaption">Available NOCP Areas</f:facet>
                            <f:facet name="targetCaption">Selected NOCP Areas</f:facet>
                        </p:pickList>
                    </div>

                    <div class="ui-g-12">
                        <span style="color: #D69C22">To move a single type, select it in the box below and click "-&gt; Add" or "&lt;- Remove"</span><br/>
                        <p:pickList value="#{MaintainActivityType.picklistCompetencyType}"  var="competencyType" responsive="true" converter="NocpCompetencyTypeConverter"
                                    itemValue="#{competencyType}" itemLabel="#{competencyType.competencyCode} - #{competencyType.competencyName}">
                            <f:facet name="sourceCaption">Available NOCP Competency Types</f:facet>
                            <f:facet name="targetCaption">Selected NOCP Competency Types</f:facet>
                        </p:pickList>
                    </div>

                    <div class="ui-g-12">
                        <span style="color: #D69C22">To move a single subtype, select it in the box below and click "-&gt; Add" or "&lt;- Remove"</span><br/>
                        <p:pickList value="#{MaintainActivityType.picklistCompetencySubtype}" var="competencySubType" responsive="true" converter="NocpCompetencySubtypeConverter"
                                    itemValue="#{competencySubType}" itemLabel="#{competencySubType.subtypeCompetencyCode} - #{competencySubType.subtypeCompetencyName}">
                            <f:facet name="sourceCaption">Available NOCP Competency Subtypes</f:facet>
                            <f:facet name="targetCaption">Selected NOCP Competency Subtypes</f:facet>
                        </p:pickList>
                    </div>
                </div>

                <p:commandButton rendered="#{MaintainActivityType.activityType.id==null}"  styleClass="submit-button"
                                 action="#{MaintainActivityType.add}" oncomplete="window.scrollTo(0, 0)"
                                 value="#{msg['button.add']}" update="form1 global-messages"/>

                <p:commandButton rendered="#{MaintainActivityType.activityType.id!=null and not MaintainActivityType.creditsChangeAndLower}"  styleClass="submit-button"
                                 action="#{MaintainActivityType.update}" oncomplete="window.scrollTo(0, 0)"
                                 value="#{msg['button.update']}" update="form1 global-messages"
                                 id="updateButtonWithoutConfirmation"/>             

                <p:commandButton rendered="#{MaintainActivityType.activityType.id!=null and MaintainActivityType.creditsChangeAndLower}"  styleClass="submit-button"
                                 action="#{MaintainActivityType.update}" oncomplete="window.scrollTo(0, 0)"
                                 value="#{msg['button.update']}" update="form1 global-messages"
                                 process="@this"
                                 id="updateButtonWithConfirmation">
                    <p:confirm header="Confirmation change" 
                               message="The credits change to a lower value than before.  This may affect EMA by lowering their score to meet the requirement.  Are you sure you want to proceed?"
                               icon="pi pi-exclamation-triangle"/>
                </p:commandButton>

                <p:commandButton action="#{MaintainActivityType.clear}"
                                 value="#{msg['button.cancel']}" 
                                 update="form1 global-messages" process="@this">
                    <p:resetInput target="entry" />
                </p:commandButton>

            </p:panel>

            <p:confirmDialog id ="confirmationLowering" global="true">
                <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times" />
            </p:confirmDialog>

            <p:dataTable id="listTable" value="#{MaintainActivityType.allActivityTypes}" var="row" rows="10" 
                         emptyMessage="No results found with given criteria" widgetVar="dataTableWidgetVar"
                         paginator="true" paginatorPosition="top" paginatorAlwaysVisible="false"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">
                <f:facet name="header">
                    <h:outputText value="All #{msg['ActivityType.desc']} Values"/>
                </f:facet>

                <p:column sortBy="#{row.activityCode}" filterBy="#{row.activityCode}" style="vertical-align: middle"
                          headerText="#{msg['ActivityType.activityCode.desc']}">
                    <h:outputText value="#{row.activityCode}"/>
                </p:column>

                <p:column sortBy="#{row.activityName}" filterBy="#{row.activityName}" style="vertical-align: middle"
                          headerText="#{msg['ActivityType.activityName.desc']}">
                    <h:outputText value="#{row.activityName}"/>
                </p:column>

                <p:column sortBy="#{row.defaultCredits}" style="vertical-align: middle"
                          headerText="#{msg['ActivityType.credits.desc']}">
                    <h:outputText value="#{row.defaultCredits}"/>
                </p:column>

                <p:column sortBy="#{row.duration}" style="vertical-align: middle"
                          headerText="#{msg['ActivityType.duration.desc']}">
                    <h:outputText value="#{row.duration}"/>
                </p:column>

                <p:column sortBy="#{row.maximum}" style="vertical-align: middle" 
                          headerText="#{msg['ActivityType.maximum.desc']}">
                    <h:outputText value="#{row.maximum}"/>
                </p:column>

                <p:column style="text-align: center; vertical-align: middle" headerText="Edit" >
                    <p:commandButton id="selectButton" styleClass="datatable-options"
                                     action="#{MaintainActivityType.select}" 
                                     value="#{msg['button.select']}" oncomplete="window.scrollTo(0,0)"
                                     update="form1" process="@this">
                        <f:setPropertyActionListener id="selectParam" target="#{MaintainActivityType.activityType}" value="#{row}"/>
                    </p:commandButton>

                    <p:commandButton id="deleteButton"  styleClass="datatable-options"
                                     action="#{MaintainActivityType.delete}" 
                                     value="#{msg['button.delete']}" oncomplete="window.scrollTo(0,0)"
                                     update="form1 global-messages" process="@this">
                        <f:setPropertyActionListener id="deleteParam" target="#{MaintainActivityType.activityType}" value="#{row}" />
                    </p:commandButton>
                </p:column>

                <p:column style="text-align:center; vertical-align: middle" headerText="Disabled" >
                    <h:selectBooleanCheckbox value="#{row.disabledBool}" style="width:25px; height:25px;">
                        <p:ajax event="change" update=":form1 :growl" listener="#{MaintainActivityType.disabledCheck(row)}" />
                    </h:selectBooleanCheckbox>
                </p:column>
            </p:dataTable>

        </h:form>
    </ui:define>
</ui:composition>
