/*******************************************************************************
 * Copyright Â© 2015, Province of British Columbia.                             *
 *                                                                             *
 * All rights reserved.                                                        *
 *                                                                             *
 * File:                        OtherActivityNameMatchValidator.java           *
 * Date of Last Commit: $Date:: 2015-06-22 17:18:37 -0700 (Mon, 22 Jun 2015) $ *
 * Revision Number:      $Rev:: 2540                                         $ *
 * Last Commit by:    $Author:: cmatsond                                     $ *
 *                                                                             *
 *******************************************************************************/

/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.jsf;

import ca.bc.gov.health.emaccs.web.Droplists;
import jakarta.enterprise.context.RequestScoped;
import jakarta.faces.application.FacesMessage;
import jakarta.faces.component.UIComponent;
import jakarta.faces.context.FacesContext;
import jakarta.faces.model.SelectItem;
import jakarta.faces.validator.FacesValidator;
import jakarta.faces.validator.Validator;
import jakarta.faces.validator.ValidatorException;
import jakarta.inject.Inject;
import java.io.Serializable;
import java.util.List;

/*
 * This validator checks if a submitted Other Activity name matches an existing Approved Activity name
 */
@RequestScoped
@FacesValidator(value = "validator.activityNameMatcher", managed = true)
public class OtherActivityNameMatchValidator implements Validator, Serializable {

    @Inject
    Droplists droplists;

    @Override
    public void validate(FacesContext context, UIComponent component, Object value) throws ValidatorException {

        /* Submitted Other Activity Name */
        String submittedActivityName = (String) value;

        //Grab the cached list of approved activities from the Droplist object
        List<SelectItem> activityNames = droplists.getActivityTypes();

        String msg = "This activity is listed in the Approved Activities. If you would like to add it, please do so on the 'Submit Approved Activities' page.";

        for (SelectItem activity : activityNames) {
            if (submittedActivityName.trim().equalsIgnoreCase(activity.getLabel().trim())) {
                if (component.getAttributes().get("message") != null) {
                    msg = (String) component.getAttributes().get("message");
                }
                FacesMessage message = new FacesMessage(msg);
                message.setSeverity(FacesMessage.SEVERITY_ERROR);
                throw new ValidatorException(message);
            }
        }

    }

}
