/*******************************************************************************
 * Copyright Â© 2015, Province of British Columbia.                             *
 *                                                                             *
 * All rights reserved.                                                        *
 *                                                                             *
 * File:                        CallDateValidator.java                         *
 * Date of Last Commit: $Date:: 2015-06-22 17:18:37 -0700 (Mon, 22 Jun 2015) $ *
 * Revision Number:      $Rev:: 2540                                         $ *
 * Last Commit by:    $Author:: cmatsond                                     $ *
 *                                                                             *
 *******************************************************************************/

/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.jsf;

import ca.bc.gov.health.emaccs.ejb.entity.PatientContact;
import ca.bc.gov.health.emaccs.web.LogPatientContacts;
import jakarta.enterprise.context.RequestScoped;
import jakarta.faces.application.FacesMessage;
import jakarta.faces.component.UIComponent;
import jakarta.faces.context.FacesContext;
import jakarta.faces.validator.FacesValidator;
import jakarta.faces.validator.Validator;
import jakarta.faces.validator.ValidatorException;
import jakarta.inject.Inject;
import java.io.Serializable;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;

/* This validator is used for checking whether or not an activity's end date falls within the currently selected reporting
 * year on the page.
 */
@RequestScoped
@FacesValidator(value = "validator.callDate", managed = true)
public class CallDateValidator implements Validator, Serializable {

    @Inject
    LogPatientContacts logPatientContacts;

    @Override
    public void validate(FacesContext context, UIComponent component, Object value) throws ValidatorException {
        Date callDate = (Date) value;
        String uniqueMsg = "Call Date Error: You may not enter two Patient Contacts with the same call date and time.";
        SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMddHHmm");

        List<PatientContact> aList = logPatientContacts.getPatientContactList();

        String callDateStr = sdf.format(callDate);
        for (PatientContact pc : aList) {
            if (callDateStr.equals(sdf.format(pc.getCallDate()))) {
                throwValidatorException(uniqueMsg);
            }
        }
    }

    private void throwValidatorException(String msg) throws ValidatorException {

        FacesMessage message = new FacesMessage(msg);
        message.setSeverity(FacesMessage.SEVERITY_ERROR);
        throw new ValidatorException(message);
    }
}
