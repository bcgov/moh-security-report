/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

package ca.bc.gov.health.pharmacare.web;

import ca.bc.gov.health.jsf.SelectItemHelper;
import ca.bc.gov.health.pcbl.session.AhfsFacadeLocal;
import ca.bc.gov.health.pcbl.session.AtcFacadeLocal;
import ca.bc.gov.health.pcbl.session.BrandNmFacadeLocal;
import ca.bc.gov.health.pcbl.session.GenDrugFacadeLocal;
import ca.bc.gov.health.pcbl.session.MfrFacadeLocal;
import ca.bc.gov.health.pcbl.session.PlanFacadeLocal;
import jakarta.annotation.PostConstruct;
import jakarta.enterprise.context.ApplicationScoped;
import jakarta.faces.model.SelectItem;
import jakarta.inject.Inject;
import jakarta.inject.Named;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Set;

/**
 * Collection of cached droplists used by
 * the application.
 *
 * @author greg.perkins
 */
@ApplicationScoped
@Named("DropLists")
public class DropLists  implements Serializable{

    @Inject
    private MfrFacadeLocal manufacturerFacade;

    @Inject
    private PlanFacadeLocal planFacade;

    @Inject
    private AhfsFacadeLocal ahfsFacade;

    @Inject
    private AtcFacadeLocal atcFacade;

    @Inject
    private GenDrugFacadeLocal genericFacade;

    @Inject
    private BrandNmFacadeLocal brandFacade;

    private List<SelectItem> plans;
    private List<SelectItem> ahfsClassifications;
    private List<SelectItem> atcClassifications;
    private List<SelectItem> manufacturers;
    private List<SelectItem> drugNames;

    public DropLists(){}

    /**
     * Initializes this object
     */
    @PostConstruct
    public void init(){
        System.out.println("Initializing droplists");
        plans = SelectItemHelper.buildSelectItemList(planFacade.findAll(), "pcarePlan", "pcarePlanCd");
        ahfsClassifications = SelectItemHelper.buildSelectItemList(ahfsFacade.findAll(), "ahfs", "ahfsCd");
        atcClassifications = SelectItemHelper.buildSelectItemList(atcFacade.findAll(), "atc", "atcCd");
        manufacturers = SelectItemHelper.buildSelectItemList(manufacturerFacade.findAll(),
                                                            "drugMfrNm", "drugMfrCd");
        List generic = SelectItemHelper.buildSelectItemList(genericFacade.findAll(), "genDrug", "genDrug");
        List brand = SelectItemHelper.buildSelectItemList(brandFacade.findAll(), "drugBrandNm", "drugBrandNm");
        drugNames = new ArrayList<SelectItem>();
        drugNames.addAll(generic);
        drugNames.addAll(brand);
        makeDistinct(ahfsClassifications);
        makeDistinct(atcClassifications);
    }

    private void makeDistinct(List<SelectItem> input){
        Set values = new HashSet();
        for (Iterator<SelectItem> it = input.iterator(); it.hasNext();) {
            SelectItem selectItem = it.next();
            if (values.contains(selectItem.getLabel())){
                it.remove();
            }else{
                values.add(selectItem.getLabel());
            }
        }
    }

    /* Getters and Setters below */

    public List<SelectItem> getAhfsClassifications() {
        return ahfsClassifications;
    }

    public void setAhfsClassifications(List<SelectItem> ahfsClassifications) {
        this.ahfsClassifications = ahfsClassifications;
    }

    public List<SelectItem> getAtcClassifications() {
        return atcClassifications;
    }

    public void setAtcClassifications(List<SelectItem> atcClassifications) {
        this.atcClassifications = atcClassifications;
    }

    public List<SelectItem> getManufacturers() {
        return manufacturers;
    }

    public void setManufacturers(List<SelectItem> manufacturers) {
        this.manufacturers = manufacturers;
    }

    public List<SelectItem> getPlans() {
        return plans;
    }

    public void setPlans(List<SelectItem> plans) {
        this.plans = plans;
    }

    public List<SelectItem> getDrugNames() {
        return drugNames;
    }

    public void setDrugNames(List<SelectItem> drugNames) {
        this.drugNames = drugNames;
    }

    public void setAhfsFacade(AhfsFacadeLocal ahfsFacade) {
        this.ahfsFacade = ahfsFacade;
    }

    public void setAtcFacade(AtcFacadeLocal atcFacade) {
        this.atcFacade = atcFacade;
    }

    public void setBrandFacade(BrandNmFacadeLocal brandFacade) {
        this.brandFacade = brandFacade;
    }

    public void setGenericFacade(GenDrugFacadeLocal genericFacade) {
        this.genericFacade = genericFacade;
    }

    public void setManufacturerFacade(MfrFacadeLocal manufacturerFacade) {
        this.manufacturerFacade = manufacturerFacade;
    }

    public void setPlanFacade(PlanFacadeLocal planFacade) {
        this.planFacade = planFacade;
    }


}
