package ca.bc.gov.health.pharmacare.web;

import ca.bc.gov.health.pcbl.entity.PharmDataUpdate;
import ca.bc.gov.health.pcbl.session.PharmDataUpdateFacadeLocal;
import jakarta.annotation.PostConstruct;
import jakarta.enterprise.context.RequestScoped;
import jakarta.inject.Inject;
import jakarta.inject.Named;
import java.io.Serializable;
import java.text.SimpleDateFormat;
import java.util.logging.Level;
import java.util.logging.Logger;

/*
 * Backing Bean for MasterTemplate which is used throughout the application
 */

/**
 *
 * @author ian.scott
 */
@RequestScoped
@Named("MasterTemplate")
public class MasterTemplate  implements Serializable {
    private Logger logger = Logger.getLogger(this.getClass().getName());
    
    @Inject
    private PharmDataUpdateFacadeLocal pharmDataUpdateFacade;
    
    private PharmDataUpdate pharmaDataUpdate;
    
    
        /**
     * Initializes this object
     */
    @PostConstruct
    public void init(){
        logger.log(Level.INFO, "initializing Date"); 
        try{
            pharmaDataUpdate = pharmDataUpdateFacade.getMostRecentRecord();
        }catch(Exception ex){
            logger.log(Level.INFO, "initializing Date: Failed");
            logger.log(Level.SEVERE, null, ex);                  
            pharmaDataUpdate = null;
        }
    }
    
    
    
    /*
    /**
     * Custom date Converter instance
     /
    private Converter dateConverter = new Converter(){

        @Override
        public Object getAsObject(FacesContext arg0, UIComponent arg1, String arg2) {
            return arg2;
        }

        @Override
        public String getAsString(FacesContext arg0, UIComponent arg1, Object arg2) {
            SimpleDateFormat sdf = new SimpleDateFormat("MMM, dd yyyy");//new SimpleDateFormat("dd-MMM-yyyy");
            return sdf.format((Date)arg2);
        }
    };
    public Converter getDateConverter() {
        return dateConverter;
    }

    public void setDateConverter(Converter dateConverter) {
        this.dateConverter = dateConverter;
    }*/
        
   public String getPharmaDataUpdateDate_AsString(){
         SimpleDateFormat sdf = new SimpleDateFormat("MMMM dd, yyyy");
         String result = "";
         if(pharmaDataUpdate==null) return "Unknown";
         try{
             result = sdf.format(pharmaDataUpdate.getLastBusinessDate());
         }catch(Exception ex){
             logger.log(Level.SEVERE, null, ex);
             return "Unknown";
         }
         
         return result;
    }
    
    public PharmDataUpdate getPharmaDataUpdate(){
         return pharmaDataUpdate;
    }
    public void setPharmaDataUpdate(PharmDataUpdate pharmaDataUpdate){
        this.pharmaDataUpdate= pharmaDataUpdate;
    }
    public void setPharmaDataUpdateFacade(PharmDataUpdateFacadeLocal pharmDataUpdateFacade){
        this.pharmDataUpdateFacade = pharmDataUpdateFacade;
    }

}
