<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
    </h:head>
    <h:body>
        <ui:composition template="/WEB-INF/templates/pcblTemplate.xhtml">
            <ui:define name="title">
                PharmaCare Formulary Search Results
            </ui:define>

            <ui:define name="content">
                <h:outputScript target="head">
                    function  UpdateBeanForPagination(){
                    try{
                    var el= document.getElementById("yui-pg0-0-pages");
                    var pg = el.getElementsByTagName("span")[0]
                    var page = pg.innerHTML;
                    var theValue =document.getElementById("form1:yyy").value;
                    if(theValue!=page){
                    document.getElementById("form1:yyy").value=page;
                    myRemote();
                    }
                    }catch(err){
                    }
                    }
                </h:outputScript>

                <h:form id="form1">
                    <h:inputHidden id="dinPin" value="#{ProductDetail.dinPin}"/>
                    <p:remoteCommand name="myRemote" actionListener="#{SearchResults.pageChange}"/>
                    <h1>PharmaCare Formulary Search Results</h1>
                    <p>Click on the DIN/PIN/NPN to show details for the product.</p>
                    <p>The amount PharmaCare actually pays depends on PharmaCare coverage rules and PharmaCare plan rules.</p>
                    <p:ajaxStatus onsuccess="UpdateBeanForPagination()" />
                    <h:inputHidden id="yyy" value="#{SearchResults.page}"/>

                    <div class="button-group">
                        <h:commandButton styleClass="primary-button button-spacer" action="#{Search.summarySearch}" value="Show Summary"/>
                        <h:outputText value=" "/>
                        <h:commandButton styleClass="secondary-button" action="#{Search.reset}" value="New Search"/>
                    </div>

                    <p:dataTable id="results" styleClass="resultsHeader" rows="#{Constants.maxResultsPerPage}" var="drug" value="#{SearchResults.results}" style="width: 100%;"
                                 paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"   paginatorPosition="bottom"
                                 first ="#{SearchResults.firstRowToDisplay}"
                                 >
                        <f:facet name="header">
                            <h:outputText value="Products found: #{SearchResults.size}"/>
                        </f:facet>
                        <p:column sortBy="#{drug.dinPin}" style="padding:3px;">
                            <f:facet name="header">
                                <h:outputText escape="false" value="DIN/PIN/NPN" title="#{msg['tipText.results.dinPin']}"></h:outputText>
                            </f:facet>
                            <p:commandLink styleClass="pcbl-table-link" value="#{drug.dinPin}" update="form1" action="#{ProductDetail.viewDrug}" oncomplete="PF('productDetailPopup').show();" >
                                <f:setPropertyActionListener target="#{ProductDetail.dinPin}" value = "#{drug.dinPin}" />
                            </p:commandLink>
                        </p:column>
                        <p:column sortBy="#{drug.genDrug}" style="padding:3px;">
                            <f:facet name="header">
                                <h:outputText value="#{msg['header.results.generic']}" escape="false" title="#{msg['tipText.results.genericName']}"></h:outputText>
                            </f:facet>
                            <h:outputText value="#{drug.genDrug}"/>
                        </p:column>
                        <p:column sortBy="#{drug.drugBrandNm}">
                            <f:facet name="header">
                                <h:outputText value="#{msg['header.results.bsd']}" escape="false" title="#{msg['tipText.results.brandName']}"></h:outputText>
                            </f:facet>
                            <h:outputText value="#{drug.drugBrandNm}"/> <nbsp/>
                            <h:outputText value="#{drug.genDrugStrgth}"/> <nbsp/>
                            <h:outputText value="#{drug.genDsgForm}"/>
                        </p:column>
                        <p:column sortBy="#{drug.drugMfrNm}" style="padding:3px;">
                            <f:facet name="header">
                                <h:outputText escape="false" title="#{msg['tipText.results.manufacturer']}" value="Manufacturer"></h:outputText>
                            </f:facet>
                            <h:outputText value="#{drug.drugMfrNm}"/>
                        </p:column>
                        <p:column style="text-align:center; padding:3px;">
                            <f:facet name="header">
                                <h:outputLink value="https://www2.gov.bc.ca/gov/content/health/practitioner-professional-resources/pharmacare/programs/reference-drug-program" title="#{msg['tipText.results.rdp']}">
                                    <h:outputText escape="false" value="RDP"/>
                                </h:outputLink>
                            </f:facet>
                            <h:outputText value="#{drug.rdpDisplayText}"/>
                        </p:column>
                        <p:column style="text-align:center; padding:3px;">
                            <f:facet name="header">
                                <h:outputText value="#{msg['header.results.maxDays']}" escape="false" title="#{msg['tipText.results.maxDays']}"></h:outputText>
                            </f:facet>
                            <h:outputText value="#{drug.maxDaysSply}"/>
                        </p:column>
                        <p:column style="text-align:center; padding:3px;" sortBy="#{drug.displayPrice}">
                            <f:facet name="header">
                                <h:outputText value="#{msg['header.results.maxCoverage']}" escape="false" title="#{msg['tipText.results.maxCoverage']}"></h:outputText>
                            </f:facet>
                            <h:outputText value="#{drug.displayPrice}" rendered="#{drug.maxPrice!=0}">
                                <f:convertNumber currencySymbol="$" minFractionDigits="4" type="currency"/>
                            </h:outputText>
                        </p:column>
                        <p:column style="text-align:center; padding:3px;">
                            <f:facet name="header">
                                <h:outputText escape="false" title="#{msg['tipText.results.unit']}" value="Unit"></h:outputText>
                            </f:facet>
                            <h:outputText value="#{drug.displayUnit}"/>
                        </p:column>
                        <p:column style="text-align:center; padding:3px;">
                            <f:facet name="header">
                                <h:outputText value="#{msg['header.results.sa']}" escape="false" title="#{msg['tipText.results.specialAuthority']}"></h:outputText>
                            </f:facet>
                            <h:outputLink rendered="#{drug.showSALink}" value="#{drug.specialAuthorityUrl}" styleClass="pcbl-table-link">
                                <h:outputText value="Yes"/>
                            </h:outputLink>
                            <h:outputText rendered="#{!drug.showSALink}" value="#{drug.saDetailsText}"/>
                        </p:column>
                        <p:column style="text-align:center; padding:3px;">
                            <f:facet name="header">
                                <h:outputText value="#{msg['header.results.ql']}" escape="false" title="#{msg['tipText.results.quantityLimits']}"></h:outputText>
                            </f:facet>
                            <p:commandLink id="quantityLimitsLink" rendered="#{drug.hasQL}" styleClass="pcbl-table-link"
                                           value="Yes" update="form1" action="#{ProductDetail.viewQuantityLimits}"
                                           oncomplete="PF('quantityLimitsPopup').show();" >
                                <f:setPropertyActionListener target="#{ProductDetail.dinPin}" value="#{drug.dinPin}" />
                            </p:commandLink>

                            <h:outputText rendered="#{!drug.hasQL}" value="No"/>
                        </p:column>

                    </p:dataTable>
                    <div class="button-group">
                        <p><h:outputText value="#{msg['text.note.rdp']}" escape="false"/></p>
                        <p><h:outputText value="#{msg['text.note.nb']}" escape="false"/></p>
                        <p><h:outputText value="#{msg['text.note.reviewResults']}" escape="false"/></p>
                        <p><h:outputText value="#{msg['text.note.search']}" escape="false"/></p>
                    </div>


                    <p:dialog id="productDetailPopup" widgetVar="productDetailPopup" styleClass="detailPopup" modal="true" height="600" width="800"
                              minHeight="550" minWidth="800" >
                        <f:facet name="header" >
                            <h:outputText value="PharmaCare Formulary Product Detail" />
                        </f:facet>
                        <p:panel style="margin-top:0px;">
                            <h2>Generic Name: <h:outputText value="#{ProductDetail.drug.genDrug}"/></h2>
                            <p style="font-size:1.2em">
                                Brand Name: <h:outputText value="#{ProductDetail.drug.drugBrandNm}"/><br/>
                                Dosage Form: <h:outputText value="#{ProductDetail.drug.genDrugStrgth} #{ProductDetail.drug.genDsgForm}"/><br/>
                                DIN/PIN: <h:outputText value="#{ProductDetail.drug.dinPin}"/><br/>
                            </p>
                            AHFS High Level Classification: <h:outputText value="#{ProductDetail.drug.ahfs1}"/><br/>
                            AHFS Therapeutic Classification: <h:outputText value="#{ProductDetail.drug.ahfs3}"/><br/>
                            ATC Classification: <h:outputText value="#{ProductDetail.drug.atc5}"/><br/>
                            Manufacturer: <h:outputText value="#{ProductDetail.drug.drugMfrNm}"/><br/>
                            Formulary Listing Date:
                            <h:outputText value="#{ProductDetail.drug.formularyLstDate}" converter="#{ProductDetail.dateConverter}"/><br/>
                            <br/><br/>
                            <h:outputText value="This product is covered under these PharmaCare Plans only."/>
                            <br/><br/>

                            <p:dataTable id="detailResults" rows="#{Constants.maxResultsPerPage}" var="benefit" value="#{ProductDetail.benefits}" style="width:100%; padding:3px;"
                                         paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"   paginatorPosition="bottom" paginatorAlwaysVisible="#{ProductDetail.showPagination}">
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText escape="false" value="Plan" title="#{msg['tipText.details.planName']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{benefit.pcarePlanCd}"/>
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="PharmaCare Plan" escape="false" title="#{msg['tipText.details.planDetails']}"></h:outputText>
                                    </f:facet>
                                    <h:outputLink value="#{msg[benefit.pcarePlanCd]}">
                                        <h:outputText value="#{benefit.pcarePlan}"/>
                                    </h:outputLink>
                                </p:column>
                                <p:column style="text-align:right; padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="Maximum PharmaCare Covers" escape="false" title="#{msg['tipText.details.coverageAmount']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{benefit.displayPrice}" rendered="#{benefit.maxPrice>0}" >
                                        <f:convertNumber minFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="Unit" escape="false" title="#{msg['tipText.details.unit']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{benefit.displayUnit}"/>
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText escape="false" title="#{msg['tipText.details.rdp']}" value="RDP"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="No" rendered="#{benefit.rdpDisplayText=='No'}"/>
                                    <h:outputLink value="http://www.health.gov.bc.ca/pharmacare/policy.html#8" rendered="#{benefit.rdpDisplayText=='Yes'}">
                                        <h:outputText value="Yes"/>
                                    </h:outputLink>
                                </p:column>
                                <p:column style="text-align:right; padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="Max Day Supply per Fill" escape="false" title="#{msg['tipText.details.maxDays']}"></h:outputText>
                                    </f:facet>
                                    <h:outputLink value="https://www2.gov.bc.ca/gov/content?id=B6EECB1791D64173A308A142CB947588">
                                        <h:outputText value="#{benefit.maxDaysSply}"/>
                                    </h:outputLink>
                                </p:column>
                            </p:dataTable>
                            <br/><br/>
                            <p:outputPanel rendered="#{ProductDetail.drug.hasQL}"><h2>PharmaCare Formulary Quantity Limits Detail</h2></p:outputPanel>

                            <br/><br/>
                            <p:dataTable id="quantityLimitsResultsEmbedded" rendered="#{ProductDetail.drug.hasQL}" rows="#{Constants.maxResultsPerPage}" var="drug" value="#{ProductDetail.drug}" style="width:100%; padding:3px;"
                                         paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"   paginatorPosition="bottom" paginatorAlwaysVisible="#{ProductDetail.showPagination}">
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText escape="false" value="Max Daily Qty" title="#{msg['tipText.ql.maxDailyQty']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{drug.maxDailyQty}"/>
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="Max PRD Qty" escape="false" title="#{msg['tipText.ql.maxPrdQty']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{drug.maxPrdQty}"/>
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="Max PRD Qty Days" escape="false" title="#{msg['tipText.ql.maxPrdQtyDay']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{drug.maxPrdQtyDays}" />
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="Max Annual Qty" escape="false" title="#{msg['tipText.ql.maxAnnualQty']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{drug.maxAnnualQty}"/>
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="BGTS Cat Label" escape="false" title="#{msg['tipText.ql.BGTSCatLabel']}"></h:outputText>
                                    </f:facet>
                                    <h:outputLink value="#{msg['url.bgtsCat']}">
                                        <h:outputText value="#{drug.bgtsCatFk.bgtsLabel}"/>
                                    </h:outputLink>
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText escape="false" title="#{msg['tipText.ql.BGTSCatMaxAnnualQty']}" value="BGTS Cat Max Annual Qty"></h:outputText>
                                    </f:facet>
                                    <h:outputLink value="#{msg['url.bgtsCat']}" >
                                        <h:outputText value="#{drug.bgtsCatMaxAnnualQty}"/>
                                    </h:outputLink>
                                </p:column>
                            </p:dataTable>
                            <br/><br/>
                            <div class="dr-pnl-h" style='margin-left: -10px; margin-right: -10px; margin-top: -10px; text-align:center;'>
                                <h:outputLink value="#" onclick="PF('productDetailPopup').hide(); return false;">Back to Search Results</h:outputLink>
                            </div>
                        </p:panel>

                        <br/>
                        <div style="width:700px;">
                            <p><h:outputText value="#{msg['text.note.search']}" escape="false"/></p>
                            <p><h:outputText value="#{msg['text.note.pharmaCarePays']}" escape="false"/></p>
                            <p><h:outputText value="#{msg['text.note.nb']}" escape="false"/></p>
                            <p><h:outputText value="#{msg['text.note.reviewResults']}" escape="false"/></p>
                            <p>
                                <!--1. <h:outputText value="#{msg['text.note.pharmaCarePlans']}" escape="false"/><br/>-->
                                <h:outputText value="#{msg['text.note.rdp']}" escape="false"/>
                            </p>
                        </div>
                    </p:dialog>

                    <p:dialog id="quantityLimitsPopup" widgetVar="quantityLimitsPopup" styleClass="detailPopup" modal="true">
                        <f:facet name="header">
                            <h:outputText value="PharmaCare Formulary Quantity Limits Detail" />
                        </f:facet>
                        <p:panel >
                            <h2>Generic Name: <h:outputText value="#{ProductDetail.drug.genDrug}"/></h2>
                            <p style="font-size:1.2em">
                                Brand Name: <h:outputText value="#{ProductDetail.drug.drugBrandNm}"/><br/>
                                Dosage Form: <h:outputText value="#{ProductDetail.drug.genDrugStrgth} #{ProductDetail.drug.genDsgForm}"/><br/>
                                DIN/PIN: <h:outputText value="#{ProductDetail.drug.dinPin}"/><br/>
                            </p>
                            <br/>
                            <p:dataTable id="quantityLimitsResults" rows="#{Constants.maxResultsPerPage}" var="drug" value="#{ProductDetail.drug}" style="width:700px; padding:3px;"
                                         paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"   paginatorPosition="bottom" paginatorAlwaysVisible="#{ProductDetail.showPagination}">
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText escape="false" value="Max Daily Qty" title="#{msg['tipText.ql.maxDailyQty']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{drug.maxDailyQty}"/>
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="Max PRD Qty" escape="false" title="#{msg['tipText.ql.maxPrdQty']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{drug.maxPrdQty}"/>
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="Max PRD Qty Days" escape="false" title="#{msg['tipText.ql.maxPrdQtyDay']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{drug.maxPrdQtyDays}" />
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText value="Max Annual Qty" escape="false" title="#{msg['tipText.ql.maxAnnualQty']}"></h:outputText>
                                    </f:facet>
                                    <h:outputText value="#{drug.maxAnnualQty}"/>
                                </p:column>
                                <p:column style="padding: 3px; ">
                                    <f:facet name="header">
                                        <h:outputText value="BGTS Cat Label" escape="false" title="#{msg['tipText.ql.BGTSCatLabel']}"></h:outputText>
                                    </f:facet>
                                    <h:outputLink value="#{msg['url.bgtsCat']}">
                                        <h:outputText value="#{drug.bgtsCatFk.bgtsLabel}"/>
                                    </h:outputLink>
                                </p:column>
                                <p:column style="padding: 3px;">
                                    <f:facet name="header">
                                        <h:outputText escape="false" title="#{msg['tipText.ql.BGTSCatMaxAnnualQty']}" value="BGTS Cat Max Annual Qty"></h:outputText>
                                    </f:facet>
                                    <h:outputLink value="#{msg['url.bgtsCat']}"  >
                                        <h:outputText value="#{drug.bgtsCatMaxAnnualQty}" />
                                    </h:outputLink>
                                </p:column>
                            </p:dataTable>
                            <br/><br/>
                            <div class="dr-pnl-h" style='margin-left: -10px; margin-right: -10px; margin-top: -10px; text-align:center;'>
                                <h:outputLink value="#" onclick="PF('quantityLimitsPopup').hide(); return false;">Back to Search Results</h:outputLink>
                            </div>

                        </p:panel>
                    </p:dialog>

                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
