/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.pharmacare.web.selenium.functional;


import ca.bc.gov.health.pharmacare.web.selenium.pageobjects.BenefitsLookupHomePage;
import ca.bc.gov.health.pharmacare.web.selenium.pageobjects.DetailsPage;
import ca.bc.gov.health.pharmacare.web.selenium.pageobjects.SearchPage;
import ca.bc.gov.health.pharmacare.web.selenium.pageobjects.fragment.LeftMenu;
import ca.bc.gov.health.pharmacare.web.selenium.pageobjects.fragment.SearchResult;
import java.util.HashMap;
import java.util.Map;
import org.junit.AfterClass;
import org.junit.Before;
import org.junit.BeforeClass;
import org.junit.Test;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.remote.CapabilityType;
import org.openqa.selenium.remote.DesiredCapabilities;
import selenium.pageobject.LoginPage;
import selenium.util.ActionBot;
import selenium.util.Constants;
import selenium.util.UserAccounts;
import selenium.util.WebDriverFactory;

/**
 *
 * @author adebiyi.kuseju
 */
public class DetailsPageTest {

    private static DesiredCapabilities desiredCapabilities;
    private static WebDriver driver;
    private static DetailsPage detailsPage;
    private static SearchPage searchPage;
    private static ActionBot actionBot;

    public DetailsPageTest() {
    }

    @BeforeClass
    public static void setUpClass() throws Exception {
        desiredCapabilities = DesiredCapabilities.internetExplorer();
        desiredCapabilities.setCapability(CapabilityType.ACCEPT_SSL_CERTS, true);

        driver = WebDriverFactory.getInstance(WebDriverFactory.DRIVER_TYPE.SERVER, desiredCapabilities);
        
        actionBot = new ActionBot(driver);

        LeftMenu leftMenu = new LeftMenu(driver, desiredCapabilities.getBrowserName());
        BenefitsLookupHomePage benefitsLookupHomePage = new BenefitsLookupHomePage(leftMenu, driver, desiredCapabilities.getBrowserName());       
        searchPage = new SearchPage(benefitsLookupHomePage, leftMenu, driver, desiredCapabilities.getBrowserName()).get();
        detailsPage = new DetailsPage(searchPage, leftMenu, driver, desiredCapabilities.getBrowserName()).get();


    }

    @AfterClass
    public static void tearDownClass() {
        driver.quit();
    }

    @Before
    public void setUp() {

    }
    
    @Test
    public void testDetailPage() {
        detailsPage.assertPharmacarePlanHyperlinked();
    }

    
    @Test
    public void testNavigationBackToSearchResultUsingLink() {
        detailsPage.navigateBackToSearchResultUsingLink();
        actionBot.waitForLoading(SearchResult.SEARCH_RESULT_TABLE_ID, Constants.MEDIUM_TIMEOUT);
        detailsPage.assertNavigationBackToResultPage();
        searchPage.viewDetailsForFirstResultItem();
    }
    
    @Test
    public void testNavigationToNewSearchFormUsingButton() {
        detailsPage.navigateToSearchFormUsingButton();
        actionBot.waitForLoading(SearchPage.SEARCH_BUTTON_ID, Constants.MEDIUM_TIMEOUT);
        detailsPage.assertAllSearchFieldsCleared();
        
        Map<String, String> parameters = new HashMap<>();
        parameters.put(SearchPage.AHFS_THERAPEUTIC_CLASSIFICATION, "Adrenals");

        searchPage.search(parameters);  
        actionBot.waitForLoading(SearchResult.SEARCH_RESULT_TABLE_ID, Constants.MEDIUM_TIMEOUT);
        searchPage.viewDetailsForFirstResultItem();
    }
    

}