/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

package ca.bc.gov.health.pcbl.session;

import ca.bc.gov.health.pcbl.entity.SpecialAuthorityLink;
import jakarta.ejb.Stateless;
import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import java.util.List;

/**
 *
 * @author greg.perkins
 */
@Stateless
public class SpecialAuthorityLinkFacade implements SpecialAuthorityLinkFacadeLocal {
    @PersistenceContext(unitName="PCBL-ejbPU")
    private EntityManager em;

    public void create(SpecialAuthorityLink specialAuthorityLink) {
        em.persist(specialAuthorityLink);
    }

    public void edit(SpecialAuthorityLink specialAuthorityLink) {
        em.merge(specialAuthorityLink);
    }

    public void remove(SpecialAuthorityLink specialAuthorityLink) {
        em.remove(em.merge(specialAuthorityLink));
    }

    public SpecialAuthorityLink find(Object id) {
        return em.find(ca.bc.gov.health.pcbl.entity.SpecialAuthorityLink.class, id);
    }

    public List<SpecialAuthorityLink> findAll() {
        return em.createQuery("select object(o) from SpecialAuthorityLink as o").getResultList();
    }
    
    public void saveAll(List<SpecialAuthorityLink> links, String baseUrl){
        for (SpecialAuthorityLink link : links) {
            if (link.getInformationLookupUrl()==null){
                link.setInformationLookupUrl(baseUrl);
            }else{
                int index = link.getInformationLookupUrl().lastIndexOf('/');
                String suffix = link.getInformationLookupUrl().substring(index+1);
                link.setInformationLookupUrl(baseUrl+suffix);
            }
            SpecialAuthorityLink dbRecord = em.find(SpecialAuthorityLink.class, link.getDinPinId());
            if (dbRecord!=null){
                dbRecord.setInformationLookupUrl(link.getInformationLookupUrl());
                em.merge(dbRecord);
            }else{
                em.persist(link);
            }
        }
    }

}
