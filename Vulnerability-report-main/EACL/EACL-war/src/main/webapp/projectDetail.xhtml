<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30Template.xhtml">
    <ui:define name="title"><h:outputText value="#{msg.Manage_Project_Detail}"/></ui:define>
    <ui:define name="body">   
        
        <h2><h:outputText value="#{msg.Manage_Project_Detail}"/></h2>
        <hr/>
        <h:form id="form1">
            
            <p:messages id="messages" closable="true">
                <p:autoUpdate />
            </p:messages>
            <p:panel id="entry">
                <f:facet name="header"><h:outputText value="#{msg.Project_Detail}"/></f:facet>
                <div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <h:outputText value="#{msg['project_name']}: "/>
                        </div>
                        <div class="ui-g-6">
                            <h:outputText value="#{projectDetail.project.name}"/>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <h:outputText value="#{msg.status}: "/>
                        </div>
                        <div class="ui-g-2">
                            <h:outputText value="#{projectDetail.project.statusId.name}"/>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <h:outputText value="#{msg.claim_start_date}: "/>
                        </div>
                        <div class="ui-g-2">
                            <h:outputText value="#{projectDetail.project.projectFromDate}">
                                <f:convertDateTime type="date" pattern="MMM-dd-yyyy"/>
                            </h:outputText>                                
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <h:outputText value="#{msg.claim_end_date}: "/>
                        </div>
                        <div class="ui-g-2">
                            <h:outputText value="#{projectDetail.project.projectToDate}" >
                                <f:convertDateTime type="date" pattern="MMM-dd-yyyy"/>
                            </h:outputText> 
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <h:outputText value="#{msg.date_to_print} "/><h:outputText value="#{msg.on_letter}: "/>                            
                        </div>
                        <div class="ui-g-2">
                            <p:calendar id="printingDate"
                                        value="#{projectDetail.printingDate}" 
                                        style="width:200px" pattern="yyyy-MMM-dd" 
                                        maxlength="11"
                                        disabled="#{projectDetail.project.statusId.name=='Archived'}"
                                        mode="popup" navigator="true" readonlyInput="true">
                                    <p:ajax event="dateSelect" update="buttonsId" global="false"/>
                                    <p:ajax event="change" update="buttonsId" global="false"/>
                            </p:calendar>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-8">
                            <p:outputPanel id="buttonsId">
                                <p:commandButton action="#{projectDetail.close}" value="#{msg.project_close}" disabled="#{projectDetail.project.statusId.name=='Archived' }"/>
                                <p:graphicImage height="1" alt="" value="/resources/template-images/spacer.gif" width="10"/>
                                <p:commandButton action="#{projectDetail.archive}"
                                                 value="#{msg.project_archive}"
                                                 id="prjArchiveId"
                                                 onclick="PF('dlg').show();return false;" 
                                                 disabled="#{projectDetail.project.statusId.name!='Closed' or projectDetail.project.statusId.name=='Archived' }"
                                                 global="false"/>
                                <p:graphicImage height="1" alt="" value="/resources/template-images/spacer.gif" width="10"/>                               
                                <p:commandButton id="previewLettersButtonId"
                                                 action="#{projectDetail.previewLetters}" 
                                                 value="#{msg.project_preview_letters}" 
                                                 disabled="#{projectDetail.disablePrintButtons or projectDetail.selectedPatientsList.size()==0 or projectDetail.printingDate==null}"                                                  
                                                 ajax="false"/>                              
        
                                
                                <p:graphicImage height="1" alt="" value="/resources/template-images/spacer.gif" width="10"/>
                                <p:commandButton id="printLettersButtonId" 
                                                 actionListener="#{projectDetail.printLetters}" 
                                                 value="#{msg.project_print_letters}"  
                                                 disabled="#{projectDetail.disablePrintButtons or projectDetail.selectedPatientsList.size()==0 or projectDetail.printingDate==null}"                                                  
                                                 ajax="false"/>
                
                            </p:outputPanel>

                            <p:dialog id="confirmPopUp" widgetVar="dlg" width="400" height="150" 
                                      modal="true" resizable="false" header="#{msg.project_confirm_archive}"
                                      styleClass="hoverable" closable="true">
                                <p><h:outputText value="#{msg.prj_archive_data_policy}"/></p>
                                <br/>
                                <table align="center">
                                    <tr>
                                        <td class="hoverable">
                                            <p:commandButton value="Confirm" id="ConfirmBtn" process="@this"
                                                             update="buttonsId entry confirmPopUp"
                                                             styleClass="hoverable"
                                                             actionListener="#{projectDetail.archive}"
                                                             onclick="PF('dlg').hide();"/>
                                        </td>
                                        <td>
                                            <p:graphicImage height="1" alt="" value="/resources/template-images/spacer.gif" width="10"/>
                                        </td>
                                        <td class="hoverable">
                                            <p:commandButton value="Cancel" id ="cancelBtn"
                                                             update="buttonsId entry confirmPopUp"
                                                             styleClass="hoverable"
                                                             onclick="PF('dlg').hide(); return false;" />
                                        </td>
                                    </tr>
                                </table>
                            </p:dialog>
                        </div>
                    </div>
                </div>
            </p:panel>
            <br/><br/>

            <p:panel id="projectSummary">
                <f:facet name="header"><h:outputText value="#{msg.project_summary}"/></f:facet>

                <p:outputPanel>
                    <h:outputText value="#{msg.pharmacy_list}: " />
                    <h:outputText value=" " />
                    <h:selectOneMenu id="projectPharmacyId" value="#{projectDetail.pharmacyProvider.id}" style="font-weight: normal;">
                        <f:selectItem itemLabel="All" itemValue ="-1"/>
                        <f:selectItems value ="#{projectDetail.pharmacyProviderForProject}" />
                        <f:ajax event="change" execute="@this"
                                listener="#{projectDetail.changePharmacyProviderCode}"
                                render="pharmacyCodeId buttonsId patientCounterId printingDate"/>
                    </h:selectOneMenu>
                </p:outputPanel>

                <p:outputPanel id="patientCounterId">
                    <h:outputText value=" " />
                    <h:outputText value="#{msg.patients_selected}: "/>
                    <h:outputText value ="#{projectDetail.selectedPatientsList.size()}" style="font-weight: normal;"/>
                </p:outputPanel>

                <p:panel id="pharmacyCodeId" styleClass="noBorder">
                    <p:dataTable value="#{projectDetail.patientLettersAll}" id="letterTable"
                                 var="patientLetter"  rowIndexVar="index" scrollHeight="600" selection="#{projectDetail.selectedPatientsList}" rowKey="#{patientLetter.phn}"
                                 paginator="true" rows="25" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="25,50,100" >
                        <p:ajax  event="rowSelectCheckbox" update=":form1:buttonsId :form1:pharmacyCodeId :form1:patientCounterId :form1:projectPharmacyId" global="false"/>
                        <p:ajax  event="toggleSelect" update=":form1:buttonsId :form1:pharmacyCodeId :form1:patientCounterId :form1:projectPharmacyId" global="false"/>
                        <p:ajax  event="rowUnselectCheckbox" update=":form1:buttonsId :form1:pharmacyCodeId :form1:patientCounterId :form1:projectPharmacyId" global="false"/>

                        <p:ajax event="rowSelect" update=":form1:buttonsId :form1:pharmacyCodeId :form1:patientCounterId :form1:projectPharmacyId" global="false"/>
                        <p:column width="3%">
                            <p:rowToggler />
                        </p:column>
                        <p:column selectionMode="Multiple" rendered="#{projectDetail.providerSelected}" width="3%" />

                        <p:column sortBy="#{patientLetter.pharmacyProviderId.code}">
                            <f:facet name="header"><h:outputText value="#{msg['pharm_code']}"/>-<h:outputText value="#{msg['pharm_name']}"/></f:facet>
                            <h:outputText value="#{patientLetter.letter.pharmacyProviderId.code}"/>-<h:outputText value="#{patientLetter.pharmacyProviderId.name}"/>
                        </p:column>
                        <p:column sortBy="#{patientLetter.recipientLastName}">
                            <f:facet name="header"><h:outputText value="#{msg['Letter.LastName.desc']}"/><br/><h:outputText value="#{msg['Letter.FirstName.desc']}"/></f:facet>
                            <h:outputText value="#{patientLetter.recipientLastName} "/><h:outputText value="#{patientLetter.recipientFirstName}"/>
                        </p:column>
                        <p:column sortBy="#{patientLetter.recipientAddress}">
                            <f:facet name="header"><h:outputText value="#{msg['Letter.recipientAddress.desc']}"/></f:facet>
                            <h:outputText value="#{patientLetter.recipientAddress} "/>
                        </p:column>
                        <p:column width="7%" sortBy="#{patientLetter.phn}">
                            <f:facet name="header"><h:outputText value="#{msg['Letter.phn.desc']}"/></f:facet>
                            <h:outputText value="#{patientLetter.phn}"/>    
                        </p:column>
                        <p:column width="7%">
                            <f:facet name="header"><h:outputText value="#{msg['case_code']}"/></f:facet>
                            <h:outputText value="#{patientLetter.caseCode}"/>
                        </p:column>
                        <p:column width="5%" sortBy="#{patientLetter.age}">
                            <f:facet name="header"><h:outputText value="#{msg['Letter.patient.age.line2']}"/></f:facet>
                            <h:outputText value="#{patientLetter.age}"/>    
                        </p:column>
                        <p:column width="7%" sortBy="#{patientLetter.letterPrintedFlag}">
                            <f:facet name="header"><h:outputText value="#{msg['Letter.desc']}"/><br/><h:outputText value="#{msg['Letter.letterPrintedFlag.desc2']}"/></f:facet>
                            <p:selectBooleanCheckbox id="letterPrintFlag" value="#{patientLetter.letterPrintedFlag.toString() ne 'Y'}" disabled="true"/>
                        </p:column>
                        <p:column sortBy="#{patientLetter.statusId.id}">
                            <f:facet name="header"><h:outputText value="#{msg['letter_status']}"/></f:facet>
                            <h:selectOneMenu  id="letterStatusId" label="#{msg.letter_status}" style="width: 100% !important" 
                                              value="#{patientLetter.statusId.id}" valueChangeListener="#{projectDetail.changeLetterStatus}">
                                <f:selectItems value ="#{Droplists.codesLetterStatuss}"/>
                                <f:ajax event="change" execute="@this" render="@this"/>
                            </h:selectOneMenu>                           
                        </p:column>
                        <p:rowExpansion>
                            <p:panelGrid columns="2" styleClass="letterDetailsPanel">
                                <p:panel styleClass="letterNotesPanel">
                                    <h3><h:outputText value="#{msg.recipient_notes}"/></h3>
                                    <p:inputTextarea value="#{patientLetter.letter.notes}" disabled="true" rows="6" cols="45" />
                                </p:panel>
                                <p:panel styleClass="letterNotesPanel">
                                    <h3><h:outputText value="#{msg.admin_notes}"/></h3>
                                    <p:inputTextarea value="#{patientLetter.letter.adminNotes}" rows="6" cols="45" />
                                    <p:commandButton 
                                        value="#{msg['button.save']}" 
                                        id="adminNotesAction" 
                                        actionListener="#{projectDetail.saveLetterAdminNotes(index, patientLetter.letter.adminNotes)}" 
                                        update="form1"/>
                                </p:panel>
                            </p:panelGrid>
                            
                            <p:outputPanel rendered="#{patientLetter.letter.hasPrescriptions}">
                                <h5><h:outputText value="#{msg['Letter.prescriptionsList.desc']}"/></h5>
                                <p:dataTable value="#{patientLetter.letter.prescriptionsList}" var="srv" styleClass="letterDetailsServices"> 
                                    <p:column headerText="#{msg['Prescriptions.prescriptionDate.desc']}">
                                        <h:outputText value="#{srv.prescriptionDate}">
                                            <f:convertDateTime type="date" pattern="MMM-dd-yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="#{msg['Prescriptions.brandName.desc']}">
                                        <h:outputText value="#{srv.brandName}"/>
                                    </p:column>
                                    <p:column headerText="#{msg['Prescriptions.genericName.desc']}">
                                        <h:outputText value="#{srv.genericName}"/>
                                    </p:column>
                                    <p:column headerText="#{msg['prac_name']}">
                                        <h:outputText value="#{srv.practitionerName}"/>
                                    </p:column>
                                    <p:column width="10%" headerText="#{msg['Prescriptions.quantity.desc']}">
                                        <h:outputText value="#{srv.quantity}"/>
                                    </p:column>
                                    <p:column width="10%" headerText="#{msg['Prescriptions.drugStrength.desc']}">
                                        <h:outputText value="#{srv.drugStrength}"/>
                                    </p:column>
                                    <p:column headerText="#{msg['status']}">
                                        <h:outputText value="#{srv.statusId.name}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:outputPanel>
                            
                            <p:outputPanel rendered="#{patientLetter.letter.hasPlans}">
                                <h4><h:outputText value="#{msg['PlansM.desc']}"/></h4>
                                <p:dataTable value="#{patientLetter.letter.plansMList}" var="srv" styleClass="letterDetailsServices">
                                    <p:column headerText="#{msg['PlansM.planMDate.desc']}">
                                        <h:outputText value="#{srv.planMDate}">
                                            <f:convertDateTime type="date" pattern="MMM-dd-yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="#{msg['PlansM.medicationReviewDesc.desc']}">
                                        <h:outputText value="#{srv.medicationReviewDesc}"/>
                                    </p:column>
                                    <p:column headerText="#{msg['PlansM.pharmacist.desc']}">
                                        <h:outputText value="#{srv.dspgPracName}"/>
                                    </p:column>
                                    <p:column headerText="#{msg['service_status']}">
                                        <h:outputText value="#{srv.statusId.name}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:outputPanel>
                            
                            <p:outputPanel rendered="#{patientLetter.letter.hasProsthetics}">
                                <h5><h:outputText value="#{msg['ProstheticsAndOrthotics.desc']}"/></h5>
                                <p:dataTable value="#{patientLetter.letter.prosthOrthList}" var="srv" styleClass="letterDetailsServices"> 
                                    <p:column headerText="#{msg['ProstheticsAndOrthotics.pAndODate.desc']}">
                                        <h:outputText value="#{srv.prostheticAndOrthoticDate}">
                                            <f:convertDateTime type="date" pattern="MMM-dd-yyyy"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="#{msg['ProstheticsAndOrthotics.medicalDeviceBenefit.desc']}">
                                        <h:outputText value="#{srv.medicalDeviceBenefit}"/>
                                    </p:column>
                                    <p:column headerText="#{msg['ProstheticsAndOrthotics.totalPhCarePay.desc']}">
                                        <h:outputText value="#{srv.totalPhCarePay}"/>
                                    </p:column>
                                    <p:column headerText="#{msg['ProstheticsAndOrthotics.totalCoCarePay.desc']}">
                                        <h:outputText value="#{srv.totalCoCarePay}"/>
                                    </p:column>
                                    <p:column headerText="#{msg['service_status']}">
                                        <h:outputText value="#{srv.statusId.name}"/>
                                    </p:column>
                                </p:dataTable>
                            </p:outputPanel>
                        </p:rowExpansion>
                        
                        <p:ajax event="page" global="false"/>
                        <p:ajax event="sort" global="false"/>
                    </p:dataTable>
                </p:panel>

            </p:panel>

        </h:form>
    </ui:define>
</ui:composition>
