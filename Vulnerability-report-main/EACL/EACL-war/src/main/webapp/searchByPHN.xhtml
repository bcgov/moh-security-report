<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30Template.xhtml">
    <ui:define name="title">#{msg.search}</ui:define>       
    <ui:define name="body">

        <h:form id="tableSearchByPhnForm">
            <p:messages id="messages" closable="true">
                <p:autoUpdate />
            </p:messages>

            <p:panel id="contentInner">
                <f:facet name="header">#{msg.Search_Patient_Letter}</f:facet>

                <div>
                    <div class="ui-g">
                        <p:outputLabel value=" #{msg['Search_By_Label']}:"/>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <h:selectOneMenu id="search_by" value="#{findPatientByPhn.searchBy}" required="true">
                                <f:selectItem itemLabel="#{msg.case_code}" itemValue="CASE_CODE" />
                                <f:selectItem itemLabel="#{msg.Patient_Detail_Phn}" itemValue="PHN" />
                            </h:selectOneMenu>
                        </div>
                        <div class="ui-g-2">
                            <p:inputText value="#{findPatientByPhn.filter}"
                                         size="15"
                                         id="filter"  
                                         maxlength="10"/>
                        </div>
                        <div id="commandButtons" class="ui-g-2">
                            <p:commandButton id="findPatientBtn" 
                                             actionListener="#{findPatientByPhn.findPatient}" 
                                             value="#{msg.Search_Patient_Letter}" 
                                             update="tableSearchByPhnForm" />
                        </div>
                    </div>
                    
                </div>
            </p:panel>
            <br/> 
            <p:panel id = "patientLetterSummary" rendered="#{findPatientByPhn.patientResults.size()!=0}">
                <f:facet name="header"><h:outputText value="#{msg['Search_Letter_by_PHN_Summary']}" /></f:facet>
                <p:dataTable value="#{findPatientByPhn.patientResults}" 
                             var="patientLetterResult" 
                             rowKey="#{patientLetterResult.id}"
                             rowIndexVar="index" 
                             rows="10" 
                             editable="true" 
                             editMode="cell" 
                             scrollHeight="150" 
                             id="resultsTable"
                             paginator="true"
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="10">

                    <p:column width="4%">
                        <p:rowToggler />
                    </p:column>
                    <p:column sortBy="#{patientLetterResult.pracSvaProjectId.pracBllgNum}"
                              filterBy="#{patientLetterResult.pracSvaProjectId.pracBllgNum}-#{patientLetterResult.pracSvaProjectId.svaProjectCode}"
                              filterMatchMode="contains" 
                              filterStyle="display: none" 
                              width="13%" >
                        <f:facet name="header"><h:outputText value="#{msg['Patient_Detail_ProjectName']}"/></f:facet>
                        <h:outputText value="#{patientLetterResult.pracSvaProjectId.pracBllgNum}"/>-<h:outputText  value="#{patientLetterResult.pracSvaProjectId.svaProjectCode}"/>
                    </p:column>
                    <p:column sortBy="#{patientLetterResult.pracSvaProjectId.pracSurname}" width="13%">
                        <f:facet name="header"><h:outputText value="#{msg['prac_display_name']}"/></f:facet>
                        <h:outputText value="#{patientLetterResult.pracSvaProjectId.pracSurname}"/><h:outputText value=", #{patientLetterResult.pracSvaProjectId.pracFirstGvnNm}"/><h:outputText value=", #{patientLetterResult.pracSvaProjectId.pracSecondGvnNm}"/>
                    </p:column> 
                    <p:column sortBy="#{patientLetterResult.recipientLastName}" width="12%">
                        <f:facet name="header"><h:outputText value="#{msg['Patient_Detail_Name']}"/></f:facet>
                        <h:outputText value="#{patientLetterResult.recipientLastName}"/>, <h:outputText value="#{patientLetterResult.recipientFirstName}"/>
                    </p:column>
                    <p:column sortBy="#{patientLetterResult.recipientAddress}" width="12%">
                        <f:facet name="header"><h:outputText value="#{msg['Patient_Detail_Address']}"/></f:facet>
                        <h:outputText value="#{patientLetterResult.recipientAddress}"/>
                    </p:column> 
                    <p:column sortBy="#{patientLetterResult.phn}" width="10%" >
                        <f:facet name="header"><h:outputText value="#{msg['Patient_Detail_Phn']}"/></f:facet>
                        <h:outputText value="#{patientLetterResult.phn}"/>
                    </p:column>
                    <p:column width="13%" >
                        <f:facet name="header"><h:outputText value="#{msg['case_code']}"/></f:facet>
                        <h:outputText value="#{patientLetterResult.caseCode}"/>
                    </p:column>
                    <p:column sortBy="#{patientLetterResult.statusId.id}" width="12%">
                        <f:facet name="header"><h:outputText value="#{msg['Patient_Detail_LetterStatus']}"/></f:facet>
                        <h:selectOneMenu id="letterRunStatusesIn" 
                                         value="#{patientLetterResult.statusId.id}"
                                         valueChangeListener="#{findPatientByPhn.changeLetterStatus}"
                                         disabled="#{findPatientByPhn.disableLetterStatus(patientLetterResult.pracSvaProjectId)}"
                                         style="width: 100% !important">
                            <f:selectItems value ="#{Droplists.codesLetterStatuss}" />
                            <f:ajax event="change" execute="@this" render="@this" />
                        </h:selectOneMenu>
                    </p:column> 
                    <p:rowExpansion>
                        <p:panelGrid columns="2" styleClass="letterDetailsPanel">
                            <p:panel styleClass="letterNotesPanel">
                                <h3><h:outputText value="#{msg.recipient_notes}"/></h3>
                                <p:inputTextarea value="#{patientLetterResult.notes}" disabled="true" rows="6" cols="45" />
                            </p:panel>
                            <p:panel styleClass="letterNotesPanel">
                                <h3><h:outputText value="#{msg.admin_notes}"/></h3>
                                <p:inputTextarea value="#{patientLetterResult.adminNotes}" rows="6" cols="45" />
                                <p:commandButton 
                                    value="#{msg['button.save']}" 
                                    id="adminNotesAction" 
                                    actionListener="#{patientDetail.saveAdminNotes(patientLetterResult.id, patientLetterResult.adminNotes)}" 
                                    update="tableSearchByPhnForm"/>
                            </p:panel>
                        </p:panelGrid>
                        <p:dataTable value="#{patientLetterResult.sortedServiceMspList}" var="srv" styleClass="letterDetailsServices"> 
                            <p:column headerText="#{msg['Search_Letter_Date_of_Service']}">
                                <h:outputText value="#{srv.srvDate}">
                                    <f:convertDateTime type="date" pattern="yyyy-MM-dd"/>
                                </h:outputText>
                            </p:column>
                            <p:column width="10%" headerText="#{msg['Search_Letter_Fee_Item']}">                        
                                <h:outputText value="#{srv.pdFitmCd}"/>
                            </p:column>
                            <p:column headerText="#{msg['short_description']}">
                                <h:outputText value="#{srv.pdFitm}"/>
                            </p:column>
                            <p:column headerText="#{msg['service_status']}">
                                <h:outputText value="#{srv.statusId.name}"/>
                            </p:column>
                        </p:dataTable>
                    </p:rowExpansion>
                    <p:ajax event="page" global="false"/>
                    <p:ajax event="sort" global="false"/>
                    <p:ajax event="rowSelect" global="false"/>
                    <p:ajax event="rowUnselect" global="false"/>
                </p:dataTable>
            </p:panel>
        </h:form>
    </ui:define>
</ui:composition>
