<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30Template.xhtml">
    <ui:define name="title"><h:outputText value="#{msg.Manage_Letter_Content}"/></ui:define>
    <ui:define name="body">
        <script type="text/javascript">
            // Disable the preview button if the template has no name.
            function checkTextField(field) {
                if (field.value === '') {
                    PF('previewLetterBtn').disable();
                } else {
                    PF('previewLetterBtn').enable();

                }
            }
        </script>
        <h2><h:outputText value="#{msg.Manage_Letter_Content}"/></h2>
        <hr/>
        <f:metadata>
            <f:event type="preRenderView" listener="#{MaintainLetterTemplate.resetData()}"/>
        </f:metadata>
        <h:form enctype="multipart/form-data" id="form1">
            <p:messages id="messages" closable="true">
                <p:autoUpdate />
            </p:messages>
            <p:panel id="contentInner">
                <span class='required'>*</span><p:outputLabel value=" #{msg['Required_Fields']}"/>
                <f:facet name="header"><h:outputText value="#{msg.Manage_Edit_Letter_Content}"/></f:facet>
                <div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="letterTemplateTypeLabel1" for="letterTemplateTypeId" value="#{msg['LetterTemplate.desc']} #{msg['LetterTemplate.type.desc']}: "
                                           rendered="#{request.isUserInRole('SYSADMIN') or ((ApplicationSelectionBean.app eq 'pacl') and (request.isUserInRole('Super_Sysadmin')))}"/>
                            <p:outputLabel id="letterTemplateTypeLabel2" for="letterSAVTemplateTypeId" value="#{msg['LetterTemplate.desc']} #{msg['LetterTemplate.type.desc']}: "
                                           rendered="#{request.isUserInRole('EACL_Sysadmin') or ((ApplicationSelectionBean.app eq 'sva') and (request.isUserInRole('Super_Sysadmin')))}"/>
                        </div>
                        <div class="ui-g-4">
                            <h:selectOneMenu  id="letterTemplateTypeId" label="#{msg['LetterTemplate.desc']}" 
                                              value="#{MaintainLetterTemplate.letterTemplate.letterTemplateTypeId.id}" 
                                              valueChangeListener="#{MaintainLetterTemplate.changeLetterTemplateType}"
                                              rendered="#{request.isUserInRole('SYSADMIN') or ((ApplicationSelectionBean.app eq 'pacl') and (request.isUserInRole('Super_Sysadmin')))}"
                                              required="true">
                                <f:selectItems value ="#{Droplists.codesLetterTemplateTypes}"/>
                                <f:ajax event="change" execute="@this" render="contentInner"/>                  
                            </h:selectOneMenu>
                            <h:selectOneMenu  id="letterSAVTemplateTypeId" label="#{msg['LetterTemplate.desc']}" 
                                              value="#{MaintainLetterTemplate.letterTemplate.letterTemplateTypeId.id}" 
                                              valueChangeListener="#{MaintainLetterTemplate.changeLetterTemplateType}"
                                              rendered="#{request.isUserInRole('EACL_Sysadmin') or ((ApplicationSelectionBean.app eq 'sva') and (request.isUserInRole('Super_Sysadmin')))}"
                                              required="true">
                                <f:selectItems value ="#{Droplists.codesSVALetterTemplateTypes}"/>
                                <f:ajax event="change" execute="@this" render="contentInner"/>                  
                            </h:selectOneMenu>                         
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="contentNameLabel" for="content_name" value="#{msg['LetterTemplate.desc']} #{msg['LetterTemplate.name.desc']}: "/>
                        </div>
                        <div class="ui-g-4">
                            <p:inputText id="content_name" value="#{MaintainLetterTemplate.letterTemplate.name}" 
                                         label="#{msg['LetterTemplate.desc']} #{msg['LetterTemplate.name.desc']} " size="75" required="true" onblur="checkTextField(this);">
                                <f:validateLength maximum="100"/>
                                <p:ajax event="blur"  />
                            </p:inputText>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="headerSectionLabel" for="headerSectionId" value="#{msg['LetterTemplate.headerSection.desc']}:"/>
                        </div>
                        <div class="ui-g-5">
                            <p:inputText id="headerSectionId" value="#{MaintainLetterTemplate.letterTemplate.headerSection}" 
                                         size="75" label="#{msg['LetterTemplate.headerSection.desc']}">
                                <f:validateLength maximum="4000"/>
                            </p:inputText>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="footerSectionLabel" for="footerSectionId" value="#{msg['LetterTemplate.footerSection.desc']}:"/>
                        </div>
                        <div class="ui-g-6">
                            <p:inputTextarea id="footerSectionId" value="#{MaintainLetterTemplate.letterTemplate.footerSection}" 
                                             cols="75" rows="3" label="#{msg['LetterTemplate.footerSection.desc']}">
                                <f:validateLength maximum="4000"/>
                            </p:inputTextarea>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="surveyOnlyLabel" for="surveyOnlyId" value="#{msg['LetterTemplate.surveyOnly.desc']}:"/>
                        </div>
                        <div class="ui-g-4">
                            <p:inputText id="surveyOnlyId" value="#{MaintainLetterTemplate.letterTemplate.surveyOnly}" 
                                         size="75" maxlength="200" label="#{msg['LetterTemplate.surveyOnly.desc']}" />
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="mainBodySectionlabel" for="mainBodySectionId" value="#{msg['LetterTemplate.mainBodySection.desc']}:"/>
                        </div>
                        <div class="ui-g-6">
                            <p:inputTextarea id="mainBodySectionId" value="#{MaintainLetterTemplate.letterTemplate.mainBodySection}"  
                                             cols="75" rows="8" label="#{msg['LetterTemplate.mainBodySection.desc']}" >
                                <f:validateLength maximum="4000"/>
                            </p:inputTextarea>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="closingRemarkLabel" for="closingRemarkSectionId" value="#{msg['LetterTemplate.closingRemarkSection.desc']}:"/>
                        </div>
                        <div class="ui-g-6">
                            <p:inputTextarea id="closingRemarkSectionId" value="#{MaintainLetterTemplate.letterTemplate.closingRemarkSection}" 
                                             cols="75" rows="3" label="#{msg['LetterTemplate.closingRemarkSection.desc']}">
                                <f:validateLength maximum="4000"/>
                            </p:inputTextarea>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="senderNameLabel" for="senderNameId" value="#{msg['LetterTemplate.senderName.desc']}:"/>
                        </div>
                        <div class="ui-g-5">
                            <p:inputText id="senderNameId" value="#{MaintainLetterTemplate.letterTemplate.senderName}" 
                                         size="75" maxlength="200" label="#{msg['LetterTemplate.senderName.desc']}"/>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="senderPositionLabel" for="senderPositionId" value="#{msg['LetterTemplate.senderPosition.desc']}:"/>
                        </div>
                        <div class="ui-g-4">
                            <p:inputText id="senderPositionId" value="#{MaintainLetterTemplate.letterTemplate.senderPosition}" 
                                         size="75" maxlength="200" label="#{msg['LetterTemplate.senderPosition.desc']}"/>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="senderSignatureLabel" value="#{msg['LetterTemplate.senderSignatureGraphic.desc']}:"/>
                        </div>
                        <div class="ui-g-1">
                            <h:outputLink rendered="#{MaintainLetterTemplate.letterTemplate.senderSignatureGraphic!=null}" target="_blank"
                                          value="#{facesContext.externalContext.requestContextPath}/attachment?img=signGraphic&amp;id=#{MaintainLetterTemplate.letterTemplate.letterTemplateTypeId.id}">
                                <h:graphicImage value="/resources/images/attach.png" /><!-- p:graphicImage override necessary for PrimeFaces 12.0.0 bug -->
                            </h:outputLink>
                            <p:outputLabel rendered="#{MaintainLetterTemplate.letterTemplate.senderSignatureGraphic==null}"
                                           id="senderSignFilename"
                                           value="No available image" />
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="uploadSignatureLabel1" value="Upload New Signature: "/>
                            <p:outputLabel id="uploadSignatureLabel2" value="#{msg['LetterTemplate.file.upload.types.desc']}"/>
                        </div>
                        <div class="ui-g-6">
                            <h:form>
                                <p:fileUpload listener="#{MaintainLetterTemplate.uploadSenderSignatureFile}"
                                              id="senderSignatureId"
                                              allowTypes="/(\.|\/)(gif|jpe?g|png|bmp)$/"
                                              invalidSizeMessage="The maximum size of the file must not exceed 100kB."
                                              invalidFileMessage="The file must be a jpg,gif,png or bmp"
                                              sizeLimit="102400"
                                              uploadLabel="Upload File"
                                              label="Select file"
                                              mode="advanced"/>
                            </h:form>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="contactPhoneLabel" for="contactPhoneNumberId" value="#{msg['LetterTemplate.contactPhoneNumber.desc']}:"/>
                        </div>
                        <div class="ui-g-6">
                            <p:inputTextarea id="contactPhoneNumberId" value="#{MaintainLetterTemplate.letterTemplate.contactPhoneNumber}" 
                                             cols="75" rows="3" label="#{msg['LetterTemplate.contactPhoneNumber.desc']}">
                                <f:validateLength maximum="400"/>
                            </p:inputTextarea>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="ministryNameLabel" for="ministyNameId" value="#{msg['LetterTemplate.ministryName.desc']}:" rendered="#{ApplicationSelectionBean.app eq 'sva'}"/>
                        </div>
                        <div class="ui-g-6">
                            <p:inputTextarea id="ministyNameId" value="#{MaintainLetterTemplate.letterTemplate.ministryName}" 
                                             cols="75" rows="1" label="#{msg['LetterTemplate.ministryName.desc']}" rendered="#{ApplicationSelectionBean.app eq 'sva'}">
                                <f:validateLength maximum="200"/>
                            </p:inputTextarea>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="guardianSignatureLabel" for="guardianSignatureId" value="#{msg['LetterTemplate.signatureText.desc']}:"/>
                        </div>
                        <div class="ui-g-6">
                            <p:inputTextarea id="guardianSignatureId" value="#{MaintainLetterTemplate.letterTemplate.guardianSignatureText}" 
                                             cols="75" rows="3" label="#{msg['LetterTemplate.signatureText.desc']}">
                                <f:validateLength maximum="400"/>
                            </p:inputTextarea>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="ministryLogoLabel" value="#{msg['LetterTemplate.ministryLogo.desc']}:"/>
                        </div>
                        <div class="ui-g-1">
                            <h:outputLink rendered="#{MaintainLetterTemplate.letterTemplate.ministryLogo!=null}" target="_blank"
                                          value="#{facesContext.externalContext.requestContextPath}/attachment?img=minLogo&amp;id=#{MaintainLetterTemplate.letterTemplate.letterTemplateTypeId.id}">
                                <h:graphicImage value="/resources/images/attach.png" /><!-- p:graphicImage override necessary for PrimeFaces 12.0.0 bug -->
                            </h:outputLink>
                            <p:outputLabel rendered="#{MaintainLetterTemplate.letterTemplate.ministryLogo==null}"
                                           id="minLogoFilename"
                                           value="No available image" />
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="uploadLogoLabel1" value="Upload New Logo: "/>
                            <p:outputLabel id="uploadLogoLabel2" value="#{msg['LetterTemplate.file.upload.types.desc']}"/>
                        </div>
                        <div class="ui-g-6">
                            <h:form>
                                <p:fileUpload listener="#{MaintainLetterTemplate.uploadMinistryLogoFile}"
                                              id="ministryLogoId"
                                              allowTypes="/(\.|\/)(gif|jpe?g|png|bmp)$/"
                                              invalidSizeMessage="The maximum size of the file must not exceed 100kB."
                                              invalidFileMessage="The file must be a jpg,gif,png or bmp"
                                              sizeLimit="102400"
                                              uploadLabel="Upload File"
                                              label="Select file"
                                              mode="advanced"/>
                            </h:form>
                        </div>

                    </div>
                    <p:fragment id="svaDetailId" rendered="#{request.isUserInRole('EACL_Sysadmin') or ((ApplicationSelectionBean.app eq 'sva') and (request.isUserInRole('Super_Sysadmin')))}">
                        <div class="ui-g">
                            <div class="ui-g-2">
                                <p:outputLabel id="addDetailLabel" for="addDetailId" value="#{msg['LetterTemplate.addDetailSection.desc']}:"/>
                            </div>
                            <div class="ui-g-6">
                                <p:inputTextarea id="addDetailId" value="#{MaintainLetterTemplate.letterTemplate.addDetail}"  
                                                 cols="75" rows="3" label="#{msg['LetterTemplate.addDetailSection.desc']}">
                                    <f:validateLength maximum="4000"/>
                                </p:inputTextarea>
                            </div>
                        </div>
                    </p:fragment>
                </div>

                <div id="commandButtons" align="center">
                    <p:commandButton id="saveBtnId"
                                     rendered="#{MaintainLetterTemplate.letterTemplate.id!=null}" 
                                     actionListener="#{MaintainLetterTemplate.save}" 
                                     value="#{msg['button.save']}" update="form1"/>
                    <p:outputLabel value=" "/>
                    <p:commandButton id="previewLetterBtnId"
                                     rendered="#{MaintainLetterTemplate.letterTemplate.id!=null}" 
                                     actionListener="#{MaintainLetterTemplate.previewLetter}" 
                                     value="#{msg['button.preview']}"
                                     onclick="$('object').remove();"
                                     oncomplete="PF('dlg1').show();"
                                     update="previewContentPanel"
                                     ajax="true" widgetVar="previewLetterBtn">

                    </p:commandButton>
                    <p:outputLabel value=" "/>
                    <p:commandButton id="cancelBtnId"
                                     action="#{MaintainLetterTemplate.cancel}" 
                                     value="#{msg['button.clearChanges']}" update="form1"/>
                </div>

                <p:dialog header="Preview Letter Template" widgetVar="dlg1" 
                          fitViewport="true" width="900" style="align-content: center;">
                    <p:ajax event="close" update="form1"/>
                    <p:panelGrid id="previewContentPanel" style="height: 90%;width: 90%;align-content: center;" columns="1">
                        <p:media id="previewContent" value="#{MaintainLetterTemplate.content}" rendered="#{MaintainLetterTemplate.content!=null}"
                                 height="650" width="800" style="align-content: center;" player="pdf">
                            <f:param id="previewContentID" value="#{MaintainLetterTemplate.templateID}"/>
                        </p:media>
                    </p:panelGrid>

                </p:dialog>


            </p:panel>

        </h:form>

    </ui:define></ui:composition>
