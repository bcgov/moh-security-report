<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/gov30Template.xhtml">
    <ui:define name="title"><h:outputText value="#{msg['Manage_Project']}" /> - <h:outputText value="#{msg['Find_Project']}" /></ui:define>
    <ui:define name="body">
        <style type="text/css">
            .ui-chkbox.ui-chkbox-all.ui-widget {
                display:block !important;
            }
            .ui-datatable-data .ui-widget-header .ui-state-default {
                background-image: none;
                background-color: #305982;
                color: #ffffff;
            }
        </style>
        <h2><h:outputText value="#{msg.Manage_Project}" /> - <h:outputText value="#{msg.Find_Project}" /></h2>
        <hr/>
        <h:form id="manageProjectForm" onsubmit="PF('projectResultW').unselectAllRows(); #{findProject.setDisplayStats(false)}">
            <p:messages id="messages" closable="true">
                <p:autoUpdate />
            </p:messages>
            <p:panel id="contentInner">
                <f:facet name="header">#{msg.Find_Project}</f:facet>

                <div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel id="Pharmacy_PO_Providers1" for="projectTypeId" value="#{msg.pharmacy_po_provider_project}:" escape="false" />
                        </div>
                        <div class="ui-g-3">
                            <h:selectOneMenu id="projectTypeId" label="#{msg['Project.project_type']}" 
                                              value="#{findProject.project.projectTypeId.id}" valueChangeListener="#{findProject.changeProjectType}">
                                <f:selectItems value ="#{Droplists.codesProjectTypes}" />
                                <f:ajax event="change" execute="@this" render="contentInner" />
                            </h:selectOneMenu>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel for="projectDate" value="#{msg.project_month_year_line1}:" /><br/>
                            <p:outputLabel for="projectDate" value="#{msg.project_month_year_line2}" />
                        </div>
                        <div class="ui-g-1">
                            <p:calendar value="#{findProject.projectDate}" id="projectDate" 
                                           style="width:200px"
                                           pattern="MMM-yyyy" size="12" mode="popup" navigator="true" />
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel for="pharmCode" value="#{msg.pharm_code}:" rendered="#{(findProject.project.projectTypeId.name=='Pharmacy Project')or(findProject.project.projectTypeId.name=='Plan M Project')}" />
                            <p:outputLabel for="poProviderCode" value="#{msg.po_provider_code}:" rendered="#{findProject.project.projectTypeId.name=='PO Provider Project'}" />
                        </div>
                        <div class="ui-g-3">
                            <p:inputText value="#{findProject.code}" size="30" 
                                         id="pharmCode" label="#{msg.pharm_code}" maxlength="10"
                                         rendered="#{(findProject.project.projectTypeId.name=='Pharmacy Project')or(findProject.project.projectTypeId.name=='Plan M Project')}">
                            </p:inputText>
                            <p:inputText value="#{findProject.code}" size="30" 
                                         id="poProviderCode" label="#{msg.po_provider_code}" maxlength="10"
                                         rendered="#{findProject.project.projectTypeId.name=='PO Provider Project'}">
                            </p:inputText>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel for="pharmName" value="#{msg.pharm_name}:" rendered="#{(findProject.project.projectTypeId.name=='Pharmacy Project')or(findProject.project.projectTypeId.name=='Plan M Project')}" />
                            <p:outputLabel for="poProviderName" value="#{msg.po_provider_name}:" rendered="#{findProject.project.projectTypeId.name=='PO Provider Project'}" />
                        </div>
                        <div class="ui-g-3">
                            <p:inputText value="#{findProject.name}" size="30" 
                                         id="pharmName" label="#{msg.pharm_name}" maxlength="75"
                                         rendered="#{(findProject.project.projectTypeId.name=='Pharmacy Project')or(findProject.project.projectTypeId.name=='Plan M Project')}">
                            </p:inputText>
                            <p:inputText id="poProviderName" value="#{findProject.name}" size="30" 
                                         label="#{msg.po_provider_name}" maxlength="75"
                                         rendered="#{findProject.project.projectTypeId.name=='PO Provider Project'}">
                            </p:inputText>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel for="projectYear" value="#{msg.project_year} " />
                        </div>
                        <div class="ui-g-1">
                            <p:inputText value="#{findProject.projectYear}" size="10"
                                         id="projectYear" label="#{msg['Project.projectYear.desc']}" maxlength="4">
                            </p:inputText>
                        </div>
                    </div>
                    <div class="ui-g">
                        <div class="ui-g-2">
                            <p:outputLabel for="projectStatuses" value="#{msg.project_status}: " />
                        </div>
                        <div class="ui-g-3">
                            <h:selectOneMenu id="projectStatuses" label="#{msg.project_status}" style="width: 50%"
                                             value="#{findProject.projectStatus}">
                                <f:selectItem itemLabel="" itemValue ="" />
                                <f:selectItems value ="#{Droplists.codesProjectStatuss}" />
                            </h:selectOneMenu>
                        </div>
                    </div>
                </div>

                <br/><br/>
                <div id="commandButtons" align="center">
                    <p:commandButton id="findProjectBtn" actionListener="#{findProject.findProjects}" value="#{msg.Find_Project}" update=":form1:projectsTable" />
                </div>
                <br/>

            </p:panel>
            <br/>
        </h:form>

        <h:form id="form1">
            <p:panel id="projectSummary">
                <f:facet name="header"><h:outputText value="#{msg.project_summary}" /></f:facet>
                <p:dataTable value="#{findProject.projectResults}" id="projectsTable" widgetVar="projectResultW"
                             var="projectsResult" rowIndexVar="index" rowKey="#{projectsResult.id}" selection="#{findProject.recentProjectsSelected}" disabledSelection="#{projectsResult.statusId.name == 'Archived'}"
                             paginator="true" rows="5"
                             paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10">
                    <p:column style="width:4%" selectionMode="Multiple" styleClass="#{projectsResult.statusId.name == 'Archived' ? 'ui-state-disabled' : ''}" /><!-- styleClass override necessary for PrimeFaces 12.0.0 bug -->
                    <p:column sortBy="#{projectsResult.name}">
                        <f:facet name="header">#{msg['project_name']}</f:facet>
                        <h:commandLink id="detailsLink" value="#{projectsResult.name}" 
                                       disabled="#{projectsResult.statusId.name == 'Archived'}"
                                       action="#{findProject.showDetailsForProjectAction(projectsResult)}"
                                       onmouseover="window.status = 'Click to view details'; return true;" 
                                       onmouseout="window.status = ''; return true;">
                        </h:commandLink>
                    </p:column>
                    <p:column sortBy="#{projectsResult.statusId.id}">
                        <f:facet name="header">#{msg.status}</f:facet>
                        <p:outputLabel value="#{projectsResult.statusId.name}" />
                    </p:column>
                    <p:column sortBy="#{projectsResult.projectYear}">
                        <f:facet name="header">#{msg.project_month_year}</f:facet>
                        <p:outputLabel value="#{projectsResult.projectMonth}" />-<h:outputText value="#{projectsResult.projectYear}" />
                    </p:column>
                    <p:column sortBy="#{projectsResult.createdOnDtm}">
                        <f:facet name="header">#{msg.project_creation_date}</f:facet>
                        <p:outputLabel value="#{projectsResult.createdOnDtm}">
                            <f:convertDateTime type="date" pattern="yyyy-MMM-dd" />
                        </p:outputLabel>
                    </p:column>
                    <p:column sortBy="#{projectsResult.projectYear}">
                        <f:facet name="header">#{msg.project_year}</f:facet>
                        <p:outputLabel value="#{projectsResult.projectYear}" />
                    </p:column>
                    <p:column sortBy="#{projectsResult.closedDate}">
                        <f:facet name="header">#{msg.project_closed_date}</f:facet>
                        <p:outputLabel value="#{projectsResult.closedDate}">
                            <f:convertDateTime type="date" pattern="yyyy-MMM-dd" />
                        </p:outputLabel>
                    </p:column>
                    <p:column sortBy="#{projectsResult.firstPrintingDate}">
                        <f:facet name="header">#{msg.date_first_print_line1} #{msg.date_first_print_line2}</f:facet>
                        <p:outputLabel value="#{projectsResult.firstPrintingDate}">
                            <f:convertDateTime type="date" pattern="yyyy-MMM-dd" />
                        </p:outputLabel>
                    </p:column>
                    <p:ajax event="page" global="false" />
                    <p:ajax event="sort" global="false" />
                    <p:ajax event="rowSelect" global="false" />
                    <p:ajax event="rowUnselect" global="false" />
                    <p:ajax event="rowSelectCheckbox" global="false" />
                    <p:ajax event="rowUnselectCheckbox" global="false" />
                </p:dataTable>
                <br/>
                <p:outputPanel id="buttonsId" >
                    <p:commandButton actionListener="#{findProject.close}" value="#{msg['project_close']}" update="buttonsId projectSummary confirmPopUp" />
                    <p:graphicImage height="1" alt="" value="/resources/template-images/spacer.gif" width="10" />
                    <p:commandButton value="#{msg.project_archive}"
                                       id="prjArchiveId"
                                       onclick="PF('dlg').show();"
                                       global="false">
                    </p:commandButton>
                    <p:graphicImage height="1" alt="" value="/resources/template-images/spacer.gif" width="10" />
                    <p:commandButton id="showStatisticalButtonId"
                                     actionListener="#{findProject.showStatisticalReport}" 
                                     value="#{msg['button.show_statistical_rep']}" update="form1" />
                </p:outputPanel>
                <p:dialog id="confirmPopUp" widgetVar="dlg" width="400" height="150" 
                                 modal="true" resizable="false" closable="true"
                                 styleClass="hoverable" header="#{msg.project_confirm_archive}">
                    <p><p:outputLabel value="#{msg.prj_archive_data_policy}" /></p>
                    <br/>
                    <table align="center">
                        <tr>
                            <td class="hoverable">
                                <p:commandButton value="Confirm" id="ConfirmBtn" process="@this"
                                       styleClass="hoverable"
                                       update="buttonsId projectSummary confirmPopUp"
                                       actionListener="#{findProject.archive}"
                                       onclick="PF('dlg').hide();" />
                            </td>
                            <td>
                                <p:graphicImage height="1" alt="" value="/resources/template-images/spacer.gif" width="10" />
                            </td>
                            <td class="hoverable">
                                <p:commandButton value="Cancel" id ="cancelBtn"
                                       update="buttonsId projectSummary confirmPopUp"
                                       styleClass="hoverable"
                                       onclick="PF('dlg').hide(); return false;" />
                            </td>
                        </tr>
                    </table>
                </p:dialog>
            </p:panel>
            <br/>
            <p:panel id="StatisticalReport" widgetVar="statsPanel" rendered="#{findProject.displayStats}">
                <f:facet name="header">
                    <div class="ui-g-2">
                        <h:outputText value="#{msg.project_statistical_report}" />
                    </div>
                    <div class="ui-g-1">
                        <p:commandLink id="ExportReportBtn" ajax="false" actionListener="#{findProject.exportReportCSV}" >
                            <p:graphicImage value="/resources/images/xls.gif" />
                        </p:commandLink>
                    </div>
                </f:facet>
                <p:dataTable id="resultsTable" var="projectRecord" value="#{findProject.recentProjectsSelected}" style="display: inline-table">
                    <p:columnGroup type="header">
                        <p:column headerText="#{msg.project_name}" />
                        <p:column headerText="#{msg.pharm_code} - #{msg['Project.name.desc']}" />
                        <p:column headerText="#{msg['Letter.mailed']}" />
                        <p:column headerText="#{msg['Letter.not.delivered']}" />
                        <p:column headerText="#{msg['Letter.delivered']}" />
                        <p:column headerText="#{msg['Letter.total.returns']}" />
                        <p:column headerText="#{msg['Letter.total.percentage.returns']}" />
                        <p:column headerText="#{msg['Letter.total.anomalies']}" />
                        <p:column headerText="#{msg['Letter.total.percentage.anomalies']}" />
                    </p:columnGroup>

                    <p:subTable var="pharmProjectRec" value="#{projectRecord.pharmacyProviderList}">
                        <p:column>
                            <h:outputText value="#{projectRecord.name}" />
                        </p:column>
                        <p:column>
                            <h:outputText value="#{pharmProjectRec.code}" />-<h:outputText value="#{pharmProjectRec.name}" />
                        </p:column>
                        <p:column>
                            <h:outputText value="#{pharmProjectRec.letterMailed}" />
                        </p:column>
                        <p:column>
                            <h:outputText value="#{pharmProjectRec.letterNonDelivered}" />
                        </p:column>
                        <p:column>
                            <h:outputText value="#{pharmProjectRec.letterDelivered}" />
                        </p:column>
                        <p:column>
                            <h:outputText value="#{pharmProjectRec.letterTotalReturns}" />
                        </p:column>
                        <p:column>
                            <h:outputText value="#{pharmProjectRec.letterTotalPercentReturns}%" />
                        </p:column>
                        <p:column>
                            <h:outputText value="#{pharmProjectRec.letterTotalAnomaly}" />
                        </p:column>
                         <p:column>
                            <h:outputText value="#{pharmProjectRec.letterTotalPercentAnomaly}%" />
                        </p:column>
                        <p:columnGroup type="footer">
                            <p:row>
                                <p:column footerText="#{msg['Letter.project.summary.totals']}" colspan="2" />
                                <p:column footerText="#{projectRecord.letterMailedTotal}" />
                                <p:column footerText="#{projectRecord.letterNotDeliverTotal}" />
                                <p:column footerText="#{projectRecord.letterDeliverTotal}" />
                                <p:column footerText="#{projectRecord.letterReturnsPerProjectTotal}" />
                                <p:column footerText="#{projectRecord.letterReturnsPercentageTotal}%" />
                                <p:column footerText="#{projectRecord.letterAnomalyTotal}" />
                                <p:column footerText="#{projectRecord.letterAnomalyPercentageTotal}%" />
                            </p:row>
                        </p:columnGroup>
                    </p:subTable>
                    <p:ajax event="sort" global="false" />
                </p:dataTable>
            </p:panel>
        </h:form>
    </ui:define>
</ui:composition>
