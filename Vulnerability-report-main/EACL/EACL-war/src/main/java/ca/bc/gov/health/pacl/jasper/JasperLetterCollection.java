package ca.bc.gov.health.pacl.jasper;

import ca.bc.gov.health.pacl.ejb.entity.LetterTemplate;
import java.io.ByteArrayInputStream;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

/**
 *
 * @author Vladimir Ddovgalyuk
 * @version 1.0 Collection of letters of the same type and belonging to the same
 * project
 */
public class JasperLetterCollection {

    /**
     * List of {@link JasperLetter} objects to be displayed in report
     */
    private List<JasperLetter> letters;
    /**
     * Letter template
     */
    private LetterTemplate letterTemplate;
    /**
     * Fields from the Project entity to be passed as report fields
     */
    private String projectName,
            projectYear,
            projectMonth;

    /**
     * Constructs a new letter collection with null as template
     */
    public JasperLetterCollection() {
    }

    /**
     * Constructs a new letter collection with the specified letter template
     *
     * @param letterTemplate - the template
     */
    public JasperLetterCollection(LetterTemplate letterTemplate) {
        this.letterTemplate = letterTemplate;
    }

    /**
     * Convenience class returning a map with miscellaneous confirmation letter
     * parameters
     *
     * @return Map of Jasper report parameters
     */
    public Map<String, Object> getParameters() {
        Map<String, Object> parameters = new HashMap<>();
        // from the letter template
        if (getLetterTemplate().getMinistryLogo() != null) {
            parameters.put("logo", new ByteArrayInputStream(getLetterTemplate().getMinistryLogo()));
        }
        if (getLetterTemplate().getSenderSignatureGraphic() != null) {
            parameters.put("graphicSignature", new ByteArrayInputStream(getLetterTemplate().getSenderSignatureGraphic()));
        }
        parameters.put("mainSection", getLetterTemplate().getMainBodySection());
        parameters.put("ministryName", getLetterTemplate().getMinistryName());
        parameters.put("departmentName", getLetterTemplate().getDepartmentName());
        parameters.put("branchName", getLetterTemplate().getBranchName());
        parameters.put("ministryAddress", getLetterTemplate().getMinistryAddress());
        parameters.put("surveyOnly", getLetterTemplate().getSurveyOnly());
        parameters.put("closingRemark", getLetterTemplate().getClosingRemarkSection());
        parameters.put("senderName", getLetterTemplate().getSenderName());
        parameters.put("senderPosition", getLetterTemplate().getSenderPosition());
        parameters.put("footerSection", getLetterTemplate().getFooterSection());
        parameters.put("headerSection", getLetterTemplate().getHeaderSection());
        parameters.put("guardianSignature", getLetterTemplate().getGuardianSignatureText());
        parameters.put("recipientSignature", getLetterTemplate().getRecipientSignatureText());
        parameters.put("contactPhoneNumber", getLetterTemplate().getContactPhoneNumber());

        // These parameters do not belong to template and do not belong to a particular letter
        parameters.put("projectYear", getProjectYear());
        parameters.put("projectMonth", getProjectMonth());
        parameters.put("projectName", getProjectName());

        // Path to subreports
        parameters.put("subreportsDir", "");

        if (getLetters() != null) {
            parameters.put("numberOfLetters", getLetters().size());
        } else {
            parameters.put("numberOfLetters", 0);
        }
        return parameters;
    }

    /* Getters and setters */
    public String getProjectName() {
        return projectName;
    }

    public void setProjectName(String projectName) {
        this.projectName = projectName;
    }

    public String getProjectYear() {
        return projectYear;
    }

    public void setProjectYear(String projectYear) {
        this.projectYear = projectYear;
    }

    public String getProjectMonth() {
        return projectMonth;
    }

    public void setProjectMonth(String projectMonth) {
        this.projectMonth = projectMonth;
    }

    public List<JasperLetter> getLetters() {
        return letters;
    }

    public void setLetters(List<JasperLetter> letters) {
        this.letters = letters;
    }

    public LetterTemplate getLetterTemplate() {
        return letterTemplate;
    }

    public void setLetterTemplate(LetterTemplate letterTemplate) {
        this.letterTemplate = letterTemplate;
    }

}
