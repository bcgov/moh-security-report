package ca.bc.gov.health.pacl.jasper;

import ca.bc.gov.health.pacl.ejb.entity.CodesLetterStatus;
import ca.bc.gov.health.pacl.ejb.entity.Letter;
import ca.bc.gov.health.pacl.ejb.entity.LetterTemplate;
import ca.bc.gov.health.pacl.ejb.entity.PharmacyProvider;
import ca.bc.gov.health.pacl.ejb.entity.PlansM;
import ca.bc.gov.health.pacl.ejb.entity.Prescriptions;
import ca.bc.gov.health.pacl.ejb.entity.ProstheticsAndOrthotics;
import ca.bc.gov.health.pacl.util.AddressHelper;
import com.lowagie.text.pdf.Barcode128;
import java.awt.Color;
import java.io.Serializable;
import java.util.Date;
import java.util.List;
import org.joda.time.DateTime;
import org.joda.time.Years;

/**
 *
 * @author Vladimir Ddovgalyuk
 * @version 2.0
 *
 * A wrapper for the {@link ca.bc.gov.health.pacl.ejb.entity.Letter} class with
 * Pharmacy coordinates (name and code).
 */
public class JasperLetter implements Serializable{

    private static final long serialVersionUID = 1L;

    /**
     * Indicates whether this letter is selected on the page
     */
    private boolean selected = false;
    /**
     * Instance of the entity class
     */
    Letter instance;
    /**
     * Constructs a new Letter with the specified entity class
     *
     * @param instance
     */
    public JasperLetter(Letter instance) {
        this.instance = instance;
    }
   

    /**
     * Generates a graphical presentation of barcode in Code128 format
     *
     * @return Barcode image to be rendered by Jasper report
     */
    public java.awt.Image getBarCode() {
        Barcode128 barcode = new Barcode128();
        barcode.setCode(Long.toString(this.instance.getBarcode()));
        return barcode.createAwtImage(Color.BLACK, Color.WHITE);
    }

    /*
     * Getters from the letter entity
     */
    public Long getPhn() {
        return instance.getPhn();
    }
    
    public String getCaseCode() {
        return instance.getCaseCode();
    }

    public Date getLetterDate() {
        return instance.getLetterDate();
    }

    public String getRecipientLastName() {
        return instance.getRecipientLastName();
    }

    public String getRecipientFirstName() {
        return instance.getRecipientFirstName();
    }

    public String getRecipientAddress() {
        return AddressHelper.displayAddress(instance.getRecipientAddress(), instance.getRecipientPostalCode(), instance.getRecipientCity(), instance.getRecipientProvince());
    }

    public List<ProstheticsAndOrthotics> getProstheticsAndOrthoticsList() {
        return instance.getProsthOrthList();
    }
        
    public String getRecipientCountry() {
        return instance.getRecipientCountry();
    }

    public String getRecipientCity() {
        return instance.getRecipientCity();
    }

    public String getRecipientProvince() {
        return instance.getRecipientProvince();
    }

    public String getRecipientPostalCode() {
        return instance.getRecipientPostalCode();
    }

    public Date getRecipientBirthday() {
        return instance.getRecipientBirthday();
    }

    public Long getBarcode() {
        return instance.getBarcode();
    }

    public List<PlansM> getPlansMList() {
        return instance.getPlansMList();
    }

    public List<Prescriptions> getPrescriptionsList() {
        return instance.getPrescriptionsList();
    }

    public List<ProstheticsAndOrthotics> getProsthOrthList() {
        return instance.getProsthOrthList();
    }

    /**
     * Calculates the patient's age in years
     *
     * @return the number of complete years between the patient's birthday and
     * the current date
     */
    public int getAge() {
        Years y = Years.yearsBetween(new DateTime(instance.getRecipientBirthday().getTime()), new DateTime(new Date().getTime()));
        return y.getYears();
    }

    public Letter getLetter() {
        return this.instance;
    }

    public void setLetter(Letter letter) {
        this.instance = letter;
    }

    public boolean isSelected() {
        return this.selected;
    }

    public void setSelected(boolean value) {
        this.selected = value;
    }

    public char getLetterPrintedFlag() {
        return instance.getLetterPrintedFlag();
    }

    public void setLetterPrintedFlag(char letterPrintedFlag) {
        instance.setLetterPrintedFlag(letterPrintedFlag);
    }

    public PharmacyProvider getPharmacyProviderId() {
        return instance.getPharmacyProviderId();
    }

    public CodesLetterStatus getStatusId() {
        return instance.getStatusId();
    }

    public void setLetterDate(Date date) {
        instance.setLetterDate(date);
    }

    public String getPharmacyProviderName() {
        return instance.getPharmacyProviderId().getName();
    }

    public String getPharmacyProviderCode() {
        return instance.getPharmacyProviderId().getCode();
    }

    public LetterTemplate getLetterTemplateId() {
        return instance.getLetterTemplateId();
    }
}
