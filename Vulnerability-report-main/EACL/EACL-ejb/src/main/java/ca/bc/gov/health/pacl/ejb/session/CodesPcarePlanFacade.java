/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.pacl.ejb.session;

import ca.bc.gov.health.pacl.ejb.entity.CodesPcarePlan;
import jakarta.ejb.Stateless;
import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;
import jakarta.persistence.Query;
import java.util.List;

/**
 *
 * @author Dan.Stepanov
 */
@Stateless
public class CodesPcarePlanFacade extends AbstractFacade<CodesPcarePlan> implements CodesPcarePlanFacadeLocal {
    @PersistenceContext(unitName = "PACLPU")
    private EntityManager em;

    @Override
    protected EntityManager getEntityManager() {
        return em;
    }

    public CodesPcarePlanFacade() {
        super(CodesPcarePlan.class);
    }

    /**
     * PharmaCare plan code query that retrieves all the plans.
     * 
     * @return List<CodesPcarePlan>     
     */
    @Override
    public List<CodesPcarePlan> findAll() {
        Query query = em.createNativeQuery("select * from CODES_PCARE_PLAN c"
                , CodesPcarePlan.class);        
        return query.getResultList();
    }

    /** 
     * PharmaCare plan code query that retrieves all the plans except plan M.
     *
     * @return List<CodesPcarePlan>  
     */
    @Override
    public List<CodesPcarePlan> findPcareCodesForPharm() {
        Query query = em.createNativeQuery("select * from CODES_PCARE_PLAN c"
                + " where c.name not in ('M')", CodesPcarePlan.class);        
        return query.getResultList();
    }

    /**
     * PharmaCare plan code query that retrieves the default selected plans.
     * 
     * @return List<CodesPcarePlan>
     */
    @Override
    public List<CodesPcarePlan> findByDefaultSelected() {
        Query query = em.createNativeQuery("select * from CODES_PCARE_PLAN c"
                + " where c.DEFAULT_SELECTED = 'Y' and c.NAME <> 'M'"
                , CodesPcarePlan.class);        
        return query.getResultList();
    }

    /**
     * PharmaCare plan code query that retrieves the default selected plan M.
     * 
     * @return List<CodesPcarePlan>
     */
    @Override
    public List<CodesPcarePlan> findByDefaultSelectedPlanM() {
        Query query = em.createNativeQuery("select * from CODES_PCARE_PLAN c"
                + " where c.name = 'M'", CodesPcarePlan.class);        
        return query.getResultList();
    }

    /**
     * Retrieve PharmaCare plan name query by id.
     * 
     * @param phCarePlanId long - pharmacare plan id
     * @return String
     */
    @Override
    public String findPharmaCarePlanNameById(long phCarePlanId) {
        Query query = em.createNativeQuery("select c.name from CODES_PCARE_PLAN c"
                + " where c.id = ?1");
        query.setParameter(1, phCarePlanId);
        return (String) query.getSingleResult();
    }
}
