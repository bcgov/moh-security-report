package ca.bc.gov.health.hscis.validators;

import jakarta.faces.application.FacesMessage;
import jakarta.faces.component.UIComponent;
import jakarta.faces.context.FacesContext;
import jakarta.faces.validator.FacesValidator;
import jakarta.faces.validator.Validator;
import jakarta.faces.validator.ValidatorException;
import java.util.Arrays;

/**
 * FacesValidator for validating Increment values
 *
 * @author CGI Information Management Consultants Inc.
 */
@FacesValidator("IncrementValidator")
public class IncrementValidator implements Validator {

  private static final String DESIGNATED_GROUP_CODE = "designatedGroupCode";
  private static final String[] DESIGNATED_GROUP_WITH_HIGH_INCREMENT = {"B", "E", "N", "S", "P"};

  /**
   * Validate the employee's increment level. The following rules are validated:
   * <li>If Incremental value is equal to 7, 8 or 9, the Designated Group Code must be B, E, N, or S
   * <li>Designated Group Code 'Community' (C) cannot have the increment values 5 â€“ 9
   *
   * @see jakarta.faces.validator.Validator#validate(jakarta.faces.context.FacesContext,
   *     jakarta.faces.component.UIComponent, java.lang.Object)
   * @param context
   * @param component
   * @param value
   */
  @Override
  public void validate(FacesContext context, UIComponent component, Object value) {

    String errorMsg = null;
    String designatedGroupCode = (String) component.getAttributes().get(DESIGNATED_GROUP_CODE);

    if (designatedGroupCode != null) {
      if (!Arrays.asList(DESIGNATED_GROUP_WITH_HIGH_INCREMENT).contains(designatedGroupCode)) {
        if ("7".equals(value) || "8".equals(value) || "9".equals(value)) {
          errorMsg = "Increment: Invalid combination with Des. Group Code";
        }
      }
      if ("P".equals(designatedGroupCode)) {
        if ("8".equals(value) || "9".equals(value)) {
          errorMsg = "Increment: Invalid combination with Des. Group Code";
        }
      }
      if ("C".equals(designatedGroupCode)) {
        if ("5".equals(value)
            || "6".equals(value)
            || "7".equals(value)
            || "8".equals(value)
            || "9".equals(value)) {
          errorMsg = "Increment: Invalid combination with Des. Group Code";
        }
      }

      if (errorMsg != null) {
        throw new ValidatorException(
            new FacesMessage(FacesMessage.SEVERITY_ERROR, errorMsg, errorMsg));
      }
    }
  }
}
