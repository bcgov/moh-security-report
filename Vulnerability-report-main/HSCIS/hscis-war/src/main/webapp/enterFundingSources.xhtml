<ui:composition template="/WEB-INF/templates/gov30Template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html">
  <ui:define name="title">
    Enter Funding Sources
  </ui:define>
  <ui:define name="content">
    <ui:include src="/WEB-INF/fragments/navTabs/fundingSourceTabs.xhtml" />
    <h:outputStylesheet name="css/enterfundingsources.css" />
    <h:form id="enterFundingSourcesTableForm">
      <p:messages id="messages" closable="true" />
      <div>
        <div class="align-right" style="margin-top: 10px">
          <p:commandButton id="printFundingSources" type="button" value="Print" styleClass="secondary-button icon" icon="pi pi-print"
                           title="Print" onclick="window.print();" immediate="true" />
          <p:commandButton id="downloadFundingSources" value="Download (PDF)" styleClass="secondary-button icon" icon="pi pi-file-pdf"
                           title="Download(PDF)" update="@form" rendered="false" />
        </div>
      </div>
      <p:outputPanel id="headerPanel" styleClass="display-flex">
        <div class="ui-g-3" style="padding-left: 0px">
          <p:outputLabel class="ui-g-label" for="@next" value="Corp Employer #" />
          <div class="ui-g-field">
            <p:selectOneMenu id="corporateID" value="#{EnterFundingSourcesView.corpId}" style="width: 100%;" required="true">
              <f:selectItem itemDisabled="true" itemLabel="Select" itemValue="#{null}" noSelectionOption="true" />
              <f:selectItems var="corpEmpNumber" value="#{EnterFundingSourcesView.corpIdList}" />
              <p:ajax event="change" update="#{EnterFundingSourcesView.corpId}" />
              <p:ajax event="itemSelect" listener="#{EnterFundingSourcesView.siteIdDynamic}" update="siteID siteIdLabel fiscalId fiscalYearLabel createId fundingTable fundingTable:totalFunding" immediate="true" />
              <p:ajax event="itemSelect" listener="#{EnterFundingSourcesView.setTotalAmountFlag(false)}" immediate="true" />
            </p:selectOneMenu>
          </div>
          <div class="clearfix" />
          <p:outputLabel id="siteIdLabel" class="${EnterFundingSourcesView.corpId == null ? 'ui-g-label readonly' : 'ui-g-label'}" for="@next" value="Site Employer #" />
          <div class="ui-g-field">
            <p:selectOneMenu id="siteID" value="#{EnterFundingSourcesView.siteId}" disabled="${EnterFundingSourcesView.corpId == null}" style="width: 100%;" required="true">
              <f:selectItem itemDisabled="true" itemLabel="Select" itemValue="#{null}" noSelectionOption="true" />
              <f:selectItems var="siteIdNumber" value="#{EnterFundingSourcesView.siteIdList}" />
              <p:ajax event="change" update="#{EnterFundingSourcesView.siteId}" />
              <p:ajax event="itemSelect" listener="#{EnterFundingSourcesView.refreshFundingSourcesList}" update="fiscalId fiscalYearLabel createId fundingTable fundingTable:totalFunding" immediate="true" />
            </p:selectOneMenu>
          </div>
          <div class="clearfix" />
          <p:outputLabel id="fiscalYearLabel" class="${(EnterFundingSourcesView.corpId == null || EnterFundingSourcesView.siteId == null) ? 'ui-g-label readonly' : 'ui-g-label'}" for="@next" value="Fiscal Year" />
          <div class="ui-g-field">
            <p:selectOneMenu id="fiscalId" value="#{EnterFundingSourcesView.fiscalYear}" disabled="${EnterFundingSourcesView.corpId == null || EnterFundingSourcesView.siteId == null}" style="width: 100%;" required="true">
              <f:selectItems var="fiscalYear" value="#{EnterFundingSourcesView.fiscalYearList}" />
              <p:ajax event="change" process="@this" />
              <p:ajax event="itemSelect" listener="#{EnterFundingSourcesView.refreshFundingSourcesList}" update="fundingTable fundingTable:totalFunding" immediate="true" />
            </p:selectOneMenu>
          </div>
        </div>
      </p:outputPanel>
      <p:dataTable id="fundingTable" widgetVar="tblFundingSources"
                   value="#{EnterFundingSourcesView.fundingSourceRows}" var="rows"
                   sortBy="#{rows.lastModifiedOn}"
                   selection="#{EnterFundingSourcesView.selectedFundingSourceRow}" selectionMode="single"
                   rowKey="#{rows.sourceId}">
        <p:ajax event="rowSelect" update="fundingSourceUpdate" oncomplete="PF('cdUpdateFundingSource').show()" />
        <p:column headerText="PROJECTED AMOUNT" width="350" sortBy="#{rows.projectedAmount}">
          <h:outputText value="#{rows.projectedAmount}">
            <f:convertNumber type="currency" currencySymbol="$" />
          </h:outputText>
        </p:column>
        <p:column headerText="FUNDING SOURCES" width="650" sortBy="#{rows.fundingSource.description}">
          <h:outputText value="#{EnterFundingSourcesView.truncateString(rows.fundingSource.description, 80)}" title="#{rows.fundingSource.description}" />
        </p:column>
        <p:column headerText="LAST MODIFIED" sortBy="#{rows.lastModifiedOn}" sortOrder="desc">
          <h:outputText value="#{rows.lastModifiedOn}">
            <f:convertDateTime type="Date" pattern="yyyy-MM-dd HH:MM" />
          </h:outputText>
        </p:column>
        <f:facet name="footer">
          <h:outputText id="totalFunding" class="ui-datatable-footer" value="#{EnterFundingSourcesView.projectedAmountTotal}" 
                        rendered="#{EnterFundingSourcesView.totalAmountFlag}">
            <f:convertNumber type="currency" currencySymbol="$" />
          </h:outputText>
        </f:facet>
      </p:dataTable>
      <div class="margin-bottom-10">
        <p:commandButton id="createId" value="Create" 
                         disabled="${EnterFundingSourcesView.corpId == null || EnterFundingSourcesView.siteId == null}"
                         update="fundingSourceCreate"
                         oncomplete="PF('cdCreateFundingSource').show()"
                         action="#{EnterFundingSourcesView.createEmptyFundingSourceRow()}">
          <f:setPropertyActionListener target="#{EnterFundingSourcesView.fundingSourceCode}" value="#{null}" />
          <f:setPropertyActionListener target="#{EnterFundingSourcesView.projectedAmount}" value="#{null}" />
        </p:commandButton>
      </div>
    </h:form>
    <p:dialog id="fundingSourceUpdate" widgetVar="cdUpdateFundingSource" modal="true" width="875px" position="center" resizable="false">
      <f:facet name="header">
        <h:outputText id="updateFundingSourceDialogHeader" value="Update Funding Source" />
      </f:facet>
      <h:form id="updateFundingSourceForm">
        <p:messages id="messages" closable="true" />
        <div class="display-flex padding-left-10 padding-right-10 border-left-right">
          <div class="ui-g-6 no-margin-left no-padding-left padding-right-10 no-padding-bottom">
            <div class="padding-left-6-5 padding-right-6-5">
              <p:outputLabel class="ui-g-label" for="@next" value="Funding Source" />
              <div class="ui-g-field">
                <p:selectOneMenu id="fundingSourceCode" style="width: 145%;" value="#{EnterFundingSourcesView.selectedFundingSourceRow.fundingSource}" required="true">
                  <f:selectItem itemDisabled="true" itemLabel="Select" itemValue="#{null}" noSelectionOption="true" />
                  <f:selectItems var="fundingSource" value="#{ApplicationBean.fundingSourceCodes}" itemLabel="#{fundingSource.fundingSourceCode} - #{fundingSource.description}" itemValue="#{fundingSource}" />
                  <f:converter converterId="fundingSourcesConverter" />
                </p:selectOneMenu>
              </div>
              <div class="clearfix" />
              <p:outputLabel class="ui-g-label" for="@next" value="Projected Amount" />
              <div class="ui-g-field">
                <p:inputNumber id="projAmount" value="${EnterFundingSourcesView.selectedFundingSourceRow.projectedAmount}" required="true" placeholder="$0.00"
                               symbol="$" thousandSeparator="," maxValue="999999999" minValue="0" decimalPlaces="0" modifyValueOnWheel="false" />
              </div>
              <div class="clearfix" />
            </div>
          </div>
        </div>
        <div class="ui-g-12 no-margin-left padding-left-10 padding-right-10 margin-bottom-10">
          <div class="padding-left-6-5">
            <p:commandButton id="updateFormUpdate" value="Update" process="@form"
                             update="messages updateFundingSourceForm @widgetVar(tblFundingSources)" partialSubmit="true"
                             action="#{EnterFundingSourcesView.updateFundingSourceRow()}" />
            <p:commandButton id="deleteFundingSourceButton" value="Delete" styleClass="danger" 
                             oncomplete="PF('cdDeleteFundingSourceConfirmation').show()" />
            <p:commandButton id="cancelUpdateFundingSource" value="Cancel" 
                             immediate="true" styleClass="secondary-button"
                             type="button" onclick="PF('cdUpdateFundingSource').hide();">
            </p:commandButton>
          </div>
        </div>
        <p:confirmDialog id="deleteFundingSource" global="false" widgetVar="cdDeleteFundingSourceConfirmation" header="Confirm Delete" appendTo="@(body)" width="650px">
          <f:facet name="message">
            <p:outputPanel>
              <h:outputText id="confirmtext" value="Are you sure you want to delete?" escape="false" /> 
            </p:outputPanel>
          </f:facet>
          <p:commandButton id="deleteConfirmButton" value="Delete"
                           oncomplete="PF('cdUpdateFundingSource').hide(); PF('cdDeleteFundingSourceConfirmation').hide()"
                           action="#{EnterFundingSourcesView.deleteFundingSource()}"
                           update="enterFundingSourcesTableForm:messages @widgetVar(tblFundingSources)"
                           styleClass="danger"
                           immediate="true" />
          <p:commandButton id="deleteCancelButton" value="Cancel" type="button"
                           onclick="PF('cdDeleteFundingSourceConfirmation').hide();"
                           styleClass="ui-confirmdialog-no"
                           immediate="true" />
        </p:confirmDialog>
      </h:form>
    </p:dialog>
    <p:dialog id="fundingSourceCreate" widgetVar="cdCreateFundingSource" modal="true" width="875px" position="center" resizable="false">
      <f:facet name="header">
        <h:outputText id="createFundingSourceDialogHeader" value="Create Funding Source" />
      </f:facet>
      <h:form id="createFundingSourceForm">
        <p:messages id="messages" closable="true" />
        <div class="display-flex padding-left-10 padding-right-10 border-left-right">
          <div class="ui-g-6 no-margin-left no-padding-left padding-right-10 no-padding-bottom">
            <div class="padding-left-6-5 padding-right-6-5">
              <p:outputLabel class="ui-g-label" for="@next" value="Funding Source" />
              <div class="ui-g-field">
                <p:selectOneMenu id="fundingSourceCode" style="width: 145%;" value="#{EnterFundingSourcesView.fundingSourceCode}" required="true">
                  <f:selectItem itemDisabled="true" itemLabel="Select" itemValue="#{null}" noSelectionOption="true" />
                  <f:selectItems var="fundingSource" value="#{ApplicationBean.fundingSourceCodes}" itemLabel="#{fundingSource.fundingSourceCode} - #{fundingSource.description}" itemValue="#{fundingSource}" />
                  <f:converter converterId="fundingSourcesConverter" />
                </p:selectOneMenu>
              </div>
              <div class="clearfix" />
              <p:outputLabel class="ui-g-label" for="@next" value="Projected Amount" />
              <div class="ui-g-field">
                <p:inputNumber id="projAmount" value="${EnterFundingSourcesView.projectedAmount}" required="true" placeholder="$0.00"
                               symbol="$" thousandSeparator="," maxValue="999999999" minValue="0" decimalPlaces="0" modifyValueOnWheel="false" />
              </div>
              <div class="clearfix" />
            </div>
          </div>
        </div>
        <div class="ui-g-12 no-margin-left padding-left-10 padding-right-10 margin-bottom-10">
          <div class="padding-left-6-5">
            <p:commandButton id="confirmCreateFundingSource" value="Create" process="@form"
                             update="messages createFundingSourceForm @widgetVar(tblFundingSources)" partialSubmit="true"
                             action="#{EnterFundingSourcesView.createFundingSourceRow()}" />
            <p:commandButton id="cancelCreateFundingSource" value="Cancel" 
                             immediate="true" styleClass="secondary-button"
                             type="reset" onclick="PF('cdCreateFundingSource').hide();">
              <p:ajax update="createFundingSourceForm" resetValues="true" />
            </p:commandButton>
          </div>
        </div>
      </h:form>
    </p:dialog>
  </ui:define>
</ui:composition>
