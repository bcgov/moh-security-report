<ui:composition template="/WEB-INF/templates/gov30Template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
  <ui:define name="title">
    Enter Payroll Summary
  </ui:define>
  <ui:define name="content">
    <ui:param name="bean" value="#{EnterPayrollSummaryView}" />
    <ui:include src="/WEB-INF/fragments/navTabs/payrollTabs.xhtml" />
    <h:outputStylesheet name="css/enterpayrollsummary.css" />
    <h:form id="entryPayrollTableForm">
      <p:messages id="messages" />
      <p:panel id="summaryList" rendered="#{EnterPayrollSummaryView.pageMode == 'LIST'}" styleClass="payrollsummary-list">
        <p:dataTable id="entryTable" value="#{EnterPayrollSummaryView.summaries}" var="summary"
                     sortBy="#{summary.lastModified}"
                     selection="#{EnterPayrollSummaryView.summary}" selectionMode="single"
                     rowKey="#{summary.membershipId}-#{summary.reportingPeriod.toDate}"
                     rows="10" paginator="true" paginatorAlwaysVisible="false"
                     paginatorPosition="top"
                     paginatorTemplate="{CurrentPageReport} {PreviousPageLink} {NextPageLink}"
                     currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords}">
          <p:ajax event="rowSelect" listener="#{EnterPayrollSummaryView.onPayrollSummarySelect}" update="@form" oncomplete="PF('tblEmployee').clearFilters()" />
          <p:column headerText="CORP EMPLOYER #" sortBy="#{summary.employerID}">
            <h:outputText value="#{summary.employerID}" />
          </p:column>
          <p:column headerText="SITE EMPLOYER #" sortBy="#{summary.siteID}">
            <h:outputText value="#{summary.siteID}" />
          </p:column>
          <p:column headerText="REPORTING FROM"
                    sortBy="#{summary.reportingPeriod.fromDate}">
            <h:outputText value="#{summary.reportingPeriod.fromDate}">
              <f:convertDateTime type="localDateTime" pattern="yyyy-MM-dd" />
            </h:outputText>
          </p:column>
          <p:column headerText="REPORTING TO"
                    sortBy="#{summary.reportingPeriod.toDate}">
            <h:outputText value="#{summary.reportingPeriod.toDate}">
              <f:convertDateTime type="localDateTime" pattern="yyyy-MM-dd" />
            </h:outputText>
          </p:column>
          <p:column headerText="LAST MODIFIED"
                    sortBy="#{summary.lastModified}" sortOrder="desc">
            <h:outputText value="#{summary.lastModified}">
              <f:convertDateTime type="localDateTime"
                                 pattern="yyyy-MM-dd HH:mm" />
            </h:outputText>
          </p:column>
          <p:column headerText="STATUS" sortBy="#{summary.status}">
            <h:outputText value="#{summary.status.label}" />
          </p:column>
        </p:dataTable>
        <div class="margin-bottom-10">
          <p:commandButton id="create" value="Create"
                           action="#{EnterPayrollSummaryView.createSummary()}" title="Create a Summary" update="@form">
          </p:commandButton>
        </div>
      </p:panel>
      <p:panel id="createPanel" styleClass="payrollsummary-panel"
               rendered="#{EnterPayrollSummaryView.pageMode == 'EDIT' || EnterPayrollSummaryView.pageMode == 'CREATESUMMARY' || EnterPayrollSummaryView.pageMode == 'READONLY'}">
        <ui:include src="/WEB-INF/fragments/enterPayrollSummaryTabs/enterPayrollSummaryHeader.xhtml" />
        <ui:include src="/WEB-INF/fragments/enterPayrollSummaryTabs/enterPayrollSummaryDesGroups.xhtml" />
        <ui:include src="/WEB-INF/fragments/enterPayrollSummaryTabs/enterPayrollSummaryEmployee.xhtml" />
        <p:outputPanel id="editButtons"
                       rendered="#{EnterPayrollSummaryView.pageMode == 'EDIT' || EnterPayrollSummaryView.pageMode == 'READONLY'}">
          <div class="payrollsummary-edit-buttons">
            <p:commandButton id="submitpayrollsummary"
                             disabled="#{!EnterPayrollSummaryView.submitEnabled}"
                             value="Submit Payroll Summary" title="Submit the Payroll Summary"
                             onclick="PF('csSummary').show()" immediate="true">
            </p:commandButton>
            <p:commandButton id="exportsummary" value="Export Summary" styleClass="secondary-button" actionListener="#{EnterPayrollSummaryView.exportSummary}"
                             disabled="#{!EnterPayrollSummaryView.exportEnabled}" title="Export the Summary" update="@form">
            </p:commandButton>
            <p:commandButton id="deletepayrollsummary" styleClass="danger" disabled="#{!EnterPayrollSummaryView.submitEnabled}"
                             value="Delete" title="Delete the Payroll Summary" onclick="PF('cdSummary').show()"
                             immediate="true">
            </p:commandButton>
            <p:commandButton id="close" value="Close" styleClass="secondary-button"
                             action="#{EnterPayrollSummaryView.cancel()}" title="Close the Screen" update="@form" onstart="clearEmployeeFilter();">
            </p:commandButton>
          </div>
        </p:outputPanel>
      </p:panel>
      <p:panel id="exportPayrollSummary" styleClass="payrollsummaryexport-panel"
               rendered="#{bean.pageMode == 'EXPORT'}">
        <ui:include src="/WEB-INF/fragments/enterPayrollSummaryTabs/exportPayrollSummary.xhtml" />
      </p:panel>

      <p:confirmDialog id="summarySubmitValidation" global="false" widgetVar="validSummary" header="Submit Payroll Summary" 
                       appendTo="@(body)" width="800px">
        <f:facet name="message">
          <p:outputPanel>
            <h:outputText id="validationHeader" 
                          value="Your Corp Employer # #{EnterPayrollSummaryView.summary.employerID} Site Employer # 
                          #{EnterPayrollSummaryView.summary.siteID} report for the period from " />
            <h:outputText value="#{EnterPayrollSummaryView.summary.reportingPeriod.fromDate}">
              <f:convertDateTime pattern="yyyyMMdd" type="localDate" />
            </h:outputText>
            <h:outputText value=" to " />
            <h:outputText value="#{EnterPayrollSummaryView.summary.reportingPeriod.toDate}">
              <f:convertDateTime pattern="yyyyMMdd" type="localDate" />
            </h:outputText>
            <h:outputText value=" has generated the following error(s): " />
          </p:outputPanel>
          <br/>
          <p:outputPanel class="submit-payroll-errors">
            <h:outputText id="validationResult" value="#{EnterPayrollSummaryView.submitSummaryValidationResult}" escape="false" /> 
          </p:outputPanel>
          <p:outputPanel>
            <h:outputText id="validationFooter" value="For further assistance, please contact the Ministry of Health Service Desk." />
          </p:outputPanel>
        </f:facet>
        <p:commandButton value="OK" type="button" onclick="PF('validSummary').hide();" />
      </p:confirmDialog>
    </h:form>

    <h:form id="summaryDelConfirmForm">
      <p:confirmDialog id="deleteConfirm" global="false" widgetVar="cdSummary" header="Delete Payroll Summary" appendTo="@(body)" width="600px">
        <f:facet name="message">
          <p:outputPanel>
            <h:outputText id="confirmtext" value="Delete the Payroll Summary to the Ministry of Health?" /> 
          </p:outputPanel>
        </f:facet>
        <p:commandButton value="Delete" 
                         action="#{EnterPayrollSummaryView.deleteSummary}" onclick="PF('cdSummary').hide();clearEmployeeFilter();"
                         update="entryPayrollTableForm"
                         styleClass="danger" />
        <p:commandButton value="Cancel" type="button"
                         onclick="PF('cdSummary').hide();"
                         styleClass="ui-confirmdialog-no" />
      </p:confirmDialog>
    </h:form>
    <h:form id="summarySubmitConfirmForm">
      <p:confirmDialog id="submitConfirm" global="false" widgetVar="csSummary" header="Submit Payroll Summary" appendTo="@(body)" width="600px">
        <f:facet name="message">
          <p:outputPanel>
            <h:outputText id="confirmtext" value="Submit the Payroll Summary to the Ministry of Health?" /> 
          </p:outputPanel>
        </f:facet>
        <p:commandButton value="Submit" 
                         action="#{EnterPayrollSummaryView.submitSummary}" onclick="PF('csSummary').hide();"
                         update="entryPayrollTableForm"
                         styleClass="ui-confirmdialog-yes" />
        <p:commandButton value="Cancel" type="button"
                         onclick="PF('csSummary').hide();"
                         styleClass="ui-confirmdialog-no" />
      </p:confirmDialog>
    </h:form>
    <ui:include
      src="/WEB-INF/fragments/enterPayrollSummaryTabs/enterPayrollSummaryDesGroupPopup.xhtml" />
    <ui:include
      src="/WEB-INF/fragments/enterPayrollSummaryTabs/enterPayrollSummaryEmployeePopup.xhtml" />
  </ui:define>
</ui:composition>