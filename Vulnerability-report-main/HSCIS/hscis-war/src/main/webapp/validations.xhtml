<ui:composition template="/WEB-INF/templates/gov30Template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
  <ui:define name="title">
    Validation
  </ui:define> 
  <ui:define name="content">
    <ui:include src="/WEB-INF/fragments/navTabs/adminTabs.xhtml" />
    <h:form id="validationsForm">
      <p:messages id="messages" closable="true">
        <p:autoUpdate />
      </p:messages>
      <div class="search-form ui-g-field">
        <p:outputLabel class="ui-g-label" for="@next" value="Search" />
        <div class="search-bar">
          <p:inputText id="inputSearchString" value="#{ValidationsView.searchValue}" styleClass="input-field" />
          <p:commandButton value="Search" id="searchButtonGo"
                           styleClass="search search-button" 
                           action="#{ValidationsView.searchValidationsList}"
                           update="@form"
                           onclick="PF('tblValidation').paginator.setPage(0);" />
        </div>
      </div>
      <p:dataTable id="validationTable" widgetVar="tblValidation"
                   value="#{ValidationsView.validations}"
                   sortBy="#{rows.ruleNumber}"
                   selectionMode="single"
                   selection="#{ValidationsView.selectedValidation}"
                   var="rows" rowKey="#{rows.ruleNumber}"
                   rows="10" paginator="true" paginatorAlwaysVisible="false"
                   paginatorPosition="top"
                   paginatorTemplate="{CurrentPageReport} {PreviousPageLink} {NextPageLink}"
                   currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords}">
        <p:ajax event="rowSelect" listener="#{ValidationsView.onRowSelect}" update="validationView" oncomplete="PF('cdViewValidation').show()" />
        <p:column headerText="ERROR #" width="100" sortBy="#{rows.ruleNumber}" sortOrder="asc">
          <h:outputText value="#{rows.ruleNumber}" />
        </p:column>
        <p:column headerText="ERROR MESSAGE" sortBy="#{rows.messageText}">
          <h:outputText value="#{ValidationsView.truncateString(rows.messageText, 93)}" title="#{rows.messageText}" />
        </p:column>
        <p:column headerText="TYPE MATCH" width="135" sortBy="#{rows.defaultSeverity == rows.severity}">
          <h:outputText value="#{rows.defaultSeverity == rows.severity ? 'True' : 'False'}" />
        </p:column>
        <p:column headerText="DEFAULT TYPE" width="145" sortBy="#{rows.defaultSeverity}">
          <h:outputText value="#{ValidationsView.convertTypeToText(rows.defaultSeverity)}" />
        </p:column>
        <p:column headerText="TYPE" width="110" sortBy="#{rows.severity}">
          <h:outputText value="#{ValidationsView.convertTypeToText(rows.severity)}" style="#{rows.defaultSeverity != rows.severity ? 'color: red;' : ''}" />
        </p:column>
      </p:dataTable>
    </h:form>
    <p:confirmDialog id="validationView" global="false" widgetVar="cdViewValidation" header="View Details" appendTo="@(body)" width="650px">
      <f:facet name="message">
        <h:form id="validationViewForm">
          <p:panelGrid columns="1" styleClass="ui-noborder" style="width: 254px">
            <p:outputPanel>
              <p:outputLabel class="ui-g-label readonly" for="@next" value="Error #" />
              <p:inputText disabled="true" value="#{ValidationsView.ruleNumber}" style="width: 254px" />
            </p:outputPanel>
          </p:panelGrid>
          <p:panelGrid columns="1" styleClass="ui-noborder" style="width: 574px">
            <p:outputPanel>
              <p:outputLabel class="ui-g-label" for="@next" value="Error Message" />
              <p:inputText value="#{ValidationsView.messageText}" id="validationViewMessageText" maxlength="300" required="true" />
            </p:outputPanel>
          </p:panelGrid>
          <p:panelGrid columns="1" styleClass="ui-noborder" style="width: 254px">
            <p:outputPanel>
              <p:outputLabel class="ui-g-label readonly" for="@next" value="Default Type" />
              <p:inputText disabled="true" value="#{ValidationsView.convertTypeToText(ValidationsView.defaultSeverity)}" />
            </p:outputPanel>
            <p:outputPanel>
              <p:outputLabel class="ui-g-label" for="@next" value="Type" />
              <p:selectOneMenu value="#{ValidationsView.severity}" required="true" style="width: 254px">
                <f:selectItem id="fatal" itemLabel="Fatal" itemValue="F" />
                <f:selectItem id="warning" itemLabel="Warning" itemValue="W" />
              </p:selectOneMenu>
            </p:outputPanel>
            <p:outputPanel>
              <p:commandButton value="Update" process="@form"
                               oncomplete="PF('cdViewValidation').hide();"
                               action="#{ValidationsView.updateValidationRow()}"
                               update="@widgetVar(tblValidation)" />
              <p:commandButton value="Cancel" type="button"
                               onclick="PF('cdViewValidation').hide();"
                               styleClass="ui-confirmdialog-no" 
                               immediate="true" />
            </p:outputPanel>
          </p:panelGrid>
        </h:form>
      </f:facet>
    </p:confirmDialog>
  </ui:define>
</ui:composition>

