<ui:composition template="/WEB-INF/templates/gov30Template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
  <ui:define name="title">
    Membership
  </ui:define> 
  <ui:define name="content">
    <ui:param name="bean" value="#{MembershipView}" />
    <ui:include src="/WEB-INF/fragments/navTabs/adminTabs.xhtml" />
    <p:messages id="membershipMessages" closable="true" />
    <h:form id="membershipForm">
      <div class="search-form ui-g-field">
        <p:outputLabel class="ui-g-label" for="@next" value="Search" />
        <div class="search-bar">
          <p:inputText id="inputSearchString" value="#{MembershipView.searchValue}" styleClass="input-field" />
          <p:commandButton value="Search" id="searchButtonGo"
                           styleClass="search search-button" 
                           action="#{MembershipView.searchMembershipList}"
                           update="@form"
                           onclick="PF('tblMembership').paginator.setPage(0);" />
        </div>
      </div>
      <p:dataTable id="membershipTable" widgetVar="tblMembership"
                   value="#{MembershipView.memberships}"
                   sortBy="#{rows.corporateEmployerNumber}"
                   selectionMode="single"
                   selection="#{MembershipView.selectedMembership}"
                   var="rows" rowKey="#{rows.hscisId}"
                   rows="10" paginator="true" paginatorAlwaysVisible="false"
                   paginatorPosition="top"
                   paginatorTemplate="{CurrentPageReport} {PreviousPageLink} {NextPageLink}"
                   currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords}">
        <p:ajax event="rowSelect" listener="#{MembershipView.onRowSelect}" update="membershipDialog" oncomplete="PF('cdUpdateMembership').show(); PF('cdUpdateMembership').content.scrollTop('0')" />
        <p:column headerText="CORP EMPLOYER #" width="180" sortBy="#{rows.corporateEmployerNumber}" sortOrder="asc">
          <h:outputText value="#{rows.corporateEmployerNumber}" />
        </p:column>
        <p:column headerText="SITE EMPLOYER #" width="170" sortBy="#{rows.siteEmployerNumber}">
          <h:outputText value="#{rows.siteEmployerNumber}" />
        </p:column>
        <p:column headerText="LEGAL NAME" sortBy="#{rows.legalName}">
          <h:outputText value="#{MembershipView.truncateString(rows.legalName, 30)}" title="#{rows.legalName}" />
        </p:column>
        <p:column headerText="OPERATING NAME" width="215" sortBy="#{rows.operatingName}">
          <h:outputText value="#{MembershipView.truncateString(rows.operatingName, 22)}" title="#{rows.operatingName}" />
        </p:column>
        <p:column headerText="EMAIL" width="145" sortBy="#{rows.email1}">
          <h:outputText value="#{MembershipView.truncateString(rows.email1, 15)}" title="#{rows.email1}" />
        </p:column>
        <p:column headerText="ACTIVE" width="85" sortBy="#{rows.activeFlag}">
          <h:outputText value="#{rows.activeFlag == 'true' ? 'Yes' : 'No'}" />
        </p:column>
        <p:column headerText="NOTES" width="85" sortBy="#{rows.commentsNotes}">
          <p:commandLink value="#{(rows.commentsNotes == null || rows.commentsNotes == '') ? null : 'View'}" action="#{MembershipView.setCommentsNotes(rows.commentsNotes)}" update="notesPopup" oncomplete="PF('cdNotesPopup').show()" class="ui-button ui-widget notes" />
        </p:column>
      </p:dataTable>
      <p:commandButton id="createButton"
                       value="Create"
                       update="@widgetVar(cdCreateMembership)"
                       oncomplete="PF('cdCreateMembership').show(); PF('cdCreateMembership').content.scrollTop('0')"
                       action="#{MembershipView.createEmptyMembershipRow()}">
        <f:setPropertyActionListener target="#{MembershipView.reportedWithinList}" value="#{null}" />
        <p:resetInput target="@widgetVar(cdCreateMembership)" />
      </p:commandButton>
    </h:form>
    <ui:include
      src="/WEB-INF/fragments/membershipPopups/membershipUpdatePopup.xhtml" />
    <ui:include
      src="/WEB-INF/fragments/membershipPopups/membershipNotePopup.xhtml" />
    <ui:include
      src="/WEB-INF/fragments/membershipPopups/membershipCreatePopup.xhtml" />
  </ui:define>
</ui:composition>