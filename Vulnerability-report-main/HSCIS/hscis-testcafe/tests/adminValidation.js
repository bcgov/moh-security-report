import { initTest } from '../helpers/common.helper';
import { urlFor } from '../helpers/url.helper';
import { regularAccUser } from '../helpers/user.helper';
import { selectorByDataRK } from '../helpers/selector.helper';
import { isDisabled, hasErrorState, selectInDropdownList } from '../helpers/field.helper';
import NavBar from '../page-objects/topNav';
import adminValidation from '../page-objects/adminValidation';

fixture `HSCIS - Admin Validation`
    .page(urlFor(''))
    .beforeEach( async t => {
        await initTest(regularAccUser);
	//Set navigation links
		await NavBar.clickadminTabsLink();

		await NavBar.clickvalidationLink();
	//****************
});

const page = new adminValidation();

test('01. Smoke Test', async t => {
    await t
		.click(page.searchButton);

    await t
        .hover(page.inputSearchString);

    await t
        .hover(page.searchButton);
});

test('02. Search a few lines', async t => {
    //Place into view update
    await t
        .hover(page.dataTable)
        .wait(100);
	
	//Clear the search field
	await t
		.selectText(page.inputSearchString)
		.pressKey('delete');    

    //Set one search 
    await t
        .typeText(page.inputSearchString, page.searchString);
    
    //Activate the search
    await t
		.click(page.searchButton);
        
    //Verify the search has been processed
    await t
        .wait(1000)
        .expect(page.dataTable.textContent).contains(page.searchResult1);
		
});

test('03. Select a row and reach update view', async t => {
    //Place into view update
    await t
        .hover(page.dataTable)
        .wait(100);
    
	//Clear the search field
	await t
		.selectText(page.inputSearchString)
		.pressKey('delete');    

    //Set one search 
    await t
        .typeText(page.inputSearchString, page.searchString);
    
    //Activate the search
    await t
		.click(page.searchButton);

	//Select first result in the table
	var firstRow = page.getDatas().nth(0);
		
    await t
        .click(firstRow);

	//Validate the confirmation was selected	
	await t
		.wait(1000)
		.expect(firstRow.textContent).contains(page.firstLineContain);

	//Close of the view
    await page.cancelDataDialog();

    //Verify the view is closed
    await t
		.wait(100)
        .expect(page.dataDialog().visible).notOk();
	
});

test('04. Select a row and update it', async t => {
    //Place into view update
    await t
        .hover(page.dataTable)
        .wait(100);
    
	//Clear the search field
	await t
		.selectText(page.inputSearchString)
		.pressKey('delete');    

    //Set one search 
    await t
        .typeText(page.inputSearchString, page.searchString);
    
    //Activate the search
    await t
		.click(page.searchButton);

	//Select first result in the table
	var firstRow = page.getDatas().nth(0);
	
    await t
        .click(firstRow);

	//Validate the confirmation was selected	
	await t
		.wait(1000)
		.expect(firstRow.textContent).contains(page.firstLineContain);

    //Verify the view is open
    await t
		.wait(100)
        .expect(page.dataDialog().visible).ok();
		
	//save current value
	var oldValue = page.messageInput.value;
	
	//Go to start of the message field
	await t
		.selectText(page.messageInput)
		.pressKey('home');
		
	//Add the test message
	await t
		.wait(100)
        .typeText(page.messageInput, 'tastytest ');
		
	//Confirm the Update
	await page.confirmDataDialog();
	
    //Verify the confirmation is closed
    await t
		.wait(100)
        .expect(page.dataDialog().visible).notOk();
	
	//Validate the update was added
	await t
		.wait(100)
		.expect(page.getDatas().textContent).contains('tastytest ');
		
	//Search the updated record
	await t
		.selectText(page.inputSearchString)
		.pressKey('delete');    

    await t
        .typeText(page.inputSearchString, 'tastytest ');
	
    //Activate the search
    await t
		.click(page.searchButton);

	//Select updated result in the table
	var firstRow = page.getDatas().nth(0);
	
    await t
        .click(firstRow);

    //Verify the view is open
    await t
		.wait(100)
        .expect(page.dataDialog().visible).ok();
	
	//Go to start of the message field and delete the modification
	await t
		.selectText(page.messageInput)
		.pressKey('home')
		.pressKey('delete')
		.pressKey('delete')
		.pressKey('delete')
		.pressKey('delete')
		.pressKey('delete')
		.pressKey('delete')
		.pressKey('delete')
		.pressKey('delete')
		.pressKey('delete')
		.pressKey('delete');
	
	//Confirm the Update
	await page.confirmDataDialog();
	
    //Verify the confirmation is closed
    await t
		.wait(100)
        .expect(page.dataDialog().visible).notOk();
	
	//Search the updated record
	await t
		.selectText(page.inputSearchString)
		.pressKey('delete');    

    await t
        .typeText(page.inputSearchString, 'tastytest ');
		
    //Activate the search
    await t
		.click(page.searchButton);

    //Verify the record was restored
    await t
        .wait(1000)
        .expect(page.dataTable.textContent).contains('No records found.');

});

