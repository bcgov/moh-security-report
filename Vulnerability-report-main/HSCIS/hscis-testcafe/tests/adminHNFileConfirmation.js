import { initTest } from '../helpers/common.helper';
import { urlFor } from '../helpers/url.helper';
import { regularAccUser } from '../helpers/user.helper';
import { selectorByDataRK } from '../helpers/selector.helper';
import { isDisabled, hasErrorState, selectInDropdownList } from '../helpers/field.helper';
import NavBar from '../page-objects/topNav';
import testcafeUtility from '../page-objects/testcafeUtility';
import adminHNFileConfirmation from '../page-objects/adminHNFileConfirmation';

fixture `HSCIS - Admin HNFile Confirmation`
    .page(urlFor(''))
    .beforeEach( async t => {
        await initTest(regularAccUser);

	//Set navigation links
		await NavBar.clickadminTabsLink();

		await NavBar.clickHNFileConfirmationLink();
	//****************
});

const page = new adminHNFileConfirmation();

test('01. Smoke Test', async t => {
    await t
		.click(page.searchButton);

    await t
        .hover(page.inputSearchString);

    await t
        .hover(page.searchButton);
});

test('02. Search a few lines', async t => {
    //Place into view the Data Entry Confirmation
    await t
        .hover(page.dataTable)
        .wait(100);
    
	//Clear the search field
	await t
		.selectText(page.inputSearchString)
		.pressKey('delete');    

    //Set one search 
    await t
        .typeText(page.inputSearchString, page.searchString);
    
    //Activate the search
    await t
		.click(page.searchButton);
        
    //Verify the search has been processed
    await t
        .wait(1000)
        .expect(page.dataTable.textContent).contains(page.searchResult1);
		
});

test('03. Select a row and reach confirmation view', async t => {
    //Place into view the Data Entry Confirmation
    await t
        .hover(page.dataTable)
        .wait(100);
    
	//Clear the search field
	await t
		.selectText(page.inputSearchString)
		.pressKey('delete');    

    //Set one search 
    await t
        .typeText(page.inputSearchString, page.searchString);
    
    //Activate the search
    await t
		.click(page.searchButton);

	//Select first result in the table
	var firstRow = page.getDatas().nth(0);
		
    await t
        .click(firstRow);

	//Validate the confirmation was selected	
	await t
		.wait(1000)
		.expect(firstRow.textContent).contains(page.firstLineContain);

	//Close of the view
    await page.cancelDataDialog();

    //Verify the view is closed
    await t
		.wait(100)
        .expect(page.dataDialog().visible).notOk();
	
});

test('04. Select a row and reach delete confirmation', async t => {
    //Place into view the Data Entry Confirmation
    await t
        .hover(page.dataTable)
        .wait(100);
    
	//Clear the search field
	await t
		.selectText(page.inputSearchString)
		.pressKey('delete');    

    //Set one search 
    await t
        .typeText(page.inputSearchString, page.searchString);
    
    //Activate the search
    await t
		.click(page.searchButton);

	//Select first result in the table
	var firstRow = page.getDatas().nth(0);
		
    await t
        .click(firstRow);

	//Validate the confirmation was selected	
	await t
		.wait(1000)
		.expect(firstRow.textContent).contains(page.firstLineContain);

    //Verify the view is open
    await t
		.wait(100)
        .expect(page.dataDialog().visible).ok();

	//Validate the delete confirmation open
	await page.confirmDataDialog();
	
    //Verify the view is open
    await t
		.wait(100)
        .expect(page.deleteDataDialog().visible).ok();

	//Cancel the delete
	await page.cancelDeleteDataDialog();
	
    //Verify the confirmation is closed
    await t
		.wait(100)
        .expect(page.deleteDataDialog().visible).notOk();

	//Cancel the delete
	await page.cancelDataDialog();
	
    //Verify the view is closed
    await t
		.wait(100)
        .expect(page.dataDialog().visible).notOk();
	
});

test('05. Select a row and reach delete confirmation and delete', async t => {
	//Set navigation links to utility
		await NavBar.clicktestUtilityLink();
	
	//Create the record to delete
		await testcafeUtility.clickcreateUploadsLink();
	
	//Set navigation links
		await NavBar.clickadminTabsLink();

		await NavBar.clickHNFileConfirmationLink();

    //Place into view the Data Entry Confirmation
    await t
        .hover(page.dataTable)
        .wait(100);
    
	//Clear the search field
	await t
		.selectText(page.inputSearchString)
		.pressKey('delete');    

    //Set one search 
    await t
        .typeText(page.inputSearchString, page.searchStringDel);
    
    //Activate the search
    await t
		.click(page.searchButton);

	//Select first result in the table
	var firstRow = page.getDatas().nth(0);
		
	//Validate the confirmation was selected	
	await t
		.wait(1000)
		.expect(firstRow.textContent).contains(page.searchStringDel);
	
	//Select the row
    await t
        .click(firstRow);

    //Verify the view is open
    await t
		.wait(100)
        .expect(page.dataDialog().visible).ok();

	//Validate the delete confirmation open
	await page.confirmDataDialog();
	
    //Verify the view is open
    await t
		.wait(100)
        .expect(page.deleteDataDialog().visible).ok();

	//Delete the confirmation
	await page.confirmDeleteDataDialog();
	
	//Clear the search field
	await t
		.selectText(page.inputSearchString)
		.pressKey('delete');    

    //Set one search 
    await t
        .typeText(page.inputSearchString, page.searchStringDel);
    
    //Activate the search
    await t
		.click(page.searchButton);
        
    //Verify the delete has been processed
    await t
        .wait(1000)
        .expect(page.dataTable.textContent).contains('No records found.');


    //Verify the confirmation is closed
    await t
		.wait(100)
        .expect(page.deleteDataDialog().visible).notOk();
	
    //Verify the view is closed
    await t
		.wait(100)
        .expect(page.dataDialog().visible).notOk();
	
});
