import { initTest } from '../helpers/common.helper';
import { urlFor } from '../helpers/url.helper';
import { regularAccUser } from '../helpers/user.helper';
import { selectorByDataRK } from '../helpers/selector.helper';
import { isDisabled, hasErrorState, selectInDropdownList } from '../helpers/field.helper';
import NavBar from '../page-objects/topNav';
import testcafeUtility from '../page-objects/testcafeUtility';
import adminCTMisFunctionalCodes from '../page-objects/adminCTMisFunctionalCodes';

fixture `HSCIS - Admin CT Mis Functional Codes`
    .page(urlFor(''))
    .beforeEach( async t => {
        await initTest(regularAccUser);
    //Set navigation links
        await NavBar.clickadminTabsLink();

        await NavBar.clickcodeTablesLink();
    //****************
});

const page = new adminCTMisFunctionalCodes();

test('01. Smoke Test', async t => {
    await t
        .click(page.codeTablesMenuClosed().nth(10));

    await t
        .wait(100)
        .click(page.codeTablesMenuClosed().nth(0));

    await t
        .wait(100)
        .click(page.codeTablesMenuOpen().nth(0));
});

test('02. Search a few lines', async t => {
    //Open the tab
    await t
        .click(page.codeTablesMenuClosed().nth(10));

    //Place into view update
    await t
        .hover(page.dataTable)
        .wait(100);
    
    //Clear the search field
    await t
        .selectText(page.inputSearchString)
        .pressKey('delete');    

    //Set one search 
    await t
        .typeText(page.inputSearchString, page.searchString);
    
    //Activate the search
    await t
        .click(page.searchButton);
        
    //Verify the search has been processed
    await t
        .wait(1000)
        .expect(page.dataTable.textContent).contains(page.searchString);
        
});

test('03. Select a row and reach update view', async t => {
    //Open the tab
    await t
        .click(page.codeTablesMenuClosed().nth(10));

    //Place into view update
    await t
        .hover(page.dataTable)
        .wait(100);
    
    //Select first result in the table
    var firstRow = page.getDatas().nth(0);
        
    await t
        .click(firstRow);

    //Close of the view
    await page.cancelDataDialog();

    //Verify the view is closed
    await t
        .wait(100)
        .expect(page.dataDialog().visible).notOk();
    
});

test('04. create a new row', async t => {
    //Open the tab
    await t
        .click(page.codeTablesMenuClosed().nth(10));

    //****** Test the view
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
    
    //Cancel the view
    await page.cancelCreateDataDialog();

    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).notOk();

    //****** create test begin
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
        
    //Create the empty record
    await page.confirmCreateDataDialog();
        
    //Validate the record was failed
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Account: Value is required.');
        
    //***** Test Code required
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
        
    //Fill in the Description
    await t
        .typeText(page.descriptionInputCreate, 'Tastytest i 99am a test cafe created row.99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999');

    //Create the record
    await page.confirmCreateDataDialog();
        
    //Validate the record require code
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Account: Value is required.');
        
    //***** Test Description required
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
        
    //Fill in the code
    await t
        .typeText(page.accountInputCreate, '99999tasty9999999');
        
    //Check numeric validation
    await t
        .expect(page.accountInputCreate.value).eql('999999999999');
        
    //Create the record
    await page.confirmCreateDataDialog();

    //Validate the record require description
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Description: Value is required.');

    //***** Create the record
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
        
    //Fill in the code
    await t
        .typeText(page.accountInputCreate, '999999tasty999999');
        
    //Fill in the description
    await t
        .typeText(page.descriptionInputCreate, 'Tastytest i 99am a test cafe created row.99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999');

    //Create the record
    await page.confirmCreateDataDialog();

    //Validate the record is created
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Record was successfully created');

    //***** Create the record again
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
        
    //Fill in the code
    await t
        .typeText(page.accountInputCreate, '999999999999');
        
    //Fill in the description
    await t
        .typeText(page.descriptionInputCreate, 'Tastytest i 99am a test cafe created row.99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999');

    //Create the record
    await page.confirmCreateDataDialog();

    //Validate the record is created
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Account for this record already exists');

});

test('05. Select a row and update it', async t => {
    //Open the tab
    await t
        .click(page.codeTablesMenuClosed().nth(10));

    //Place into view update
    await t
        .hover(page.dataTable)
        .wait(100);
    //Change order to get the test record in view
    await page.changeOrder();
    
    //Verify the record is present
    await t
        .wait(1000)
        .expect(page.dataTable.textContent).contains('Tastytest ');

    //Select first result in the table
    var testRow = page.getDatasTestRow();
    
    //***** Test description required
    // Select the row
    await t
        .click(testRow);

    //Verify the view is open
    await t
        .wait(100)
        .expect(page.dataDialog().visible).ok();

    //Go to message field and reset with void
    await t
        .selectText(page.descriptionInput)
        .pressKey('delete');

    //Confirm the Update
    await page.confirmDataDialog();
    
    //Validate the description is required
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Description: Value is required.');

    //****** Test the update
    // Select the row
    await t
        .click(testRow);

    //Verify the view is open
    await t
        .wait(100)
        .expect(page.dataDialog().visible).ok();
        
    //Go to message field and reset with new value
    await t
        .selectText(page.descriptionInput)
        .pressKey('delete')
        .typeText(page.descriptionInput, 'Tastymuffintest i am a test cafe created row.99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999');

    //Confirm the Update
    await page.confirmDataDialog();

    //Verify the confirmation is closed
    await t
        .wait(100)
        .expect(page.dataDialog().visible).notOk();

    //Validate the record was Updated
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Record was successfully updated');
    
    //****** Delete the test record
    //Set navigation links to utility
        await NavBar.clicktestUtilityLink();
    
    //Delete the classification added in the tests
        await testcafeUtility.clickdeleteHcdMisFuncCentAccntsLink();

    //Validate the record was deleted
    await t
        .wait(2000)
        .expect(testcafeUtility.testCafeUtilityMessages().textContent).contains('Record was successfully deleted');

});