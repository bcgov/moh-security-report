import { initTest } from '../helpers/common.helper';
import { urlFor } from '../helpers/url.helper';
import { regularAccUser } from '../helpers/user.helper';
import { selectorByDataRK } from '../helpers/selector.helper';
import { isDisabled, hasErrorState, selectInDropdownList } from '../helpers/field.helper';
import NavBar from '../page-objects/topNav';
import testcafeUtility from '../page-objects/testcafeUtility';
import adminCTServiceType from '../page-objects/adminCTServiceType';

fixture `HSCIS - Admin CT Service Type`
    .page(urlFor(''))
    .beforeEach( async t => {
        await initTest(regularAccUser);
    //Set navigation links
        await NavBar.clickadminTabsLink();

        await NavBar.clickcodeTablesLink();
    //****************
});

const page = new adminCTServiceType();

test('01. Smoke Test', async t => {
    await t
        .click(page.codeTablesMenuClosed().nth(12));

    await t
        .wait(100)
        .click(page.codeTablesMenuClosed().nth(0));

    await t
        .wait(100)
        .click(page.codeTablesMenuOpen().nth(0));
});

test('02. Select a row and reach update view', async t => {
    //Open the tab
    await t
        .click(page.codeTablesMenuClosed().nth(12));

    //Place into view update
    await t
        .hover(page.dataTable)
        .wait(100);
    
    //Select first result in the table
    var firstRow = page.getDatas().nth(0);
        
    await t
        .click(firstRow);

    //Close of the view
    await page.cancelDataDialog();

    //Verify the view is closed
    await t
        .wait(100)
        .expect(page.dataDialog().visible).notOk();
    
});

test('03. create a new row', async t => {
    //Open the tab
    await t
        .click(page.codeTablesMenuClosed().nth(12));

    //****** Test the view
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
    
    //Cancel the view
    await page.cancelCreateDataDialog();

    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).notOk();

    //****** create test begin
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
        
    //Create the empty record
    await page.confirmCreateDataDialog();
        
    //Validate the record was failed
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Code: Value is required.');
        
    //***** Test Code required
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
        
    //Fill in the Description
    await t
        .typeText(page.typeInputCreate, 'Tastytest i 99am a test cafe created row.999999999999999999999999');

    //Create the record
    await page.confirmCreateDataDialog();
        
    //Validate the record require code
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Code: Value is required.');
        
    //***** Test Description required
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
        
    //Fill in the code
    await t
        .typeText(page.codeInputCreate, '9999');
        
    //Create the record
    await page.confirmCreateDataDialog();

    //Validate the record require description
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Type: Value is required.');

    //***** Create the record
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
        
    //Fill in the code
    await t
        .typeText(page.codeInputCreate, '9999');
        
    //Fill in the description
    await t
        .typeText(page.typeInputCreate, 'Tastytest i 99am a test cafe created row.999999999999999999999999');

    //Create the record
    await page.confirmCreateDataDialog();

    //Validate the record is created
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Record was successfully created');

    //***** Create the record again
    //Open the create view
    await t
        .wait(100)
        .click(page.createButton);
        
    //Verify the view is open
    await t
        .wait(100)
        .expect(page.createDataDialog().visible).ok();
        
    //Fill in the code
    await t
        .typeText(page.codeInputCreate, '9999');
        
    //Fill in the description
    await t
        .typeText(page.typeInputCreate, 'Tastytest i 99am a test cafe created row.999999999999999999999999');

    //Create the record
    await page.confirmCreateDataDialog();

    //Validate the record is created
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Code for this record already exists');

});

test('04. Select a row and update it', async t => {
    //Open the tab
    await t
        .click(page.codeTablesMenuClosed().nth(12));

    //Place into view update
    await t
        .hover(page.dataTable)
        .wait(100);
    
    //Verify the record is present
    await t
        .wait(1000)
        .expect(page.dataTable.textContent).contains('Tastytest ');

    //Select first result in the table
    var testRow = page.getDatasTestRow();
    
    //***** Test description required
    // Select the row
    await t
        .click(testRow);

    //Verify the view is open
    await t
        .wait(100)
        .expect(page.dataDialog().visible).ok();

    //Go to message field and reset with void
    await t
        .selectText(page.typeInput)
        .pressKey('delete');

    //Confirm the Update
    await page.confirmDataDialog();
    
    //Validate the description is required
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Type: Value is required.');

    //****** Test the update
    // Select the row
    await t
        .click(testRow);

    //Verify the view is open
    await t
        .wait(100)
        .expect(page.dataDialog().visible).ok();
        
    //Go to message field and reset with new value
    await t
        .selectText(page.typeInput)
        .pressKey('delete')
        .typeText(page.typeInput, 'Tastymuffintest i am a test cafe created row.999999999999999999999999');

    //Confirm the Update
    await page.confirmDataDialog();

    //Verify the confirmation is closed
    await t
        .wait(100)
        .expect(page.dataDialog().visible).notOk();

    //Validate the record was Updated
    await t
        .wait(100)
        .expect(page.errorMessage.textContent).contains('Record was successfully updated');
    
    //****** Delete the test record
    //Set navigation links to utility
        await NavBar.clicktestUtilityLink();
    
    //Delete the classification added in the tests
        await testcafeUtility.clickdeleteHcdServiceTypeLink();

    //Validate the record was deleted
    await t
        .wait(2000)
        .expect(testcafeUtility.testCafeUtilityMessages().textContent).contains('Record was successfully deleted');

});