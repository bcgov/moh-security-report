package ca.bc.gov.health.hscis.mapper;

import ca.bc.gov.health.hscis.dto.PayrollSummary;
import ca.bc.gov.health.hscis.dto.PayrollSummaryStatus;
import ca.bc.gov.health.hscis.entity.HcdPayrollSummary;
import java.time.LocalDate;
import java.util.List;
import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.Named;

@Mapper(
    componentModel = "cdi",
    uses = {PayrollSummaryGroupCompMapper.class, PayrollSummaryEmployeeMapper.class})
public interface PayrollSummaryMapper {

  @Mapping(source = "id.corporateEmployerNumber", target = "employerID")
  @Mapping(source = "id.siteEmployerNumber", target = "siteID")
  @Mapping(source = "id.reportingFrom", target = "reportingPeriod.fromDate")
  @Mapping(source = "id.reportingTo", target = "reportingPeriod.toDate")
  @Mapping(source = "lastModified", target = "lastModified")
  @Mapping(source = "completeDate", target = "status", qualifiedByName = "completeDateToStatus")
  @Mapping(source = "payrollSummaryGroupComp", target = "groupSummaries")
  @Mapping(source = "payrollSummaryEmployee", target = "employeeSummaries")
  @Mapping(source = "membership.hscisId", target = "membershipId")
  PayrollSummary toSummary(HcdPayrollSummary hcdPayrollSummary);

  List<PayrollSummary> toSummaries(List<HcdPayrollSummary> hcdPayrollSummaries);

  @Named("completeDateToStatus")
  public static PayrollSummaryStatus toStatus(LocalDate completeDate) {
    if (completeDate == null) {
      return PayrollSummaryStatus.IN_PROGRESS;
    } else {
      return PayrollSummaryStatus.COMPLETED;
    }
  }
}
