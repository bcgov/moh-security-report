package ca.bc.gov.health.hscis.mapper;

import ca.bc.gov.health.hscis.dto.PayrollSummaryEmployee;
import ca.bc.gov.health.hscis.entity.HcdPayrollSummaryEmployee;
import java.util.List;
import org.mapstruct.AfterMapping;
import org.mapstruct.InheritInverseConfiguration;
import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.MappingTarget;

@Mapper(componentModel = "cdi")
public interface PayrollSummaryEmployeeMapper {

  @Mapping(target = "id", source = "hcdPaysumEmpId")
  // Just copy SummaryPk fields
  @Mapping(target = "summary.employerID", source = "corporateEmployerNumber")
  @Mapping(target = "summary.siteID", source = "siteEmployerNumber")
  @Mapping(target = "summary.reportingPeriod.fromDate", source = "reportingFrom")
  @Mapping(target = "summary.reportingPeriod.toDate", source = "reportingTo")
  @Mapping(target = "hscisid", source = "hcdMembership.hscisId")

  // Child relations
  @Mapping(target = "designatedGroup", source = "hcdDesignatedGroup")
  @Mapping(target = "classification", source = "hcdClassification")
  @Mapping(target = "gender", source = "hcdGender")
  @Mapping(target = "jobStatus", source = "hcdJobStatus")
  @Mapping(target = "terminationCode", source = "hcdTerminationCode")
  @Mapping(target = "union", source = "hcdUnion")

  // All other fields are default
  @Mapping(target = "employeeNumber")
  @Mapping(target = "employeeSinCrypt")
  @Mapping(target = "employeeSinHash")
  @Mapping(target = "incrementValue")
  @Mapping(target = "integratedPosition")
  @Mapping(target = "jobTitle")
  @Mapping(target = "layeredoverPositionsClasscd")
  @Mapping(target = "originalDateHire")
  @Mapping(target = "positionFte")
  @Mapping(target = "regularPaidHours")
  @Mapping(target = "seniorityStartDate")
  @Mapping(target = "terminationDate")
  @Mapping(target = "vacationEntitlement")
  @Mapping(target = "vacationHrsUsedInTheYear")
  @Mapping(target = "wageRate")
  @Mapping(target = "dateBirth")
  @Mapping(target = "lastModifiedBy")
  PayrollSummaryEmployee toDto(HcdPayrollSummaryEmployee entity);

  List<PayrollSummaryEmployee> toDtos(List<HcdPayrollSummaryEmployee> entities);

  @AfterMapping
  default void setLastModified(
      @MappingTarget PayrollSummaryEmployee dto, HcdPayrollSummaryEmployee entity) {

    // Set the last modified on
    if (entity.getLastModifiedOn() != null) {
      dto.setLastModified(entity.getLastModifiedOn());
    } else {
      dto.setLastModified(entity.getCreatedOn());
    }
  }

  @InheritInverseConfiguration
  HcdPayrollSummaryEmployee toEntity(
      PayrollSummaryEmployee dto, @MappingTarget HcdPayrollSummaryEmployee entity);
}
