/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.plr.util;

import ca.bc.gov.health.plr.ejb.entity.PrsProviders;
import static ca.bc.gov.health.plr.service.provider.IntegrationSetup.entityManagerProxy;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

/**
 *
 * @author jonathan.wiebe
 */
public class ProviderCleanUpHelper {

    public static void deleteProvidersWithLastName(String firstName) {
        deleteProvidersWithLastName(new String[]{firstName});
    }

    public static void deleteProvidersWithLastName(String[] lastNames) {
        List<PrsProviders> providersToDelete = new ArrayList<PrsProviders>();
        for (String fName : lastNames) {
            providersToDelete.addAll(entityManagerProxy.findProvidersByLastName(fName));
        }
        deleteProviders(providersToDelete);

    }

    public static void deleteProviders(List<PrsProviders> providersToDelete) throws IllegalStateException {
        providersToDelete.removeAll(Collections.singleton(null));
        ArrayList<Exception> exceptions = new ArrayList<>();
        for (PrsProviders prsProviders : providersToDelete) {
            try {
                entityManagerProxy.remove(prsProviders);
            } catch (Exception e) {
                e.printStackTrace();
                exceptions.add(e);
            }
        }
        if (!exceptions.isEmpty()) {
            throw new IllegalStateException("Exceptions occurred while deleting entities. Check log for details.");
        }
    }

    public static void deleteProvidersWithShortName(String orgShortName) {
        List<PrsProviders> providersToDelete = new ArrayList<PrsProviders>();
        providersToDelete.addAll(entityManagerProxy.findProvidersByOrgShortName(orgShortName));
        deleteProviders(providersToDelete);

    }

    public static void deteleProvidersWithIDValue(String ID_VALUE) {
        List<PrsProviders> providersToDelete = new ArrayList<PrsProviders>();    
        providersToDelete.addAll(entityManagerProxy.findProvidersByID(ID_VALUE));
        deleteProviders(providersToDelete);
    }
}
