package ca.bc.gov.health.plr.remote;

import ca.bc.gov.health.plr.dto.esb.BatchTransactionStatusRequest;
import ca.bc.gov.health.plr.dto.provider.esb.BatchStatus;
import ca.bc.gov.health.plr.service.provider.IntegrationSetup;
import java.math.BigInteger;
import java.security.SecureRandom;
import org.hamcrest.Matchers;
import org.junit.Assert;
import org.junit.Test;

/**
 *
 * @author sumesh.kariyil
 */
public class BatchTransactionStatusServiceTest extends IntegrationSetup {

    static SecureRandom random = new SecureRandom();
    
    @Test
    public void testAddTransactionStatusFromLocal() {
        int initialCount = getCurrentStatusCount();
        String txId = getRandom();
        batchTransactionStatusServiceLocal.logStatus(BatchStatus.FAILED, txId, "00008585");
        Assert.assertThat(getCurrentStatusCount(), Matchers.equalTo(++initialCount));
        batchTransactionStatusServiceLocal.logStatus(BatchStatus.PROCESSED, txId, "00008585");
        Assert.assertThat(getCurrentStatusCount(), Matchers.equalTo(++initialCount));
    }
    
    private int getCurrentStatusCount(){
        return entityManagerProxy.query("select tx from PrsBatchTransactionStatus tx").size();        
    }
    
    private String getRandom() {
        return new BigInteger(130, random).toString(32);
    }
}
