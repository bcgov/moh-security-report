package ca.bc.gov.health.plr.dto.converter;

import ca.bc.gov.health.plr.dto.provider.CollegeIdentifierDto;
import ca.bc.gov.health.plr.ejb.entity.GrsIdentifiers;
import ca.bc.gov.health.plr.ejb.entity.PrsCtIdentifierTypes;
import ca.bc.gov.health.plr.ejb.entity.PrsProviders;
import ca.bc.gov.health.plr.persistence.CodeTableCodes;
import ca.bc.gov.health.plr.service.provider.IntegrationSetup;
import java.util.Date;
import org.junit.After;
import org.junit.AfterClass;
import static org.junit.Assert.assertEquals;
import org.junit.Before;
import org.junit.BeforeClass;
import org.junit.Test;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

/**
 *
 * @author ian.scott
 */
public class ProviderIdentifierDtoConverterTest extends IntegrationSetup {

    public ProviderIdentifierDtoConverterTest() {
    }

    @BeforeClass
    public static void setUpClass() {
    }

    @AfterClass
    public static void tearDownClass() {
    }

    @Before
    public void setUp() {
    }

    @After
    public void tearDown() {
    }

    /**
     * Test of toEntity method
     */
    @Test
    public void testToEntity_IdentifierType() throws Exception {
        CollegeIdentifierDto dto = populateDTO();

        GrsIdentifiers result = providerIdentifierConverter.toEntity(dto);
        assertEquals(result.getIdentifierTypeCode().getCtlNameCode(), "PHID");
        assertEquals(result.getIdentifierTypeCode().getCtlDescTxt(), "Pharmacist ID Number");
    }
    
    @Test
    public void testToEntity_identifier() {
        String someId = "someId";
        CollegeIdentifierDto dto = populateDTO();
        dto.setIdentifier(someId);

        GrsIdentifiers result = providerIdentifierConverter.toEntity(dto);

        assertEquals(someId, result.getProviderChid());
    }

    @Test
    public void testToEntity_effectiveStartDate_id() {
        Date date = new Date();
        CollegeIdentifierDto dto = populateDTO();
        dto.setEffectiveStartDate(date);

        GrsIdentifiers result = providerIdentifierConverter.toEntity(dto);

        assertEquals(date, result.getEffectiveStartDate());
    }
    
    @Test
    public void testToEntity_identifierTypeId() {
        CollegeIdentifierDto dto = populateDTO();
        PrsCtIdentifierTypes ctIdentifierType =  codesDao.lookup(PrsCtIdentifierTypes.class, "DENID");
        dto.setTypeId(ctIdentifierType.getCtlId());

        GrsIdentifiers result = providerIdentifierConverter.toEntity(dto);

        assertEquals(ctIdentifierType, result.getIdentifierTypeCode());
    }
    private CollegeIdentifierDto populateDTO() {
        CollegeIdentifierDto dto = new CollegeIdentifierDto();

        dto.setPauthId(67l);
        dto.setTypeId(2821l); // PHID Pharmacist ID Number

        return dto;
    }
}
