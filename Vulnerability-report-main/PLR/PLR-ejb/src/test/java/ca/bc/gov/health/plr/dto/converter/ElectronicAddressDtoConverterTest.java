package ca.bc.gov.health.plr.dto.converter;

import ca.bc.gov.health.plr.dto.provider.ElectronicAddressDto;
import ca.bc.gov.health.plr.ejb.entity.GrsElectronicAddresses;
import ca.bc.gov.health.plr.ejb.entity.PrsCtElectronicAddrTypes;
import ca.bc.gov.health.plr.persistence.CodeTableCodes;
import ca.bc.gov.health.plr.ejb.entity.util.DatabaseConstants;
import ca.bc.gov.health.plr.service.provider.IntegrationSetup;
import java.util.Calendar;
import java.util.Date;
import org.junit.After;
import org.junit.AfterClass;
import org.junit.Before;
import org.junit.BeforeClass;
import org.junit.Test;
import static org.junit.Assert.*;

/**
 *
 * @author jonathan.wiebe
 */
public class ElectronicAddressDtoConverterTest extends IntegrationSetup {

    public ElectronicAddressDtoConverterTest() {
    }

    @BeforeClass
    public static void setUpClass() {
    }

    @AfterClass
    public static void tearDownClass() {
    }

    @Before
    public void setUp() {
    }

    @After
    public void tearDown() {
    }

    /**
     * Test of toEntity method, of class ElectronicAddressDtoConverter.
     */
    @Test
    public void testToEntity_EAddressType() throws Exception {
        ElectronicAddressDto dto = populateElectronicAddressDTO();

        GrsElectronicAddresses result = eAddressConverter.toEntity(dto);
        assertEquals(result.getElectronicAddressTypeCode().getCtlNameCode(), "F");
        assertEquals(result.getElectronicAddressTypeCode().getCtlDescTxt(), "FTP");
        Calendar cal = Calendar.getInstance();
        cal.set(9999, 11,30,0,0,0);
        cal.set(Calendar.MILLISECOND, 0);
        assertEquals(result.getEffectiveEndDate().getTime(), cal.getTime().getTime());
    }
    @Test
    public void testToEntity_defaultEffectiveEndDate() throws Exception {
        ElectronicAddressDto dto = populateElectronicAddressDTO();

        GrsElectronicAddresses result = eAddressConverter.toEntity(dto);
        assertEquals(result.getEffectiveEndDate(), DatabaseConstants.SYSTEM_HIGH_DATE.toDate());        
    }
    
    @Test
    public void testToEntity_effectiveEndDate() throws Exception {
        ElectronicAddressDto dto = populateElectronicAddressDTO();

       
        Date currDate= new Date();
        dto.setEffectiveEndDate(currDate);

         GrsElectronicAddresses result = eAddressConverter.toEntity(dto);
        assertNotSame(result.getEffectiveEndDate(), DatabaseConstants.SYSTEM_HIGH_DATE.toDate());        
        assertEquals(result.getEffectiveEndDate(), currDate);        
    }
    
    @Test
    public void testToEntity_emailAddress() {
        ElectronicAddressDto dto = populateElectronicAddressDTO();
        String emailAddress = "emailAddress";
        dto.setAddress(emailAddress);

        PrsCtElectronicAddrTypes eTypeCode = codesDao.lookup(PrsCtElectronicAddrTypes.class, CodeTableCodes.PrsCtElectronicAddrTypes.EMAIL);
        dto.setTypeId(eTypeCode.getCtlId());

        GrsElectronicAddresses result = eAddressConverter.toEntity(dto);

        assertEquals(emailAddress, result.getElectronicAddressTxt());
        assertEquals(eTypeCode, result.getElectronicAddressTypeCode());
    }
    
    private ElectronicAddressDto populateElectronicAddressDTO() {
        ElectronicAddressDto dto = new ElectronicAddressDto();

        dto.setPauthId(67l);
        dto.setTypeId(2048l); // F FTP


        return dto;
    }
}
