package ca.bc.gov.health.plr.rule.provider.search;

import ca.bc.gov.health.plr.persistence.BusinessRuleKeys;
import ca.bc.gov.health.plr.persistence.BusinessRuleMessageDao;
import ca.bc.gov.health.plr.rule.BusinessRule;
import ca.bc.gov.health.plr.rule.BusinessRuleMessage;
import ca.bc.gov.health.plr.rule.BusinessRuleResult;
import java.util.ArrayList;
import java.util.List;
import javax.ejb.LocalBean;
import javax.ejb.Stateless;

/**
 * Implementation of REQ-00304. Search results returned to a user should be
 * limited via the setting of a maximum number of records; the user should also
 * know when the potential list of results exceeds this number.
 *
 * @author Grant.Hodgins
 */
@Stateless
@LocalBean
public class ValidateSearchResultSize implements BusinessRule {

    /**
     * Validates the maximum allowed search result size for a provider search.
     *
     * @param queryResultSize the size of the query result set
     * @param maxResultSize the maximum allowed search result size
     * @return the business rule result. * <code>true</code> if the result size
     * is not exceeded.
     */
    public BusinessRuleResult validateMaxSearchResults(int queryResultSize, int maxResultSize) {
        BusinessRuleResult result;
        List<BusinessRuleMessage> messages = new ArrayList<>();

        if (queryResultSize > maxResultSize) {
            BusinessRuleKeys key = BusinessRuleKeys.ERROR_SEARCH_MAXRESULTS;
            String message = BusinessRuleMessageDao.getMessageResource(key);
            messages.add(new BusinessRuleMessage(message, BusinessRuleMessage.Severity.WARNING));
            result = new BusinessRuleResult(false, messages);
        } else {
            result = new BusinessRuleResult();
        }

        return result;
    }

}
