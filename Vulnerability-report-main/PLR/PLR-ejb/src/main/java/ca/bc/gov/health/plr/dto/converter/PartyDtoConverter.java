package ca.bc.gov.health.plr.dto.converter;

import ca.bc.gov.health.plr.dto.PartyDto;
import ca.bc.gov.health.plr.ejb.entity.GrsCtBooleanTypes;
import ca.bc.gov.health.plr.ejb.entity.GrsCtPartyType;
import ca.bc.gov.health.plr.ejb.entity.GrsParties;
import ca.bc.gov.health.plr.ejb.entity.util.EntityUtils;
import ca.bc.gov.health.plr.persistence.CodeTableCodes;

import ca.bc.gov.health.plr.persistence.CodesDao;
import javax.ejb.EJB;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

/**
 * Convert a Party DTO into a GrsParties Entity.
 *
 * @author Adebiyi Kuseju
 */
@Stateless
public class PartyDtoConverter {

    @PersistenceContext(unitName = "PLR-ejbPU")
    private EntityManager em;
    @EJB
    private CodesDao codesDao;

    public GrsParties toEntity(PartyDto dto) {
        GrsParties entity = new GrsParties();

        entity.setPartyId(dto.getId());


        if (dto.isActive()) {
            entity.setActiveFlag(codesDao.lookup(GrsCtBooleanTypes.class, CodeTableCodes.GrsCtBooleanTypes.YES));
        } else {
            entity.setActiveFlag(codesDao.lookup(GrsCtBooleanTypes.class, CodeTableCodes.GrsCtBooleanTypes.NO));
        }

        if (dto.getPartyTypeId() != null) {
            entity.setPartyTypeCode(codesDao.lookup(GrsCtPartyType.class, dto.getPartyTypeId()));
        } else if (dto.getPartyTypeCode() != null) {
            entity.setPartyTypeCode(codesDao.lookup(GrsCtPartyType.class, CodeTableCodes.GrsCtPartyType.ORG.getValue()));
        }

        entity.setRegistryUserOrgChid(dto.getRegUserId());
        entity.setInvalidatedDts(dto.getInvalidatedDate());
        entity.setUserChid(dto.getUserChid());
        entity.setCreatedDts(dto.getCreatedDate());

        return entity;
    }

    public PartyDto toDto(GrsParties entity) {
        PartyDto dto = new PartyDto();

        dto.setId(entity.getPartyId());
        dto.setActive(EntityUtils.booleanValue(entity.getActiveFlag()));
        dto.setRegUserId(entity.getRegistryUserOrgChid());

        if (entity.getPartyTypeCode() != null) {
            dto.setPartyTypeCode(entity.getPartyTypeCode().getCtlNameCode());
            dto.setPartyTypeId(entity.getPartyTypeCode().getCtlId());
        }

        dto.setInvalidatedDate(entity.getInvalidatedDts());
        dto.setUserChid(entity.getUserChid());
        dto.setCreatedDate(entity.getCreatedDts());

        return dto;

    }
}
