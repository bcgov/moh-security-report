/*
 * *********************************************************************************************************************
 *  Copyright (c) 2018, Ministry of Health, BC.                                                                        *
 *                                                                                                                     *
 *  All rights reserved.                                                                                               *
 *    This information contained herein may not be used in whole                                                       *
 *    or in part without the express written consent of the                                                            *
 *    Government of British Columbia, Canada.                                                                          *
 *                                                                                                                     *
 *  Revision Control Information                                                                                       *
 *  File:                $Id::                                                                                       $ *
 *  Date of Last Commit: $Date::                                                                                     $ *
 *  Revision Number:     $Rev::                                                                                      $ *
 *  Last Commit by:      $Author::                                                                                   $ *
 *                                                                                                                     *
 * *********************************************************************************************************************
 */
package ca.bc.gov.health.plr.rule.provider;

import java.util.logging.Level;
import java.util.logging.Logger;
import java.util.regex.Pattern;
import javax.validation.ConstraintValidator;
import javax.validation.ConstraintValidatorContext;

/**
 *
 * Email address field validator for defect PLRP3-44.
 *
 * @author CGI Information Management Consultants Inc.
 */
public class AcceptableElectronicAddressValidator implements ConstraintValidator<AcceptableElectronicAddress, String> {

    private static final String CLASSNAME = AcceptableElectronicAddressValidator.class.getSimpleName();
    private static final Logger LOG = Logger.getLogger(CLASSNAME);

    public static final Pattern VALID_ELECTRONIC_ADDRESS_CHARS_PATTERN = Pattern.compile("[^ _`&^!#$%*+=?{|}~',\\-./0-9:@A-Z_a-z]");

    @Override
    public void initialize(AcceptableElectronicAddress constraintAnnotation) {
    }

    @Override
    public boolean isValid(String value, ConstraintValidatorContext context) {
        if (value == null) {
            return true;
        }
        
        LOG.log(Level.INFO, "AcceptableElectronicAddressValidator emailAddress is: {0} and isValid is: {1}.",
                new Object[]{value, !VALID_ELECTRONIC_ADDRESS_CHARS_PATTERN.matcher(value).find()});


        return !VALID_ELECTRONIC_ADDRESS_CHARS_PATTERN.matcher(value).find();
    }

}