package ca.bc.gov.health.plr.dto.converter;

import ca.bc.gov.health.plr.dto.provider.StatusDto;
import ca.bc.gov.health.plr.ejb.entity.PrsCtDataOwnerCodes;
import ca.bc.gov.health.plr.ejb.entity.PrsCtStatusClassCodes;
import ca.bc.gov.health.plr.ejb.entity.PrsCtStatusCodes;
import ca.bc.gov.health.plr.ejb.entity.PrsCtStatusReasonCodes;
import ca.bc.gov.health.plr.ejb.entity.PrsProviders;
import ca.bc.gov.health.plr.ejb.entity.PrsStatuses;
import ca.bc.gov.health.plr.persistence.CodesDao;
import javax.ejb.EJB;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

/**
 * Convert a Status DTO into a Status Entity.
 *
 * @author David Sharpe <david.a.sharpe@cgi.com>
 */
@Stateless
public class StatusDtoConverter {
    
    @PersistenceContext(unitName = "PLR-ejbPU")
    EntityManager em;
    @EJB
    CodesDao codesDao;
    @EJB
    DtoConverter dtoConverter;

    public PrsStatuses toEntity(StatusDto dto) {

        PrsStatuses entity = new PrsStatuses();

        dtoConverter.copyCommonProperties(dto, entity);
        
        if (dto.getId() != null) {
            entity.setAs2Id(dto.getId());
        }
        if (dto.getPauthId() != null) {
            entity.setPauthPauthId(em.find(PrsProviders.class, dto.getPauthId()));
        }
        if (dto.getDataOwnerCode() != null) {
            entity.setDataOwnerCode(codesDao.lookup(PrsCtDataOwnerCodes.class, dto.getDataOwnerCode()));
        }
        if (dto.getTypeId() != null) {
            PrsCtStatusCodes statusTypeCode = codesDao.lookup(PrsCtStatusCodes.class, dto.getTypeId());
            entity.setStatusTypeCode(statusTypeCode);
        } else if (dto.getTypeCode() != null) {
            PrsCtStatusCodes statusTypeCode = codesDao.lookup(PrsCtStatusCodes.class, dto.getTypeCode());
            entity.setStatusTypeCode(statusTypeCode);
        }
        if (dto.getClassCodeId() != null) {
            PrsCtStatusClassCodes statusClassCode = codesDao.lookup(PrsCtStatusClassCodes.class, dto.getClassCodeId());
            entity.setStatusClassCode(statusClassCode);
        } else if (dto.getClassCode() != null) {
            PrsCtStatusClassCodes statusClassCode = codesDao.lookup(PrsCtStatusClassCodes.class, dto.getClassCode());
            entity.setStatusClassCode(statusClassCode);
        }
        if (dto.getReasonCodeId() != null) {
            PrsCtStatusReasonCodes reasonCode = codesDao.lookup(PrsCtStatusReasonCodes.class, dto.getReasonCodeId());
            entity.setStatusReasonCode(reasonCode);
        } else if (dto.getReasonCode() != null) {
            PrsCtStatusReasonCodes reasonCode = codesDao.lookup(PrsCtStatusReasonCodes.class, dto.getReasonCode());
            entity.setStatusReasonCode(reasonCode);
        }

        return entity;
    }

}
