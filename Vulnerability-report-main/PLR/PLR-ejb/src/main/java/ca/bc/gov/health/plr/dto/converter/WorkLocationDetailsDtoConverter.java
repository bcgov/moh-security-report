/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.plr.dto.converter;

import ca.bc.gov.health.plr.dto.provider.WorkLocationDetailsDto;
import ca.bc.gov.health.plr.ejb.entity.GrsCtBooleanTypes;
import ca.bc.gov.health.plr.ejb.entity.GrsCtEndReasonTypes;
import ca.bc.gov.health.plr.ejb.entity.PrsCtWorkLocationPurps;
import ca.bc.gov.health.plr.ejb.entity.PrsWorkLocationDetails;
import ca.bc.gov.health.plr.ejb.entity.PrsWorkLocations;
import ca.bc.gov.health.plr.ejb.entity.util.DatabaseConstants;
import ca.bc.gov.health.plr.persistence.CodeTableCodes;
import ca.bc.gov.health.plr.persistence.CodesDao;
import javax.ejb.EJB;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

/**
 *
 * @author ian.scott
 */
@Stateless
public class WorkLocationDetailsDtoConverter {

    @PersistenceContext(unitName = "PLR-ejbPU")
    EntityManager em;
    @EJB
    CodesDao codesDao;
    @EJB
    DtoConverter dtoConverter;

    /**
     * Assemble Entity from transfer object
     *
     * @param dto - the transfer object to convert
     * @return - the entity representation of the transfer object
     */
    public PrsWorkLocationDetails toEntity(WorkLocationDetailsDto dto) {
        PrsWorkLocationDetails newEntity = new PrsWorkLocationDetails();
        newEntity.setWldId(dto.getId());

        if (dto.getWlWlId() != null) {
            newEntity.setWlWlId(em.find(PrsWorkLocations.class, dto.getWlWlId()));
        }

        newEntity.setWorkLocationNameTxt(dto.getName());
        newEntity.setAdditionalAddresseeInfoTxt(dto.getAdditionalAddresseeInfo());

        GrsCtBooleanTypes defaultFlag;
        if (dto.isDefaultFlag()) {
            defaultFlag = codesDao.lookup(GrsCtBooleanTypes.class, CodeTableCodes.GrsCtBooleanTypes.YES);
        } else {
            defaultFlag = codesDao.lookup(GrsCtBooleanTypes.class, CodeTableCodes.GrsCtBooleanTypes.NO);
        }
        newEntity.setDefaultFlag(defaultFlag);

        if (dto.getTypeId() != null) {
            PrsCtWorkLocationPurps foundPurps = codesDao.lookup(PrsCtWorkLocationPurps.class, dto.getTypeId());
            newEntity.setWorkLocationTypeCode(foundPurps);
            newEntity.setWorkLocationTypeId(foundPurps);
        } else if (dto.getTypeCode() != null) {
            PrsCtWorkLocationPurps foundPurps = codesDao.lookup(PrsCtWorkLocationPurps.class, dto.getTypeCode());
            newEntity.setWorkLocationTypeCode(foundPurps);
            newEntity.setWorkLocationTypeId(foundPurps);
        }

        dtoConverter.copyCommonProperties(dto, newEntity);

        return newEntity;
    }
}
