/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.plr.service.validators;

import ca.bc.gov.health.plr.ejb.entity.PrsCtStatusReasonCodes;
import ca.bc.gov.health.plr.ejb.entity.PrsStatuses;
import static ca.bc.gov.health.plr.persistence.BusinessRuleKeys.ERROR_INVALID_STATUS_REASON;
import ca.bc.gov.health.plr.persistence.BusinessRuleMessageDao;
import ca.bc.gov.health.plr.service.provider.ProviderHelperService;
import java.util.List;
import javax.ejb.EJB;
import javax.ejb.LocalBean;
import javax.ejb.Stateless;
import org.apache.commons.lang3.Validate;

/**
 * REQ-00919 : Validator class which checks if the Status Type Code have access to the Status reason Code
 * @author sumesh.kariyil
 */
@LocalBean
@Stateless
public class ApplicableStatusReasonCodeValidator implements EntityValidator<PrsStatuses>{
    
    @EJB
    private ProviderHelperService providerHelperService;
    
    private static final String errorMessage = BusinessRuleMessageDao.getMessageResource(ERROR_INVALID_STATUS_REASON);

    @Override
    public void validate(PrsStatuses entity) throws EntityValidationException {
        Validate.notNull(entity);
        Validate.notNull(entity.getStatusTypeCode());
        List<PrsCtStatusReasonCodes> applicableReasons = providerHelperService.filterStatusReasonCodes(entity.getStatusTypeCode().getCtlId());
        if(applicableReasons == null || applicableReasons.isEmpty()){
            throw new EntityValidationException(errorMessage);
        }
        if(! applicableReasons.contains(entity.getStatusReasonCode())){
            throw new EntityValidationException(errorMessage);
        }
    }
    
}
