package ca.bc.gov.health.plr.rule.provider;

import java.util.regex.Pattern;
import javax.faces.context.FacesContext;
import javax.validation.ConstraintValidator;
import javax.validation.ConstraintValidatorContext;

/**
 * Address field validator for EA REQ-00320.
 *
 * @author David Sharpe <david.a.sharpe@cgi.com>
 */
public class AcceptableAddressValidator implements ConstraintValidator<AcceptableAddress, String> {

    public static final Pattern INVALID_ADDRESS_CHARACTERS_PATTERN = Pattern.compile("[^ &'\\-.A-Za-z0-9]");
    
    @Override
    public void initialize(AcceptableAddress constraintAnnotation) {
    }

    @Override
    public boolean isValid(String value, ConstraintValidatorContext context) {
        // On the Web, failed validation results in an error, but for Messages, it produces a warning.
        // Message handling occurs elsewhere (in MaintainProviderEsbService at the time of this writing).
        if (FacesContext.getCurrentInstance() != null) {
            return new AcceptableCharacterValidator(INVALID_ADDRESS_CHARACTERS_PATTERN).valildate(value, context);
        } else {
            return true;
        }
    }

}
