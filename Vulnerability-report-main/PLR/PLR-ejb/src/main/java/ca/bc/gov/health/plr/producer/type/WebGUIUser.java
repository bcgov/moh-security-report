package ca.bc.gov.health.plr.producer.type;

import ca.bc.gov.health.login.UserPrincipal;
import ca.bc.gov.health.plr.ejb.entity.GrsRegistryUsers;
import ca.bc.gov.health.plr.ejb.session.GrsPartiesFacade;
import ca.bc.gov.health.plr.util.PlrRoleHelper;
import java.io.Serializable;
import javax.annotation.PostConstruct;
import javax.enterprise.context.SessionScoped;
import javax.inject.Inject;

/**
 *
 * @author Adebiyi.Kuseju
 */
@SessionScoped
public class WebGUIUser implements User, Serializable {

    @Inject
    @Authenticated
    private UserPrincipal userPrincipal;

    @Inject
    private GrsPartiesFacade grsPartiesFacade;

    private GrsRegistryUsers regUser;

    @PostConstruct
    public void init() {
        String org = userPrincipal.getProperty(PlrRoleHelper.organizationIdKey);
        regUser = grsPartiesFacade.findByOrganization(org).getGrsRegistryUsersList().get(0);
    }

    @Override
    public GrsRegistryUsers getUserEntity() {
        return regUser;
    }

    @Override
    public UserPrincipal getUserPrincipal() {
        return userPrincipal;
    }

    @Override
    public void setUserId(String orgId) {
        // Does nothing, only used in RmiUser impl
    }
    
    @Override
    public void resetUser() {
        // does nothing, only used in RmiUser for batch
    }

    @Override
    public String getUserId() {
        return userPrincipal != null ? userPrincipal.getProperty(PlrRoleHelper.organizationIdKey) : null;
    }

}
