/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.plr.dto.converter;

import ca.bc.gov.health.plr.dto.provider.ExpertiseDto;
import ca.bc.gov.health.plr.ejb.entity.GrsCtBooleanTypes;
import ca.bc.gov.health.plr.ejb.entity.GrsCtEndReasonTypes;
import ca.bc.gov.health.plr.ejb.entity.PrsCtDataOwnerCodes;
import ca.bc.gov.health.plr.ejb.entity.PrsCtProvExpertiseTypes;
import ca.bc.gov.health.plr.ejb.entity.PrsCtProviderRoleTypes;
import ca.bc.gov.health.plr.ejb.entity.PrsProviderExpertises;
import ca.bc.gov.health.plr.ejb.entity.util.DatabaseConstants;
import ca.bc.gov.health.plr.ejb.session.PrsProvidersFacade;
import ca.bc.gov.health.plr.persistence.CodeTableCodes;
import ca.bc.gov.health.plr.persistence.CodesDao;
import javax.ejb.EJB;
import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

/**
 *
 * @author Adebiyi.Kuseju
 */
@Stateless
public class ExpertiseDtoConverter {

    @PersistenceContext(unitName = "PLR-ejbPU")
    private EntityManager em;

    @EJB
    private PrsProvidersFacade prsProvidersFacade;
       
    @EJB
    private CodesDao codesDao;

    @EJB
    private DtoConverter dtoConverter;
    
    /**
     * Assemble Entity from transfer object
     *
     * @param dto - the transfer object to convert
     * @return - the entity representation of the transfer object
     */
    public PrsProviderExpertises toEntity(ExpertiseDto dto) {
        PrsProviderExpertises newEntity = new PrsProviderExpertises();
        if (dto.getDataOwnerCode() != null) {
            PrsCtDataOwnerCodes dataOwnerCode = codesDao.lookup(PrsCtDataOwnerCodes.class, dto.getDataOwnerCode());
            newEntity.setDataOwnerCode(dataOwnerCode);
        }

        if (dto.getPauthId() != null) {
            newEntity.setPauthPauthId(prsProvidersFacade.find(dto.getPauthId()));
        }
        
        if (dto.getTypeId()!= null) {
            newEntity.setProviderExpertiseTypeCode(codesDao.lookup(PrsCtProvExpertiseTypes.class, dto.getTypeId()));
        } else if (dto.getTypeCode()!= null) {
            newEntity.setProviderExpertiseTypeCode(codesDao.lookup(PrsCtProvExpertiseTypes.class, dto.getTypeCode()));
        }
        
        if (dto.getRoleTypeCode()!= null) {
            newEntity.setProvExpertiseRoleTypeCode(codesDao.lookup(PrsCtProviderRoleTypes.class, dto.getRoleTypeCode()));            
        } else {
            newEntity.setProvExpertiseRoleTypeCode(prsProvidersFacade.find(dto.getPauthId()).getHptCode());
        }
        
        if (dto.getId()!= null) {
            newEntity.setAs1Id(dto.getId());
        }
        //PLR-1067 : Setting the Sources Code
        if (dto.getSourcesCode() != null) {
            newEntity.setOriginalSourceProviderCode(dto.getSourcesCode());
        }
        
        dtoConverter.copyCommonProperties(dto, newEntity);
        
        return newEntity;

    }
}
