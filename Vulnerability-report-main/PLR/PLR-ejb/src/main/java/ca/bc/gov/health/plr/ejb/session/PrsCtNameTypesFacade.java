/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.plr.ejb.session;

import ca.bc.gov.health.plr.ejb.entity.PrsCtNameTypes;
import java.util.List;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;
import javax.annotation.PostConstruct;
import javax.ejb.Lock;
import javax.ejb.LockType;
import javax.ejb.Singleton;
import javax.ejb.Startup;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

/**
 * Class is implemented as a singleton to avoid excessive database calls as only a few name types
 * are expected to be available
 * 
 * @author david.sharpe
 */
@Singleton
@Startup
@Lock(LockType.READ)
public class PrsCtNameTypesFacade extends AbstractFacade<PrsCtNameTypes> {

    @PersistenceContext(unitName = "PLR-ejbPU")
    private EntityManager em;
    private final Map<String, PrsCtNameTypes> nameTypes = new ConcurrentHashMap<>();

    @Override
    protected EntityManager getEntityManager() {
        return em;
    }
    
    public PrsCtNameTypesFacade() {
        super(PrsCtNameTypes.class);
    }
    
    @PostConstruct
    public void init() {        
        List<PrsCtNameTypes> result = findAll();
        nameTypes.clear();
        for (PrsCtNameTypes nt : result) {
            nameTypes.put(nt.getCtlNameCode(), nt);
        }
    }
    
    @Lock(LockType.WRITE)
    public void reInitialize() {
        init();
    }
    
    public PrsCtNameTypes findNameType(String nameType) {
        return nameTypes.get(nameType);
    }
}
