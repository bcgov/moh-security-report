/*******************************************************/
$(document).ready(function(){						   
	
	// Initialization
	SetupMenus();                
	var winHeight = $(window).height();
	$('[placeholder]').placeholder();
		
	//******************************************
	// Home Page Banner Cycle
	//******************************************
	$('#rotating-banner').cycle({
		fx: 'fade',
		timeout: 8500,
		speed: 1000,
		cleartype: true,
		cleartypeNoBg: true,
		random: 0
	})
	
	//******************************************
	// Partner Logo Cycle
	//******************************************
	$('#partner-list').cycle({
		fx: 'fade',
		timeout: 8500,
		speed: 1000,
		cleartype: true,
		cleartypeNoBg: true,
		random: 0
	})
	

	//******************************************
	// Search Tabs
	//******************************************
	$('#search-tabs li').click(function(){		
		// Get LI position in list
		var position = $(this).index('#search-tabs li');
		// Edit LI and DIV classes
		$('#search-tabs li, .search-section').removeClass('active');
		$('#search-tabs li').eq(position).addClass('active');
		$('#search-sections').find('.search-section').eq(position).addClass('active');
		return false;
	});
	
	
	//******************************************
	// Immunization Page			
	//******************************************
	$('.immunization a').fancybox({
		helpers	: {
				overlay	: {
					opacity : 0.3,
					css : { 
						'background-color' : '#000'
					}
				}
			}
	});		
	
	//******************************************
	// Print Page			
	// Create iFrame
	//******************************************
	$('.pageOptions li.print a').fancybox({
		autoSize	: false,
		width		: 990,
		type		: 'html',
		content		: $('#content').clone().prepend('<img id="logo" src="/images/healthlinkBC-logo-print.png" />'),
		helpers		: {
			overlay	: {
				opacity : 0.3,
				css : { 
					'background-color' : '#000'
				}
			}
		}
	});	
	
	$('.fancybox-inner li.print').live('click', function(){
		parent.window.print();
		return false; 
	});
	
	$('.fancybox-inner a:not(li.print a)').live('click', function(e){
		 e.preventDefault();
	});


	//******************************************
	// Email a Friend Form
	// Build Form
	//******************************************
	$('.pageOptions li.email a').fancybox({
		width	: 435,
		scrolling : 'no',
		type 	: 'iframe',
		href	: '/assets/email-friend.asp?url=' + window.location,
		helpers	: {
			overlay	: {
				opacity : 0.3,
				css : { 
					'background-color' : '#000'
				}
			}
		}
	});
	
	//******************************************
	// Menu Active Trail - HLBC, Topics & Footer Menus
	//******************************************
	var pathname 	= window.location.pathname;
		pathname	= pathname.replace('.html', '/'); // Hack for IE
	var split_data	= pathname.split('/');	
	var path_first 	= split_data[1];
	var path_second	= split_data[2];
	var path_third 	= split_data[3];
	var path_fourth	= split_data[4];
			
	// Add current class to first level, hlbc_menu.inc
	if( split_data.length >= 3 ){
		$('.subthemes .horizontalMenu a[href*="/' + path_first + '"]')
			.parent('li')
			.addClass('current');
	}
	
	// Add current class to second level, topic_menu_*.inc
	if( split_data.length >= 4 ){
		$('.topics .horizontalMenu a[href*="/' + path_second + '"]')
			.parent('li')
			.addClass('current');
	}
	
	// Add current class to third level, 
	if( split_data.length >= 5 ){
		$('.navigationColumn ul.inPageNavigation > li > a[href*="/' + path_third + '"]')
			.parent('li')
			.addClass('current');
	}
	
	// Add current class to fourth level,
	// If Need to go more than 4,  need to address the possibility of
	// having the path names match and adding current to multiple li's
	if( split_data.length >= 6 ){
		$('.navigationColumn ul.inPageNavigation ul > li > a[href*="/' + path_fourth + '.html"]')
			.parent('li')
			.addClass('current');
	}

	
	//******************************************
	// Breadcrumb Generator
	//******************************************
	var parent_breadcrumb	= '';
	var topic_breadcrumb 	= '';
	var inpage_breadcrumb	= '';
	var inpage2_breadcrumb	= '';
	
	if( $('#breadcrumbs').hasClass('custom') ){
		return false;
	}else{
		// if in the dietitian section - Hardcoded menu and breadcrumb
		if (path_first === 'dietitian') {
			var title 	= $(this).find('#content h1').text();
			var pageURL = window.location; 
			
			// Breadcrumb
			$('#breadcrumbs').html('<a href="/">HealthLinkBC Home</a> &#0187 <a href="/healthyliving">Healthy  Living</a> &#0187 <a href="/healthyliving/healthyeating">Healthy Eating</a> &#0187 <a href="'+pageURL+'">' + title + '</a>');
			
			// Active Trail Menu
			$('.subthemes .horizontalMenu a[href*="/healthyliving"]').parent('li').addClass('current');
			$('.topics .horizontalMenu a[href="/healthyliving/healthyeating"]').parent('li').addClass('current');		
		
		}else 
		
		// if in the KB section - Hardcoded menu and breadcrumb
		if (path_first === 'kb') {
			var title = $('h1#HwContentTitle').text();
			if(path_second === 'list') {
				title = 'Search Topics'
			}	
			var pageURL 	= window.location; 
			if(split_data.length < 6 ){
				$('#breadcrumbs').html('<a href="/">HealthLinkBC Home</a>');
			} else {
				$('#breadcrumbs').html('<a href="/">HealthLinkBC Home</a> &#0187 <a href="'+pageURL+'">' + title + '</a>');
			}
			
		} else {
			// First Level
			if($('#navigation .subthemes .horizontalMenu li.current').length != 0){
				var parent_item = $('#navigation .subthemes .horizontalMenu li.current').html();
				var parent_text = $.trim($(parent_item).text());
				var parent_link = $(parent_item).attr('href');
					parent_breadcrumb = '<a href="/">HealthLinkBC Home</a> &#0187 ' + '<a href="' + parent_link + '">' + parent_text + '</a>';
			}else{
				parent_breadcrumb = '<a href="/">HealthLinkBC Home</a>';
			}
			
			// Second Level
			if($('#navigation .topics .horizontalMenu li.current').length != 0){
				var topic_item 	= $('#navigation .topics .horizontalMenu li.current').html();
				var topic_text = $.trim($(topic_item).text());
				var topic_link = $(topic_item).attr('href');
					topic_breadcrumb = ' &#0187 <a href="' + topic_link + '">' + topic_text + '</a>';
			}
			
			// Third Level
			if($('.inPageNavigation > li.current').length != 0){
				var inpage_text = $('.inPageNavigation > li.current > a').html();
				var inpage_link = $('.inPageNavigation > li.current > a').attr('href');
					inpage_breadcrumb = ' &#0187 <a href="' + inpage_link + '">' + inpage_text + '</a>';
			}
			
			// Fourth Level
			if($('.inPageNavigation li.current li.current').length != 0){
				var inpage2_text = $('.inPageNavigation li.current li.current').html();
				var inpage2_link = $('.inPageNavigation li.current li.current').attr('href');
					inpage2_breadcrumb = ' &#0187 <a href="' + inpage2_link + '">' + inpage2_text + '</a>';
			}
			
			$('#breadcrumbs').html(parent_breadcrumb + topic_breadcrumb + inpage_breadcrumb + inpage2_breadcrumb);
		} 
	}
	
	//******************************************
	// Font Sizer  //
	//******************************************
	$('#sizer').font_sizer({ 
		applyTo: '#content', 
		changesmall: 0.2, 
		changelarge: 0.2, 
		expire: 30
	});

	//******************************************
	// Search By Letter - A-Z Search Results
	//******************************************
	
	$('#a-z-search-list li a').live('click', function(){		
		var page_href = $(this).attr('href');		
		show_search_content(page_href)
		$(this).addClass('active');
		return false;
	});
	
	// On Load, get hash and open correct Letter
	if (window.location.hash != ''){
		var hash = window.location.hash;
			hash = hash.replace('#', '');
		
		if(path_first == 'servicesresources'){
			show_healthfileBC_content(hash);
		}else if( path_first == 'medicaltests' || path_first == 'medications' || path_first == 'healthtopics') {
			show_search_content(hash);
		}
		
		// Get Link, add Cclass active
		$('#a-z-search-list a[href$="' + hash + '"]').addClass('active');	
	};
	
	// Health Files BC
	$('#a-z-search-list.healthfiles li a').live('click', function(){		
		var page_href = $(this).attr('href');		
		show_healthfileBC_content(page_href);
		return false;
	});
			
	
}); 

// Load Letter Index into Search Results Div
function show_search_content(url){
	$('#search-results').load(url + ' .HwContent', function(){
		$(this).wrapInner('<div/>');
		var newheight = $('div:first',this).height();
		$(this).animate({height: newheight}, 0);
		$('#search-results .HwListSection li a').each(function(){

			var path = $(this).attr('href');
			var new_path = path.replace('../../../', '/kb/');
			$(this).attr('href', new_path);

			if(jQuery.browser.msie && jQuery.browser.version.substring(0, 1) == 7){
				var href_string = $(this).attr('href').split('/');
				//alert(href_string[6]);
				var new_href = '/kb/' + href_string[3] + '/' + href_string[4] + '/' + href_string[5];
				$(this).attr({'href': new_href});
			}
						
		});
	});

	// Set New HASH
	window.location.hash = url;
	$('#a-z-search-list li a').removeClass('active');
	
	$(window).scrollTop($('#a-z-search-list').offset().top-50);

};

// Load HealthFiles BC into Search Results Div
function show_healthfileBC_content(url){
	//$('#search-results').animate({height: 0}, 200);
	$('#search-results').load(url + ' #toc', function(){
		$(this).wrapInner('<div/>');
		var newheight = $('div:first',this).height();
		$(this).animate({height: newheight}, 0);
	});
	
	// Set New HASH
	window.location.hash = url;	
};