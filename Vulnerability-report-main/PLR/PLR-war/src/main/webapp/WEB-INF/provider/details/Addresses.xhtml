<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:custom="http://java.sun.com/jsf/composite/custom">
    <p:panel id="addressesPanel" header="Addresses">
        <h:panelGrid styleClass="recordDetailsPanels">
            <ui:include src="/WEB-INF/fragments/noresult.xhtml">
                <ui:param name="text" value="addresses"/>
                <ui:param name="field" value="addresses"/>
                <ui:param name="records" value="#{viewProviderManager.providerDetails.addresses}"/>
                <ui:param name="result" value="#{viewProviderManager.providerDetails}"/>
            </ui:include>

            <ui:repeat var="address" value="#{viewProviderManager.providerDetails.addresses}">
                <p:panel id="addressPanel" header="#{address.addressLineOne} #{address.city}, #{address.provinceOrStateTxt} (#{address.type}) (#{address.communicationPurpose}) (#{address.dataOwnerCode})" toggleTitle="Expand/Collapse" toggleable="true" collapsed="#{viewProviderManager.collapsed}" >

                    <h:panelGrid columns="2" cellpadding="2">
                        <h:outputLabel value="Validation Status:" rendered="#{address.validationStatus != null or address.validationStatus.length() > 0}"/><h:outputText value="#{address.validationStatusDesc} (#{address.validationStatus})" rendered="#{address.validationStatus != null or address.validationStatus.length() > 0}"/>
                        <h:outputLabel value="Address Type:"/><h:outputText value="#{address.type} (#{address.typeCode})"/>
                        <h:outputLabel value="Address Purpose:"/><h:outputText value="#{address.communicationPurpose} (#{address.communicationPurposeCode})"/>
                        <h:outputLabel value="Address Line 1:"/><h:outputText value="#{address.addressLineOne}"/>
                        <h:outputLabel value="Address Line 2:"/><h:outputText value="#{address.addressLineTwo}"/>
                        <h:outputLabel value="Address Line 3:"/><h:outputText value="#{address.addressLineThree}"/>
                        <h:outputLabel value="City:"/><h:outputText value="#{address.city}"/>
                        <h:outputLabel value="State/Prov:"/><h:outputText value="#{address.provinceOrStateTxt}"/>
                        <h:outputLabel value="Postal/Zip Code:"/><h:outputText value="#{address.postalCode}"/>
                        <h:outputLabel value="Country:"/><h:outputText value="#{address.country} (#{address.countryCode})"/>
                        <h:outputLabel value="Effective From:"/><h:outputText value="#{jsfUtils.formatDate(address.effectiveStartDate)}"/>
                        <h:outputLabel value="Effective To:"/><h:outputText value="#{jsfUtils.formatDate(address.effectiveEndDate)}"/>
                        <h:outputLabel value="End Reason:"/><h:outputText value="#{address.endReasonCode}"/>
                        <h:outputLabel value="Data Source:"/><h:outputText value="#{address.userChid}"/>
                        <h:outputLabel value="DB Created:"/><h:outputText value="#{jsfUtils.formatDate(address.createdDate)}"/>
                        <h:outputLabel value="DB Expired:"/><h:outputText value="#{jsfUtils.formatDate(address.invalidatedDate)}"/>
                        <h:outputLabel value="Data Owner Code:"/><h:outputText value="#{address.dataOwnerCode}"/>
                    </h:panelGrid>

                    <f:facet name="actions" > 
                        <h:panelGroup styleClass="rightAlign">
                            <custom:activeIcon rendered="#{address.displayActive}" />
                            <p:commandLink id="updateAddressLink" rendered="#{address.updatable and not viewProviderManager.userRoleService.consumer}" oncomplete="PF('maintainAddressModal').show()" update=":maintainAddressDialog, :addressesPanel, :addrValidDlgId, :addrInvalidNoCorrectionsDlgId">
                                <custom:updateIcon title="Update #{address.type}" />
                                <f:setPropertyActionListener value="#{viewProviderManager.providerDetails.pauthId}" target="#{maintainAddressManager.pauthId}" />
                                <f:setPropertyActionListener value="#{address}" target="#{maintainAddressManager.addressDto}" />
                                <f:setPropertyActionListener value="#{viewProviderManager.providerDetailsCopy}" target="#{maintainAddressManager.providerDetails}" />
                                <f:setPropertyActionListener value="#{viewProviderManager.providerDetailsCopy.addresses}" target="#{maintainAddressManager.addresses}" />
                                <f:setPropertyActionListener value=":addressesPanel" target="#{maintainAddressManager.panelToUpdate}" />                                 
                                <f:actionListener binding="#{addressSupportManager.initProvinceDropdownOnDialogOpen(address.countryId)}" />
                                <p:resetInput target=":maintainAddressForm" />
                            </p:commandLink>
                        </h:panelGroup>
                    </f:facet>

                </p:panel>
            </ui:repeat>
        </h:panelGrid>

        <f:facet name="actions" >
            <p:commandLink id="createAddressLink" process="@this" update=":maintainAddressDialog, :addressesPanel, :addrValidDlgId, :addrInvalidNoCorrectionsDlgId" oncomplete="PF('maintainAddressModal').show()" rendered="#{not viewProviderManager.userRoleService.consumer}">
                <f:actionListener binding="#{maintainAddressManager.init()}"/>
                <f:actionListener binding="#{addressSupportManager.init()}"/>
                <custom:addIcon title="Add a new Address" />
                <f:setPropertyActionListener value="#{viewProviderManager.providerDetails.pauthId}" target="#{maintainAddressManager.pauthId}" />
                <f:setPropertyActionListener value="#{viewProviderManager.providerDetailsCopy}" target="#{maintainAddressManager.providerDetails}" />
                <f:setPropertyActionListener value="#{viewProviderManager.providerDetailsCopy.addresses}" target="#{maintainAddressManager.addresses}" />
                <f:setPropertyActionListener value=":addressesPanel" target="#{maintainAddressManager.panelToUpdate}" /> 
                <p:resetInput target=":maintainAddressForm" />
            </p:commandLink>
        </f:facet>
    </p:panel>

</ui:composition>