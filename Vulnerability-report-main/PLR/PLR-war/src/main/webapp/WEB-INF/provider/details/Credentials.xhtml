<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:custom="http://java.sun.com/jsf/composite/custom">
    <p:panel id="credentialsPanel" header="Credentials" >
        <h:panelGrid styleClass="recordDetailsPanels">
            <ui:include src="/WEB-INF/fragments/noresult.xhtml">
                <ui:param name="text" value="credentials"/>
                <ui:param name="field" value="credentials"/>
                <ui:param name="records" value="#{viewProviderManager.providerDetails.credentials}"/>
                <ui:param name="result" value="#{viewProviderManager.providerDetails}"/>
            </ui:include>
            
            <ui:repeat var="credential" value="#{viewProviderManager.providerDetails.credentials}">
                <p:panel id="credentialPanel" header="#{credential.designation}, #{credential.grantingInstitution} (#{credential.dataOwnerCode})" toggleTitle="Expand/Collapse" toggleable="true" collapsed="#{viewProviderManager.collapsed}">
                    <h:panelGrid columns="2" cellpadding="2">
                        <h:outputLabel value="Credential Type:"/><h:outputText value="#{credential.type} (#{credential.typeCode})"/>
                        <h:outputLabel value="Designation:"/><h:outputText value="#{credential.designation}"/>
                        <h:outputLabel value="Registration Number:"/><h:outputText value="#{credential.registrationNumber}"/>
                        <h:outputLabel value="Granting Institution:"/><h:outputText value="#{credential.grantingInstitution}"/>
                        <h:outputLabel value="Institution City:"/><h:outputText value="#{credential.institutionCity}"/>
                        <h:outputLabel value="Institution Prov/State:"/><h:outputText value="#{credential.institutionProvState} (#{credential.institutionProvStateCode})"/>
                        <h:outputLabel value="Institution Country:"/><h:outputText value="#{credential.institutionCountry} (#{credential.institutionCountryCode})"/>
                        <h:outputLabel value="Year Issued:"/><h:outputText value="#{credential.yearIssued}"/>
                        <h:outputLabel value="Equivalency Flag:"/><h:outputText value="#{credential.equivalencyFlag ? 'Yes' : 'No'}"/>
                        <h:outputLabel value="Effective From:"/><h:outputText value="#{jsfUtils.formatDate(credential.effectiveStartDate)}"/>
                        <h:outputLabel value="Effective To:"/><h:outputText value="#{jsfUtils.formatDate(credential.effectiveEndDate)}"/>
                        <h:outputLabel value="End Reason:"/><h:outputText value="#{credential.endReasonCode}"/>
                        <h:outputLabel value="Data Source:"/><h:outputText value="#{credential.userChid}"/>
                        <h:outputLabel value="DB Created:"/><h:outputText value="#{jsfUtils.formatDate(credential.createdDate)}"/>
                        <h:outputLabel value="DB Expired:"/><h:outputText value="#{jsfUtils.formatDate(credential.invalidatedDate)}"/>
                        <h:outputLabel value="Data Owner Code:"/><h:outputText value="#{credential.dataOwnerCode}"/>
                    </h:panelGrid>

                    <f:facet name="actions" >
                        <h:panelGroup styleClass="rightAlign">
                            <custom:activeIcon rendered="#{credential.displayActive}" />
                            <p:commandLink action="#{addressSupportManager.refreshDropDownsGroup1(credential.institutionCountryId)}" id="updateCredentialLink" rendered="#{credential.updatable and not viewProviderManager.userRoleService.consumer}" oncomplete="PF('maintainCredentialModal').show()" update=":maintainCredentialDialog">
                                <custom:updateIcon title="Update #{credential.designation}" />
                                <f:setPropertyActionListener value="#{viewProviderManager.providerDetails.pauthId}" target="#{maintainCredentialsManager.pauthId}" />
                                <f:setPropertyActionListener value="#{credential}" target="#{maintainCredentialsManager.credentialsDto}" />
                                <f:setPropertyActionListener value="#{viewProviderManager.providerDetails.typeId}" target="#{maintainCredentialsManager.providerTypeId}" />
                                <f:setPropertyActionListener value="#{viewProviderManager.providerDetailsCopy.credentials}" target="#{maintainCredentialsManager.credentials}" />
                                <f:actionListener binding="#{maintainCredentialsManager.refreshDropDowns()}" />
                                <p:resetInput target=":maintainCredentialForm" />
                            </p:commandLink>
                        </h:panelGroup>
                    </f:facet>
                </p:panel>
            </ui:repeat>
        </h:panelGrid>        
        <f:facet name="actions" >
            <p:commandLink process="@this" actionListener="#{maintainCredentialsManager.init}" update=":maintainCredentialDialog" oncomplete="PF('maintainCredentialModal').show()" rendered="#{not viewProviderManager.userRoleService.consumer}">
                <custom:addIcon title="Add a new Credential" />
                <p:resetInput target=":maintainCredentialForm" />
                <f:setPropertyActionListener value="#{viewProviderManager.providerDetails.pauthId}" target="#{maintainCredentialsManager.pauthId}" />
                <f:setPropertyActionListener value="#{viewProviderManager.providerDetails.typeId}" target="#{maintainCredentialsManager.providerTypeId}" />
                <f:setPropertyActionListener value="#{viewProviderManager.providerDetailsCopy.credentials}" target="#{maintainCredentialsManager.credentials}" />
                <f:actionListener binding="#{addressSupportManager.refreshDropDownsGroup1(maintainCredentialsManager.credentialsDto.institutionCountryId)}" />
            </p:commandLink>
        </f:facet>
    </p:panel>         
</ui:composition>