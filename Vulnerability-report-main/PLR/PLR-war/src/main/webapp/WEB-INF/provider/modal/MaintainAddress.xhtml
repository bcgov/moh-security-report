<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    >
    <p:dialog id="addrValidDlgId" widgetVar="addrValidDlg" header="Address Validation Status:" visible="false" modal="true" dynamic="true" closable="false">     
<!--        <p:messages id="msgAddrWarnId" showDetail="false" closable="true" >
            <p:autoUpdate disabled="false"/>
        </p:messages>-->
        <p:staticMessage severity="warn" summary="" detail="PRS.SYS.ADR.UNK.1.0.7046: The Address is not valid per Canada Post standards." />
<!--        <p:staticMessage severity="warn" summary="" detail="#{val.error.cease.address.invalid}" />-->
        <p:panelGrid columns="2">
            <p:panel header="Address Provided:" >
            <p:panelGrid columns="2">
                <h:outputText value="Address Line 1:" />
                <h:outputText value="#{maintainAddressManager.addressDto.addressLineOne}" />

                <h:outputText value="Address Line 2:" />
                <h:outputText value="#{maintainAddressManager.addressDto.addressLineTwo}" />

                <h:outputText value="Address Line 3:" />
                <h:outputText value="#{maintainAddressManager.addressDto.addressLineThree}" />

                <h:outputText value="City:" />
                <h:outputText value="#{maintainAddressManager.addressDto.city}" />

                <h:outputText value="Province / State:" />
                <h:outputText value="#{maintainAddressManager.addressDto.provinceOrStateTxt}" />

                <h:outputText value="Country:" />
                <h:outputText value="#{maintainAddressManager.addressDto.country}" />

                <h:outputText value="Postal Code / Zip Code:" />
                <h:outputText value="#{maintainAddressManager.addressDto.postalCode}" />
            </p:panelGrid>
            </p:panel>
            <p:panel header="Address Recommended:" >
            <p:panelGrid columns="2">
                <h:outputText value="Address Line 1:" />
                <h:outputText value="#{maintainAddressManager.recommendedAddress.addressLineOne}" />

                <h:outputText value="Address Line 2:" />
                <h:outputText value="#{maintainAddressManager.recommendedAddress.addressLineTwo}" />

                <h:outputText value="Address Line 3:" />
                <h:outputText value="#{maintainAddressManager.recommendedAddress.addressLineThree}" />

                <h:outputText value="City:" />
                <h:outputText value="#{maintainAddressManager.recommendedAddress.city}" />

                <h:outputText value="Province / State:" />
                <h:outputText value="#{maintainAddressManager.recommendedAddress.provinceOrStateTxt}" />

                <h:outputText value="Country:" />
                <h:outputText value="#{maintainAddressManager.addressDto.country}" />

                <h:outputText value="Postal Code / Zip Code:" />
                <h:outputText value="#{maintainAddressManager.recommendedAddress.postalCode}" />
            </p:panelGrid>
            </p:panel>
        </p:panelGrid><br></br>
        <p:commandButton value="Continue w/ Original" action="#{maintainAddressManager.saveInvalid(true)}" update=":maintainAddressForm, #{maintainAddressManager.panelToUpdate}, :modalMessages" onclick="PF('addrValidDlg').hide();" oncomplete="if (args &amp;&amp; !args.validationFailed) PF('maintainAddressModal').hide(); return false;" />
        <p:commandButton value="Continue w/ Recommended" action="#{maintainAddressManager.useADAddress}" onclick="PF('addrValidDlg').hide();" process="@this" update=":maintainAddressForm, #{maintainAddressManager.panelToUpdate}, :modalMessages" oncomplete="if (args &amp;&amp; !args.validationFailed) PF('maintainAddressModal').hide(); return false;" />
        <p:commandButton value="Cancel" action="#{maintainAddressManager.cancelDialog}" process="@this" update=":maintainAddressForm, #{maintainAddressManager.panelToUpdate}" onclick="PF('addrValidDlg').hide();"/>
    </p:dialog>
    <p:dialog id="addrValidationUnkownDlgId" widgetVar="addrValidationUnkownDlg" header="Address Validation Status Unknown:" visible="false" closable="false">     
        <p:messages id="adrUnkMessages" showDetail="false" closable="true" >
            <p:autoUpdate disabled="false"/>
        </p:messages>
        <p:commandButton value="Continue w/ Original" action="#{maintainAddressManager.saveInvalid(true)}" update=":maintainAddressForm, #{maintainAddressManager.panelToUpdate}, :modalMessages"  onclick="PF('addrValidationUnkownDlg').hide();" oncomplete="if (args &amp;&amp; !args.validationFailed) PF('maintainAddressModal').hide(); return false;" />
        <p:commandButton value="Cancel" action="#{maintainAddressManager.cancelDialog}" process="@this" update=":maintainAddressForm, #{maintainAddressManager.panelToUpdate}" onclick="PF('addrValidationUnkownDlg').hide();"/>
    </p:dialog>
    <p:dialog id="addrInvalidNoCorrectionsDlgId" widgetVar="addrInvalidNoCorrectionsDlg"  header="Address Invalid, No Corrections Available:" visible="false" modal="true" dynamic="true" closable="false">     
        <p:staticMessage severity="warn" summary="" detail="PRS.SYS.ADR.UNK.1.0.7046: The Address is not valid per Canada Post standards." />
        <p:messages id="addrInvalidMessages" showDetail="false" closable="true">
            <p:autoUpdate disabled="false"/>
        </p:messages>
            <p:panel header="Address Provided:" >
            <p:panelGrid columns="2">
                <h:outputText value="Address Line 1:" />
                <h:outputText value="#{maintainAddressManager.addressDto.addressLineOne}" />

                <h:outputText value="Address Line 2:" />
                <h:outputText value="#{maintainAddressManager.addressDto.addressLineTwo}" />

                <h:outputText value="Address Line 3:" />
                <h:outputText value="#{maintainAddressManager.addressDto.addressLineThree}" />

                <h:outputText value="City:" />
                <h:outputText value="#{maintainAddressManager.addressDto.city}" />

                <h:outputText value="Province / State:" />
                <h:outputText value="#{maintainAddressManager.addressDto.provinceOrStateTxt}" />

                <h:outputText value="Country:" />
                <h:outputText value="#{maintainAddressManager.addressDto.country}" />

                <h:outputText value="Postal Code / Zip Code:" />
                <h:outputText value="#{maintainAddressManager.addressDto.postalCode}" />
            </p:panelGrid>
            </p:panel><br></br>
        <p:commandButton value="Continue w/ Original" action="#{maintainAddressManager.saveInvalid(true)}" update=":maintainAddressForm, #{maintainAddressManager.panelToUpdate}, :modalMessages" onclick="PF('addrInvalidNoCorrectionsDlg').hide();" oncomplete="if (args &amp;&amp; !args.validationFailed) PF('maintainAddressModal').hide(); return false;" />
        <p:commandButton value="Cancel" action="#{maintainAddressManager.cancelDialog}" process="@this" update=":maintainAddressForm, #{maintainAddressManager.panelToUpdate}" onclick="PF('addrInvalidNoCorrectionsDlg').hide();"/>
    </p:dialog>    
    <p:dialog id="maintainAddressDialog" 
              header="#{maintainAddressManager.addressDto.new ? 'Add' : 'Update'} Address"
              widgetVar="maintainAddressModal" modal="true" draggable="false" 
              closeOnEscape="true" resizable="false" fitViewport="true" width="475" height="755">
        <h:form id="maintainAddressForm">
		
            <p:messages id="messages" showDetail="false" closable="true">
                <p:autoUpdate disabled="false"/>
            </p:messages>

            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="Address Type"/>
                <ui:param name="for" value="addressType"/>
            </ui:include>
            
            <ui:include src="/WEB-INF/fragments/type.xhtml">
                <ui:param name="isNew" value="#{maintainAddressManager.addressDto.new}"/>
                <ui:param name="id" value="addressType"/>
                <ui:param name="value" value="#{maintainAddressManager.addressDto.typeId}"/>
                <ui:param name="selectValues" value="#{Droplists.prsCtAddressTypes}"/>
            </ui:include> 
            
            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="Purpose"/>
                <ui:param name="for" value="addressPurpose"/>
            </ui:include>
            <ui:include src="/WEB-INF/fragments/type.xhtml">
                <ui:param name="isNew" value="#{maintainAddressManager.addressDto.new}"/>
                <ui:param name="id" value="addressPurpose"/>
                <ui:param name="value" value="#{maintainAddressManager.addressDto.communicationPurposeId}"/>
                <ui:param name="selectValues" value="#{Droplists.prsCtCommunPurposeTypesFilterByEc}"/>
            </ui:include> 

            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="Address Auto Complete"/>
                <ui:param name="for" value="autoComplete"/>
                <ui:param name="tip2a" value="Address Auto Complete attempts to suggest valid Canadian addresses based on the input you provide."/>
                <ui:param name="tip2b" value="Click on an address from the resulting list to automatically fill the address fields below."/>
		<ui:param name="tip2c" value="PO Box and RR Addresses should include the correct City, City and Province or Postal Code for better results."/>
            </ui:include>
            <p:autoComplete value="#{maintainAddressManager.addressAutoComplete}" id="autoComplete" queryDelay="#{maintainAddressManager.configurationDao.addressSuggestionsUIDelay}" inputStyle="width: 175%" autocomplete="off"
                            completeMethod="#{maintainAddressManager.suggestAddresses}" maxResults="#{maintainAddressManager.autocompleteMaxResults}"
                            emptyMessage="#{maintainAddressManager.suggestedAddressesIsNotNullButEmpty ? 'No results' : 'Searching ... if nothing returns try typing more of the address.'}" >
                <p:ajax event="itemSelect" listener="#{maintainAddressManager.onAutoCompleteSelection}" 
                        update="autoComplete,addressLine1,addressLine2,addressLine3,city,country,province_fragment,postalCode,addressCountrySubmit_fragment"/>
            </p:autoComplete>
            <p:watermark value="Type here for quick address suggestions..." for="autoComplete" />
            
            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="Address Line 1"/>
                <ui:param name="for" value="addressLine1"/>
                <ui:param name="tip" value="Address Lines must only contain spaces, &amp;, ', -, ., numbers, and the English alphabet."/>
            </ui:include>
            <p:inputText value="#{maintainAddressManager.addressDto.addressLineOne}" id="addressLine1" required="true" styleClass="zeroMargin"/>

            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="Address Line 2"/>
                <ui:param name="for" value="addressLine2"/>
                <ui:param name="tip" value="Address Lines must only contain spaces, &amp;, ', -, ., numbers, and the English alphabet."/>
            </ui:include>
            <p:inputText value="#{maintainAddressManager.addressDto.addressLineTwo}" id="addressLine2" styleClass="zeroMargin"/>
            
            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="Address Line 3"/>
                <ui:param name="for" value="addressLine3"/>
                <ui:param name="tip" value="Address Lines must only contain spaces, &amp;, ', -, ., numbers, and the English alphabet."/>
            </ui:include>
            <p:inputText value="#{maintainAddressManager.addressDto.addressLineThree}" id="addressLine3" styleClass="zeroMargin"/>

            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="City"/>
                <ui:param name="for" value="city"/>
                <ui:param name="tip" value="Address City must only contain spaces, &amp;, ', -, ., numbers, and the English alphabet."/>
            </ui:include>
            <p:autoComplete id="city" 
                            value="#{maintainAddressManager.addressDto.city}" 
                            required="true"
                            completeMethod="#{addressSupportManager.suggestCityName}" 
                            effect="fade" />

            <p:fragment id="province_fragment">                
                <ui:include src="/WEB-INF/fragments/label.xhtml">
                    <ui:param name="text" value="Province / State"/>
                    <ui:param name="for" value="province_address"/>
                </ui:include>
                <p:inputText id="province_txt" rendered="#{!addressSupportManager.showProvinceDropDown(maintainAddressManager.addressDto.countryId)}"
                             value="#{maintainAddressManager.addressDto.provinceOrStateTxt}" 
                             label="Province / State" />
                <p:selectOneMenu id="province_address" value="#{maintainAddressManager.addressDto.provinceOrStateTxt}"
                                 rendered="#{addressSupportManager.showProvinceDropDown(maintainAddressManager.addressDto.countryId)}">
                    <f:selectItems value="#{maintainAddressManager.addressProvinceSelectItems}"/>
                </p:selectOneMenu>
            </p:fragment>
            
            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="Country"/>
                <ui:param name="for" value="country"/>
            </ui:include>
            <p:selectOneMenu id="country" value="#{maintainAddressManager.addressDto.countryId}" required="true">
                <f:selectItems value="#{addressSupportManager.countrySelectItemsOrderedByName}"/>
                <p:ajax listener="#{maintainAddressManager.addressCountryChanged(maintainAddressManager.addressDto.countryId)}" update="province_fragment,addressCountrySubmit_fragment,addrInvalidNoCorrectionsDlgId" />
            </p:selectOneMenu>
            
            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="Postal Code / Zip Code"/>
                <ui:param name="for" value="postalCode"/>
                <ui:param name="tip" value="Postal Code must only contain spaces, &amp;, ', -, ., numbers, and the English alphabet."/>
            </ui:include>
            <p:inputText value="#{maintainAddressManager.addressDto.postalCode}" id="postalCode" styleClass="zeroMargin"
                         validator="postalCodeValidator">
                <f:attribute name="countryId" value="#{maintainAddressManager.addressDto.countryId}" />
            </p:inputText>

            <ui:fragment rendered="#{!maintainAddressManager.addressDto.new}">
                <ui:include src="/WEB-INF/fragments/label.xhtml">
                    <ui:param name="text" value="End Reason"/>
                    <ui:param name="for" value="EndReasonType"/>
                </ui:include>
                <p:selectOneMenu id="EndReasonType" value="#{maintainAddressManager.addressDto.endReasonCodeId}" required="true">
                    <f:selectItems value="#{Droplists.grsCtEndReasonTypes}" />
                </p:selectOneMenu>
            </ui:fragment>

            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="Effective From"/>
                <ui:param name="for" value="effectiveFromDate"/>
            </ui:include>
            <p:calendar id="effectiveFromDate" value="#{maintainAddressManager.addressDto.effectiveStartDate}" required="true" showOn="button" navigator="true" size="11" pattern="dd-MMM-yyyy" styleClass="zeroMargin"/>
            <p:watermark value="1980-06-30" for="effectiveFromDate"/>

            <ui:include src="/WEB-INF/fragments/label.xhtml">
                <ui:param name="text" value="Effective To"/>
                <ui:param name="for" value="effectiveToDate"/>
            </ui:include>
            <p:calendar id="effectiveToDate" value="#{maintainAddressManager.addressDto.effectiveEndDate}" required="false" showOn="button" navigator="true" size="11" pattern="dd-MMM-yyyy"  styleClass="zeroMargin"/>
            <p:watermark value="1980-06-30" for="effectiveToDate"/>
            
            <div class="formControls" id="outer-div">   
                <div id="inner-div">
                <p:fragment id="addressCountrySubmit_fragment" >
                    <p:commandButton id="idAddressSubmitButton"
                                     process="@form"
                                     rendered="#{addressSupportManager.showProvinceDropDown(maintainAddressManager.addressDto.countryId)}" 
                                     value="#{maintainAddressManager.addressDto.new ? 'Create' : 'Update'}" 
                                     actionListener="#{maintainAddressManager.validateForSave(true)}" 
                                     update=":maintainAddressForm, #{maintainAddressManager.panelToUpdate}, :modalMessages, :addrInvalidNoCorrectionsDlgId" />
                    <p:commandButton id="idAddressSubmitButtonNotCA"
                                     process="@form"
                                     rendered="#{!addressSupportManager.showProvinceDropDown(maintainAddressManager.addressDto.countryId)}" 
                                     value="#{maintainAddressManager.addressDto.new ? 'Create' : 'Update'}" 
                                     actionListener="#{maintainAddressManager.validateForSave(true)}" 
                                     update=":maintainAddressForm, #{maintainAddressManager.panelToUpdate}, :modalMessages, :addrInvalidNoCorrectionsDlgId" 
                                     oncomplete="if (args &amp;&amp; !args.validationFailed) PF('maintainAddressModal').hide();" />
                </p:fragment>
                <p:ajaxStatus style="display:inline-block;">
                    <f:facet name="start"><h:graphicImage value="/resources/Spinner.gif"/></f:facet>
                    <f:facet name="complete"><h:outputText value="" /></f:facet>                     
                </p:ajaxStatus>
                <a href="#" onclick="PF('maintainAddressModal').hide();
                        return false;">Cancel</a>
                </div>
            </div>
        </h:form>
    </p:dialog> 
</ui:composition>