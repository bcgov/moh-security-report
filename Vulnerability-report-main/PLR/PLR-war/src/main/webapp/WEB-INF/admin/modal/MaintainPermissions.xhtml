<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    >
    <h:body>
    <p:dialog id="maintainPermissionDialog" 
              header="#{maintainPermissionsManager.dpsDto.groupChid}"
              widgetVar="maintainPermissionModal" modal="true" draggable="false" 
              closeOnEscape="true" onHide="confirmation.hide();" resizable="false" styleClass="no-mandatory-text dps-dialog" fitViewport="true" height="500">
        <!-- Dialog height set to 500 for PLR-1573. If dialog is changed, test that height is large enough to accommodate confirmation dialog. -->
        <h:form id="maintainPermissionForm">
		
			<p:messages id="messages" showDetail="false" closable="true" >
				<p:autoUpdate disabled="false"/>
			</p:messages>

            <p:outputLabel value="Data Object" for="dataObject"/>
            <p:selectOneMenu value="#{maintainPermissionsManager.selectedDataObject}" id="dataObject" style="vertical-align:middle;margin-left: 25px;">
                <f:selectItems value="#{Droplists.grsCtDataObjects}"/>
                <p:ajax listener="#{maintainPermissionsManager.populatePermissions()}" update="permTbl"/>
            </p:selectOneMenu>
            <p:commandButton process="@this" onclick="PF('confirmation').show()" 
                             style="vertical-align:middle;margin-left: 25px;" id="updateBtn"
                             update="permTbl" value="Update"
                             disabled="#{maintainPermissionsManager.changedPermissions.size() == 0 }">
            </p:commandButton>
            
            <p:confirmDialog  header="Are you sure?" severity="alert" widgetVar="confirmation" id="confirmationDialog"
                              showEffect="fade" hideEffect="fade" closeOnEscape="true"  styleClass="no-mandatory-text dps-confirm-dialog" >
                <f:facet name="message" > 
                    <h:outputText value="Are you sure that you would like to update the following fields : " />
                    <br /><br />
                    <p:dataList value="#{maintainPermissionsManager.changedPermissions}" var="changedPermission" 
                                id="dataList">
                        <h:outputText value="#{changedPermission.declCode} - 
                        Read (#{changedPermission.readFlag ? 'Checked' : 'Unchecked'} ), 
                        Write (#{changedPermission.updateFlag ? 'Checked' : 'Unchecked'} )" />
                    </p:dataList>
                 </f:facet>
                <p:commandButton value="Update" update="messages,permTbl,updateBtn" oncomplete="PF('confirmation').hide()" 
                            actionListener="#{maintainPermissionsManager.update()}" />
                <p:ajaxStatus style="display:inline-block">
                    <f:facet name="start"><h:graphicImage value="/resources/Spinner.gif"/></f:facet>
                    <f:facet name="complete"><h:outputText value="" /></f:facet>                     
                </p:ajaxStatus>
                <p:commandButton value="Cancel" onclick="PF('confirmation').hide()" type="button" />
            </p:confirmDialog>
            
            
            <a href="#" onclick="PF('maintainPermissionModal').hide();
                     return false;" style="vertical-align:middle;margin-left: 25px;">Close</a>

            <p:dataTable id="permTbl" var="result" value="#{maintainPermissionsManager.dataObjectPermissions}"  
                         rows="10" paginator="true" paginatorPosition="bottom" 
                         paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" 
                         rowsPerPageTemplate="5,10" style="padding-top: 50px; width: 700px;"
                         rowStyleClass="#{maintainPermissionsManager.changedPermissions.contains(result)?'highlight':''}">                
                <p:column styleClass="wrap" width="50%">
                    <f:facet name="header">
                        <h:outputText value=""/>
                    </f:facet>
                    <h:outputText value="#{result.declCode} " />
                </p:column>
                <p:column styleClass="wrap" width="25%">
                    <f:facet name="header">
                        <h:outputText value="Read"/>
                    </f:facet>
                    <p:selectBooleanCheckbox id="readFlag" value="#{result.readFlag}" >
                        <p:ajax update="permTbl" process="@this" listener="#{maintainPermissionsManager.addToChanges(result)}"
                                oncomplete="updateButton()" />
                    </p:selectBooleanCheckbox>
                </p:column>
                <p:column styleClass="wrap" width="25%">
                    <f:facet name="header">
                        <h:outputText value="Write"/>
                    </f:facet>
                    <p:selectBooleanCheckbox id="writeFlag" value="#{result.updateFlag}">
                        <p:ajax update="permTbl" process="@this" listener="#{maintainPermissionsManager.addToChanges(result)}"
                                oncomplete="updateButton()"/>
                    </p:selectBooleanCheckbox>
                </p:column>
            </p:dataTable>
            <p:remoteCommand name="updateButton" update="updateBtn,confirmationDialog" />
            <div class="formControls"> 

            </div>
            <h:outputStylesheet>
                .ui-datalist-content{
                    border : 0px !important;
                    font-size : 0.9em !important;
                }
                .ui-icon-alert{
                    display:none
                }
                .ui-datalist-data{
                    margin-left: 20px;                    
                }
                .ui-datalist-item{
                    list-style: circle;
                }
                .ui-widget-overlay{
                    z-index:0 !important;
                }
            </h:outputStylesheet>
        </h:form>
    </p:dialog> 
        </h:body>

</ui:composition>