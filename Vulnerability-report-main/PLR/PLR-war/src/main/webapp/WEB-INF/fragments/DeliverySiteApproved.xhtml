<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:richext="http://java.sun.com/jsf/composite/richext">  
    <p:panel>
        <f:facet name="header">
            <h:outputText value="#{msg['AddDeliverySite.site.location']}"/>
        </f:facet> 
        <table cellpadding="2" cellspacing="0">
            <!-- Display DS Id field only if we are updating an existing site or approving a pending request -->
            <tr>
                <td class="label">
                    <h:outputText id="dsId" value="#{msg['UpdateDeliverySite.site.location.ds.id']}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId ne null or PrsWorkLocationBean.action == 'existingRequest' or PrsWorkLocationBean.action == 'pendingRequest'}"/>
                </td>
                <td colspan="3">
                    <h:outputText id="identifierNo" value="#{PrsWorkLocationBean.prsWorkLocation.primaryId.identifierNo}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId ne null}"/>
                    <h:outputText id="identifierNoUnassigned" value="Unassigned" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId eq null and (PrsWorkLocationBean.action == 'existingRequest' or PrsWorkLocationBean.action == 'pendingRequest')}"/>
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['UpdateDeliverySite.site.location.status']}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId ne null and (PrsWorkLocationBean.action == 'existingRequest' or PrsWorkLocationBean.action == 'pendingRequest')}"/>
                </td>
                <td colspan="3">
                    <h:selectOneMenu id="status" value="#{PrsWorkLocationBean.prsWorkLocation.statusId.ctlId}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId ne null and (PrsWorkLocationBean.action == 'existingRequest' or PrsWorkLocationBean.action == 'pendingRequest')}" required="true" requiredMessage="Status is required." >
                        <f:selectItem itemValue="" itemLabel=""/>
                        <f:selectItems value="#{DsrDroplists.grsActiveInactiveStatuses}"/>
                    </h:selectOneMenu>
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.name']}"/>
                    <span class="required">*</span>
                </td>
                <td colspan="3">
                    <h:inputText id="siteName" value="#{PrsWorkLocationBean.prsWorkLocationDetails[0].workLocationNameTxt}" size="#{msg['textfield.larger.size']}" required="true" requiredMessage="Delivery Site name is required." />
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.addressLine1']}"/>
                    <span class="required">*</span>
                </td>
                <td colspan="3">
                    <h:inputText id="addressLine1" value="#{PrsWorkLocationBean.grsAddresses[0].addressLine1Txt}" size="#{msg['textfield.larger.size']}" required="true" requiredMessage="Address Line 1 is required." />
                </td>

            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.addressLine2']}"/>
                </td>
                <td colspan="3">
                    <h:inputText id="addressLine2" value="#{PrsWorkLocationBean.grsAddresses[0].addressLine2Txt}" size="#{msg['textfield.larger.size']}" />
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.addressLine3']}"/>
                </td>
                <td colspan="3">
                    <h:inputText id="addressLine3" value="#{PrsWorkLocationBean.grsAddresses[0].addressLine3Txt}" size="#{msg['textfield.larger.size']}" />
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.addressLine4']}"/>
                </td>
                <td colspan="3">
                    <h:inputText id="addressLine4" value="#{PrsWorkLocationBean.grsAddresses[0].addressLine4Txt}" size="#{msg['textfield.larger.size']}" />
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.country']}"/>
                    <span class="required">*</span>
                </td>
                <td colspan="3">
                    <p:selectOneMenu id="country" value="#{PrsWorkLocationBean.grsAddresses[0].countryId.ctlId}" style="width: 400px" required="true" requiredMessage="Country is required." >
                        <f:selectItems value="#{addressSupportManager.dsrCountrySelectItemsByName}"/>
                        <p:ajax event="change" process="@this" 
                                listener="#{addressSupportManager.addressDsrCountryChanged(PrsWorkLocationBean.grsAddresses[0].countryId.ctlId)}" 
                                update="province_fragment_txt province_fragment_drop"/>
                    </p:selectOneMenu>   					
                </td>
            </tr>
            <tr>
                <td>
                    <h:outputText value="#{msg['AddDeliverySite.site.location.province']}"/>
                    <span class="required">*</span>
                </td>
                <td colspan="3">
                    <p:fragment id="province_fragment_txt">
                        <p:inputText value="#{PrsWorkLocationBean.grsAddresses[0].provinceOrStateTxt}" id="province_address_txt" 
                                     rendered="#{!addressSupportManager.showDsrProvinceDropDown(PrsWorkLocationBean.grsAddresses[0].countryId.ctlId)}"/>
                    </p:fragment>
                    <p:fragment id="province_fragment_drop">
                        <p:selectOneMenu id="province_drop" value="#{PrsWorkLocationBean.grsAddresses[0].provinceId.ctlId}" 
                                         rendered="#{addressSupportManager.showDsrProvinceDropDown(PrsWorkLocationBean.grsAddresses[0].countryId.ctlId)}">
                            <f:selectItems value="#{addressSupportManager.addressDsrProvinceSelectItems}" />
                        </p:selectOneMenu>
                    </p:fragment>
                </td>
            </tr>			
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.city']}"/>
                    <span class="required">*</span>
                </td>
                <td>
                    <h:inputText id="city" value="#{PrsWorkLocationBean.grsAddresses[0].cityTxt}" size="#{msg['textfield.large.size']}" required="true" requiredMessage="City is required." />
                </td>
                <td class="label" colspan="2" style="text-align: left">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.postalcode']}"/>
                    <span class="required">*</span>
                    <richext:spacer width="5"/>
                    <h:inputText id="postalCode" value="#{PrsWorkLocationBean.grsAddresses[0].postalCodeOrZipTxt}" size="#{msg['textfield.medium.size']}" required="true" requiredMessage="Postal Code is required." />
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.contact.name']}"/>
                    <span class="required">*</span>
                </td>
                <td colspan="3">
                    <h:inputText id="contactName" value="#{PrsWorkLocationBean.prsWorkLocation.contactName}" size="#{msg['textfield.larger.size']}" required="true" requiredMessage="Contact name is required." />
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.telephone']}"/>
                    <span class="required">*</span>
                </td>
                <td>
                    <h:inputText id="telAreaCode" value="#{PrsWorkLocationBean.grsTelephone.areaCodeNum}" size="#{msg['textfield.smallest.size']}" maxlength="3" required="true" requiredMessage="Telephone area code is required." validatorMessage="Telephone area code must be three digits long." >
                        <f:validateLength minimum="3" maximum="3" />
                    </h:inputText>
                    <richext:spacer width="5"/>
                    <h:inputText id="telNo" value="#{PrsWorkLocationBean.grsTelephone.telecommunicationNmbrNum}" size="#{msg['textfield.small.size']}" maxlength="8" required="true" requiredMessage="Telephone number is required." validatorMessage="Telephone number must be seven digits long and in the format XXX-XXXX." >
                        <f:validateRegex pattern="\d{3}[-]\d{4}" />
                    </h:inputText>
                    <richext:spacer width="5"/>
                    <h:outputText value="#{msg['AddDeliverySite.site.location.telephone.ext']}"/>
                    <h:inputText id="telExt" value="#{PrsWorkLocationBean.grsTelephone.extensionNum}" size="#{msg['textfield.smallest.size']}" validatorMessage="Only numbers are allowed in telephone ext." >
                        <f:validateRegex pattern="\d*" />
                    </h:inputText>
                </td>
                <td colspan="2">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.fax']}"/>
                    <richext:spacer width="5"/>
                    <h:inputText id="faxAreaCode" value="#{PrsWorkLocationBean.faxAreaCode}" size="#{msg['textfield.smallest.size']}" />
                    <richext:spacer width="5"/>
                    <h:inputText id="faxNo" value="#{PrsWorkLocationBean.faxNumber}" size="#{msg['textfield.small.size']}" />
                    <richext:spacer width="5"/>
                    <h:outputText value="#{msg['AddDeliverySite.site.location.fax.ext']}"/>
                    <h:inputText id="faxExt" value="#{PrsWorkLocationBean.faxExtensionNumber}" size="#{msg['textfield.smallest.size']}" validatorMessage="Only numbers are allowed in fax ext." >
                        <f:validateRegex pattern="\d*" />
                    </h:inputText>
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.email']}"/>
                </td>
                <td colspan="3">
                    <h:inputText id="email" value="#{PrsWorkLocationBean.grsElectronicAddresses[0].electronicAddressTxt}" size="#{msg['textfield.larger.size']}" />
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.startdate']}"/>
                    <span class="required">*</span>
                </td>
                <td>
                    <p:calendar id="startDate" value="#{PrsWorkLocationBean.prsWorkLocationDetails[0].effectiveStartDate}" mode="popup" showOn="button" pattern="dd-MMM-yyyy" required="true" requiredMessage="Start Date is required." />
                    <p:watermark value="1980-06-30" for="startDate"/>
                </td>
                <td class="label" colspan="2">
                    <h:outputText value="#{msg['AddDeliverySite.site.location.enddate']}"/>
                    <richext:spacer width="5"/>
                    <p:calendar id="endDate" value="#{PrsWorkLocationBean.prsWorkLocationDetails[0].effectiveEndDate}" mode="popup" showOn="button" pattern="dd-MMM-yyyy"/>
                    <p:watermark value="1980-06-30" for="endDate"/>
                </td>
            </tr>
        </table>
    </p:panel>
    <br/>
    <p:panel>
        <f:facet name="header">
            <h:outputText value="Alternative Identifiers"/>
        </f:facet>
        <br/>

        <p:dataTable id="siteIdentifiers" value="#{PrsWorkLocationBean.siteIdentifierWrapperList}" var="var" rowIndexVar="idx" style="width: 60%" rowStyleClass="#{var.displayable?'':'hiddenRow'}">
            <p:column styleClass="wrap" style="width:50%;">
                <f:facet name="header">Source</f:facet>
                <h:outputText value="#{var.dsId.sourceSystemCd.sourceSystemCd}"/>
            </p:column>
            <p:column styleClass="wrap" style="text-align: center">
                <f:facet name="header">Identifier</f:facet>
                <h:outputText value="#{var.dsId.identifierNo}" rendered="#{var.displayable and var.read}"/>
                <h:inputText value="#{var.dsId.identifierNo}" rendered="#{var.editing or var.new}" disabled="#{!var.editable}" required="true" maxlength="15" size="#{msg['textfield.median.size']}" requiredMessage="Alternative Identifiers: Identifier value is required" />
                <h:outputText value=" *" styleClass="required" rendered="#{var.editing or var.new}"/>
            </p:column>
        </p:dataTable>
    </p:panel>
    <br/>
    <p:panel>
        <f:facet name="header">
            <h:outputText value="#{msg['AddDeliverySite.ownership.information']}"/>
        </f:facet>
        <table cellpadding="2" cellspacing="0">
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.ownership.information.legal.owner']}" />
                    <span class="required">*</span>
                </td>
                <td>
                    <h:inputText id="owner" value="#{PrsWorkLocationBean.prsWorkLocation.ownerNameTxt}" size="#{msg['textfield.larger.size']}" required="true" requiredMessage="Legal Owner is required." />
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.ownership.information.legal.owner.type']}"/>
                    <span class="required">*</span>
                </td>
                <td>
                    <p:selectOneMenu id="ownerType" value="#{PrsWorkLocationBean.prsWorkLocation.ownerTypeId.ctlId}" required="true" requiredMessage="Legal Owner Type is required." >
                        <f:selectItem itemValue="" itemLabel=""/>
                        <f:selectItems value="#{DsrDroplists.grsOwnerOperators}"/>
                    </p:selectOneMenu>
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.ownership.information.legal.operator']}"/>
                </td>
                <td>
                    <h:inputText id="operatorName" value="#{PrsWorkLocationBean.operatorName}" size="#{msg['textfield.larger.size']}" />
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.ownership.information.legal.operator.type']}"/>
                </td>
                <td><p:selectOneMenu id="operatorType" value="#{PrsWorkLocationBean.operatorType}">
                        <f:selectItem itemValue="" itemLabel=""/>
                        <f:selectItems value="#{DsrDroplists.grsLegalOperators}"/>
                    </p:selectOneMenu>
                </td>
            </tr>
        </table>
    </p:panel>
    <br/>
    <p:panel>
        <f:facet name="header">
            <h:outputText value="#{msg['AddDeliverySite.additional.information']}"/>
        </f:facet>
        <table cellpadding="2" cellspacing="0">
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.additional.information.program.area']}"/>
                    <span class="required">*</span>
                </td>
                <td>
                    <p:selectOneMenu id="programArea" value="#{PrsWorkLocationBean.selectedProgramArea}" valueChangeListener="#{PrsWorkLocationBean.updateCategory}" required="true" requiredMessage="Program Area is required." >
                        <f:selectItem itemValue="" itemLabel=""/>
                        <f:selectItems value="#{DsrDroplists.dsrProgramAreas}"/>
                        <p:ajax process="@this" update="programCategory" event="change" async="true"/>
                    </p:selectOneMenu>
                </td>

            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.additional.information.program.category']}"/>
                    <span class="required">*</span>
                </td>
                <td>
                    <p:selectManyMenu id="programCategory" value="#{PrsWorkLocationBean.selectedProgramCategories}"  required="true" requiredMessage="Program Category is required." >
                        <f:selectItems value="#{PrsWorkLocationBean.categoryList}"/>
                    </p:selectManyMenu>
                </td>

            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.additional.information.program.campus']}"/>
                </td>
                <td>
                    <h:inputText id="campus" value="#{PrsWorkLocationBean.prsWorkLocation.campusOfCareTxt}" size="#{msg['textfield.larger.size']}" />
                </td>
            </tr>
            <tr>
                <td class="label">                   
                    <h:outputText value="#{msg['AddDeliverySite.additional.information.lha']}" />
                    <span class="required">*</span>
                </td>
                <td>
                    <!-- Validation for field is done in backing been to prevent validation when doing a simple ajax to populate
                    hsad and providerOrg componnets -->
                    <p:selectOneMenu id="lha" value="#{PrsWorkLocationBean.prsWorkLocation.localHealthAreaCd.localHealthAreaCd}" valueChangeListener="#{PrsWorkLocationBean.updateHsdaAndProvider}" required="true" requiredMessage="Local Health Area is required.">
                        <f:selectItem itemValue="" itemLabel=""/>
                        <f:selectItems value="#{DsrDroplists.allActiveLocalHealthArea}"/>
                        <p:ajax process="@this" update="hsda providerOrg" event="change"  async="true"/>                       
                    </p:selectOneMenu>
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.additional.information.hsda']}" />
                    <span class="required">*</span>
                </td>
                <td>
                    <p:selectOneMenu id="hsda" value="#{PrsWorkLocationBean.dummyHsda}" required="true" disabled="true" requiredMessage="Health Delivery Services Area is required." >
                        <f:selectItem itemValue="" itemLabel=""/>
                        <f:selectItems value="#{DsrDroplists.allActiveHsda}"/>
                    </p:selectOneMenu>
                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.additional.information.provider.organization']}"/>
                    <span class="required">*</span>
                </td>
                <td>
                    <p:selectOneMenu id="providerOrg" value="#{PrsWorkLocationBean.dummyHa}" required="true" disabled="true" requiredMessage="Provider Organization is required." >
                        <f:selectItem itemValue="" itemLabel=""/>
                        <f:selectItems value="#{DsrDroplists.prsOrgNames}"/>                        
                    </p:selectOneMenu>

                </td>
            </tr>
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.additional.information.location.type']}" />
                    <span class="required">*</span>
                </td>
                <td>
                    <p:selectOneMenu id="locationType" value="#{PrsWorkLocationBean.prsWorkLocationDetails[0].workLocationTypeId.ctlId}" required="true" requiredMessage="Location Type is required." >
                        <f:selectItem itemValue="" itemLabel=""/>
                        <f:selectItems value="#{DsrDroplists.grsLocationTypes}"/>
                    </p:selectOneMenu>
                </td>
            </tr>         
            <tr>
                <td class="label">
                    <h:outputText value="#{msg['AddDeliverySite.additional.information.notes']}" />
                </td>
                <td>
                    <h:inputTextarea value="#{PrsWorkLocationBean.prsWorkLocation.notes}" cols="#{msg['textfield.larger.size']}" rows="#{msg['textfield.small.size']}" />
                </td>
            </tr>
        </table>
    </p:panel>
    <div style="text-align: right;  margin-top: 10px">
        <ui:include src="/WEB-INF/fragments/Spinner.xhtml"/>
        <!--            Display add new site button only if we are adding a new site-->
        <p:commandButton id="addSite" value="#{msg['button.submit']}" action="#{PrsWorkLocationBean.addNewSite}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId == null and PrsWorkLocationBean.action == null}" update="@form" ajax="false"/>
        <!--            Display update site button only if we are updating an existing site-->
        <p:commandButton id="updateSite" value="#{msg['button.submit']}" action="#{PrsWorkLocationBean.updateSite}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId ne null and PrsWorkLocationBean.action ne 'pendingRequest'}" update="@form" ajax="false"/>
        <!--            Display approve site button only if we are viewing a existing request-->
        <p:commandButton id="approveRequest" value="Approve" action="#{PrsWorkLocationBean.approveRequest}" rendered="#{PrsWorkLocationBean.action == 'pendingRequest'}" update="@form" ajax="false"/>
        <richext:spacer width="10"/>
        <!--            Display clear button only if we adding a new request -->    
        <p:commandButton id="clearForm" value="#{msg['button.clear']}" action="#{PrsWorkLocationBean.clear}" process="@this" rendered="#{PrsWorkLocationBean.action == 'new' or PrsWorkLocationBean.action == null}" update="@form"/>
        <!--            Display clear button only if we updating an existing one -->
        <p:commandButton id="cancelUpdateForm" value="#{msg['button.cancel']}" action="#{PrsWorkLocationBean.cancelUpdate}" process="@this" rendered="#{PrsWorkLocationBean.action == 'existingRequest'}" update="@form"/>
        <!--            Display approve site button only if we are viewing a pending request-->
        <p:commandButton id="denyRequest" value="Deny" action="#{PrsWorkLocationBean.denyRequest}" process="@this" rendered="#{PrsWorkLocationBean.action == 'pendingRequest'}" update="@form" ajax="false"/>
    </div>    
</ui:composition>