<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:p="http://primefaces.org/ui"
                xmlns:richext="http://java.sun.com/jsf/composite/richext">
    <h:form id="viewDeliverySiteFormAdmin"  > 
        
        <p:messages id="messages" showDetail="false" closable="true" >
			<p:autoUpdate disabled="false"/>
		</p:messages>
        
        <p:outputPanel rendered="#{PrsWorkLocationBean.isView }">
            <div style="text-align: right">
                <p:commandButton id="updateAndApproveRequest" value="#{msg['ViewDeliverySite.button.updateInfo']}" 
				process="@this" action="#{PrsWorkLocationBean.enableEditing}" rendered="#{PrsWorkLocationBean.prsWorkLocation.statusId.ctlDescTxt ne 'Merged'}" update="@form" ajax="false"/>
            </div>
            <h2>
                <h:outputText value="#{msg['ViewDeliverySite.title']} #{PrsWorkLocationBean.prsWorkLocationDetails[0].workLocationNameTxt}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId eq null}"/>
                <h:outputText value="#{msg['ViewDeliverySite.title']} #{PrsWorkLocationBean.prsWorkLocation.primaryId.identifierNo} - #{PrsWorkLocationBean.prsWorkLocationDetails[0].workLocationNameTxt}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId ne null}"/>

                <p:outputPanel style="float: right">
                    <h:commandLink id="pdfExport" action="#{PrsWorkLocationBean.exportAsPdf('viewDeliverySiteFormAdmin:resultTable')}">
                        <h:graphicImage library="images" name="pdf.png"/>                       
                    </h:commandLink>
                    <p:tooltip id="pdfTt" for="pdfExport">
                        <span style="white-space: nowrap">Export as PDF</span>
                    </p:tooltip>
                    #{' '} 
                    <h:commandLink id="excelExport" action="#{PrsWorkLocationBean.exportAsXls('viewDeliverySiteFormAdmin:resultTable')}">
                        <h:graphicImage library="images" name="excel.png"/>                        
                    </h:commandLink>
                    <p:tooltip id="excelTt" for="excelExport">
                        <span style="white-space: nowrap">Export as Excel</span>
                    </p:tooltip>
                    #{' '} 
                    <h:commandLink id="csvExport" action="#{PrsWorkLocationBean.exportAsCsv('viewDeliverySiteFormAdmin:resultTable')}" >
                        <h:graphicImage library="images" name="csv.png"/>                        
                    </h:commandLink>
                    <p:tooltip id="csvTt" for="csvExport">
                        <span style="white-space: nowrap">Export as CSV</span>
                    </p:tooltip>
                </p:outputPanel>
            </h2>

            <hr/>
            <richext:spacer height="10"/>

            <p:panel>
                <f:facet name="header">
                    <h:outputText value="#{msg['AddDeliverySite.site.location']}"/>
                </f:facet> 
                <table cellpadding="2" cellspacing="0">
                    <tr>
                        <td>
                            <h:outputText value="#{msg['UpdateDeliverySite.site.location.ds.id']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.primaryId.identifierNo}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId ne null}"/>
                            <h:outputText value="Unassigned" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId eq null and (PrsWorkLocationBean.action == 'existingRequest' or PrsWorkLocationBean.action == 'pendingRequest')}"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h:outputText value="#{msg['UpdateDeliverySite.site.location.status']}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId ne null}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.statusId.ctlDescTxt}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId ne null}"/>
                        </td>  
                    </tr>
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.site.location.name']}"/>
                        </td>
                        <td colspan="4">
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocationDetails[0].workLocationNameTxt}" />
                        </td>
                    </tr>
                    <tr>
                        <!-- Address -->
                        <td>
                            <h:outputText value="#{msg['ViewDeliverySite.site.location.address']}"/>
                        </td>
                        <td colspan="4">
                            <div style="text-align: left">
                                <h:panelGroup rendered="#{PrsWorkLocationBean.grsAddresses[0].addressLine1Txt ne null and PrsWorkLocationBean.grsAddresses[0].addressLine1Txt ne ''}">
                                    <h:outputText value="#{PrsWorkLocationBean.grsAddresses[0].addressLine1Txt}"/><br/><br/>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{PrsWorkLocationBean.grsAddresses[0].addressLine2Txt ne null and PrsWorkLocationBean.grsAddresses[0].addressLine2Txt ne ''}">
                                    <h:outputText value="#{PrsWorkLocationBean.grsAddresses[0].addressLine2Txt}"/><br/><br/>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{PrsWorkLocationBean.grsAddresses[0].addressLine3Txt ne null and PrsWorkLocationBean.grsAddresses[0].addressLine3Txt ne ''}">
                                    <h:outputText value="#{PrsWorkLocationBean.grsAddresses[0].addressLine3Txt}"/><br/><br/>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{PrsWorkLocationBean.grsAddresses[0].addressLine4Txt ne null and PrsWorkLocationBean.grsAddresses[0].addressLine4Txt ne ''}">
                                    <h:outputText value="#{PrsWorkLocationBean.grsAddresses[0].addressLine4Txt}"/><br/><br/>
                                </h:panelGroup>

                                <h:panelGroup>
                                    <h:outputText value="#{PrsWorkLocationBean.grsAddresses[0].cityTxt}" />
                                    <richext:spacer width="8"/>
                                    <h:outputText value=" #{PrsWorkLocationBean.grsAddresses[0].provinceId.ctlDescTxt}" />
                                    <richext:spacer width="8"/>
                                    <h:outputText value=" #{PrsWorkLocationBean.grsAddresses[0].countryId.ctlDescTxt}" />
                                </h:panelGroup><br/><br/>
                                <h:outputText value="#{PrsWorkLocationBean.grsAddresses[0].postalCodeOrZipTxt}"  />

                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.site.location.contact.name']}"/>
                        </td>
                        <td colspan="4">
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.contactName}" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.site.location.telephone']}"/>
                        </td>
                        <td>
                            <h:outputText value="(#{PrsWorkLocationBean.grsTelephone.areaCodeNum})" rendered="#{PrsWorkLocationBean.grsTelephone.tlcmnctnNmbrTypCd.ctlNameCode == 'T'}"/>
                            <richext:spacer width="5"/>
                            <h:outputText value="#{PrsWorkLocationBean.grsTelephone.telecommunicationNmbrNum}" rendered="#{PrsWorkLocationBean.grsTelephone.tlcmnctnNmbrTypCd.ctlNameCode == 'T'}"/>
                            <richext:spacer width="5"/>
                            <h:outputText value="#{msg['AddDeliverySite.site.location.telephone.ext']}"/>
                            <h:outputText value="#{PrsWorkLocationBean.grsTelephone.extensionNum}" rendered="#{PrsWorkLocationBean.grsTelephone.tlcmnctnNmbrTypCd.ctlNameCode == 'T'}"/>
                        </td>
                        <td><richext:spacer width="20"/></td>
                        <td >
                            <h:outputText value="#{msg['AddDeliverySite.site.location.fax']}"/>
                        </td>
                        <td>
                            <!-- If we have more than one telephone numbers, then the second one must be fax number -->
                            <h:outputText value="(#{PrsWorkLocationBean.faxAreaCode})" rendered="#{PrsWorkLocationBean.faxAreaCode ne null and PrsWorkLocationBean.faxAreaCode.trim().length() > 0}"/>
                            <richext:spacer width="5"/>
                            <h:outputText value="#{PrsWorkLocationBean.faxNumber}"  rendered="#{PrsWorkLocationBean.faxNumber ne null and PrsWorkLocationBean.faxNumber.trim().length() > 0}"/>
                            <richext:spacer width="5"/>
                            <h:outputText value="#{msg['AddDeliverySite.site.location.fax.ext']}"  rendered="#{PrsWorkLocationBean.faxNumber ne null and PrsWorkLocationBean.faxAreaCode.trim().length() > 0}"/>
                            <h:outputText value="#{PrsWorkLocationBean.faxExtensionNumber}"  rendered="#{PrsWorkLocationBean.faxExtensionNumber ne null and PrsWorkLocationBean.faxExtensionNumber.trim().length() > 0}"/>
                        </td>
                    </tr>
                    <tr>
                        <td >
                            <h:outputText value="#{msg['AddDeliverySite.site.location.email']}"/>
                        </td>
                        <td colspan="4">
                            <h:outputText value="#{PrsWorkLocationBean.grsElectronicAddresses[0].electronicAddressTxt}"  />
                        </td>
                    </tr>
                    <tr>
                        <td >
                            <h:outputText value="#{msg['AddDeliverySite.site.location.startdate']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocationDetails[0].effectiveStartDate}" >
                                <f:convertDateTime type="date" dateStyle="medium" />
                            </h:outputText>
                        </td>
                        <td><richext:spacer width="20"/></td>
                        <td >
                            <h:outputText value="#{msg['AddDeliverySite.site.location.enddate']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocationDetails[0].effectiveEndDate}" >
                                <f:convertDateTime type="date" dateStyle="medium" />
                            </h:outputText>
                        </td>
                    </tr>
                </table>
            </p:panel>
            <br />
            <p:panel> 
                <f:facet name="header">
                    <h:outputText value="#{msg['AddDeliverySite.site.alternateId']}"/>
                </f:facet>
                <table border="0">
                    <th>Source</th>
                    <th>Identifier</th>
                    <tbody>   
                        <ui:repeat value="#{PrsWorkLocationBean.siteIdentifierWrapperList}" var="var" >
                            <tr class="#{var.displayable?'':'hiddenRow'}">
                                <td><h:outputText value="#{var.dsId.sourceSystemCd.sourceSystemCd}" rendered="#{var.displayable}"/></td>
                                <td style="text-align: right"><h:outputText value="#{var.dsId.identifierNo}" rendered="#{var.displayable}"/></td>
                            </tr>
                        </ui:repeat>
                    </tbody>
                </table>
            </p:panel>
            <br/>
            <p:panel>
                <f:facet name="header">
                    <h:outputText value="#{msg['AddDeliverySite.ownership.information']}"/>
                </f:facet>
                <table cellpadding="2" cellspacing="0">
                    <tr>
                        <td >
                            <h:outputText value="#{msg['AddDeliverySite.ownership.information.legal.owner']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.ownerNameTxt}"  />
                        </td>
                    </tr>
                    <tr>
                        <td >
                            <h:outputText value="#{msg['AddDeliverySite.ownership.information.legal.owner.type']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.ownerTypeId.ctlDescTxt}"  />
                        </td>
                    </tr>
                    <tr>
                        <td >
                            <h:outputText value="#{msg['AddDeliverySite.ownership.information.legal.operator']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.operatorName}"  />
                        </td>
                    </tr>
                    <tr>
                        <td >
                            <h:outputText value="#{msg['AddDeliverySite.ownership.information.legal.operator.type']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.operatorTypeId.ctlDescTxt}"  />
                        </td>
                    </tr>
                </table>
            </p:panel>
            <br/>
            <p:panel>
                <f:facet name="header">
                    <h:outputText value="#{msg['AddDeliverySite.additional.information']}"/>
                </f:facet>
                <table cellpadding="2" cellspacing="0">
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.additional.information.program.area']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocationDetails[0].dsrSiteProgramCategoriesList[0].programCategoryCd.programAreaCd.programAreaDsc}" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.additional.information.program.category']}"/>
                        </td>
                        <td>       
                            <div style="text-align: left">
                                <ui:repeat value="#{PrsWorkLocationBean.prsWorkLocationDetails[0].dsrSiteProgramCategoriesList}" var="var">
                                    #{var.programCategoryCd.programCategoryCd}
                                    #{' - '}
                                    #{var.programCategoryCd.programCategoryDsc}
                                    <br/><br/>
                                </ui:repeat>
                            </div>
                        </td>

                    </tr>
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.additional.information.program.campus']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.campusOfCareTxt}"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.additional.information.lha']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.localHealthAreaCd.localHealthAreaCd}"/>
                            #{' - '}
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.localHealthAreaCd.localHealthAreaDsc}"  />
                        </td>                        
                    </tr>
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.additional.information.hsda']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.serviceDeliveryAreaCd.serviceDeliveryAreaCd}"/>
                            #{' - '}
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.serviceDeliveryAreaCd.serviceDeliveryAreaDsc}"  />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.additional.information.provider.organization']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.pauthPauthId.grsOrgNamesList[0].orgnztnLongNameTxt}"  />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.additional.information.notes']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.prsWorkLocation.notes}"  />
                        </td>
                    </tr>
                </table>
            </p:panel>
            <br/>
            <p:panel rendered="#{PrsWorkLocationBean.action == 'pendingRequest'}">
                <f:facet name="header">
                    <h:outputText value="#{msg['AddDeliverySite.submitter.information']}"/>
                </f:facet>
                <table cellpadding="2" cellspacing="0">
                    <tr>
                        <td>
                            <h:outputText value="#{msg['AddDeliverySite.submitter.information.name']}"/>
                        </td>
                        <td>
                            <h:outputText value="#{PrsWorkLocationBean.submitterName}" />
                        </td>
                    </tr>
                    <tr>
                        <td >
                            <h:outputText value="#{msg['AddDeliverySite.submitter.information.email']}"/>
                        </td>
                        <td>       
                            <h:outputText value="#{PrsWorkLocationBean.submitterEmail}" />
                        </td>

                    </tr>

                </table>
            </p:panel>
            <br/>
            <!--  Display approve and deny buttons only if we navigated (clicked a link) from the pending request table -->
            <p:outputPanel style="text-align: right" rendered="#{PrsWorkLocationBean.action == 'pendingRequest'}">   
                <ui:include src="/WEB-INF/fragments/Spinner.xhtml"/>                
                <p:commandButton value="Approve" action="#{PrsWorkLocationBean.approveRequest()}" ajax="false"/>
                <richext:spacer width="10"/>                 
                <p:commandButton value="Deny" action="#{PrsWorkLocationBean.denyRequest()}" ajax="false"/>
            </p:outputPanel>

            <p:dataTable id="resultTable" value="#{PrsWorkLocationBean.viewExport}" var="var" style="display: none">
                <p:column>
                    <f:facet name="header">Label</f:facet>
                    <h:outputText value="#{var[0]}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">Value</f:facet>
                    <h:outputText value="#{var[1]}"/>
                </p:column>
            </p:dataTable>
        </p:outputPanel>  

        <!-- Update site section-->
        <p:outputPanel id="updateSiteContainerAdmin" rendered="#{not PrsWorkLocationBean.isView}">
            <h2>
                <h:outputText value="#{msg['UpdateDeliverySite.title']}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId ne null}"/>
                <h:outputText value="#{msg['AddDeliverySite.title']}" rendered="#{PrsWorkLocationBean.prsWorkLocation.wlId eq null}"/>
            </h2>
            <hr/>
            <richext:spacer height="10"/>

            <!-- Only show for roles that can approve an update-site request -->
            <p:outputPanel id="updateAndApproveSite"> 
                <ui:include src="/WEB-INF/fragments/DeliverySiteApproved.xhtml"/>
            </p:outputPanel>

        </p:outputPanel>
        <!-- Without this style included, the confirm dialog are displayed 
        at the top left hand corner  of the page. This fix is a hack and may 
        not always display the dialogs in the centre of the screen depending 
        on the window size
        -->
        <style>
            .ui-dialog {
                left: 40%!important; 
                top: 45%!important;
            }
        </style>


        <p:confirmDialog styleClass="no-mandatory-text" id="approverApproveNotifier" widgetVar="approverApproveNotifier" width="300" visible="true" rendered="#{PrsWorkLocationBean.approved and PrsWorkLocationBean.newRequest}">
            <f:facet name="header">
                <h:outputText value="Notification" />
            </f:facet>
            <f:facet name="message">               
                <h:outputText value="#{PrsWorkLocationBean.actionResponse}"/>                                          
                <h:outputText value="DS ID: #{PrsWorkLocationBean.prsWorkLocation.primaryId.identifierNo}"/> 
            </f:facet>
            <div style="text-align: center">
                <p:commandButton action="ApproveDeliverySiteRequest" value="OK" onclick="PF('approverApproveNotifier').hide();" ajax="false" />
            </div>
        </p:confirmDialog>
        <p:confirmDialog styleClass="no-mandatory-text" id="approverDenyNotifier" widgetVar="approverDenyNotifier" width="300" visible="true" rendered="#{PrsWorkLocationBean.denied}">
            <f:facet name="header">
                <h:outputText value="Notification" />
            </f:facet>

            <f:facet name="message">                
                <h:outputText value="Site request denied"/>               
            </f:facet>
            <div style="text-align: center">
                <p:commandButton action="ApproveDeliverySiteRequest" value="OK" onclick="PF('approverDenyNotifier').hide();" ajax="false" />
            </div>

        </p:confirmDialog>
        <p:confirmDialog styleClass="no-mandatory-text" id="approverUpdateNotifier" widgetVar="approverUpdateNotifier" width="300" visible="true" rendered="#{PrsWorkLocationBean.approved and PrsWorkLocationBean.updateRequest}">
            <f:facet name="header">
                <h:outputText value="Notification" />
            </f:facet>
            <f:facet name="message">
                <richext:spacer height="3"/>
                <h:outputText value="#{PrsWorkLocationBean.actionResponse}"/>

            </f:facet>
            <div style="text-align: center">
                <p:commandButton action="ApproveDeliverySiteRequest" value="OK" ajax="false" onclick="PF('approverUpdateNotifier').hide();" />
            </div>

        </p:confirmDialog>
        <p:confirmDialog styleClass="no-mandatory-text" id="approverNotifier" widgetVar="approverNotifier" width="300" visible="true" rendered="#{PrsWorkLocationBean.success}">
            <f:facet name="header">
                <h:outputText value="Notification" />
            </f:facet>
            <f:facet name="message">
                <richext:spacer height="3"/>
                <h:outputText value="#{PrsWorkLocationBean.actionResponse}"/>

            </f:facet>
            <div style="text-align: center">
                <p:commandButton action="#{PrsWorkLocationBean.reset}" value="OK" onclick="PF('approverNotifier').hide();" process="@this"/>
            </div>

        </p:confirmDialog>                
    </h:form>
</ui:composition>