<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                template="/templates/gov21Template.xhtml">
    <ui:define name="title">Search Provider</ui:define>
    <ui:define name="body">
        <style>
            td {
                background: transparent;
                border: none;
            }
            td .ui-selectonemenu  {
                vertical-align: middle;
            }            
            .ui-chkbox .ui-chkbox-box {
                background: white;
            }
            .ui-button {
                margin-left: .5em;
            }
            .ui-radiobutton .ui-radiobutton-box {
                background: white;
            }
            .ui-selectoneradio.ui-widget td {
                /* Prevent the radio buttons from jumping up when selected. */
                vertical-align: middle;
            }
            .historyCheckBox {
                border:1px solid black;
                padding:1em;
                border-radius:5px;
            }
        </style>
        <table>
            <tr>
                <td><h2>Search Provider</h2></td>
                <td><p:spacer width="550px" height="20px" /></td>
                <td>
                    <h:form id="includeHistoryForm">
                        <span class="historyCheckBox">
                            <h:outputText value="Include History " />
                            <p:selectBooleanCheckbox value="#{searchProviderManager.searchWithHistory}" immediate="true"  >
                                <p:ajax process="@this" />
                            </p:selectBooleanCheckbox>
                            <h:outputText value="&#160;" />
                            <h:graphicImage id="helpHistory" value="/images/help.png" />
                            <p:tooltip for="helpHistory" escape="false">
                                <span>Searching with history (check box enabled) causes this application to check<br/> 
                                    for Provider matches not only in the current record but also in historical records. <br/> 
                                    By default only the current (active) records are searched.</span>
                            </p:tooltip> 
                            <h:outputText value="&#160;" />
                        </span>
                    </h:form>
                </td>
            </tr>
        </table>

        <p:messages id="messages" showDetail="false" closable="true" >
            <p:autoUpdate disabled="false"/>
        </p:messages>

        <p:accordionPanel id="accordian" >
            <p:tab id="searchByIdTab" title="Search by Identifier" titletip="Click to collapse and again to expand" >   
                <h:form id="searchByIdForm">
                    <table>
                        <tr>
                            <td colspan="2">(*) Indicates a mandatory field.</td>
                        </tr>
                        <tr>
                            <td><p:outputLabel for="identifierType" value="Identifier Type" /></td>
                            <td><p:outputLabel for="identifier" value="Provider ID" /></td>
                        </tr>
                        <tr>
                            <td>                        
                                <p:selectOneMenu id="identifierType" value="#{searchProviderManager.searchProviderFormData.identifierTypeId}" required="true">
                                    <f:selectItems value="#{Droplists.identifierTypesForSearch}"/>
                                </p:selectOneMenu>
                            </td>
                            <td>
                                <p:inputText id="identifier" value="#{searchProviderManager.searchProviderFormData.identifier}" required="true"/>
                                <p:commandButton type="submit" value="Search" action="#{searchProviderManager.searchByIdentifier}" update=":searchResultsGroup, @form" />
                                <p:ajaxStatus style="display:inline-block">
                                    <f:facet name="start"><h:graphicImage value="/images/Spinner.gif"/></f:facet>
                                    <f:facet name="complete"><h:outputText value="" /></f:facet>                     
                                </p:ajaxStatus>
                                <br/>
                                <span style="font-size: x-small">(e.g. 012345)</span>
                            </td>
                        </tr>
                    </table>
                </h:form>
            </p:tab>
            <p:tab  id="searchByRegistryIdTab" title="Search by Registry Identifier" titletip="Click to expand and again to collapse" > 
                <h:form id="searchByRegistryIdForm">
                    <table>
                        <tr>
                            <td colspan="2">(*) Indicates a mandatory field.</td>
                        </tr>                        
                        <tr>
                            <td><p:outputLabel for="registryIdentifierTypeCode" value="Registry Identifier Type"/></td>
                            <td><p:outputLabel for="registryIdentifier" value="Registry Identifier Value" /></td>
                        </tr>
                        <tr>
                            <td>                        
                                <p:selectOneMenu id="registryIdentifierTypeCode" value="#{searchProviderManager.searchProviderFormData.registryIdentifierTypeCodeId}" required="true">
                                    <f:selectItems value="#{Droplists.grsCtRegIdentifierTypes}"/>
                                </p:selectOneMenu>
                            </td>
                            <td>
                                <p:inputText id="registryIdentifier" value="#{searchProviderManager.searchProviderFormData.registryIdentifier}"  size="9" required="true"/> <p:spacer width="2"/>
                                <p:inputText id="registryIdentifierPostfix" value="#{searchProviderManager.searchProviderFormData.registryIdentifierPostfix}" size="7"/>
                                <p:commandButton type="submit" value="Search" action="#{searchProviderManager.searchByRegistryIdentifier}" update=":searchResultsGroup, @form"/>
                                <p:ajaxStatus style="display:inline-block">
                                    <f:facet name="start"><h:graphicImage value="/resources/Spinner.gif"/></f:facet>
                                    <f:facet name="complete"><h:outputText value="" /></f:facet>                     
                                </p:ajaxStatus>
                                <br/>
                                <span style="font-size: x-small">(e.g. 00012300)</span>
                            </td>
                        </tr> 
                    </table>
                </h:form>
            </p:tab>
            <p:tab title="Search by Criteria" titletip="Click to expand and again to collapse" id="criteriaTab" > 
                <h:form id="searchByCriteriaForm">
                    <table>
                        <tr>
                            <td width="70%">
                                <table>
                                    <tr>
                                        <td colspan="3">
                                            <p:outputLabel for="providerType" value="Provider Role Type" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3">
                                            <p:selectOneMenu id="providerType" value="#{searchProviderManager.searchProviderFormData.providerRoleTypeId}" required="false" >
                                                <f:selectItems value="#{searchProviderManager.providerRoleTypeINDSelectItems}"  />
                                                <p:ajax listener="#{searchProviderManager.providerRoleTypeChanged()}" update="expertise"/>
                                            </p:selectOneMenu>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><p:outputLabel for="firstName" value="First Name" /><h:graphicImage id="helpFirst" value="/images/help.png" /><p:tooltip for="helpFirst" value="Use a trailing wildcard (*) to match a first name. (e.g. Jo*)" /></td>
                                        <td colspan="2"><p:outputLabel for="lastName" value="Last Name" /><h:graphicImage value="/images/help.png" id="helpLast"/><p:tooltip for="helpLast" value="Use a trailing wildcard (*) to match a last name. (e.g. Sm*)" /></td>
                                    </tr>
                                    <tr>
                                        <td><p:inputText id="firstName" value="#{searchProviderManager.searchProviderFormData.firstName}" required="false" /></td>
                                        <td colspan="2"><p:inputText id="lastName" value="#{searchProviderManager.searchProviderFormData.lastName}" required="false" /></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p:outputLabel for="gender" value="Gender" />
                                        </td>
                                        <td colspan="2"><p:outputLabel for="city" value="City" /></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p:selectOneMenu id="gender" value="#{searchProviderManager.searchProviderFormData.gender}" required="false" >
                                                <f:selectItems value="#{Droplists.prsCtGenderCodesWithSelectOne}"  />
                                            </p:selectOneMenu>
                                        </td>
                                        <td colspan="2">
                                            <p:autoComplete id="city" value="#{searchProviderManager.searchProviderFormData.city}" completeMethod="#{addressSupportManager.suggestCityName}" effect="fade" />
                                        </td>                            
                                    </tr>
                                    <tr>
                                        <td>
                                            <p:outputLabel for="licenseStatusCdId" value="Status Code" />
                                        </td>
                                        <td colspan="2"><p:outputLabel for="licenseStatusReasonCdId" value="Status Reason Code" /></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p:selectOneMenu id="licenseStatusCdId" value="#{searchProviderManager.searchProviderFormData.licenseStatusCd}" required="false" >
                                                <f:selectItems value="#{searchProviderManager.statusCodeSelectItems}"/>
                                                <p:ajax listener="#{searchProviderManager.licenseStatusCodeChanged()}" update="licenseStatusReasonCdId"/>
                                            </p:selectOneMenu>
                                        </td>
                                        <td colspan="2">
                                            <p:selectOneMenu id="licenseStatusReasonCdId" value="#{searchProviderManager.searchProviderFormData.licenseStatusReasonCd}" required="false" >
                                                <f:selectItems value="#{searchProviderManager.statusReasonCodeSelectItems}"  />
                                            </p:selectOneMenu>                                                
                                        </td>                            
                                    </tr>
                                    <tr>
                                        <td><p:outputLabel for="expertise" value="Expertise" /></td>
                                        <td colspan="2"><p:outputLabel for="language" value="Language" /></td>
                                    </tr>
                                    <tr>
                                        <td style="vertical-align: top;">
                                            <p:selectManyMenu value="#{searchProviderManager.searchProviderFormData.expertiseList}" id="expertise" required="false" showCheckbox="true" style="vertical-align: top; width: auto; overflow-style: scrollbar; overflow: auto; overflow-y:auto; overflow-x: auto; height: 200px;">
                                                <f:selectItems value="#{searchProviderManager.expertiseTypeSelectItems}"/>
                                            </p:selectManyMenu>
                                        </td>
                                        <td style="vertical-align: top;">
                                            <p:selectManyMenu value="#{searchProviderManager.searchProviderFormData.languageList}" id="language" required="false" showCheckbox="true" style="vertical-align: top; width: auto; overflow-style: scrollbar; overflow: auto; overflow-y:auto; overflow-x: auto; height: 200px;">
                                                <f:selectItems value="#{Droplists.allLanguageExpertiseTypes}" />
                                            </p:selectManyMenu>
                                        </td>
                                        <td style="vertical-align: top;">
                                            <p:commandButton id="clearButton" type="submit" value="Clear" action="#{searchProviderManager.clearSearchByCriteria}"  update=":searchResultsGroup, @form" />
                                            <br/>
                                            <br/>
                                            <p:commandButton id="searchButton" type="submit" value="Search" action="#{searchProviderManager.searchByCriteria}"  update=":searchResultsGroup, @form" />
                                            <p:defaultCommand target="searchButton" />
                                            <p:ajaxStatus style="display:inline-block">
                                                <f:facet name="start"><h:graphicImage value="/resources/Spinner.gif"/></f:facet>
                                                <f:facet name="complete"><h:outputText value="" /></f:facet>                     
                                            </p:ajaxStatus>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td>
                                <p:panel >
                                    <h:outputText value="The Search by Criteria form has some rules to be aware of.  First Name and Last Name are mandatory unless one of City, Expertise or Language is populated.  First Name and Last Name may use trailing wildcards if at least one character is provided."/>
                                </p:panel>
                            </td>
                        </tr>
                    </table>
                </h:form>
            </p:tab>
            <p:tab title="Search for Organization" titletip="Click to expand and again to collapse" rendered="#{searchProviderManager.allowSearchForOrg}" id="organizationTab"> 
                <h:form id="searchByOrganizationForm">
                    <table>
                        <tr>
                            <td colspan="2">(*) Indicates a mandatory field.</td>
                        </tr>
                        <tr>
                            <td colspan="2"><p:outputLabel for="providerType" value="Organizational Provider Role Type" /></td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <p:selectOneMenu id="providerType" value="#{searchProviderManager.searchProviderFormData.providerRoleTypeId}" required="true" >
                                    <f:selectItems value="#{searchProviderManager.providerRoleTypeORGSelectItems}"/>
                                </p:selectOneMenu>
                            </td>
                        </tr>
                        <tr>
                            <td><p:outputLabel for="orgName" value="Name" /><h:graphicImage id="helpFirst" value="/images/help.png" /><p:tooltip for="helpFirst" value="Use a trailing wildcard (*) to match an org. name. (e.g. HA*)" /></td>
                            <td><p:outputLabel for="orgLongName" value="Description" /><h:graphicImage id="helpFirstDescription" value="/images/help.png" /><p:tooltip for="helpFirstDescription" value="Use a trailing wildcard (*) to match an org. description. (e.g. Hosp*)" /></td>
                        </tr>
                        <tr>
                            <td><p:inputText id="orgName" value="#{searchProviderManager.searchProviderFormData.organizationProviderName}" required="true" /></td>
                            <td><p:inputText id="orgLongName" value="#{searchProviderManager.searchProviderFormData.organizationProviderLongName}" required="false" /></td>
                        </tr>
                        <tr>
                            <td colspan="2"><p:outputLabel for="city" value="City" /></td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <p:autoComplete id="city" 
                                                value="#{searchProviderManager.searchProviderFormData.city}" 
                                                completeMethod="#{addressSupportManager.suggestCityName}" 
                                                effect="fade" />
                                <p:commandButton type="submit" value="Search" action="#{searchProviderManager.searchForOrganization}"  update=":searchResultsGroup, @form" />
                                <p:ajaxStatus style="display:inline-block">
                                    <f:facet name="start"><h:graphicImage value="/resources/Spinner.gif"/></f:facet>
                                    <f:facet name="complete"><h:outputText value="" /></f:facet>                     
                                </p:ajaxStatus>
                            </td>
                        </tr>
                    </table>
                </h:form>
            </p:tab>

        </p:accordionPanel>
        <br/>
        <h:panelGroup id="searchResultsGroup">
            <p:fragment rendered="#{searchProviderManager.searchResult.searchResults ne null}">
                <h:form id="searchResultsForm">
                    <h:outputText value="#{fn:length(searchProviderManager.searchResult.searchResults)}"/> 
                    result<h:outputText rendered="#{fn:length(searchProviderManager.searchResult.searchResults) gt 1 || fn:length(searchProviderManager.searchResult.searchResults) == 0}" value="s"/>
                    (<h:outputText value="#{searchProviderManager.searchResult.searchTime}">
                        <f:convertNumber type="number" pattern="#0.000"/>
                    </h:outputText> seconds) 
                    <p:dataTable id="tbl" var="result" value="#{searchProviderManager.searchResult.searchResults}" style="min-height: 4em"
                                 resizableColumns="true">
                        <p:column width="200" style="white-space: normal;word-break: break-all">
                            <f:facet name="header">
                                <h:outputText value="Name"/>
                            </f:facet>
                            <h:commandLink  action="#{searchProviderManager.logAndNavigateToProvider(result)}">
                                <h:outputText escape="false" value="#{searchProviderManager.renderNames(result)}" />
                            </h:commandLink>
                        </p:column>
                        <p:column width="40" style="white-space: normal;word-break: break-all">
                            <f:facet name="header">
                                <h:outputText value="Type"/>
                            </f:facet>
                            <h:outputText value="#{result.type}"/>
                        </p:column>
                        <p:column width="150" style="white-space: normal;word-break: break-all">
                            <f:facet name="header">
                                <h:outputText value="Identifiers"/>
                            </f:facet>
                            <h:outputText escape="false" value="#{searchProviderManager.renderIdentifiers(result)}"/>
                        </p:column>
                        <p:column width="390" style="white-space: normal;word-break: break-all">
                            <f:facet name="header">
                                <h:outputText value="Address"/>
                            </f:facet>
                            <h:outputText escape="false" value="#{searchProviderManager.renderAddresses(result)}"/>
                        </p:column>
                        <p:column width="70" style="white-space: normal;word-break: break-all">
                            <f:facet name="header">
                                <h:outputText value="Status"/>
                            </f:facet>
                            <h:outputText escape="false" value="#{searchProviderManager.renderStatuses(result)}"/> 
                        </p:column>
                    </p:dataTable>

                    <div style="float: right; margin-top: 1em">
                        <p:commandButton value="Export PDF" ajax="false">
                            <p:dataExporter type="pdf" target="tbl" fileName="providers" postProcessor="#{searchProviderManager.postProcessExporter}"
                                            preProcessor="#{searchProviderManager.preProcessExporter}"/>
                        </p:commandButton>
                        <p:commandButton value="Export XLS" ajax="false">
                            <p:dataExporter type="xls" target="tbl" fileName="providers"  postProcessor="#{searchProviderManager.postProcessExporter}"
                                            preProcessor="#{searchProviderManager.preProcessExporter}"/>
                        </p:commandButton>
                    </div>
                </h:form>
            </p:fragment>
        </h:panelGroup>
    </ui:define>
</ui:composition>