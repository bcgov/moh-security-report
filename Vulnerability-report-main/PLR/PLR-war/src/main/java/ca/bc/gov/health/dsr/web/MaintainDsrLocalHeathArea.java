package ca.bc.gov.health.dsr.web;
import ca.bc.gov.health.plr.ejb.entity.*;
import ca.bc.gov.health.dsr.ejb.session.*;
import ca.bc.gov.health.jsf.BaseBean;
import java.util.List;
import javax.annotation.PostConstruct;
import javax.ejb.EJB;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import javax.faces.bean.ViewScoped;
import javax.faces.bean.ManagedBean;
import javax.faces.component.UIInput;
import javax.faces.component.UIViewRoot;

@ManagedBean(name="MaintainDsrLocalHealthArea")
@ViewScoped
/**
 * Backing bean for DsrProgramAreas code table maintenance
 * @author JSF Code Generator
 */
public class MaintainDsrLocalHeathArea extends BaseBean implements java.io.Serializable{

    /* Facade for persistence */   
    @EJB
    private DsrHealthDeliveryServicesAreaFacadeLocal dsrServiceDeliveryAreaFacade;
    
    @EJB
    private DsrLocalHealthAreaFacadeLocal dsrLocalHeathAreaFacade;

    /* List of all values in the code table */
    private List<DsrLocalHealthAreas> dsrLocalHealthAreas;

    /* The instance we're currently editing */
    private DsrLocalHealthAreas dsrLocalHealthArea;

    /* PK of the selected instance */
    private Object selectedKey;
    
    private boolean active = true;

    /**
     * Default Constructor
     */
    public MaintainDsrLocalHeathArea(){}

    /**
     * Initializes this bean after injection
     */
    @PostConstruct
    public void init(){
        dsrLocalHealthAreas = dsrLocalHeathAreaFacade.findAll();
        clear();
    }

    /**
     * Adds a new record
     */
    public String add(){
        nullify();
        
        DsrLocalHealthAreas existing = null;
        
        for (DsrLocalHealthAreas temp : dsrLocalHealthAreas) {
            
            if (temp.getLocalHealthAreaCd().equalsIgnoreCase(dsrLocalHealthArea.getLocalHealthAreaCd())) {
                existing = temp;
                break;
            }
        }
        
         if (existing != null) {
            String msgStr = "Local health area code '" + dsrLocalHealthArea.getLocalHealthAreaCd() + "' exists already";
            FacesMessage msg = new FacesMessage(FacesMessage.SEVERITY_ERROR, msgStr, msgStr);
            FacesContext.getCurrentInstance().addMessage(null, msg);
            
            return null;
        }
         
          preUpdate();
        
        dsrLocalHeathAreaFacade.create(dsrLocalHealthArea);
        FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_INFO, "Add Successful", "Add Successful"));
        init();
        ((Droplists)findBean("DsrDroplists")).init();
        return null;
    }

    /**
     * Updates an existing record
     */
    public String update(){
        nullify();
        
        DsrHlthServsDeliveryAreas dsrHealthDeliveryServicesArea = dsrServiceDeliveryAreaFacade.find(dsrLocalHealthArea.getServiceDeliveryAreaCd().getServiceDeliveryAreaCd());

        preUpdate();
        
        if (!dsrHealthDeliveryServicesArea.getServiceDeliveryAreaDsc().equals(dsrLocalHealthArea.getServiceDeliveryAreaCd().getServiceDeliveryAreaDsc())) {
            dsrHealthDeliveryServicesArea.getDsrLocalHealthAreasList().add(dsrLocalHealthArea);
            dsrLocalHealthArea.setServiceDeliveryAreaCd(dsrHealthDeliveryServicesArea);
            dsrServiceDeliveryAreaFacade.edit(dsrHealthDeliveryServicesArea);
        } else {
            dsrLocalHeathAreaFacade.edit(dsrLocalHealthArea);
        }
        
        FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_INFO, "Update Successful", "Update Successful"));
        init();
        ((Droplists)findBean("DsrDroplists")).init();
        return null;
    }

    /**
     * Deletes a record
     */
    public String delete(){
        nullify();
        dsrLocalHeathAreaFacade.remove(dsrLocalHealthArea);
        init();
        ((Droplists)findBean("DsrDroplists")).init();
        return null;
    }

    /**
     * Clears the form
     */
    public String clear(){
        selectedKey=null;
        active = true;
        dsrLocalHealthArea = new DsrLocalHealthAreas();
        dsrLocalHealthArea.setServiceDeliveryAreaCd(new DsrHlthServsDeliveryAreas());
        
        UIViewRoot viewRoot = FacesContext.getCurrentInstance().getViewRoot();

        String[] compIds = {"form1:hsdaCd", "form1:active", "form1:lhaCd", "form1:lhaDesc"};

        UIInput comp;
        for (String id : compIds) {
            comp = (UIInput) viewRoot.findComponent(id);
            if (comp != null) {
                comp.resetValue();
            }
        }

        return null;
    }
    /**
     * Selects a record for editing
     */
    public String select(){
        for(int i=0; i<dsrLocalHealthAreas.size(); i++){
            if (dsrLocalHealthAreas.get(i).getLocalHealthAreaCd().equals(selectedKey)){
                dsrLocalHealthArea = dsrLocalHealthAreas.get(i);
                preDisplay();
                break;
            }
        }
        return null;
    }
    
    
    public boolean isActive() {
        return active;
    }

    public void setActive(boolean active) {
        this.active = active;
    }

    private void preUpdate() {

        if (active) {
            dsrLocalHealthArea.setActiveYn("Y");
        } else {
            dsrLocalHealthArea.setActiveYn("N");
        }
    }

    private void preDisplay() {

        if (dsrLocalHealthArea.getActiveYn().equals("Y")) {
            active = true;
        } else {
            active = false;
        }
    }
    
    /**
     * Nullifys any parent records where proper PKs aren't set
     */
    private void nullify(){
    }
    /* Getters and Setters */
    public List<DsrLocalHealthAreas> getAllDsrLocalHealthAreas(){
        return dsrLocalHealthAreas;
    }
    public void setAllDsrLocalHealthAreas(List<DsrLocalHealthAreas> allDsrLocalHealthAreas){
        this.dsrLocalHealthAreas = allDsrLocalHealthAreas;
    }
    public DsrLocalHealthAreas getDsrLocalHealthArea(){
        return dsrLocalHealthArea;
    }
    public void setDsrLocalHealthArea(DsrLocalHealthAreas dsrLocalHealthArea){
        this.dsrLocalHealthArea = dsrLocalHealthArea;
    }
    public Object getSelectedKey(){
        return selectedKey;
    }
    public void setSelectedKey(Object selectedKey){
        this.selectedKey = selectedKey;
    }
}