package ca.bc.gov.health.dsr.web;
import ca.bc.gov.health.plr.ejb.entity.*;
import ca.bc.gov.health.dsr.ejb.session.*;
import ca.bc.gov.health.jsf.BaseBean;
import java.util.List;
import javax.annotation.PostConstruct;
import javax.ejb.EJB;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import javax.faces.bean.ViewScoped;
import javax.faces.bean.ManagedBean;
import javax.faces.component.UIInput;
import javax.faces.component.UIViewRoot;

@ManagedBean(name="MaintainDsrProgramAreas")
@ViewScoped
/**
 * Backing bean for DsrProgramAreas code table maintenance
 * @author JSF Code Generator
 */
public class MaintainDsrProgramAreas extends BaseBean implements java.io.Serializable{

    /* Facade for persistence */
    @EJB
    private DsrProgramAreaFacadeLocal dsrProgramAreasFacade;

    /* List of all values in the code table */
    private List<DsrProgramAreas> allDsrProgramAreass;

    /* The instance we're currently editing */
    private DsrProgramAreas dsrProgramAreas;

    /* PK of the selected instance */
    private Object selectedKey;
    
    private boolean active = true;

    /**
     * Default Constructor
     */
    public MaintainDsrProgramAreas(){}

    /**
     * Initializes this bean after injection
     */
    @PostConstruct
    public void init(){
        allDsrProgramAreass = dsrProgramAreasFacade.findAll();
        clear();
    }

    /**
     * Adds a new record
     */
    public String add(){
        nullify();
        
        DsrProgramAreas existing = null;
        
        for (DsrProgramAreas temp : allDsrProgramAreass) {
            
            if (temp.getProgramAreaCd().equalsIgnoreCase(dsrProgramAreas.getProgramAreaCd())) {
                existing = temp;
                break;
            }
        }
        
        if (existing != null) {
            String msgStr = "Program area code '" + dsrProgramAreas.getProgramAreaCd() + "' exists already";
            FacesMessage msg = new FacesMessage(FacesMessage.SEVERITY_ERROR, msgStr, msgStr);
            FacesContext.getCurrentInstance().addMessage(null, msg);
            
            return null;
        }
        
         preUpdate();
        
        dsrProgramAreasFacade.create(dsrProgramAreas);
        FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_INFO, "Add Successful", "Add Successful"));
        init();
        ((Droplists)findBean("DsrDroplists")).init();
        return null;
    }

    /**
     * Updates an existing record
     */
    public String update(){
        nullify();
        preUpdate();
        dsrProgramAreasFacade.edit(dsrProgramAreas);
        FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_INFO, "Update Successful", "Update Successful"));
        init();
        ((Droplists)findBean("DsrDroplists")).init();
        return null;
    }

    /**
     * Deletes a record
     */
    public String delete(){
        nullify();
        dsrProgramAreasFacade.remove(dsrProgramAreas);
        init();
        ((Droplists)findBean("Droplists")).init();
        return null;
    }

    /**
     * Clears the form
     */
    public String clear(){
        selectedKey=null;
        active = true;
        dsrProgramAreas = new DsrProgramAreas();
        
        UIViewRoot viewRoot = FacesContext.getCurrentInstance().getViewRoot();

        String[] compIds = {"form1:active", "form1:pgCd", "form1:pgDesc"};

        UIInput comp;
        for (String id : compIds) {
            comp = (UIInput) viewRoot.findComponent(id);
            if (comp != null) {
                comp.resetValue();
            }
        }

        return null;
    }
    /**
     * Selects a record for editing
     */
    public String select(){
        for(int i=0; i<allDsrProgramAreass.size(); i++){
            if (allDsrProgramAreass.get(i).getProgramAreaCd().equals(selectedKey)){
                dsrProgramAreas = allDsrProgramAreass.get(i);
                preDisplay();
                break;
            }
        }
        return null;
    }
    
    public boolean isActive() {
        return active;
    }

    public void setActive(boolean active) {
        this.active = active;
    }

    private void preUpdate() {

        if (active) {
            dsrProgramAreas.setActiveYn("Y");
        } else {
            dsrProgramAreas.setActiveYn("N");
        }
    }

    private void preDisplay() {

        if (dsrProgramAreas.getActiveYn().equals("Y")) {
            active = true;
        } else {
            active = false;
        }
    }
    
    /**
     * Nullifys any parent records where proper PKs aren't set
     */
    private void nullify(){
    }
    /* Getters and Setters */
    public List<DsrProgramAreas> getAllDsrProgramAreass(){
        return allDsrProgramAreass;
    }
    public void setAllDsrProgramAreass(List<DsrProgramAreas> allDsrProgramAreass){
        this.allDsrProgramAreass = allDsrProgramAreass;
    }
    public DsrProgramAreas getDsrProgramAreas(){
        return dsrProgramAreas;
    }
    public void setDsrProgramAreas(DsrProgramAreas dsrProgramAreas){
        this.dsrProgramAreas = dsrProgramAreas;
    }
    public Object getSelectedKey(){
        return selectedKey;
    }
    public void setSelectedKey(Object selectedKey){
        this.selectedKey = selectedKey;
    }
}