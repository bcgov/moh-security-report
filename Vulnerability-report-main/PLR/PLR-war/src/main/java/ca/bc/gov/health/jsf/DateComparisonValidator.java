/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.jsf;

import java.util.Date;
import javax.faces.application.FacesMessage;
import javax.faces.component.UIComponent;
import javax.faces.component.UIInput;
import javax.faces.context.FacesContext;
import javax.faces.validator.FacesValidator;
import javax.faces.validator.Validator;
import javax.faces.validator.ValidatorException;
import org.primefaces.component.calendar.Calendar;

/**
 *
 * @author greg.perkins
 */
@FacesValidator("validator.afterDate")
public class DateComparisonValidator implements Validator{

    @Override
    public void validate(FacesContext context, UIComponent component, Object value) throws ValidatorException {
        if (value == null || ((UIInput)component).getAttributes().get("beforeDate") == null) return;
        
        Date toDate   = (Date) value; 
        String componentId = (String)((UIInput)component).getAttributes().get("beforeDate");
        Date fromDate = (Date) ((Calendar)(context.getViewRoot().findComponent(componentId))).getValue();

        if (fromDate!=null && toDate.before(fromDate)) {
            String msg = "Start Date cannot be after End Date";
            if (component.getAttributes().get("message")!=null){
                msg = (String)component.getAttributes().get("message");
            }
            FacesMessage message = new FacesMessage(msg);
            message.setSeverity(FacesMessage.SEVERITY_ERROR);
            throw new ValidatorException(message);
        }
    }

    
}
