/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.health.jsf;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import javax.faces.FacesException;
import javax.faces.application.ViewHandler;
import javax.faces.application.ViewHandlerWrapper;
import javax.faces.component.UIViewRoot;
import javax.faces.context.FacesContext;

/**
 * Custom View Expired Handler for ViewExpiredException and to restore the view
 * on the client side for JOGS.
 *
 */
public class CustomViewExpiredHandler extends ViewHandlerWrapper {

    private ViewHandler wrapped;

    private static Map<String, Boolean> viewsToProcess = new HashMap<String, Boolean>();

    //assuming the xhtml throw ViewExpiredException
    static {

        viewsToProcess.put("/Home.xhtml", true);
        viewsToProcess.put("/plr/SearchProvider.xhtml?faces-redirect=true", true);
        viewsToProcess.put("/dsr/SearchAndUpdate.xhtml?faces-redirect=true", true);

    }

    public CustomViewExpiredHandler(ViewHandler parent) {
        this.wrapped = parent;
    }

    @Override
    public ViewHandler getWrapped() {
        return wrapped;
    }

    @Override
    public UIViewRoot restoreView(FacesContext context, String viewId) {
        UIViewRoot viewRoot = super.restoreView(context, viewId);
        if (viewsToProcess.containsKey(viewId) && viewRoot == null) {
            viewRoot = super.createView(context, viewId);

            super.initView(context);
            try {
                super.renderView(context, viewRoot);
            } catch (FacesException e) {
                e.printStackTrace();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
        return viewRoot;
    }
}
