<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
*********************************************************************************************************************
 Copyright (c) 2017, Ministry of Health, BC.                                                 *
                                                                                                                    *
 All rights reserved.                                                                                               *
   This information contained herein may not be used in whole                                                       *
   or in part without the express written consent of the                                                            *
   Government of British Columbia, Canada.                                                                          *
                                                                                                                    *
 Revision Control Information                                                                                       *
 File:                $Id::                                                                                       $ *
 Date of Last Commit: $Date::                                                                                     $ *
 Revision Number:     $Rev::                                                                                      $ *
 Last Commit by:      $Author::                                                                                   $ *
                                                                                                                    *
*********************************************************************************************************************
-->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui" >

    <ui:composition rendered="#{MenuBean.setCurrentPage('/Scheduler')}" template="/resources/templates/gov30Template.xhtml">
        <ui:define name="title"> HEM - Schedule Viewer </ui:define>

        <ui:define name="content">
            <script type="text/javascript">
                if (PrimeFaces.widget.Schedule) {
                    PrimeFaces.widget.Schedule = PrimeFaces.widget.Schedule.extend({
                        setupEventHandlers: function () {
                            this._super();
                            // Override setupEventHandlers from PrimeFaces implementation of FullCalendar
                            var a = this;
                            if (this.cfg.tooltip) {
                                this.cfg.eventMouseover = function (d, c, b) {
                                    if (d.description) {
                                        var p = $("#mainFormScheduler").position();
                                        a.tipTimeout = setTimeout(function () {
                                            // Offset the tooltip by the form's position
                                            a.tip.css({left: c.pageX - p.left, top: c.pageY - p.top + 15, "z-index": ++PrimeFaces.zindex}).html(d.description).show();
                                        }, 150);
                                    }
                                };
                            }
                        }
                    });
                }
            </script>
            <style>
                <h:outputText value = "#{Scheduler.customCss}}" />
            </style>
            <h:form id="mainFormScheduler">
                <div class="col-lg-48">

                    <!-- Filter section -->
                    <div class="col-lg-10">
                        <ui:include src="/resources/templates/sideBar.xhtml" />
                    </div>

                    <!-- Scheduler -->
                    <div class="col-lg-38">
                        <link rel="stylesheet" href="resources/css/gov30primefaces.css"></link>
                        <link rel="stylesheet" href="resources/css/hemstyle.css"></link>

                        <p:tabView id="scheduleTabs"
                                   onTabShow="centerThreeMonthsViewAfterTabLoad()"
                                   widgetVar="scheduleTabs" prependId="false"
                                   dynamic="true"
                                   activeIndex="#{Scheduler.currentTabIndex}">
                            <p:ajax event="tabChange"/>
                            <p:tab title="Single Week View">
                                <p:outputPanel id="tab0">
                                    <p:commandButton action="#{Scheduler.decrementSingleWeekViewScheduleDate}"
                                                     icon ="fa-arrow-circle-o-left"
                                                     styleClass="calendar-nav-button-left"
                                                     update="mainFormScheduler"/>
                                    <p:commandButton action="#{Scheduler.incrementSingleWeekViewScheduleDate}" 
                                                     icon="fa-arrow-circle-o-right"
                                                     styleClass="calendar-nav-button-right"
                                                     update="mainFormScheduler"/>
                                    <p:commandButton action="#{Scheduler.today}"
                                                     value="Today"
                                                     styleClass="calendar-nav-button-today"
                                                     update="mainFormScheduler"/>
                                    <p:commandButton  value="Month" update="weekView" actionListener="#{Scheduler.selectView}" styleClass="calendar-view-button" process="@this">
                                        <f:attribute name="view" value="month"/>
                                    </p:commandButton >
                                    <p:commandButton  value="Week" update="weekView" actionListener="#{Scheduler.selectView}" styleClass="calendar-view-button" process="@this">
                                        <f:attribute name="view" value="agendaWeek"/>
                                    </p:commandButton >
                                    <p:commandButton  value="Day" update="weekView" actionListener="#{Scheduler.selectView}" styleClass="calendar-view-button" process="@this">
                                        <f:attribute name="view" value="agendaDay"/>
                                    </p:commandButton >
                                    <p:schedule id="weekView" 
                                                value="#{Scheduler.taskModel}" 
                                                widgetVar="weekView" 
                                                initialDate="#{Scheduler.weekViewDate}"                                                 
                                                styleClass="weekView"                                                 
                                                leftHeaderTemplate="none" 
                                                rightHeaderTemplate="none"
                                                view="#{Scheduler.view}"
                                                tooltip="true"
                                                allDaySlot="true"
                                                style="margin-bottom:20px;width:100%"
                                                clientTimeZone="local"
                                                draggable="false" 
                                                resizable="false">
                                        <p:ajax event="dateSelect" listener="#{Scheduler.onDateSelect}"/>
                                        <p:ajax event="eventSelect" 
                                                listener="#{Scheduler.onTaskSelect}"                                                  
                                                update="schedulerDialog"
                                                oncomplete="PF('schedulerDialog').show()"/>
                                    </p:schedule>
                                </p:outputPanel>
                            </p:tab>

                            <p:tab title="3 Months View">
                                <p:outputPanel id="tab1">
                                    <p:commandButton action="#{Scheduler.decrementThreeMonthView}" 
                                                     styleClass="calendar-nav-button-left"
                                                     icon ="fa-arrow-circle-o-left"
                                                     update="mainFormScheduler"
                                                     oncomplete="centerThreeMonthsViewAfterTabLoad();"/>
                                    <p:commandButton action="#{Scheduler.incrementThreeMonthView}"
                                                     icon="fa-arrow-circle-o-right"
                                                     styleClass="calendar-nav-button-right"
                                                     update="mainFormScheduler"
                                                     oncomplete="centerThreeMonthsViewAfterTabLoad();"/>
                                    <div id="ThreeMonthViewScrollArea" style="width:100%; overflow-x: scroll;">
                                        <p:panelGrid layout="grid" columns="3"
                                                     style="width:2220px;" styleClass="multi-month-grid borderless"
                                                     columnClasses="ui-grid-col-4, ui-grid-col-4, ui-grid-col-4" >

                                            <p:schedule id="schedulePrevious" value="#{Scheduler.taskModel}" 
                                                        widgetVar="schedulePrevious" 
                                                        initialDate="#{Scheduler.firstMonthView}"
                                                        styleClass="threeMonthsView"
                                                        view="month" 
                                                        tooltip="true"
                                                        draggable="false" 
                                                        resizable="false" 
                                                        leftHeaderTemplate="none" 
                                                        rightHeaderTemplate="none"
                                                        clientTimeZone="local"
                                                        style="margin-right:10px;">
                                                <p:ajax event="dateSelect" listener="#{Scheduler.onDateSelect}" 
                                                        update="weekView"/>
                                                <p:ajax event="eventSelect" listener="#{Scheduler.onTaskSelect}"
                                                        update="schedulerDialog,weekView"
                                                        oncomplete="PF('schedulerDialog').show()"/>
                                            </p:schedule>

                                            <p:schedule id="scheduleCurrent" value="#{Scheduler.taskModel}" 
                                                        widgetVar="scheduleCurrent" 
                                                        initialDate="#{Scheduler.secondMonthView}"
                                                        styleClass="threeMonthsView"
                                                        view="month" 
                                                        tooltip="true"
                                                        draggable="false" 
                                                        resizable="false" 
                                                        leftHeaderTemplate="none" 
                                                        rightHeaderTemplate="none"
                                                        clientTimeZone="local"
                                                        style="margin-right:10px;">
                                                <p:ajax event="dateSelect" listener="#{Scheduler.onDateSelect}" 
                                                        update="weekView"/>
                                                <p:ajax event="eventSelect" listener="#{Scheduler.onTaskSelect}"
                                                        update="schedulerDialog,weekView"
                                                        oncomplete="PF('schedulerDialog').show()"/>
                                            </p:schedule>

                                            <p:schedule id="scheduleNext" value="#{Scheduler.taskModel}" 
                                                        widgetVar="scheduleNext" 
                                                        initialDate="#{Scheduler.thirdMonthView}"
                                                        styleClass="threeMonthsView"
                                                        view="month" 
                                                        tooltip="true"
                                                        draggable="false" 
                                                        resizable="false" 
                                                        leftHeaderTemplate="none" 
                                                        rightHeaderTemplate="none"
                                                        clientTimeZone="local">
                                                <p:ajax event="dateSelect" listener="#{Scheduler.onDateSelect}" 
                                                        update="weekView"/>
                                                <p:ajax event="eventSelect" listener="#{Scheduler.onTaskSelect}"
                                                        update="schedulerDialog,weekView"
                                                        oncomplete="PF('schedulerDialog').show()"/>
                                            </p:schedule>
                                        </p:panelGrid>  
                                    </div>
                                </p:outputPanel>                                                            
                            </p:tab>
                        </p:tabView>
                    </div>
                </div>
            </h:form>

            <p:dialog id="schedulerDialog" 
                      widgetVar="schedulerDialog" 
                      style="background: #f9f9f9"
                      modal="true" 
                      resizable="false" 
                      appendTo="@(body)"                       
                      closable="true"
                      width="1300"
                      height="800"
                      closeOnEscape="true"
                      > 
              <p:ajax event="close" listener="#{Scheduler.close}"
                        update="mainFormScheduler:weekView,mainFormScheduler:schedulePrevious,
                        mainFormScheduler:scheduleCurrent,mainFormScheduler:scheduleNext,growl"/>
                <f:facet name="header">
                    <h:outputText id="dialogHeader" value="#{Scheduler.headerDialog}"/>
                </f:facet>                      
                <h:form id="dialogForm">
                    <ui:include src="#{Scheduler.dialogContent}"/>          
                </h:form>           
            </p:dialog>
        </ui:define>
    </ui:composition>
</html>
