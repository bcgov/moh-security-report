<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
*********************************************************************************************************************
 Copyright (c) 2017, Ministry of Health, BC.                                                 *
                                                                                                                    *
 All rights reserved.                                                                                               *
   This information contained herein may not be used in whole                                                       *
   or in part without the express written consent of the                                                            *
   Government of British Columbia, Canada.                                                                          *
                                                                                                                    *
 Revision Control Information                                                                                       *
 File:                $Id::                                                                                       $ *
 Date of Last Commit: $Date::                                                                                     $ *
 Revision Number:     $Rev::                                                                                      $ *
 Last Commit by:      $Author::                                                                                   $ *
                                                                                                                    *
*********************************************************************************************************************
-->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui" >
    <ui:composition rendered="#{MenuBean.setCurrentPage('/admin/ManageEnvironments')}" 
                    template="/resources/templates/gov30Template.xhtml">
        <ui:define name="title"> HEM - Manage Environments </ui:define>

        <ui:define name="content">
            <h:form id="formEnvironment" rendered="#{Login.userHasAdminRole}">
                <p:dataTable var="item" id="environments" 
                             value="#{manageEnvironments.environmentInfos}" 
                             editable="true" 
                             style="margin-bottom:20px;"
                             widgetVar="environments" 
                             sortBy="#{item.environmentName}"
                             rows="5"
                             paginator="true"
                             paginatorPosition="bottom"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,15,30,50"
                             rowKey="#{item.environmentId}">
                    <f:facet name="header">
                        Manage Environments
                    </f:facet>
                    
                    <p:columnGroup type="header">
                        <p:row>
                            <p:column rowspan="2" headerText="Id" style="width:50px;"/>
                            <p:column rowspan="2" headerText="Name"/>
                            <p:column colspan="7" headerText="Allowed release day" style="width:50%"/>
                            <p:column rowspan="2" id="releaseWindow" headerText="Release Window*" style="width:80px"/>
                            <p:tooltip id="releaseHelperTip" for="releaseWindow" 
                                       value="Determine the delay in day(s) between RFC creation and release allowance" 
                                       position="top"/>
                            <p:column colspan="2" headerText="Action" style="width:120px;"/>
                        </p:row>
                        <p:row>
                            <p:column headerText="Sunday"/>
                            <p:column headerText="Monday"/>
                            <p:column headerText="Tuesday"/>
                            <p:column headerText="Wednesday"/>
                            <p:column headerText="Thursday"/>
                            <p:column headerText="Friday"/>
                            <p:column headerText="Saturday"/>
                            
                            <p:column headerText="Edit"/>
                            <p:column headerText="Delete"/>
                        </p:row>
                    </p:columnGroup>

                    <p:column style="text-align:center" sortBy="#{item.environmentId}">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{item.environmentId}" />
                            </f:facet>
                            <f:facet name="input">
                                <h:outputText value="#{item.environmentId}" />
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column style="text-align:center" sortBy="#{item.environmentName}">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{item.environmentName}" />
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{item.environmentName}" style="width:96%;"
                                             label="Name" required="true" 
                                             requiredMessage="#{bundle.EnvironmentNameRequiredMessage}">
                                    <f:attribute name="currentId" value="#{item.environmentId}"/>
                                    <f:attribute name="errorMessage" value=""/>
                                    <f:validator binding="#{environmentValidator}"/>
                                </p:inputText>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>
                    <p:column style="text-align:center">                       
                        <p:selectBooleanCheckbox 
                                    id="sundayCheckbox"
                                    disabled="#{!item.beingEdited}"
                                    value="#{item.sundayChecked}"
                                    style="text-align:center;"/>
                    </p:column>
                    <p:column style="text-align:center">
                        <p:selectBooleanCheckbox
                                    id="mondayCheckbox"
                                    disabled="#{!item.beingEdited}"
                                    value="#{item.mondayChecked}"
                                    style="text-align:center;"/>
                    </p:column>
                    <p:column style="text-align:center">
                        <p:selectBooleanCheckbox
                                    id="tuesdayCheckbox"                                    
                                    disabled="#{!item.beingEdited}"
                                    value="#{item.tuesdayChecked}"
                                    style="text-align:center;"/>
                    </p:column>
                    <p:column style="text-align:center">
                         <p:selectBooleanCheckbox
                                    id="wednesdayCheckbox"
                                    disabled="#{!item.beingEdited}"
                                    value="#{item.wednesdayChecked}"                                    
                                    style="text-align:center;"/>
                    </p:column>
                    <p:column style="text-align:center">
                         <p:selectBooleanCheckbox
                                    id="thursdayCheckbox"
                                    disabled="#{!item.beingEdited}"
                                    value="#{item.thursdayChecked}"                                    
                                    style="text-align:center;"/>
                    </p:column>
                    <p:column style="text-align:center">
                         <p:selectBooleanCheckbox
                                    id="fridayCheckbox"
                                    disabled="#{!item.beingEdited}"
                                    value="#{item.fridayChecked}"                                    
                                    style="text-align:center;"/>
                    </p:column>
                    <p:column style="text-align:center">
                         <p:selectBooleanCheckbox
                                    id="saturdayCheckbox"
                                    disabled="#{!item.beingEdited}"
                                    value="#{item.saturdayChecked}"                                    
                                    style="text-align:center;"/>
                    </p:column>
                    <p:column style ="text-align:center">
                        <p:inputNumber
                                id="releaseWindowInput"
                                disabled="#{!item.beingEdited}"
                                value="#{item.environmentReleaseWindow}"
                                minValue="0"
                                maxValue="365"
                                class="release-window-input"
                                >
                        </p:inputNumber>
                    </p:column>
                    <p:column rendered="#{Login.userHasAdminRole}" style="text-align:center;">
                        <p:rowEditor editTitle="Edit the environment"/>
                    </p:column>
                    <p:column rendered="#{Login.userHasAdminRole}">
                        <p:commandLink
                            type="button"
                            actionListener="#{manageEnvironments.openDeleteEnvironmentPopup(item)}"
                            styleClass="ui-icon ui-icon-trash"                           
                            update="formEnvironment:ConfirmDialog" ajax="true"
                            style="width:16px; margin:auto;"
                            title="Delete the environment"/>
                    </p:column>

                    <p:ajax event="rowEdit" listener="#{manageEnvironments.onRowEdit}"/>
                    <p:ajax event="rowEditCancel" listener="#{manageEnvironments.onRowCancel}" update="growl" />
                    <p:ajax event="rowEditInit" listener="#{manageEnvironments.onRowInit}"/>

                </p:dataTable>
                <p:confirmDialog id="ConfirmDialog" showEffect="fade" hideEffect="fade"
                                 header="Action confirmation"
                                 message="#{manageEnvironments.confirmationMessage()}"
                                 severity="alert"
                                 widgetVar="ConfirmDialog">
                    <p:commandButton value="Yes"
                                     styleClass="ui-confirmdialog-yes"
                                     icon="ui-icon-check"
                                     actionListener="#{manageEnvironments.removeEntity()}"
                                     update="@this,:formEnvironment:environments"/>
                    <p:commandButton value="No"
                                     styleClass="ui-confirmdialog-no"
                                     icon="ui-icon-close"
                                     update="@this"
                                     actionListener="#{manageEnvironments.closeDeleteEnvironmentPopup()}"/>
                </p:confirmDialog>
            </h:form>
            <p:dialog id="newEntityDialog" 
                      widgetVar="newEntityDialog" style="background: #f9f9f9"
                      modal="true" resizable="false" 
                      appendTo="@(body)" header="New Environment" 
                      closable="true"
                      rendered="#{Login.userHasAdminRole}">
                <p:ajax ignoreAutoUpdate="true" event="close" 
                        listener="#{manageEnvironments.updateData}" 
                        update=":formEnvironment:environments" />
                <h:form id="dialogForm">
                    <ui:include src="Environment.xhtml"/>
                </h:form>
            </p:dialog>
        </ui:define> 
    </ui:composition>
</html>
