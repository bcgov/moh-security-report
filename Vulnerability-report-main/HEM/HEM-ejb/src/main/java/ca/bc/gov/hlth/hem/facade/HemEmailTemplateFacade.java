package ca.bc.gov.hlth.hem.facade;

import ca.bc.gov.hlth.hem.entity.HemEmailTemplate;
import java.sql.Timestamp;
import java.time.Instant;

import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;
import javax.validation.ConstraintViolation;
import javax.validation.ConstraintViolationException;
import java.time.LocalDateTime;
import java.util.List;
import java.util.Set;
import java.util.logging.Level;
import java.util.logging.Logger;

@Stateless
public class HemEmailTemplateFacade extends AbstractFacade<HemEmailTemplate> implements HemEmailTemplateFacadeLocal {

    private static final String CLASSNAME = HemEmailTemplateFacade.class.getSimpleName();
    private static final Logger LOGGER = Logger.getLogger(CLASSNAME);

    @PersistenceContext(unitName = "HEM-pu")
    private EntityManager em;

    @Override
    protected EntityManager getEntityManager() {
        return em;
    }

    public HemEmailTemplateFacade() {
        super(HemEmailTemplate.class);
    }

    @Override
    public HemEmailTemplate find(Object id) {
        return em.find(HemEmailTemplate.class, id);
    }

    @Override
    public List<HemEmailTemplate> findAll() {
        Query query = em.createNamedQuery("HemEmailTemplate.findAll");
        query.setParameter("archived", false);

        return query.getResultList();
    }

    @Override
    public HemEmailTemplate findByEmailId(Integer param) {
        Query query = em.createNamedQuery("HemEmailNotification.findByEmailId");
        query.setParameter("emailId", param);
        return (HemEmailTemplate) query.getSingleResult();
    }

    @Override
    public StringBuffer buildNotOutageEmailTemplate() {
        StringBuffer sB = new StringBuffer();

        // Add the header    
        sB.append(buildHeader());

        /*
        sB.append("<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-CA");
        sB.append("style='mso-bidi-font-size:10.0pt;mso-bidi-font-family:Arial;mso-ansi-language:");
        sB.append("EN-CA'>Subject Line Instructions:</span></b></p>");
        sB.append("<p class=MsoNormal style='margin-left:45.0pt;text-indent:-45.0pt'><span");
        sB.append("lang=EN-CA style='mso-ansi-language:EN-CA'><span style='mso-tab-count:");
        sB.append("1'> </span>NOTIFICATION: EMPI/HCIM HI3 Integration (Non-Production) Environment");
        sB.append("– Wednesday, September 18, 2019</span></p>");
         */
        // Audience section (parameter #1)
        sB.append("<p class=MsoTitle><span lang=EN-CA style='mso-bidi-font-size:10.0pt;mso-bidi-font-family:");
        sB.append("Arial;mso-ansi-language:EN-CA'>User Impact:</span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        //All users of the HCIM/EMPI Integration/Test environments (HI1 and HI4) application.
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>{1}</span></p>");

        // Date and time section (parameter #2, #3 & #4)
        sB.append("<p class=MsoTitle><span lang=EN-CA style='mso-bidi-font-size:10.0pt;mso-bidi-font-family:");
        sB.append("Arial;mso-ansi-language:EN-CA'>Date and Time:</span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>The change will");
        // Wednesday, September 18, 2019 from 12:00 pm to 2:00 pm.
        // Full date
        sB.append("occur on {2} from {3} to {4}.</span></p>");

        // Description section (parameter #5)
        sB.append("<p class=MsoTitle><span lang=EN-CA style='mso-bidi-font-size:10.0pt;mso-bidi-font-family:");
        sB.append("Arial;mso-ansi-language:EN-CA'>Description:</span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        // The change is required to deploy the HCIM.7.0.1 release.
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>{5}</span></p>");

        // Duration section (parameter #6)
        sB.append("<p class=MsoTitle><span lang=EN-US style='mso-ansi-language:EN-US'>Estimated");
        sB.append("Time:</span><span lang=EN-CA style='mso-ansi-language:EN-CA'></span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>The estimated time length");
        sB.append("of time to implement this change is {6}.</span></p>");

        // RFC link section (parameter #7)
        sB.append("<p class=MsoTitle><span lang=EN-US style='mso-ansi-language:EN-US'>RFC");
        sB.append("Reference:</span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-ansi-language:EN-CA'>The RFC for");
        sB.append("this work is {7}.</span></p>");

        // Testing & verification steps section (pârameter #8)
        sB.append("<p class=MsoTitle><span lang=EN-US style='mso-ansi-language:EN-US'>Testing and");
        sB.append("Verification:</span><span lang=EN-CA style='mso-ansi-language:EN-CA'></span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        //End users please verify that issue <u><span style='mso-spacerun:yes'> </span>X </u><span style='mso-spacerun:yes'> </span>has been resolved.
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>{8}</span></p>");

        // Add the footor
        sB.append(buildFooter());

        return sB;
    }

    @Override
    public StringBuffer buildOutageEmailTemplate() {
        StringBuffer sB = new StringBuffer();

        // Add the header    
        sB.append(buildHeader());

        // Audience section (parameter #1)
        sB.append("<p class=MsoTitle><span lang=EN-CA style='mso-bidi-font-size:10.0pt;mso-bidi-font-family:");
        sB.append("Arial;mso-ansi-language:EN-CA'>User Impact:</span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        //All users of the HCIM/EMPI Integration/Test environments (HI1 and HI4) application.
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>{1}</span></p>");

        // Date and time section (parameter #2, #3 & #4)
        sB.append("<p class=MsoTitle><span lang=EN-CA style='mso-bidi-font-size:10.0pt;mso-bidi-font-family:");
        sB.append("Arial;mso-ansi-language:EN-CA'>Date and Time:</span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>The change will");
        // Wednesday, September 18, 2019 from 12:00 pm to 2:00 pm.
        // Full date
        sB.append("occur on {2} from {3} to {4}.</span></p>");

        // Description section (parameter #5)
        sB.append("<p class=MsoTitle><span lang=EN-CA style='mso-bidi-font-size:10.0pt;mso-bidi-font-family:");
        sB.append("Arial;mso-ansi-language:EN-CA'>Description:</span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        // The change is required to deploy the HCIM.7.0.1 release.
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>{5}</span></p>");

        // Duration section (parameter #6)
        sB.append("<p class=MsoTitle><span lang=EN-US style='mso-ansi-language:EN-US'>Estimated");
        sB.append("Time:</span><span lang=EN-CA style='mso-ansi-language:EN-CA'></span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>The estimated time length");
        sB.append("of time to implement this change is {6}.</span></p>");

        // RFC link section (parameter #7)
        sB.append("<p class=MsoTitle><span lang=EN-US style='mso-ansi-language:EN-US'>RFC");
        sB.append("Reference:</span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-ansi-language:EN-CA'>The RFC for");
        sB.append("this work is {7}.</span></p>");

        // Testing & verification steps section (pârameter #8)
        sB.append("<p class=MsoTitle><span lang=EN-US style='mso-ansi-language:EN-US'>Testing and");
        sB.append("Verification:</span><span lang=EN-CA style='mso-ansi-language:EN-CA'></span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        //End users please verify that issue <u><span style='mso-spacerun:yes'> </span>X </u><span style='mso-spacerun:yes'> </span>has been resolved.
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>{8}</span></p>");

        // Add the footor
        sB.append(buildFooter());

        return sB;
    }

    private StringBuffer buildHeader() {
        StringBuffer sB = new StringBuffer();
        sB.append("<html");
        sB.append("xmlns:v=\"urn:schemas-microsoft-com:vml\"");
        sB.append("xmlns:o=\"urn:schemas-microsoft-com:office:office\"");
        sB.append("xmlns:w=\"urn:schemas-microsoft-com:office:word\"");
        sB.append("xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\"");
        sB.append("xmlns=\"http://www.w3.org/TR/REC-html40\">");
        sB.append("<head>");
        sB.append("    <meta http-equiv=Content-Type content=\"text/html; charset=iso-8859-1\" />");
        sB.append("    <meta name=Generator content=\"Microsoft Word 15 (filtered medium)\" />");
        sB.append("    <style>");
        sB.append("        <!--");
        sB.append("        /* Font Definitions */");
        sB.append("        @font-face");
        sB.append("        {font-family:\"Cambria Math\";");
        sB.append("         panose-1:2 4 5 3 5 4 6 3 2 4;}");
        sB.append("        @font-face");
        sB.append("        {font-family:Calibri;");
        sB.append("         panose-1:2 15 5 2 2 2 4 3 2 4;}");
        sB.append("        @font-face");
        sB.append("        {font-family:Tahoma;");
        sB.append("         panose-1:2 11 6 4 3 5 4 4 2 4;}");
        sB.append("        /* Style Definitions */");
        sB.append("        p.MsoNormal, li.MsoNormal, div.MsoNormal");
        sB.append("        {margin:0cm;");
        sB.append("         margin-bottom:.0001pt;");
        sB.append("         font-size:11.0pt;");
        sB.append("         font-family:\"Calibri\",sans-serif;}");
        sB.append("        a:link, span.MsoHyperlink");
        sB.append("        {mso-style-priority:99;");
        sB.append("         color:#0563C1;");
        sB.append("         text-decoration:underline;}");
        sB.append("        a:visited, span.MsoHyperlinkFollowed");
        sB.append("        {mso-style-priority:99;");
        sB.append("         color:#954F72;");
        sB.append("         text-decoration:underline;}");
        sB.append("        p.msonormal0, li.msonormal0, div.msonormal0");
        sB.append("        {mso-style-name:msonormal;");
        sB.append("         mso-margin-top-alt:auto;");
        sB.append("         margin-right:0cm;");
        sB.append("         mso-margin-bottom-alt:auto;");
        sB.append("         margin-left:0cm;");
        sB.append("         font-size:12.0pt;");
        sB.append("         font-family:\"Times New Roman\",serif;}");
        sB.append("        span.EmailStyle18");
        sB.append("        {mso-style-type:personal;");
        sB.append("         font-family:\"Calibri\",sans-serif;");
        sB.append("         color:windowtext;}");
        sB.append("        span.EmailStyle19");
        sB.append("        {mso-style-type:personal-reply;");
        sB.append("         font-family:\"Calibri\",sans-serif;");
        sB.append("         color:windowtext;");
        sB.append("         font-weight:normal;");
        sB.append("         font-style:normal;");
        sB.append("         text-decoration:none none;}");
        sB.append("        .MsoChpDefault");
        sB.append("        {mso-style-type:export-only;");
        sB.append("         font-size:10.0pt;}");
        sB.append("        @page WordSection1");
        sB.append("        {size:612.0pt 792.0pt;");
        sB.append("         margin:72.0pt 90.0pt 72.0pt 90.0pt;}");
        sB.append("        div.WordSection1");
        sB.append("sB.append(\"        {page:WordSection1;}");
        sB.append("        -->");
        sB.append("    </style>");
        sB.append("</head>");
        sB.append("<body lang=EN-US link=\"#0563C1\" vlink=\"#954F72\">");
        sB.append("    <div class=WordSection1>");
        sB.append("    </div>");
        sB.append("</body>");
        sB.append("</html>");
        //throw new UnsupportedOperationException("Not supported yet.");
        sB.append("<html xmlns=\"http://www.w3.org/TR/REC-html40\">");
        sB.append("<head>");
        sB.append("<meta http-equiv=Content-Type content=\"text/html; charset=windows-1252\">");
        sB.append("<meta name=Generator content=\"HEM\">");
        sB.append("<meta name=Originator content=\"HEM\">");
        sB.append("<style>");
        sB.append("<!--");
        sB.append("/* Font Definitions */");
        sB.append("@font-face");
        sB.append("{font-family:Wingdings;");
        sB.append("panose-1:5 0 0 0 0 0 0 0 0 0;");
        sB.append("mso-font-charset:2;");
        sB.append("mso-generic-font-family:auto;");
        sB.append("mso-font-pitch:variable;");
        sB.append("mso-font-signature:0 268435456 0 0 -2147483648 0;}");
        sB.append("@font-face");
        sB.append("{font-family:\"Cambria Math\";");
        sB.append("panose-1:2 4 5 3 5 4 6 3 2 4;");
        sB.append("mso-font-charset:1;");
        sB.append("mso-generic-font-family:roman;");
        sB.append("mso-font-pitch:variable;");
        sB.append("mso-font-signature:-536869121 1107305727 33554432 0 415 0;}");
        sB.append("@font-face");
        sB.append("{font-family:Calibri;");
        sB.append("panose-1:2 15 5 2 2 2 4 3 2 4;");
        sB.append("mso-font-charset:0;");
        sB.append("mso-generic-font-family:swiss;");
        sB.append("mso-font-pitch:variable;");
        sB.append("mso-font-signature:-536858881 -1073732485 9 0 511 0;}");
        sB.append("@font-face");
        sB.append("{font-family:Tahoma;");
        sB.append("panose-1:2 11 6 4 3 5 4 4 2 4;");
        sB.append("mso-font-charset:0;");
        sB.append("mso-generic-font-family:swiss;");
        sB.append("mso-font-pitch:variable;");
        sB.append("mso-font-signature:-520081665 -1073717157 41 0 66047 0;}");
        sB.append("/* Style Definitions */");
        sB.append("p.MsoNormal, li.MsoNormal, div.MsoNormal");
        sB.append("{mso-style-unhide:no;");
        sB.append("mso-style-qformat:yes;");
        sB.append("mso-style-parent:\"\";");
        sB.append("margin:0cm;");
        sB.append("margin-bottom:.0001pt;");
        sB.append("mso-pagination:widow-orphan;");
        sB.append("font-size:10.0pt;");
        sB.append("mso-bidi-font-size:11.0pt;");
        sB.append("font-family:\"Arial\",sans-serif;");
        sB.append("mso-fareast-font-family:Calibri;");
        sB.append("mso-fareast-theme-font:minor-latin;");
        sB.append("mso-bidi-font-family:\"Times New Roman\";");
        sB.append("mso-bidi-theme-font:minor-bidi;}");
        sB.append("p.MsoTitle, li.MsoTitle, div.MsoTitle");
        sB.append("{mso-style-priority:10;");
        sB.append("mso-style-unhide:no;");
        sB.append("mso-style-qformat:yes;");
        sB.append("mso-style-link:\"Titre Car\";");
        sB.append("mso-style-next:Normal;");
        sB.append("margin-top:18.0pt;");
        sB.append("margin-right:0cm;");
        sB.append("margin-bottom:2.0pt;");
        sB.append("margin-left:0cm;");
        sB.append("mso-pagination:widow-orphan;");
        sB.append("font-size:10.0pt;");
        sB.append("mso-bidi-font-size:11.0pt;");
        sB.append("font-family:\"Arial\",sans-serif;");
        sB.append("mso-fareast-font-family:Calibri;");
        sB.append("mso-fareast-theme-font:minor-latin;");
        sB.append("mso-bidi-font-family:\"Times New Roman\";");
        sB.append("mso-bidi-theme-font:minor-bidi;");
        sB.append("font-weight:bold;");
        sB.append("mso-bidi-font-weight:normal;}");
        sB.append("a:link, span.MsoHyperlink");
        sB.append("{mso-style-noshow:yes;");
        sB.append("mso-style-priority:99;");
        sB.append("color:#0563C1;");
        sB.append("mso-themecolor:hyperlink;");
        sB.append("text-decoration:underline;");
        sB.append("text-underline:single;}");
        sB.append("a:visited, span.MsoHyperlinkFollowed");
        sB.append("{mso-style-noshow:yes;");
        sB.append("mso-style-priority:99;");
        sB.append("color:#954F72;");
        sB.append("mso-themecolor:followedhyperlink;");
        sB.append("text-decoration:underline;");
        sB.append("text-underline:single;}");
        sB.append("p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph");
        sB.append("{mso-style-priority:34;");
        sB.append("mso-style-unhide:no;");
        sB.append("mso-style-qformat:yes;");
        sB.append("margin-top:0cm;");
        sB.append("margin-right:0cm;");
        sB.append("margin-bottom:0cm;");
        sB.append("margin-left:36.0pt;");
        sB.append("margin-bottom:.0001pt;");
        sB.append("text-indent:-18.0pt;");
        sB.append("mso-pagination:widow-orphan;");
        sB.append("mso-list:l0 level1 lfo2;");
        sB.append("font-size:10.0pt;");
        sB.append("mso-bidi-font-size:11.0pt;");
        sB.append("font-family:\"Calibri\",sans-serif;");
        sB.append("mso-fareast-font-family:Calibri;");
        sB.append("mso-fareast-theme-font:minor-latin;}");
        sB.append("p.msonormal0, li.msonormal0, div.msonormal0");
        sB.append("{mso-style-name:msonormal;");
        sB.append("mso-style-unhide:no;");
        sB.append("mso-margin-top-alt:auto;");
        sB.append("margin-right:0cm;");
        sB.append("mso-margin-bottom-alt:auto;");
        sB.append("margin-left:0cm;");
        sB.append("mso-pagination:widow-orphan;");
        sB.append("font-size:12.0pt;");
        sB.append("font-family:\"Times New Roman\",serif;");
        sB.append("mso-fareast-font-family:Calibri;");
        sB.append("mso-fareast-theme-font:minor-latin;}");
        sB.append("span.TitreCar");
        sB.append("{mso-style-name:\"Titre Car\";");
        sB.append("mso-style-priority:10;");
        sB.append("mso-style-unhide:no;");
        sB.append("mso-style-locked:yes;");
        sB.append("mso-style-link:Titre;");
        sB.append("mso-ansi-font-size:28.0pt;");
        sB.append("mso-bidi-font-size:28.0pt;");
        sB.append("font-family:\"Calibri Light\",sans-serif;");
        sB.append("mso-ascii-font-family:\"Calibri Light\";");
        sB.append("mso-ascii-theme-font:major-latin;");
        sB.append("mso-fareast-font-family:\"Times New Roman\";");
        sB.append("mso-fareast-theme-font:major-fareast;");
        sB.append("mso-hansi-font-family:\"Calibri Light\";");
        sB.append("mso-hansi-theme-font:major-latin;");
        sB.append("mso-bidi-font-family:\"Times New Roman\";");
        sB.append("mso-bidi-theme-font:major-bidi;");
        sB.append("letter-spacing:-.5pt;");
        sB.append("mso-font-kerning:14.0pt;}");
        sB.append("p.Instructions, li.Instructions, div.Instructions");
        sB.append("{mso-style-name:Instructions;");
        sB.append("mso-style-unhide:no;");
        sB.append("mso-style-qformat:yes;");
        sB.append("margin:0cm;");
        sB.append("margin-bottom:.0001pt;");
        sB.append("mso-pagination:widow-orphan;");
        sB.append("font-size:10.0pt;");
        sB.append("mso-bidi-font-size:11.0pt;");
        sB.append("font-family:\"Arial\",sans-serif;");
        sB.append("mso-fareast-font-family:Calibri;");
        sB.append("mso-fareast-theme-font:minor-latin;");
        sB.append("mso-bidi-font-family:\"Times New Roman\";");
        sB.append("mso-bidi-theme-font:minor-bidi;");
        sB.append("color:blue;");
        sB.append("font-style:italic;");
        sB.append("mso-bidi-font-style:normal;}");
        sB.append("p.Title, li.Title, div.Title");
        sB.append("{mso-style-name:Title;");
        sB.append("mso-style-unhide:no;");
        sB.append("mso-style-link:\"Title Char\";");
        sB.append("margin:0cm;");
        sB.append("margin-bottom:.0001pt;");
        sB.append("mso-pagination:widow-orphan;");
        sB.append("font-size:10.0pt;");
        sB.append("mso-bidi-font-size:11.0pt;");
        sB.append("font-family:\"Arial\",sans-serif;");
        sB.append("mso-fareast-font-family:Calibri;");
        sB.append("mso-fareast-theme-font:minor-latin;");
        sB.append("mso-bidi-font-family:\"Times New Roman\";");
        sB.append("mso-bidi-theme-font:minor-bidi;}");
        sB.append("span.TitleChar");
        sB.append("{mso-style-name:\"Title Char\";");
        sB.append("mso-style-priority:10;");
        sB.append("mso-style-unhide:no;");
        sB.append("mso-style-locked:yes;");
        sB.append("mso-style-link:Title;");
        sB.append("mso-ansi-font-size:10.0pt;");
        sB.append("font-family:\"Arial\",sans-serif;");
        sB.append("mso-ascii-font-family:Arial;");
        sB.append("mso-hansi-font-family:Arial;");
        sB.append("mso-bidi-font-family:Arial;");
        sB.append("font-weight:bold;");
        sB.append("mso-bidi-font-weight:normal;}");
        sB.append("span.EmailStyle24");
        sB.append("{mso-style-type:personal-compose;");
        sB.append("mso-style-noshow:yes;");
        sB.append("mso-style-unhide:no;");
        sB.append("mso-ansi-font-size:10.0pt;");
        sB.append("mso-bidi-font-size:10.0pt;");
        sB.append("font-family:\"Calibri\",sans-serif;");
        sB.append("mso-ascii-font-family:Calibri;");
        sB.append("mso-hansi-font-family:Calibri;");
        sB.append("mso-bidi-font-family:Arial;");
        sB.append("color:windowtext;");
        sB.append("mso-text-animation:none;");
        sB.append("font-weight:normal;");
        sB.append("font-style:normal;");
        sB.append("text-decoration:none;");
        sB.append("text-underline:none;");
        sB.append("text-decoration:none;");
        sB.append("text-line-through:none;}");
        sB.append(".MsoChpDefault");
        sB.append("{mso-style-type:export-only;");
        sB.append("mso-default-props:yes;");
        sB.append("font-size:10.0pt;");
        sB.append("mso-ansi-font-size:10.0pt;");
        sB.append("mso-bidi-font-size:10.0pt;");
        sB.append("font-family:\"Calibri\",sans-serif;");
        sB.append("mso-ascii-font-family:Calibri;");
        sB.append("mso-ascii-theme-font:minor-latin;");
        sB.append("mso-fareast-font-family:Calibri;");
        sB.append("mso-fareast-theme-font:minor-latin;");
        sB.append("mso-hansi-font-family:Calibri;");
        sB.append("mso-hansi-theme-font:minor-latin;");
        sB.append("mso-bidi-font-family:\"Times New Roman\";");
        sB.append("mso-bidi-theme-font:minor-bidi;}");
        sB.append("@page WordSection1");
        sB.append("{size:612.0pt 792.0pt;");
        sB.append("margin:72.0pt 72.0pt 72.0pt 72.0pt;");
        sB.append("mso-header-margin:36.0pt;");
        sB.append("mso-footer-margin:36.0pt;");
        sB.append("mso-paper-source:0;}");
        sB.append("div.WordSection1");
        sB.append("{page:WordSection1;}");
        sB.append("/* List Definitions */");
        sB.append("@list l0");
        sB.append("{mso-list-id:1839807853;");
        sB.append("mso-list-type:hybrid;");
        sB.append("mso-list-template-ids:1797182530 -1446357472 269025283 269025285 269025281 269025283 269025285 269025281 269025283 269025285;}");
        sB.append("@list l0:level1");
        sB.append("{mso-level-number-format:bullet;");
        sB.append("mso-level-text:\\F0B7;");
        sB.append("mso-level-tab-stop:none;");
        sB.append("mso-level-number-position:left;");
        sB.append("text-indent:-18.0pt;");
        sB.append("font-family:Symbol;}");
        sB.append("@list l0:level2");
        sB.append("{mso-level-number-format:bullet;");
        sB.append("mso-level-text:o;");
        sB.append("mso-level-tab-stop:none;");
        sB.append("mso-level-number-position:left;");
        sB.append("text-indent:-18.0pt;");
        sB.append("font-family:\"Courier New\";}");
        sB.append("@list l0:level3");
        sB.append("{mso-level-number-format:bullet;");
        sB.append("mso-level-text:\\F0A7;");
        sB.append("mso-level-tab-stop:none;");
        sB.append("mso-level-number-position:left;");
        sB.append("text-indent:-18.0pt;");
        sB.append("font-family:Wingdings;}");
        sB.append("@list l0:level4");
        sB.append("{mso-level-number-format:bullet;");
        sB.append("mso-level-text:\\F0B7;");
        sB.append("mso-level-tab-stop:none;");
        sB.append("mso-level-number-position:left;");
        sB.append("text-indent:-18.0pt;");
        sB.append("font-family:Symbol;}");
        sB.append("@list l0:level5");
        sB.append("{mso-level-number-format:bullet;");
        sB.append("mso-level-text:o;");
        sB.append("mso-level-tab-stop:none;");
        sB.append("mso-level-number-position:left;");
        sB.append("text-indent:-18.0pt;");
        sB.append("font-family:\"Courier New\";}");
        sB.append("@list l0:level6");
        sB.append("{mso-level-number-format:bullet;");
        sB.append("mso-level-text:\\F0A7;");
        sB.append("mso-level-tab-stop:none;");
        sB.append("mso-level-number-position:left;");
        sB.append("text-indent:-18.0pt;");
        sB.append("font-family:Wingdings;}");
        sB.append("@list l0:level7");
        sB.append("{mso-level-number-format:bullet;");
        sB.append("mso-level-text:\\F0B7;");
        sB.append("mso-level-tab-stop:none;");
        sB.append("mso-level-number-position:left;");
        sB.append("text-indent:-18.0pt;");
        sB.append("font-family:Symbol;}");
        sB.append("@list l0:level8");
        sB.append("{mso-level-number-format:bullet;");
        sB.append("mso-level-text:o;");
        sB.append("mso-level-tab-stop:none;");
        sB.append("mso-level-number-position:left;");
        sB.append("text-indent:-18.0pt;");
        sB.append("font-family:\"Courier New\";}");
        sB.append("@list l0:level9");
        sB.append("{mso-level-number-format:bullet;");
        sB.append("mso-level-text:\\F0A7;");
        sB.append("mso-level-tab-stop:none;");
        sB.append("mso-level-number-position:left;");
        sB.append("text-indent:-18.0pt;");
        sB.append("font-family:Wingdings;}");
        sB.append("ol");
        sB.append("{margin-bottom:0cm;}");
        sB.append("ul");
        sB.append("{margin-bottom:0cm;}");
        sB.append("-->");
        sB.append("</style>");
        sB.append("</head>");

        sB.append("<body lang=FR-CA link=\"#0563C1\" vlink=\"#954F72\" style='tab-interval:36.0pt'>");

        sB.append("<div class=WordSection1>");

        sB.append("<p class=MsoNormal>&nbsp;</p>");

        // Image section (parameter #0)
        sB.append("<p class=MsoNormal><span style='mso-bidi-font-size:10.0pt;mso-bidi-font-family:");
        sB.append("Arial;mso-no-proof:yes'><img width=626 height=42");
        //"CGI-AMS%20Notification%20Email%20Template_fichiers/image002.png" test
        //sB.append("src='{0}'");
        sB.append("src=\"http://www.health.gov.bc.ca/images/it-services-banner.png\"");        
        sB.append("alt=\"Outage Notification Banner\"></span><span");
        sB.append("lang=EN-CA style='mso-bidi-font-size:10.0pt;mso-bidi-font-family:Arial;");
        sB.append("mso-ansi-language:EN-CA'></span></p>");

        // 2 verticals spaces
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>&nbsp;</span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>&nbsp;</span></p>");

        return sB;
    }

    private StringBuffer buildFooter() {
        StringBuffer sB = new StringBuffer();

        // Static info section
        sB.append("<p class=MsoTitle><span lang=EN-CA style='mso-bidi-font-size:10.0pt;mso-bidi-font-family:");
        sB.append("Arial;mso-ansi-language:EN-CA'>Contact:</span></p>");
        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>If you have any questions");
        sB.append("about this change please contact your SBC (Senior Business Consultant)</span></p>");

        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>If you experience any");
        sB.append("issues with the listed applications after the change, please contact the MOH");
        sB.append("Helpdesk (<a href=\"mailto:HLTH.Helpdesk@gov.bc.ca\">HLTH.Helpdesk@gov.bc.ca</a>)</span></p>");

        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>&nbsp;</span></p>");

        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>Regards,</span></p>");

        sB.append("<p class=MsoNormal><span lang=EN-CA style='mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>&nbsp;</span></p>");

        // Signature section
        sB.append("<p class=MsoNormal><span lang=EN-CA style='font-size:9.0pt;mso-bidi-font-size:");
        sB.append("10.0pt;mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>_________________________</span></p>");

        sB.append("<p class=MsoNormal><span lang=EN-CA style='font-size:9.0pt;mso-bidi-font-size:");
        sB.append("10.0pt;mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>[Your Name] | [Your");
        sB.append("Title]</span></p>");

        sB.append("<p class=MsoNormal><span lang=EN-CA style='font-size:9.0pt;mso-bidi-font-size:");
        sB.append("10.0pt;mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>CGI | 1175 Douglas");
        sB.append("Street, 6<sup>th</sup> Floor, Victoria, B.C. V8W 2E1</span></p>");

        sB.append("<p class=MsoNormal><span lang=EN-CA style='font-size:9.0pt;mso-bidi-font-size:");
        sB.append("10.0pt;mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>T: _________________</span></p>");

        sB.append("<p class=MsoNormal><span lang=EN-CA style='font-size:9.0pt;mso-bidi-font-size:");
        sB.append("10.0pt;mso-bidi-font-family:Arial;mso-ansi-language:EN-CA'>[Your email address]");
        sB.append("| </span><span lang=EN-CA style='mso-ansi-language:EN-CA'><a");
        sB.append("href=\"http://www.cgi.com\"><span style='font-size:9.0pt;mso-bidi-font-size:10.0pt;");
        sB.append("mso-bidi-font-family:Arial'>www.cgi.com</span></a></span><span lang=EN-CA");
        sB.append("style='font-size:9.0pt;mso-bidi-font-size:10.0pt;mso-bidi-font-family:Arial;");
        sB.append("mso-ansi-language:EN-CA'></span></p>");

        sB.append("</div>");

        sB.append("</body>");

        sB.append("</html>");

        return sB;
    }

    @Override
    public void create(HemEmailTemplate h, String username) {
        h.setCreatedBy(username);
        h.setCreatedDate(Timestamp.from(Instant.now()));

        h.setLastModifiedBy(username);
        h.setLastModifiedDate(Timestamp.from(Instant.now()));

        try {
            em.persist(h);
        } catch (Exception e) {
            ConstraintViolationException ve = (ConstraintViolationException) e.getCause();
            Set<ConstraintViolation<?>> violations = ve.getConstraintViolations();
            LOGGER.log(Level.SEVERE, violations.toString());
        }
    }

    @Override
    public void edit(HemEmailTemplate h, String username) {
        h.setLastModifiedBy(username);
        h.setLastModifiedDate(Timestamp.from(Instant.now()));

        em.merge(h);
    }

    @Override
    public void remove(HemEmailTemplate h, String username) {
        h.setArchived(true);
        h.setArchivedBy(username);
        h.setArchivedDate(Timestamp.from(Instant.now()));

        edit(h);
    }
}
