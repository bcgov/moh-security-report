package ca.bc.gov.hlth.hem.facade;

import ca.bc.gov.hlth.hem.entity.HemAvailabilityImpact;

import javax.ejb.Stateless;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.Query;
import java.time.LocalDateTime;
import java.util.List;

@Stateless
public class HemAvailabilityImpactFacade extends AbstractFacade<HemAvailabilityImpact> implements HemAvailabilityImpactFacadeLocal {

    @PersistenceContext(unitName = "HEM-pu")
    private EntityManager em;

    public HemAvailabilityImpactFacade() {
        super(HemAvailabilityImpact.class);
    }

    @Override
    protected EntityManager getEntityManager() {
        return em;
    }

    /**
     * Get all the objects
     *
     * @return return the list of all objects
     */
    @Override
    public List<HemAvailabilityImpact> findAllOrderByLevel() {
        Query query = em.createNamedQuery("HemAvailabilityImpact.findAllOrderByLevel");
        return query.getResultList();
    }

    @Override
    public void create(HemAvailabilityImpact h, String username) {
        h.setCreatedBy(username);
        h.setCreatedDate(LocalDateTime.now());

        h.setLastModifiedBy(username);
        h.setLastModifiedDate(LocalDateTime.now());

        em.persist(h);
    }

    @Override
    public void edit(HemAvailabilityImpact h, String username) {
        h.setLastModifiedBy(username);
        h.setLastModifiedDate(LocalDateTime.now());

        em.merge(h);
    }

    @Override
    public void remove(HemAvailabilityImpact h, String username) {
        h.setArchived(true);
        h.setArchivedBy(username);
        h.setArchivedDate(LocalDateTime.now());

        edit(h);
    }
}
