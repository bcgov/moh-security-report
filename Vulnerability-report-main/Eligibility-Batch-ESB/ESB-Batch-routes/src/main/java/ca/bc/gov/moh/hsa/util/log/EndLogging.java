/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package ca.bc.gov.moh.hsa.util.log;

import ca.bc.gov.moh.hsa.esb.service.batch.HeaderConstants;
import org.apache.camel.Exchange;
import org.apache.camel.Processor;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;

/**
 * Processor to log values to the log file
 * @author greg.perkins
 */
@Component
public class EndLogging implements Processor {

    private static final org.slf4j.Logger logger = LoggerFactory.getLogger(EndLogging.class);
    
    /**
     * Write appropriate values to the log. 
     * Currently, just duration (to INFO)
     * and the response body (to DEBUG)
     * @param exchange Exchange
     * @throws Exception 
     */
    @Override
    public void process(Exchange exchange) throws Exception {
        Long startTime = (Long)exchange.getIn().getHeader(HeaderConstants.START_TIME);
        Long endTime = System.currentTimeMillis();
        
        if (startTime!=null){
            long duration = endTime - startTime;
            logger.info("Response generated in: "+duration+"ms");
        }
        
        Object body = exchange.getIn().getBody();
        String msg = body.toString();
        logger.debug(msg);
    }
    
}
