/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package ca.bc.gov.moh.hsa.esb.service.batch.dto;

import ca.bc.gov.moh.esb.common.entity.Author;
import ca.bc.gov.moh.esb.common.entity.CommunicationFunction;
import ca.bc.gov.moh.hsa.util.audit.AuditableMessage;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;

/**
 * Data Transfer Object for holding the POJO representation of a batch request
 * 
 * @author conrad.gustafson
 * @author greg.perkins
 */
public class BatchRequestDTO implements AuditableMessage, Serializable {
   
    /**
     * Individual Messages in the batch request.
     */
    private List<IndividualBatchRequestDTO> individualMessages = new ArrayList<IndividualBatchRequestDTO>();
    
    /**
     * Processing Mode (only I allowed)
     */
    private String modeCode;
    
    /**
     * Organization and Device that sent the request
     */ 
    private CommunicationFunction sender = new CommunicationFunction();
    private String organizationOid;    
    private String deviceOid;
    
    /**
     * Message IDs
     */
    private String getDemoId;
    private String getEligId;
    private String batchId;

    /* Getters and Setters */
    
    public List<IndividualBatchRequestDTO> getIndividualMessages() {
        return individualMessages;
    }

    public void setIndividualMessages(List<IndividualBatchRequestDTO> individualMessages) {
        this.individualMessages = individualMessages;
    }

    public String getModeCode() {
        return modeCode;
    }

    public void setModeCode(String modeCode) {
        this.modeCode = modeCode;
    }
    
    @Override
    public CommunicationFunction getSender() {
        return sender;
    }

    public String getOrganizationOid() {
        return organizationOid;
    }

    public void setOrganizationOid(String organizationOid) {
        this.organizationOid = organizationOid;
    }

    public String getDeviceOid() {
        return deviceOid;
    }

    public void setDeviceOid(String deviceOid) {
        this.deviceOid = deviceOid;
    }

    public String getGetDemoId() {
        return getDemoId;
    }

    public void setGetDemoId(String getDemoId) {
        this.getDemoId = getDemoId;
    }

    public String getGetEligId() {
        return getEligId;
    }

    public void setGetEligId(String getEligId) {
        this.getEligId = getEligId;
    }

    public String gettBatchId() {
        return batchId;
    }

    public void setBatchId(String getBatchId) {
        this.batchId = getBatchId;
    }

    @Override
    public String getMessageId() {
       return batchId;
    }
    
    /**
     * @return Author if message is GetDemo or GetElig otherwise null
     */
    @Override
    public Author getAuthor() {
        
        if (!this.individualMessages.isEmpty()) {
            for (IndividualBatchRequestDTO individualMessage : this.individualMessages) {
                if (individualMessage.getIsGetDemographics()) {
                    return individualMessage.getAuthor();
                }
            }
            //GetDemo has priority
            for (IndividualBatchRequestDTO individualMessage : this.individualMessages) {
                if (individualMessage.getIsGetEligibility()) {
                    return individualMessage.getAuthor();
                }
            }
        }
        
        return null;

    }
    @Override
    public String toString(){
        StringBuilder sb = new StringBuilder();
        for (IndividualBatchRequestDTO individualBatchRequestDTO : individualMessages) {
            sb.append(individualBatchRequestDTO.toString());
            sb.append("\n");
        }
        return sb.toString();
    }
    
}
