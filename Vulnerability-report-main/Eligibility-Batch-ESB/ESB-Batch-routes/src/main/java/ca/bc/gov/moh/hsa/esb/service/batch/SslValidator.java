/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ca.bc.gov.moh.hsa.esb.service.batch;

import ca.bc.gov.moh.hsa.esb.service.batch.HeaderConstants;
import ca.bc.gov.moh.hsa.esb.service.batch.dto.BatchRequestDTO;
import ca.bc.gov.moh.hsa.esb.service.batch.exception.BatchRequestBusinessValidationException;
import org.apache.camel.Exchange;
import org.apache.camel.Processor;
import org.springframework.stereotype.Component;

/**
 *  Validates that the cert matches the org in the message
 * @author greg.perkins
 */
@Component
public class SslValidator implements Processor {

    @Override
    public void process(Exchange exchange) throws Exception {
        String name = (String) exchange.getIn().getHeader(HeaderConstants.ORG_KEY);
        if (name != null) {
            BatchRequestDTO dto = exchange.getIn().getBody(BatchRequestDTO.class);
            if (!dto.getSender().getOrganization().equals(name)) {
                throw new BatchRequestBusinessValidationException(BatchRequestBusinessValidationException.ValidationErrorType.ORG_CERT_MISMATCH);
            }
        }
    }

}
